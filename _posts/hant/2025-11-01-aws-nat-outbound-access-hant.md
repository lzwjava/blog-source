---
audio: false
generated: true
image: false
lang: hant
layout: post
model: x-ai/grok-4-fast
title: AWS NAT 閘道出站存取解析
translated: true
type: note
---

### 釐清 AWS 中 NAT 的單向出站存取機制

沒錯，您的理解完全正確——這正是 AWS VPC 中 NAT 閘道運作的美妙之處（也是其安全特性）。讓我用您的範例逐步拆解說明，以確認您的理解。

#### 1. **NAT 對出站流量的「單向」特性**
   - **私有子網 → 公共網際網路（由私有端發起的出站流量）**：
     - 私有子網中的執行個體（例如 IP 為 10.0.1.10）可以向公共網際網路發起連線，例如進行軟體更新。這就是「僅可出站」或單向出站。
     - 範例：在私有子網中的 Ubuntu EC2 執行個體上執行 `apt install`。該執行個體會向 Ubuntu 的公共儲存庫（例如 archive.ubuntu.com）發起連線。NAT 閘道會將私有來源 IP 轉換為其公共 Elastic IP，發送請求，並將回應路由回原始執行個體。
     - 為何是單向？NAT 僅處理*由私有執行個體發起*的流量。它不會開啟連接埠或允許來自公共端的未經請求的入站連線。這使得私有子網得以「隱藏」並保持安全——這些執行個體沒有直接分配公共 IP。
   - **公共網際網路 → 私有子網（預設被封鎖的入站流量）**：
     - 公共網際網路無法直接存取私有子網。除非您明確配置，否則不會為入站流量設定任何路由或轉譯規則（詳見下文）。
     - 這可防止對您私有子網中的後端伺服器/資料庫進行攻擊或未經授權的存取。

#### 2. **軟體更新與公開應用服務的對比**
   - **軟體更新（由私有端發起的出站流量）**：
     - 正如您所說，這是私有執行個體自行更新——例如，`apt update && apt upgrade` 從公共儲存庫拉取套件，或從 Docker Hub 下載 Docker 映像。
     - 無需公開暴露：NAT 閘道會透明地處理轉譯。您的執行個體保持私有狀態，無法從外部進行掃描或探測。
   - **提供使用者存取的應用服務（需要公開暴露的入站流量）**：
     - 如果您運行的網路應用程式/伺服器需要讓使用者存取（例如透過 GET/POST 請求呼叫您的 API），情況則相反：公共端 → 您的伺服器（入站）。
     - 您*確實需要*公開暴露此服務，但並非將其置於私有子網中。常見的 AWS 設定方式：
       - 將應用伺服器置於**公共子網**中，並分配公共 IP 或 Elastic IP。
       - 在其前方使用**應用程式負載平衡器 (ALB)** 或**網路負載平衡器 (NLB)**——這些可以位於公共子網中，並將流量轉發到私有後端執行個體（例如自動擴展群組）。
       - 為了實現完整安全性：將敏感後端（資料庫、運算資源）保留在私有子網中，但使用負載平衡器代理請求。ALB 甚至可以強制實施 HTTPS 和 WAF 規則。
     - NAT 並不直接用於此入站情境；您會使用**網際網路閘道 (IGW)** 用於公共子網，或透過負載平衡器進行**連接埠轉發/DNAT 等效配置**。

#### 簡易架構範例（常見模式）
- **公共子網**：ALB（對網際網路公開）→ 將流量路由至...
- **私有子網**：您的應用伺服器/EC2 執行個體（處理請求，但無法被直接存取）。
- **NAT 閘道**：位於公共子網，允許私有執行個體擷取更新/推送日誌出站。
- 結果：使用者透過公共端點（例如 api.yourapp.com）存取您的應用，但內部資源受到保護。

這種設定具有良好的擴展性，並遵循 AWS 的安全最佳實踐（最小權限原則）。如果您在設定過程中遇到問題（例如路由表配置），請分享更多細節——我可以逐步指導您進行疑難排解！