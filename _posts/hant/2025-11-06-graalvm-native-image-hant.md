---
audio: false
generated: true
image: false
lang: hant
layout: post
model: x-ai/grok-4-fast
title: GraalVM 原生映像概覽
translated: true
type: note
---

### 什麼是 GraalVM 中的原生映像？

在 GraalVM 的介紹中，**原生映像**是指一項將 Java（或其他基於 JVM 的）應用程式進行預先編譯（AOT），生成獨立原生可執行檔的功能。這些可執行檔直接在宿主機器上運行，無需在運行時使用 Java 虛擬機（JVM）。本質上，這是將 Java 程式碼轉換為類似 C/C++ 原生二進位檔的方法，但源於高階語言如 Java、Kotlin 或 Scala。

#### 背後的關鍵技術
- **GraalVM 編譯器**：原生映像利用 GraalVM 編譯器（一種用於 JVM 的高級優化編譯器）進行靜態分析和 AOT 編譯。在構建過程中：
  1. **靜態分析**：掃描整個應用程式（包括依賴項），識別所有可達到的程式碼路徑、類別、方法及資源。這建立了「封閉世界」假設，在構建時解析動態行為。
  2. **部分評估**：編譯器預先對部分程式碼進行符號評估（例如反射、動態類別載入），並將其替換為優化的機器碼。
  3. **程式碼生成**：使用低階虛擬機（LLVM）或 SubstrateVM（GraalVM 的嵌入式 VM）生成原生可執行檔，以產生平台特定的二進位檔（例如適用於 Linux、Windows、macOS 甚至嵌入式系統）。
  
- **SubstrateVM**：這是原生映像底層的核心運行環境。它是一個輕量級、可嵌入的 VM，移除了 AOT 不需要的 JVM 功能（如即時編譯），並僅包含從應用程式中靜態連結的內容。

結果是一個自包含的二進位檔——無需外部 JVM，無需安裝 JRE。像 `native-image` CLI 或 Maven/Gradle 插件等工具負責處理構建過程。

#### 優勢與權衡
- **優點**：
  - **即時啟動**：啟動時間從秒級縮短至毫秒級（非常適合無伺服器/微服務）。
  - **低記憶體佔用**：通常僅為 JVM 使用量的十分之一。
  - **更小的部署體積**：單一檔案，無需處理類別路徑問題。
- **缺點**：
  - **構建時間**：對於大型應用程式，由於需要進行分析，可能耗時數分鐘至數小時。
  - **有限的動態功能**：如動態代理或晚期綁定反射等功能需要明確配置（透過元資料檔案）。
  - **平台特定性**：二進位檔與構建機器的作業系統/架構綁定。

這項技術在雲原生應用、容器（例如 Docker 映像小於 50MB）及邊緣計算中頗受歡迎。

更多詳細資訊，請查閱官方 GraalVM 文件：[GraalVM Native Image Guide](https://www.graalvm.org/latest/reference-manual/native-image/)。