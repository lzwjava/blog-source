---
audio: false
generated: true
lang: hant
layout: post
title: Google Docs 即時協作技術
translated: true
type: note
---

Google Docs 採用精密的**即時協作演算法**，讓多位使用者能同時編輯同一份文件。這項技術的核心基礎是**操作轉換（OT）**，後續更演進至在某些系統中整合**無衝突複製資料類型（CRDTs）**。以下將解析關鍵組成要素：

### 1. **操作轉換（OT）**
   - **核心概念**：透過將傳入操作對已執行操作進行轉換（調整），以解決編輯衝突。
   - **運作原理**：
     1. 當使用者進行編輯（例如插入文字），客戶端會生成**操作指令**（如 `insert("hello", pos=5)`）。
     2. 該指令會傳送至伺服器，伺服器將其與其他使用者的並行編輯進行**轉換調校**以維持一致性。
     3. 所有客戶端以確保最終一致性的方式套用操作指令。
   - **範例**：若使用者A在位置5插入「abc」，同時使用者B刪除位置5的內容，OT會將B的操作調整為刪除位置8（位於A插入內容之後）。
   - **挑戰**：OT需依賴中央伺服器管理轉換流程，實作複雜度較高。

### 2. **無衝突複製資料類型（CRDTs）**
   - **核心概念**：透過設計具數學收斂特性的資料結構，讓分散式系統無需中央伺服器即可合併編輯內容。
   - **運作原理**：
     1. 編輯動作會標記唯一識別符（如時間戳記或向量時鐘）。
     2. 系統運用數學特性（例如交換律、結合律運算）合併編輯內容。
   - **相較OT的優勢**：
     - 無需中央伺服器（支援點對點運作）
     - 離線編輯適應性更強
   - **範例**：CRDT可能採用分級索引（如 "A" < "A1" < "B"）取代傳統數字位置追蹤，避免衝突產生。

### 3. **Google的實作方式（Wave/OT混合架構）**
   - Google Docs最初基於**Google Wave的OT演算法**，該演算法擴充經典OT技術並具備：
     - **中央伺服器架構**：確保所有操作正確轉換
     - **差分同步機制**：最小化網路傳輸資料量
   - 後續Google很可能導入**類CRDT優化技術**以強化離線支援能力。

### 4. **其他關鍵技術**
   - **前後端同步**：採用 **WebSockets/長輪詢** 實現即時更新
   - **版本向量/邏輯時鐘**：追蹤編輯因果關係
   - **衝突解決機制**：當多位使用者同時編輯相同文字時，系統透過OT/CRDT規則解決衝突

### **OT與CRDT對照表**

| 特性                  | OT（經典版Google Docs） | CRDT（如Figma、Notion） |
|-----------------------|--------------------------|---------------------------|
| 需中央伺服器          | 是                       | 否（可實現點對點）        |
| 離線支援              | 有限                     | 更佳                      |
| 複雜度                | 高（轉換邏輯）           | 高（資料結構設計）        |
| 延遲表現              | 低（伺服器管理）         | 視實作方式而定            |

### **Google傾向採用OT（融合CRDT元素）的原因**
- OT特別適合Google Docs這類**集中式**服務
- CRDT雖在分散式應用（如**Figma、Apple Notes**）日趨普及，但Google基礎架構已針對OT深度優化

### **延伸閱讀**
- **OT論文**：[即時群組編輯器中的操作轉換](https://dl.acm.org/doi/10.1145/146486.146487)（Cormack等人著作）
- **CRDTs**：[CRDTs全面性研究](https://arxiv.org/abs/1805.06358)
- **Google Wave通訊協定**：[Wave通訊協定](https://wave-protocol.google.com/)

是否需要針對特定面向進行更深入的探討？