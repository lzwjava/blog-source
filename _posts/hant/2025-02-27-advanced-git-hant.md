---
audio: false
generated: true
lang: hant
layout: post
title: 進階 Git 指令
translated: true
type: note
---

Git 就像開發者的瑞士軍刀——功能多樣、威力強大，但若不清楚該使用哪種工具，偶爾也會讓人困惑。今天我們將深入探討 Git 一些最實用的功能與工作流程：精選提交變更、合併的風格選擇、重整基底以保持歷史清晰、刪除意外提交的龐大檔案，以及當發現提交偏離正軌時如何撤銷。讓我們逐一解析。

#### 精選提交：只擷取所需內容
假設你有一個包含十幾次提交的功能分支，但其中某個亮眼提交你只想單獨提取到主分支，而不想合併其他內容——這時就需要 `git cherry-pick`。

操作非常簡單：先找到提交的雜湊值（可透過 `git log` 獲取），切換至目標分支後執行：
```
git cherry-pick <commit-hash>
```
完成！該提交現已融入當前分支。若發生衝突，Git 會暫停操作讓你解決，就像合併時一樣。確認無誤後提交變更即可。

當錯誤修復程式意外混入凌亂的功能分支，而我需要立即將其部署至 `main` 分支時，經常使用此功能。但請注意：精選提交會複製提交內容並產生新雜湊值。若後續要合併原始分支，請先進行清理以免發生衝突。

#### 合併選項：不僅僅是「合併」
合併是 Git 的核心功能，但你知道它其實有多種模式嗎？預設的 `git merge` 會盡可能採用「快轉模式」（直接整合歷史），若分支已分岐則建立合併提交。但其實你還有其他選擇：

- **`--no-ff` (禁用快轉)**：即使可快轉仍強制建立合併提交。我偏好用此方式清晰記錄功能分支合併至 `main` 的時間點：
  ```
  git merge --no-ff feature-branch
  ```
- **`--squash`**：將分支所有變更壓縮為單一提交。不產生合併提交，只生成整潔的單次提交。最適合將雜亂分支整理為清爽版本：
  ```
  git merge --squash feature-branch
  ```
  執行後需手動提交完成最終流程。

每種方式各有適用場景：長期分支我傾向使用 `--no-ff`，而充滿「工作中」臨時提交的分支則適合用 `--squash` 整理。

#### 重整基底：專業級歷史改寫術
若覺得合併記錄過於雜亂，不妨試試 `git rebase`。它會將你的提交重新套用至另一分支，形成線性歷史軌跡，彷彿一切從開始就經過完美規劃。

切換到功能分支後執行：
```
git rebase main
```
Git 會先取下你的提交，將分支更新至與 `main` 同步，再重新套用你的變更。若出現衝突，解決後執行 `git rebase --continue` 直至完成。

優點？整潔的歷史線。缺點？若已推送分支且團隊成員正在使用，重整基底會改寫歷史——小心收到隊友的抱怨郵件。我僅在本地分支或個人專案使用重整基底，協作專案則採用更安全的合併方式。

#### 從歷史記錄刪除大型檔案：糟糕，那個 2GB 影片檔
大家都可能遇過這種狀況：意外提交巨型檔案並推送後，儲存庫變得臃腫不堪。Git 的記憶力絕佳，但我們仍可透過特殊工具清理歷史記錄。

經典工具是 `git filter-branch`，但更推薦新一代的 `git filter-repo`（速度更快且更不易出錯）。假設需要清除已提交的 `bigfile.zip`：
1. 安裝 `git-filter-repo`（請參閱官方文件）
2. 執行：
   ```
   git filter-repo --path bigfile.zip --invert-paths
   ```
   此指令將從所有歷史提交中移除 `bigfile.zip`
3. 強制推送改寫後的歷史：
   ```
   git push --force
   ```

注意：此操作將改寫歷史，請務必與團隊協調。若存在於提取請求中，可能還需清理參照。完成清除後，執行垃圾收集（`git gc`）即可讓儲存庫恢復精簡。

#### 撤銷提交：時光倒流術
剛提交就後悔？Git 能拯救你。根據操作進度有不同解決方案：

- **尚未推送時**：使用 `git reset」。要撤銷最近提交但保留工作目錄變更：
  ```
  git reset HEAD^ --soft
  ```
  若想完全捨棄變更：
  ```
  git reset HEAD^ --hard
  ```
- **已推送時**：需改寫歷史。先在本地重置 `git reset HEAD^」，再強制推送：
  ```
  git push --force
  ```
  再次提醒，這會影響共享歷史，請謹慎操作。

我透過 `git reset --soft` 自救的次數不勝枚舉——特別適合處理提前提交卻需要微調的狀況。

#### 總結

Git 的靈活性正是其強大之處，但若不熟悉選項很容易陷入混亂。精選提交實現精準移植、調整合併模式適應工作流程、重整基底打造完美歷史，遇到失誤時也無需驚慌——無論是巨型檔案或倉促提交都能補救。若感到不安，先在測試儲存庫練習這些技巧，很快你就能運用自如。

你最喜愛的 Git 技巧是什麼？歡迎分享——我始終熱衷學習新方法！