---
audio: false
generated: true
image: false
lang: hant
layout: post
title: Spring Batch 作業執行指南
translated: true
type: note
---

Spring Batch 是 Spring 生態系統中的輕量級開源框架，專為**批次處理**而設計 — 以可靠且可擴展的方式執行涉及讀取、處理和寫入大量資料的工作。

以下是 Spring Batch 工作運作方式的全面解析：

---

## 1. 核心概念

* **工作 (Job)**  
  工作是最高層級的實體。它代表整個批次處理過程，由一個或多個步驟組成。

* **步驟 (Step)**  
  每個步驟代表工作中的一個階段（例如：讀取 → 處理 → 寫入）。步驟可以是分塊導向 (chunk-oriented) 或任務導向 (tasklet-oriented)。

* **工作啟動器 (JobLauncher)**  
  負責啟動工作的元件，通常透過程式碼、排程器（Quartz、cron）或命令列觸發。

* **工作儲存庫 (JobRepository)**  
  基於資料庫的儲存庫，保存有關工作執行的元資料，例如狀態、開始/結束時間、退出碼和重啟點。

* **工作執行與步驟執行 (JobExecution & StepExecution)**  
  代表工作及其步驟的運行時狀態，包括成功、失敗或部分完成。

---

## 2. 執行流程

1. **工作啟動**  
   `JobLauncher` 透過傳遞 `Job` 實例和 `JobParameters` 來啟動工作。

2. **工作實例與元資料**  
   框架檢查 `JobRepository` 以查看具有這些參數的工作實例是否已存在。

   * 如果存在，可能會繼續/重啟。
   * 如果不存在，則創建新實例。

3. **步驟執行**  
   每個步驟按順序運行（除非配置了平行流程）。

   * 如果一個步驟失敗且未設置為「允許重啟」，則工作停止。
   * 否則，工作繼續到下一個步驟。

4. **分塊導向處理**（最常見）

   * **讀取器 (Reader)**：讀取一個資料塊（例如從檔案/資料庫讀取 100 條記錄）。
   * **處理器 (Processor)**：可選地轉換或驗證資料。
   * **寫入器 (Writer)**：將處理後的資料塊寫入目標（例如資料庫、檔案、API）。
   * 提交後，Spring Batch 將檢查點保存在 `JobRepository` 中。

5. **容錯能力**

   * 內建重試邏輯、跳過策略和重啟功能。
   * 如果工作崩潰，可以從最後提交的檢查點重啟。

---

## 3. 範例

設想處理一個交易記錄的 CSV 檔案：

* **讀取器**：`FlatFileItemReader` 從 CSV 載入行。
* **處理器**：自訂類別驗證並將其轉換為領域物件。
* **寫入器**：`JdbcBatchItemWriter` 以批次方式將其插入資料庫。
* **工作流程**：

  * 步驟 1：讀取/處理/寫入交易記錄。
  * 步驟 2：生成摘要報告。

---

## 4. 優勢

* 聲明式配置（Java 配置或 XML）。
* 可擴展（平行步驟、分區、遠程分塊）。
* 強大的錯誤處理和重啟能力。
* 與 Spring 生態系統整合（Spring Boot、Spring Data 等）。

---

✅ 簡而言之：**Spring Batch 工作是一個結構良好的步驟管道，資料從輸入 → 處理 → 輸出流動，具有內建的事務管理、容錯能力和重啟功能。**

---

您是否希望我也展示一個 Spring Batch 工作的**最小 Java 配置程式碼範例**（包含讀取器、處理器、寫入器），以便您了解其實際運作方式？