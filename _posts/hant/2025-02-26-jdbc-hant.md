---
audio: false
generated: true
lang: hant
layout: post
title: 使用JDBC驅動程式
translated: true
type: note
---

要在 Java 中使用 JDBC（Java 資料庫連接）驅動程式，您需要按照一系列步驟來建立資料庫連接、執行查詢並處理結果。以下我將以清晰實用的方式逐步引導您完成整個流程。

### 步驟 1：將 JDBC 驅動程式加入專案
首先，您需要取得適用於您所用資料庫（例如 MySQL、PostgreSQL、Oracle 等）的 JDBC 驅動程式。各家資料庫廠商都會提供自家的驅動程式。

- **Maven 專案**：
  將相依性加入您的 `pom.xml`。以 MySQL 為例：
  ```xml
  <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.33</version> <!-- 請檢查最新版本 -->
  </dependency>
  ```
  以 PostgreSQL 為例：
  ```xml
  <dependency>
      <groupId>org.postgresql</groupId>
      <artifactId>postgresql</artifactId>
      <version>42.7.3</version> <!-- 請檢查最新版本 -->
  </dependency>
  ```

- **非 Maven 專案**：
  從廠商網站（例如 mysql.com 的 MySQL Connector/J）下載 JDBC 驅動程式 JAR 檔，並手動將其加入專案的 classpath。

### 步驟 2：載入 JDBC 驅動程式
在舊版 Java（JDBC 4.0 之前）中，您必須使用 `Class.forName()` 明確載入驅動程式。現代的 JDBC 驅動程式（JDBC 4.0+）已透過服務提供者機制自動註冊，此步驟可省略。但為了清晰起見，以下說明其運作方式：

```java
try {
    Class.forName("com.mysql.cj.jdbc.Driver"); // MySQL 範例
    // PostgreSQL：Class.forName("org.postgresql.Driver");
} catch (ClassNotFoundException e) {
    e.printStackTrace();
}
```

### 步驟 3：建立連接
使用 `DriverManager` 類別，透過提供連接 URL、使用者名稱和密碼來連接資料庫。URL 格式依資料庫而異。

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase"; // MySQL 範例
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            System.out.println("已連接至資料庫！");
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

- **URL 範例**：
  - MySQL：`jdbc:mysql://localhost:3306/mydatabase?useSSL=false`
  - PostgreSQL：`jdbc:postgresql://localhost:5432/mydatabase`
  - Oracle：`jdbc:oracle:thin:@localhost:1521:xe`

### 步驟 4：建立陳述式並執行查詢
連接成功後，您可以使用 `Statement`、`PreparedStatement`（建議用於參數化查詢）或 `CallableStatement`（用於預存程序）來執行 SQL 查詢。

#### 簡單查詢範例：
```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase";
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            Statement statement = connection.createStatement();
            ResultSet resultSet = statement.executeQuery("SELECT * FROM users");

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", 名稱: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

#### 使用 PreparedStatement 範例（對使用者輸入更安全）：
```java
try (Connection connection = DriverManager.getConnection(url, username, password)) {
    String sql = "SELECT * FROM users WHERE id = ?";
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.setInt(1, 5); // 設定參數值
    ResultSet resultSet = preparedStatement.executeQuery();

    while (resultSet.next()) {
        System.out.println("ID: " + resultSet.getInt("id") + ", 名稱: " + resultSet.getString("name"));
    }
} catch (SQLException e) {
    e.printStackTrace();
}
```

### 步驟 5：關閉資源
務必關閉您的 `ResultSet`、`Statement` 和 `Connection` 物件以釋放資源。使用 try-with-resources（如上所示）會自動為您處理此步驟。

### 完整可運作範例（MySQL）
以下是一個完整範例，假設 `users` 資料表包含 `id`（int）和 `name`（varchar）欄位：

```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase?useSSL=false";
        String username = "root";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            String sql = "SELECT * FROM users WHERE id = ?";
            PreparedStatement preparedStatement = connection.prepareStatement(sql);
            preparedStatement.setInt(1, 1);
            ResultSet resultSet = preparedStatement.executeQuery();

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", 名稱: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

### 關鍵提示
- **錯誤處理**：務必捕捉 `SQLException` 以處理資料庫相關錯誤。
- **相依性**：確保 JDBC 驅動程式版本與您的資料庫版本相符。
- **安全性**：對包含使用者輸入的查詢使用 `PreparedStatement` 以防止 SQL 注入攻擊。
- **連接池**：在生產環境應用中，考慮使用連接池（例如 HikariCP）替代 `DriverManager`。

如果您需要針對特定資料庫或更進階的使用案例提供協助，請隨時告訴我！