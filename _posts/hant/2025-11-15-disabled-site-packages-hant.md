---
audio: false
generated: true
image: false
lang: hant
layout: post
model: x-ai/grok-4-fast
title: Python 使用者網站套件已停用
translated: true
type: note
---

該套件**已安裝**在你的用戶目錄中（`~/.local/lib/python3.13/site-packages`），但當你執行 `python3 ./scripts/train/extract_wiki.py` 時，Python 卻**沒有搜尋用戶 site-packages 目錄**，原因不明。

這是 Python 3.11+ 在許多 Linux 發行版（Ubuntu 22.04/24.04、Debian、Arch 等）上非常常見的問題，因為系統套件管理員通常會將環境變數 `PYTHONNOUSERSITE=1` 設為預設，或啟用 `-I`（隔離）標記，這會**完全停用用戶 site-packages 路徑**。

### 快速驗證問題的方法

執行以下兩條指令：

```bash
python3 -c "import sys, pathlib; print('user site:', pathlib.Path(sys.path[-1]).resolve() if 'site-packages' in sys.path[-1] else 'DISABLED')"
python3 -c "import site; print(site.ENABLE_USER_SITE)"
```

如果你看到 `DISABLED` 或 `False` 或 `None`，那就正是此問題。

### 解決方案（擇一使用）

#### 選項 1 – 使用 `python3 -m pip` 並以相同 Python 執行（推薦）

```bash
# 始終使用模組形式，以確保安裝到正確的 Python 環境
python3 -m pip install --user --upgrade mediawiki-dump

# 然後以相同 Python 執行腳本
python3 ./scripts/train/extract_wiki.py
```

如果仍然失敗，強制啟用用戶 site：

```bash
python3 -s ./scripts/train/extract_wiki.py
# 或
PYTHONNOUSERSITE=0 python3 ./scripts/train/extract_wiki.py
```

#### 選項 2 – 使用虛擬環境（這是最佳實踐）

```bash
cd /home/lzw/projects/blog-source
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install mediawiki-dump   # 將安裝到虛擬環境中，無權限問題
python ./scripts/train/extract_wiki.py   # 現在肯定能找到套件
```

#### 選項 3 – 強制永久啟用用戶 site（不建議用於系統 Python）

將以下內容加入你的 `~/.bashrc` 或 `~/.zshrc`：

```bash
export PYTHONNOUSERSITE=
```

或建立 `~/.config/pythonstartup.py` 並寫入：

```python
import site
import os
os.environ["PYTHONNOUSERSITE"] = ""
```

### 快速單行測試

直接在當前 shell 中執行：

```bash
python3 -s -c "from mediawiki_dump.tokenizer import WikiTokenizer; print('Works!')"
```

如果顯示 "Works!"，則只需始終使用 `python3 -s` 或建立虛擬環境即可解決。

建議採用虛擬環境方案（選項 2）——這將為你避免無數其他套件帶來的困擾。如果之後遇到任何新錯誤，請告訴我！