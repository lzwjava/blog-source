---
audio: true
lang: hant
layout: post
title: 無線橋接配置 OpenWRT
translated: true
---

要解答你的查詢，關於配置 OpenWRT 作為無線橋接器的步驟是否正確，並提供正確的方法來實現這一點，我將評估你提供的步驟，並根據 OpenWRT 的最佳實踐來進行修正。你的目標是設置你的 OpenWRT 路由器（例如，搭載 OpenWRT 24.10.0 的小米路由器 4C）作為無線橋接器——無線連接到現有的 Wi-Fi 網絡作為客戶端，並通過其自己的 Wi-Fi 訪問點（AP）或以太網端口共享該連接，使所有設備與主路由器在同一子網中。

你提供的步驟大致正確，但缺少一個關鍵調整，以確保正確的橋接並避免 IP 衝突。以下，我將首先評估你的配置，然後提出正確的完整步驟來實現 OpenWRT 的無線橋接，使用簡單橋接方法（客戶端 + AP 在同一橋接中），這與你的意圖一致。我還將簡要提及使用 `relayd` 的替代方法，以應對簡單方法失敗的情況，儘管你的設置可能支持更簡單的方法。

---

### **評估你提供的步驟**

你的步驟旨在：
1. 將 OpenWRT 路由器連接到現有的 Wi-Fi 網絡作為客戶端。
2. 設置一個 AP 來廣播新的 Wi-Fi 網絡。
3. 將客戶端和 AP 接口橋接以共享互聯網。

這裡有一個快速回顧：
- **步驟 1：登錄到 LuCI** - 正確，訪問網絡界面是起點。
- **步驟 2：配置無線客戶端** - 加入目標 Wi-Fi 並將其分配到 `lan` 網絡是一個好開始，但 OpenWRT 的默認 `lan` 配置（靜態 IP，通常是 192.168.1.1）如果主路由器也使用相同的 IP，可能會發生衝突。這需要調整。
- **步驟 3：配置無線 AP** - 設置 AP 並將其分配到 `lan` 是正確的橋接，但依賴於 `lan` 接口被正確配置。
- **步驟 4：橋接網絡** - 將兩個接口分配給 `lan` 理論上會橋接它們，但如果不禁用 DHCP 服務器或調整 IP 設置，可能無法順利運行。
- **步驟 5：測試設置** - 測試是必要的，但成功取決於前面的步驟是否完全正確。

**缺少或錯誤的內容？**
- 默認情況下，OpenWRT 的 `lan` 接口具有靜態 IP（例如，192.168.1.1）並運行 DHCP 服務器。如果主路由器也是 192.168.1.1，這將導致 IP 衝突。你需要將 `lan` 接口設置為 DHCP 客戶端模式以從主路由器獲取 IP，並禁用本地 DHCP 服務器，讓主路由器為所有設備分配 IP。
- `lan` 的防火牆區域分配對於簡化流量規則是可以的，但 IP 配置是關鍵。

考慮到這些，你的步驟是「大致正確」但不完整，未調整 `lan` 接口設置。以下是修正後的步驟。

---

### **正確步驟配置 OpenWRT 作為無線橋接器（簡單橋接方法）**

這種方法將你的 OpenWRT 路由器設置為連接到現有 Wi-Fi 網絡作為客戶端，並通過其自己的 AP 或以太網端口共享該連接，所有設備都在與主路由器相同的子網中（例如，192.168.1.x）。這是如何通過 LuCI 網絡界面完成的：

#### **先決條件**
- 安裝 OpenWRT（例如，版本 24.10.0 在小米路由器 4C 上）。
- 擁有主 Wi-Fi 網絡的 SSID、密碼和加密類型（例如，WPA2-PSK）。
- 訪問 LuCI 於 `http://192.168.1.1`（或當前 IP）和你的管理員憑證。

#### **步驟 1：登錄到 LuCI**
- 打開瀏覽器並導航到 `http://192.168.1.1`。
- 使用你的 OpenWRT 用戶名（默認：`root`）和密碼（安裝時設置）登錄。

#### **步驟 2：配置無線客戶端**
- **導航到無線設置：**
  - 轉到 **網絡 > 無線**。
- **掃描網絡：**
  - 找到你的無線電（例如，`radio0` 為 2.4 GHz 在 Mi 路由器 4C 上）。
  - 點擊 **掃描** 以列出可用的 Wi-Fi 網絡。
- **加入主 Wi-Fi 網絡：**
  - 找到主路由器 Wi-Fi 的 SSID。
  - 點擊 **加入網絡**。
- **配置客戶端設置：**
  - **Wi-Fi 密鑰：** 输入主 Wi-Fi 的密碼。
  - **網絡：** 選擇或設置為 `lan`（這將客戶端接口添加到 `br-lan` 橋接）。
  - **防火牆區域：** 分配到 `lan`（這簡化了橋接的流量規則）。
  - **接口名稱：** LuCI 可能建議 `wwan`；你可以保留它或重命名為 `client` 以便於理解，但確保它與 `lan` 綁定。
- **保存並應用：**
  - 點擊 **保存並應用** 以連接到主 Wi-Fi。

#### **步驟 3：調整 LAN 接口為 DHCP 客戶端**
- **轉到接口：**
  - 導航到 **網絡 > 接口**。
- **編輯 LAN 接口：**
  - 點擊 `lan` 接口旁邊的 **編輯**。
- **將協議設置為 DHCP 客戶端：**
  - 在 **協議** 下拉菜單中，選擇 **DHCP 客戶端**。
  - 這允許 `br-lan` 橋接（現在包括無線客戶端）從主路由器的 DHCP 服務器獲取 IP 地址（例如，192.168.1.x）。
- **禁用 DHCP 服務器：**
  - 由於 `lan` 現在是 DHCP 客戶端，本地 DHCP 服務器會自動禁用。在 **高級設置** 或 **DHCP 和 DNS** 下驗證這一點——確保勾選了“忽略接口”選項（如果該選項出現）。
- **保存並應用：**
  - 點擊 **保存並應用**。路由器現在將從主路由器請求 IP。

#### **步驟 4：配置無線訪問點**
- **添加新的無線網絡：**
  - 返回 **網絡 > 無線**。
  - 點擊同一無線電（例如，`radio0`）下的 **添加** 以創建新的無線接口。
- **設置 AP：**
  - **ESSID：** 為你的 Wi-Fi 選擇一個名稱（例如，`OpenWRT_AP`）。
  - **模式：** 設置為 **訪問點（AP）**。
  - **網絡：** 分配到 `lan`（這將其與客戶端接口和以太網端口橋接）。
- **配置安全性：**
  - 轉到 **無線安全性** 選項卡。
  - **加密：** 選擇 **WPA2-PSK**（推薦）。
  - **密鑰：** 為你的 AP 設置一個強密碼。
- **保存並應用：**
  - 點擊 **保存並應用**。你的路由器現在將廣播自己的 Wi-Fi。

#### **步驟 5：驗證橋接**
- **檢查接口：**
  - 轉到 **網絡 > 接口**。
  - 確保 `lan` 接口列出了無線客戶端（例如，`wlan0`）和 AP（例如，`wlan0-1`）在 `br-lan` 橋接下。
- **檢查 IP 分配：**
  - 轉到 **狀態 > 概覽**。
  - 記下 `lan` 接口由主路由器分配的 IP 地址（例如，`192.168.1.100`）。

#### **步驟 6：測試設置**
- **測試 Wi-Fi：**
  - 將一個設備連接到 `OpenWRT_AP` Wi-Fi。
  - 驗證它是否從主路由器（例如，`192.168.1.x`）獲取 IP 並具有互聯網訪問。
- **測試以太網（如果適用）：**
  - 將一個設備插入路由器的 LAN 端口。
  - 確認它從主路由器獲取 IP 並連接到互聯網。
- **訪問 LuCI：**
  - 使用新的 IP 地址（例如，`http://192.168.1.100`）訪問 OpenWRT 界面。

---

### **為什麼這樣有效**
- 將客戶端和 AP 接口分配給 `lan` 網絡將它們添加到 `br-lan` 橋接，允許層 2 流量在它們和主路由器之間流動。
- 將 `lan` 設置為 DHCP 客戶端確保 OpenWRT 路由器從主路由器獲取唯一 IP，避免衝突（例如，與 `192.168.1.1`），並禁用本地 DHCP 服務器，使主路由器管理所有 IP 分配。
- 連接到 AP 或以太網端口的設備出現在與主網絡相同的子網中（例如，`192.168.1.x`），滿足無線橋接要求。

---

### **替代方法：使用 relayd（偽橋接）**
如果簡單橋接方法失敗（例如，由於無線驅動程序限制），你可以使用 `relayd` 套件進行偽橋接。這創建了一個路由設置，其中 OpenWRT 路由器的客戶端在不同的子網中，但在某些硬件上更可靠。這裡有一個簡要概述：

1. **安裝 relayd：**
   - 轉到 **系統 > 軟件**，搜索 `relayd` 並安裝它。
2. **配置無線客戶端：**
   - 加入主 Wi-Fi，但將其分配到新接口（例如，`wwan`）設置為 DHCP 客戶端。
3. **配置 LAN：**
   - 將 `lan` 設置為靜態 IP（例如，`192.168.2.1`）並具有自己的 DHCP 服務器。
4. **設置 relayd：**
   - 通過 SSH 或 LuCI（在 **網絡 > 主機名** 下）配置 `relayd` 以在 `wwan` 和 `lan` 之間中繼。
5. **配置 AP：**
   - 將 AP 設置在 `lan` 網絡上。
6. **測試：**
   - `OpenWRT_AP` 上的設備將在 `192.168.2.x`，互聯網從主路由器中繼。

**注意：** 這不是真正的橋接（不同子網），因此僅在簡單方法無法工作時使用。對於搭載 OpenWRT 24.10.0 的小米路由器 4C，簡單橋接應該足夠。

---

### **結論**
你的原始步驟是 **大致正確** 但不完整，未將 `lan` 接口設置為 DHCP 客戶端模式以避免 IP 衝突並確保正確的橋接。上述修正後的步驟提供了一種可靠的方法來配置 OpenWRT 作為無線橋接器。如果你遵循它們，你的路由器將連接到主 Wi-Fi 並通過其 AP 或以太網端口無縫共享該連接，所有設備都在同一子網中。測試設置，如果出現問題（現代 OpenWRT 中很少見），考慮 `relayd` 替代方案。