---
audio: false
generated: true
image: false
lang: hant
layout: post
title: 配置 OpenWRT 為無線橋接器
translated: true
type: note
---

在 Grok 的協助下，我仍在努力處理以下事項。

---

為了解決您關於「步驟是否正確？」的疑問，並提供實現此目標的正確方法，我將評估您提供的步驟，並根據 OpenWRT 的最佳實踐進行改進。您的目標是將 OpenWRT 路由器（例如刷了 OpenWRT 24.10.0 的小米路由器 4C）設置為無線橋接——以客戶端模式無線連接到現有的 Wi-Fi 網絡，並通過其自身的 Wi-Fi 接入點或乙太網端口共享該連接，使所有設備都位於主路由器的同一子網內。

您提供的步驟大部分是正確的，但缺少一個關鍵調整以確保正確的橋接並避免 IP 衝突。下面，我將首先評估您的配置，然後呈現正確、完整的步驟，以使用簡單橋接方法（客戶端和 AP 位於同一橋接上）在 OpenWRT 中實現無線橋接，這符合您的意圖。如果簡單方法失敗，我也會簡要提及使用 `relayd` 的替代方案，不過您的設置很可能支持更簡單的方法。

---

### **對您提供步驟的評估**

您的步驟旨在：
1.  將 OpenWRT 路由器作為客戶端連接到現有的 Wi-Fi 網絡。
2.  設置一個 AP 來廣播新的 Wi-Fi 網絡。
3.  橋接客戶端和 AP 接口以共享網路。

以下是簡要回顧：
- **步驟 1：登入 LuCI** - 正確，訪問網頁界面是第一步。
- **步驟 2：配置無線客戶端** - 加入目標 Wi-Fi 並將其分配給 `lan` 網絡是一個好的開始，但如果主路由器使用相同的 IP，OpenWRT 中默認的 `lan` 配置（靜態 IP，通常為 192.168.1.1）可能會與主路由器衝突。這需要調整。
- **步驟 3：配置無線 AP** - 設置 AP 並將其分配給 `lan` 對於橋接是正確的，但依賴於 `lan` 接口被正確配置。
- **步驟 4：橋接網絡** - 將兩個接口都分配給 `lan` 在理論上橋接了它們，但如果不禁用 DHCP 伺服器或調整 IP 設置，可能無法無縫工作。
- **步驟 5：測試設置** - 測試是必要的，但成功與否取決於之前的步驟是否完全正確。

**缺少或錯誤的是什麼？**
- 默認情況下，OpenWRT 的 `lan` 接口具有靜態 IP（例如 192.168.1.1）並運行 DHCP 伺服器。如果主路由器也是 192.168.1.1，這會導致 IP 衝突。您需要將 `lan` 接口設置為 DHCP 客戶端模式，以從主路由器獲取 IP，並禁用本地 DHCP 伺服器，讓主路由器為所有設備分配 IP。
- 將防火牆區域分配給 `lan` 對於簡化操作是可以的，但 IP 配置至關重要。

考慮到這一點，您的步驟「大部分是正確的」，但如果不調整 `lan` 接口設置，則不完整。以下是修正後的步驟。

---

### **將 OpenWRT 配置為無線橋接的正確步驟（簡單橋接方法）**

此方法設置您的 OpenWRT 路由器以客戶端模式連接到現有的 Wi-Fi 網絡，並通過其自身的 AP 或乙太網端口共享該連接，所有設備都位於與主路由器相同的子網內（例如 192.168.1.x）。以下是通過 LuCI 網頁界面操作的方法：

#### **先決條件**
- 已安裝 OpenWRT（例如，小米路由器 4C 上的版本 24.10.0）。
- 您擁有主 Wi-Fi 網絡的 SSID、密碼和加密類型（例如 WPA2-PSK）。
- 可以訪問 LuCI（網址為 `http://192.168.1.1` 或當前 IP）以及您的管理員憑證。

#### **步驟 1：登入 LuCI**
- 打開瀏覽器並導航至 `http://192.168.1.1`。
- 使用您的 OpenWRT 用戶名（默認：`root`）和密碼（在安裝過程中設置）登入。

#### **步驟 2：配置無線客戶端**
- **導航至無線設置：**
  - 前往 **Network > Wireless**。
- **掃描網絡：**
  - 找到您的無線電（例如，小米路由器 4C 上的 2.4 GHz `radio0`）。
  - 點擊 **Scan** 以列出可用的 Wi-Fi 網絡。
- **加入主 Wi-Fi 網絡：**
  - 找到您主路由器 Wi-Fi 的 SSID。
  - 點擊 **Join Network**。
- **配置客戶端設置：**
  - **Wi-Fi Key：** 輸入主 Wi-Fi 的密碼。
  - **Network：** 選擇或設置為 `lan`（這會將客戶端接口添加到 `br-lan` 橋接）。
  - **Firewall Zone：** 分配給 `lan`（這簡化了橋接的流量規則）。
  - **Interface Name：** LuCI 可能會建議 `wwan`；您可以保留它或為了清晰起見將其重命名為 `client`，但要確保它與 `lan` 綁定。
- **保存並應用：**
  - 點擊 **Save & Apply** 以連接到主 Wi-Fi。

#### **步驟 3：將 LAN 接口調整為 DHCP 客戶端**
- **前往接口：**
  - 導航至 **Network > Interfaces**。
- **編輯 LAN 接口：**
  - 點擊 `lan` 接口旁邊的 **Edit**。
- **將協議設置為 DHCP 客戶端：**
  - 在 **Protocol** 下拉選單中，選擇 **DHCP client**。
  - 這允許 `br-lan` 橋接（現在包含無線客戶端）從主路由器的 DHCP 伺服器獲取 IP 地址（例如 192.168.1.x）。
- **禁用 DHCP 伺服器：**
  - 由於 `lan` 現在是 DHCP 客戶端，本地 DHCP 伺服器會自動禁用。在 **Advanced Settings** 或 **DHCP and DNS** 下驗證——如果出現「Ignore interface」選項，請確保其被勾選。
- **保存並應用：**
  - 點擊 **Save & Apply**。路由器現在將向主路由器請求 IP。

#### **步驟 4：配置無線接入點**
- **添加新的無線網絡：**
  - 返回 **Network > Wireless**。
  - 在同一無線電（例如 `radio0`）下點擊 **Add** 以創建新的無線接口。
- **設置 AP：**
  - **ESSID：** 為您的 Wi-Fi 選擇一個名稱（例如 `OpenWRT_AP`）。
  - **Mode：** 設置為 **Access Point (AP)**。
  - **Network：** 分配給 `lan`（這將其與客戶端接口和乙太網端口橋接）。
- **配置安全性：**
  - 轉到 **Wireless Security** 選項卡。
  - **Encryption：** 選擇 **WPA2-PSK**（推薦）。
  - **Key：** 為您的 AP 設置一個強密碼。
- **保存並應用：**
  - 點擊 **Save & Apply**。您的路由器現在將廣播其自身的 Wi-Fi。

#### **步驟 5：驗證橋接**
- **檢查接口：**
  - 前往 **Network > Interfaces**。
  - 確保 `lan` 接口在 `br-lan` 橋接下列出了無線客戶端（例如 `wlan0`）和 AP（例如 `wlan0-1`）。
- **檢查 IP 分配：**
  - 前往 **Status > Overview**。
  - 記下主路由器分配給 `lan` 接口的 IP 地址（例如 `192.168.1.100`）。

#### **步驟 6：測試設置**
- **測試 Wi-Fi：**
  - 將設備連接到 `OpenWRT_AP` Wi-Fi。
  - 驗證它是否從主路由器獲取 IP（例如 `192.168.1.x`）並具有網路訪問權限。
- **測試乙太網（如果適用）：**
  - 將設備插入路由器的一個 LAN 端口。
  - 確認它從主路由器獲取 IP 並連接到網路。
- **訪問 LuCI：**
  - 使用新的 IP 地址（例如 `http://192.168.1.100`）訪問 OpenWRT 界面。

---

### **為什麼這能工作**
- 將客戶端和 AP 接口都分配給 `lan` 網絡會將它們添加到 `br-lan` 橋接，允許第 2 層流量在它們與主路由器之間流動。
- 將 `lan` 設置為 DHCP 客戶端可確保 OpenWRT 路由器從主路由器獲取唯一的 IP，避免衝突（例如與 `192.168.1.1`），並禁用本地 DHCP 伺服器，讓主路由器管理所有 IP 分配。
- 連接到 AP 或乙太網端口的設備將出現在與主網絡相同的子網上（例如 `192.168.1.x`），滿足了無線橋接的要求。

---

### **替代方法：使用 relayd（偽橋接）**
如果簡單橋接方法失敗（例如，由於無線驅動程式限制），您可以使用 `relayd` 套件進行偽橋接。這會創建一個路由設置，其中 OpenWRT 路由器的客戶端位於不同的子網上，但在某些硬體上更可靠。以下是簡要概述：

1.  **安裝 relayd：**
    - 前往 **System > Software**，搜索 `relayd` 並安裝它。
2.  **配置無線客戶端：**
    - 加入主 Wi-Fi，但將其分配給一個設置為 DHCP 客戶端的新接口（例如 `wwan`）。
3.  **配置 LAN：**
    - 將 `lan` 設置為靜態 IP（例如 `192.168.2.1`）並運行其自身的 DHCP 伺服器。
4.  **設置 relayd：**
    - 通過 SSH 或 LuCI（在 **Network > Hostnames** 下）配置 `relayd` 以在 `wwan` 和 `lan` 之間進行中繼。
5.  **配置 AP：**
    - 在 `lan` 網絡上設置 AP。
6.  **測試：**
    - `OpenWRT_AP` 上的設備將位於 `192.168.2.x`，網路通過主路由器中繼。

**注意：** 這不是真正的橋接（不同子網），因此僅在簡單方法無效時使用。對於您刷了 OpenWRT 24.10.0 的小米路由器 4C，簡單橋接方法應該足夠。

---

### **結論**
您原始的步驟**大部分正確**，但如果不將 `lan` 接口設置為 DHCP 客戶端模式以避免 IP 衝突並確保正確橋接，則不完整。上面修正後的步驟提供了一種可靠的方法來將 OpenWRT 配置為無線橋接。如果您遵循這些步驟，您的路由器將連接到主 Wi-Fi 並通過其 AP 或乙太網端口無縫共享該連接，所有設備都在同一子網內。測試設置，如果出現問題（在現代 OpenWRT 中很少見），請考慮 `relayd` 替代方案。