---
audio: false
generated: true
lang: hant
layout: post
title: PingCAP 與 Cloudflare 讚譽 Go 語言
translated: true
type: note
---

無論是 PingCAP 還是 Cloudflare，都未曾對使用 Go 語言表達過「遺憾」。事實上，這兩家公司都曾公開讚揚 Go 語言的優勢，並持續在其核心產品中廣泛使用。不過他們在語言選擇上也秉持務實態度，會在特定場景下選用更合適的程式語言。

具體分析如下：

### PingCAP（TiDB）與 Go

* **並無遺憾**：PingCAP 選擇使用 Go 開發 TiDB 的 SQL 層（`tidb-server`），正是看中其卓越的並行處理模型（goroutine 與 channel）、開發便捷性以及強大的標準函式庫。這些特性幫助他們以相對較快的速度建構出複雜的分散式資料庫系統。
* **正視挑戰**：雖然 Go 是 TiDB 的核心語言，但 PingCAP 對其挑戰保持高度透明，尤其關於垃圾回收機制。其技術文件和部落格經常探討：
    * **GC 暫停**：他們承認即使短暫的 GC 暫停也可能在高效能資料庫中引發延遲抖動，因此透過調校 `GOGC`、`GOMEMLIMIT` 參數與實作自適應 GC 觸發機制來積極緩解此問題
    * **記憶體管理**：他們提供詳盡的記憶體監控指南與 OOM 問題排查方案，正視 Go 語言中不當記憶體模式可能導致的問題
* **Rust 的戰略性應用**：PingCAP 選擇使用 **Rust** 開發其分散式鍵值儲存引擎 TiKV。這並非對 Go 的「遺憾」，而是針對儲存層的 **戰略決策**——該場景對極致低延遲、可預測效能與精細記憶體控制有嚴格要求
    * Rust 的所有權系統與借用檢查機制，加上無垃圾回收器的特性，非常適合需要微秒級效能控制的系統級程式設計
    * 他們認為在關鍵儲存引擎中承受 Rust 較高學習曲線與較慢編譯速度的代價是值得的，但對於迭代更快速的 SQL 層則不具吸引力
* **PingCAP 結論**：他們明確將 Go 與 Rust 視為互補工具——Go 用於高階邏輯與快速迭代，Rust 用於低階效能關鍵組件

### Cloudflare 與 Go

* **廣泛採用 Go**：Cloudflare 是 Go 語言的早期熱情採用者，其 DNS 基礎架構、SSL 處理、壓力測試工具及眾多內部系統均使用 Go 開發。他們始終積極肯定 Go 在並行處理、部署便捷性與開發效率方面的優勢
* **技術演進而非遺憾**：Cloudflare 確實拓展了語言生態，特別是在關鍵領域轉向 **Rust**，但這是出於效能、安全性與資源效率的考量，而非對 Go 的「遺憾」
    * **Pingora（Rust）**：典型範例是他們用 Rust 開發的新一代 HTTP 代理 **Pingora**，用以取代部分基於 C 語言的 NGINX 基礎架構。此舉主要基於：
        * **記憶體安全**：Rust 能防範 C/C++（如 NGINX）中常見的記憶體錯誤（緩衝區溢位、釋放後使用等），大幅提升系統安全性與穩定性
        * **極致效能**：對於處理兆級請求的核心組件，Rust 的「零成本抽象」與精細控制能力，可實現比 Go（因 GC 開銷）更優的效能表現與資源利用率
        * **系統程式設計的開發體驗提升**：雖然 Rust 學習門檻較高，但對於開發極底層網路組件的系統工程師而言，其嚴謹性與強大型別系統有助於建構更穩健且易於維護的程式碼
    * **Go 持續擔綱要角**：即便推出 Pingora，Cloudflare 仍持續使用 Go 開發維護眾多服務。他們認為 Go 在多數工作負載下「足夠快速」，並欣賞其開發速度與運維簡便性
* **Cloudflare 結論**：Cloudflare 採取多語言協作策略，根據場景選用最適工具。Go 仍是其基礎性語言，特別適合需要快速開發與並行處理的服務；而 Rust 則日益應用於對極致效能、記憶體安全與精細控制有嚴苛要求的系統級組件

本質而言，這兩家公司都是深諳各種程式語言權衡之道的專業工程組織。他們並非對選擇 Go 表示「遺憾」，而是展現出務實的技術選型思路——在關鍵基礎架構領域，針對性地採用如 Rust 等語言，以充分發揮其無 GC 機制、記憶體安全等特性帶來的顯著優勢。