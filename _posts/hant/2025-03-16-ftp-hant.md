---
audio: false
generated: true
lang: hant
layout: post
title: FTP 伺服器
translated: true
type: note
---

若要在 Ubuntu 上設定 FTP 伺服器，以便從 iPad 或其他裝置存取檔案（例如 `/var/www/movies/` 中的 `.mkv` 檔案），您可以使用 **vsftpd**（Very Secure FTP Daemon），這是一個輕量且安全的選擇。以下是針對您設定的逐步指南：

### 前置準備
- 您使用的是 Ubuntu（例如截至 2025 年 3 月 15 日的 22.04 或 24.04 版本）。
- 您擁有 sudo 權限。
- 您的 Nginx 伺服器位於 `192.168.1.27`，檔案位於 `/var/www/movies/`。

### 步驟 1：安裝 vsftpd
1. **更新套件清單**：
   ```bash
   sudo apt update
   ```
2. **安裝 vsftpd**：
   ```bash
   sudo apt install vsftpd -y
   ```
3. **驗證安裝**：
   ```bash
   sudo systemctl status vsftpd
   ```
   - 應顯示 `active (running)`。若未顯示，請啟動服務：
     ```bash
     sudo systemctl start vsftpd
     sudo systemctl enable vsftpd  # 開機時啟動
     ```

### 步驟 2：設定 vsftpd
預設設定檔為 `/etc/vsftpd.conf`。我們將調整它以實現基本存取。

1. **備份原始設定檔**：
   ```bash
   sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.bak
   ```

2. **編輯設定檔**：
   ```bash
   sudo nano /etc/vsftpd.conf
   ```
   進行以下變更：
   - 啟用本地使用者：
     ```bash
     local_enable=YES
     ```
   - 允許檔案上傳（可選，若需上傳檔案）：
     ```bash
     write_enable=YES
     ```
   - 限制使用者僅能存取其家目錄（可選，為了安全）：
     ```bash
     chroot_local_user=YES
     ```
   - 指向您的影片目錄（可選，詳見步驟 3 的使用者設定）：
     - 預設情況下，使用者會存取其家目錄。我們稍後會調整此設定。

   儲存（`Ctrl + O`，Enter，`Ctrl + X`）。

3. **重新啟動 vsftpd**：
   ```bash
   sudo systemctl restart vsftpd
   ```

### 步驟 3：設定 FTP 使用者
您可以使用現有使用者或建立新使用者來存取 `/var/www/movies/`。

#### 選項 1：使用現有使用者
若想使用當前的 Ubuntu 使用者（例如 `user`）：
1. **檢查您的使用者名稱**：
   ```bash
   whoami
   ```
2. **設定密碼（如有需要）**：
   ```bash
   sudo passwd user  # 將 "user" 替換為您的使用者名稱
   ```
3. **連結至影片目錄**：
   - 預設情況下，此使用者的家目錄（例如 `/home/user/`）是 FTP 根目錄。若要存取 `/var/www/movies/`，請建立符號連結：
     ```bash
     ln -s /var/www/movies/ /home/user/movies
     ```
   - 或調整權限（較不安全）：
     ```bash
     sudo chown -R user:user /var/www/movies
     ```

#### 選項 2：建立專用 FTP 使用者
為了更好的安全性：
1. **新增使用者**：
   ```bash
   sudo adduser ftpuser
   ```
   - 依照提示設定密碼和詳細資料。
2. **將家目錄設為影片目錄**：
   ```bash
   sudo usermod -d /var/www/movies ftpuser
   sudo chown -R ftpuser:ftpuser /var/www/movies
   ```

3. **限制存取**（若設定了 `chroot_local_user=YES`）：
   - 確保 `/var/www/movies` 可由 `ftpuser` 寫入：
     ```bash
     sudo chmod -R 755 /var/www/movies
     ```

### 步驟 4：開啟防火牆連接埠
FTP 預設使用連接埠 20 和 21。
1. **在 UFW 中允許 FTP**：
   ```bash
   sudo ufw allow 21/tcp
   sudo ufw allow 20/tcp
   sudo ufw status
   ```
   - 應顯示 `20/tcp ALLOW` 和 `21/tcp ALLOW`。

2. **重新啟動 vsftpd**：
   ```bash
   sudo systemctl restart vsftpd
   ```

### 步驟 5：從 iPad 測試 FTP
您需要在 iPad 上安裝 FTP 用戶端應用程式。

#### 推薦的 iPad 應用程式：FileZilla 或 FE File Explorer
- **FileZilla**（免費）：
  1. 從 App Store 安裝（搜尋 "FileZilla"）。
  2. 開啟 FileZilla。
  3. 點擊 **New Site** 或 **Connect**。
  4. 輸入：
     - Host：`192.168.1.27`
     - Username：`ftpuser`（或您的使用者名稱）
     - Password：[您的密碼]
     - Port：21（預設值）
  5. 點擊 **Connect**。
- **FE File Explorer**（免費，含應用內購買）：
  1. 從 App Store 安裝。
  2. 點擊 **+** > **FTP**。
  3. 輸入上述相同資料。
  4. 連線。

#### 從 FTP 串流
- 大多數 FTP 應用程式允許瀏覽檔案。要串流 `.mkv` 檔案：
  - 在應用程式中點選 `.mkv` 檔案。
  - 若無法直接播放，請下載串流應用程式如 **VLC for Mobile**（參見先前回覆），然後使用其 **Network Stream** 選項並輸入 FTP URL：
    ```
    ftp://ftpuser:password@192.168.1.27/yourfile.mkv
    ```

### 步驟 6：驗證存取
- 從 iPad 透過 FTP 應用程式連線至 `192.168.1.27`。
- 您應看到 `/var/www/movies/` 的內容（例如 `yourfile.mkv`）。
- 點選以預覽或串流（視應用程式而定）。

### 疑難排解
- **連線被拒絕**：檢查 `sudo ufw status` 並確保連接埠 20/21 已開啟。確認 vsftpd 正在執行（`sudo systemctl status vsftpd`）。
- **權限被拒絕**：確認使用者擁有或可讀取 `/var/www/movies/`（`ls -l /var/www/movies/`）。
- **404 或無檔案**：確保目錄路徑與使用者的家目錄或符號連結設定相符。

### 最終說明
- **安全性**：對於本地網路，此設定已足夠。若需外部存取，請考慮啟用 `vsftpd.conf` 中的 SSL 以使用 FTPS（加密 FTP）。
- **Nginx 與 FTP**：您已透過 Nginx 使用 HTTP 串流——FTP 增加了檔案管理功能。若覺得 FTP 設定多餘，可在 iPad 上使用 VLC 進行 HTTP 串流。

您的 iPad 現在擁有存取 Ubuntu 伺服器檔案的 FTP「魔法」！若遇到任何問題，請隨時告知。