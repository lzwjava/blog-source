---
audio: false
generated: false
lang: hant
layout: post
title: Java 應用程式的 VisualVM 設定檔
translated: true
---

這裡有一個清晰且簡潔的指南，教你如何使用 **VisualVM** 來監控和分析 Java 應用程式。VisualVM 是一個免費且強大的工具，隨 JDK 提供，幫助你分析性能、記憶體使用情況和線程活動。

---

### 第 1 步：安裝和啟動 VisualVM
- **檢查是否已安裝 VisualVM**：VisualVM 通常隨 JDK 提供（版本 6 更新 7 及以後）。在 JDK 安裝目錄的 `bin` 目錄中查找它（例如，Windows 上的 `jdk/bin/visualvm.exe`）。
- **如有需要下載**：如果沒有包含在內，請從 [官方 VisualVM 網站](https://visualvm.github.io/) 下載。
- **啟動 VisualVM**：運行 `visualvm` 可執行文件。啟動後，你會看到當前在本地機器上運行的 Java 進程列表。

---

### 第 2 步：連接到您的 Java 應用程式
- **本地應用程式**：VisualVM 會自動檢測本機上運行的 Java 進程。雙擊你想要監控的進程以連接到它。
- **遠程應用程式**：要監控另一台機器上的 Java 進程：
  1. 使用 JMX 啟動遠程 JVM（例如，將 `-Dcom.sun.management.jmxremote` 添加到 JVM 參數）。
  2. 在 VisualVM 中，右鍵點擊左側面板中的 **Remote**，選擇 **Add Remote Host**，輸入遠程機器的詳細信息。
  3. 連接後，選擇要監控的遠程進程。

---

### 第 3 步：監控應用程式性能
連接後，**Overview** 選項卡顯示基本詳細信息，如進程 ID 和 JVM 參數。切換到 **Monitor** 選項卡以獲取實時性能數據：
- **CPU 使用率**：追蹤應用程式使用的 CPU 量。
- **記憶體使用量**：顯示堆和元空間的消耗情況。
- **線程**：顯示活動線程的數量。
- **垃圾回收**：監控 GC 活動。

這些圖表給你一個高層次的應用程式健康狀況視圖。

---

### 第 4 步：分析 CPU 和記憶體使用情況
進行深入分析，使用 **Profiler** 選項卡：
- **CPU 分析**：識別消耗最多 CPU 時間的方法。
  1. 轉到 **Profiler** 選項卡，點擊 **CPU**。
  2. 點擊 **Start** 開始分析。
  3. 使用應用程式生成你想要分析的工作負載。
  4. 點擊 **Stop**，檢查結果以查看哪些方法最慢。
- **記憶體分析**：追蹤對象分配並檢測記憶體洩漏。
  1. 在 **Profiler** 選項卡中，點擊 **Memory**。
  2. 點擊 **Start**，使用應用程式，然後點擊 **Stop**。
  3. 檢查結果中的對象計數和大小，以發現潛在的記憶體問題。

**注意**：分析會增加開銷，因此在開發或測試環境中使用，而不是生產環境。

---

### 第 5 步：分析堆和線程轉储
- **堆轉储**：捕獲記憶體快照以進行詳細分析。
  1. 在 **Monitor** 選項卡中，點擊 **Heap Dump**。
  2. 在 **Classes** 或 **Instances** 視圖中探索轉储，查看對象分配。
  3. 查找不寻常的模式（例如，過多對象），這可能表示洩漏。
- **線程轉储**：診斷線程問題，如死鎖。
  1. 在 **Threads** 選項卡中，點擊 **Thread Dump**。
  2. 檢查線程狀態（例如，RUNNABLE、WAITING）以識別問題。

---

### 第 6 步：探索其他功能
- **Sampler**：在 **Sampler** 選項卡中找到，這提供輕量級的 CPU 和記憶體分析，開銷比全面分析小。
- **Visual GC**：安裝 Visual GC 插件（通過 **Tools > Plugins**）以可視化垃圾回收行為。
- **MBeans**：使用 **MBeans** 選項卡查看和管理自定義指標的 JMX 豆。

---

### 最佳實踐
- **避免生產環境分析**：分析會減慢應用程式，因此請使用開發或測試設置。
- **從簡單開始**：首先使用 **Monitor** 選項卡獲取基準，然後再進行分析。
- **針對特定問題**：專注於懷疑問題區域的分析，以最小化開銷。
- **檢查 GC 數據**：分析垃圾回收統計數據以優化記憶體使用。

---

### 疑難排解
- **應用程式未顯示**：確保它使用兼容的 JVM 運行，並且 VisualVM 有訪問權限。
- **遠程問題**：確認遠程 JVM 配置為 JMX，並且網絡設置（例如防火牆）允許連接。
- **性能影響**：如果分析過慢，切換到 **Sampler** 以獲取輕量選項。

---

VisualVM 是一個了解和優化 Java 應用程式的優秀工具。按照這些步驟監控性能、分析瓶頸並有效診斷問題。更多詳細信息，請參閱 [官方 VisualVM 文檔](https://visualvm.github.io/documentation.html)。