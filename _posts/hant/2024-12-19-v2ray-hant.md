---
audio: true
lang: hant
layout: post
title: 尝试V2Ray：一步步指南
---

V2Ray 是一个多功能平台，用于构建代理以绕过网络限制并增强在线隐私。在本指南中，我们将引导您在 Ubuntu 服务器上安装和配置 V2Ray。我们将涵盖安装步骤、配置文件、常见问题以及验证方法，以确保一切顺利运行。

## 目錄
1. [安裝](#installation)
2. [配置](#configuration)
   - [V2Ray 配置 (`config.json`)](#v2ray-configuration-configjson)
   - [代理配置 (`config.yaml`)](#proxy-configuration-configyaml)
3. [管理 V2Ray 服務](#managing-v2ray-service)
4. [常見問題與故障排除](#common-issues-and-troubleshooting)
5. [驗證](#verification)
6. [結論](#conclusion)
7. [額外提示](#additional-tips)

---

## 安装

首先，使用提供的安装脚本下载并安装V2Ray。

```bash
ubuntu@ip-172-26-0-236:~$ curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh > in.sh
```

翻譯：
```bash
ubuntu@ip-172-26-0-236:~$ curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh > in.sh
```

這段命令的意思是從指定的URL下載一個腳本文件，並將其保存為本地的`in.sh`文件。具體來說：

- `curl` 是一個用於從或向服務器傳輸數據的命令行工具。
- `-L` 選項表示如果遇到重定向，則自動跟隨重定向。
- `https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh` 是要下載的腳本文件的URL。
- `> in.sh` 表示將下載的內容保存到名為`in.sh`的文件中。

這段命令通常用於下載並執行安裝腳本，以便在系統上安裝V2Ray。

运行安装脚本：

```bash
chmod +x in.sh
sudo ./in.sh
```

將上述指令翻譯成繁體中文如下：

```bash
chmod +x in.sh
sudo ./in.sh
```

這些指令的功能是：

1. `chmod +x in.sh`：將 `in.sh` 文件的權限設置為可執行。
2. `sudo ./in.sh`：以超級用戶權限執行 `in.sh` 腳本。

安装输出：

```
[Install]
WantedBy=multi-user.target
```

信息：V2Ray v5.22.0 已安裝。
```

注意：脚本建议在必要时移除依赖软件：

```bash
apt purge curl unzip
``` 

將被翻譯為：

```bash
apt 移除 curl unzip
``` 

這裡的 `purge` 是指徹底移除軟件包及其配置文件，而 `curl` 和 `unzip` 是要被移除的軟件包名稱。

---

## 配置

### V2Ray 配置 (`config.json`)

这个JSON文件定义了V2Ray的入站和出站设置。

```json
{
    "inbounds": [
        {
            "port": 1080,
            "listen": "0.0.0.0",
            "protocol": "vmess",
            "settings": {
                "clients": [
                    {
                        "id": "9f02f6b2-1d7d-4b10-aada-69e050f1be6b",
                        "level": 0,
                        "alterId": 0,
                        "email": "example@v2ray.com",
                        "security": "auto"
                    }
                ]
            },
            "streamSettings": {
                "network": "tcp"
            },
            "sniffing": {
                "enabled": true,
                "destOverride": [
                    "http",
                    "tls"
                ]
            },
            "tag": "vmess-inbound",
            "udp": true
        }
    ],
    "outbounds": [
        {
            "protocol": "freedom",
            "settings": {},
            "tag": "outbound-freedom",
            "udp": true
        }
    ],
    "log": {
        "loglevel": "debug",
        "access": "/var/log/v2ray/access.log",
        "error": "/var/log/v2ray/error.log"
    },
    "stats": {
        "enabled": false
    },
    "environment": {
        "v2ray.vmess.aead.forced": "false"
    }
}
```

关键点：
- 入站规则：定义了传入连接的入口点。此处设置为在端口`1080`上使用`vmess`协议。
- 出站规则：指定流量应发送至何处。`freedom`协议允许流量无限制地通过。
- 日志记录：配置为记录访问和错误信息，以便调试。
- 安全性：`security`字段设置为`aes-256-gcm`，以增强加密强度。

### 代理配置 (`config.yaml`)

此YAML文件配置了代理设置、DNS以及流量路由规则。

```yaml
port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: true
mode: Rule
log-level: info
external-controller: 0.0.0.0:9090
experimental:
  ignore-resolve-fail: true
```

dns:
  enable: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 119.29.29.29
    - 223.5.5.5
  nameserver:
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
  fake-ip-filter:
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"

proxies:
  - name: "我的VMess代理"
    type: vmess
    server: 54.254.0.0
    port: 1080
    uuid: "9f02f6b2-1d7d-4b10-aada-0000"
    alterId: 0
    cipher: "aes-128-gcm"
    udp: true

proxy-groups:
  - name: "代理"
    type: select
    proxies:
      - "我的VMess代理"

规则：
  - IP-CIDR,192.168.0.0/16,直连
  - IP-CIDR,10.0.0.0/8,直连
  - IP-CIDR,127.0.0.0/8,直连
  - GEOIP,CN,直连
  - 匹配,代理
```

关键点：
- 端口：配置HTTP、SOCKS及混合流量的多种端口。
- DNS：设置DNS，包括虚假IP范围和指定的域名服务器。
- 代理：定义一个使用`aes-128-gcm`加密的VMess代理。
- 代理组：允许在不同代理选项之间进行选择。
- 规则：根据IP范围和地理位置引导流量。

注意：确保代理配置中的`cipher`与`config.json`中的`security`设置相匹配。

---

## 管理V2Ray服务

在安装和配置完成后，您需要使用`systemctl`来管理V2Ray服务。

### 启用并启动V2Ray

1. **Enable V2Ray Service**  
   1. **启用V2Ray服务**  
   To ensure V2Ray starts automatically upon system boot, enable the service:  
   为确保V2Ray在系统启动时自动启动，请启用服务：  
   ```bash
   sudo systemctl enable v2ray
   ```

2. **Start V2Ray Service**  
   2. **启动V2Ray服务**  
   Start the V2Ray service with the following command:  
   使用以下命令启动V2Ray服务：  
   ```bash
   sudo systemctl start v2ray
   ```

3. **Check V2Ray Status**  
   3. **检查V2Ray状态**  
   Verify that V2Ray is running without issues:  
   确认V2Ray运行无误：  
   ```bash
   sudo systemctl status v2ray
   ```  
   A successful status will display "active (running)".  
   成功状态将显示“active (running)”。

启用V2Ray开机自启动：

```bash
sudo systemctl enable v2ray
```

启动V2Ray服务：

```bash
sudo systemctl start v2ray
```

预期输出：

```bash
已创建符号链接 /etc/systemd/system/multi-user.target.wants/v2ray.service → /etc/systemd/system/v2ray.service。
```

验证服务状态：

```bash
sudo systemctl status v2ray
``` 

這行指令在繁體中文中的意思是：

```bash
sudo systemctl 狀態 v2ray
```

這條指令用於檢查 `v2ray` 服務的運行狀態。`sudo` 表示以管理員權限執行，`systemctl` 是系統服務管理工具，`status` 是查看服務狀態的命令，`v2ray` 則是你要查看的服務名稱。

示例输出：

```
● v2ray.service - V2Ray 服務
   已加載：已加載 (/etc/systemd/system/v2ray.service; 已啟用; 供應商預設：已啟用)
   活動狀態：活動中（運行中）自 2024年4月27日 星期一 12:55:00 UTC 起；1分30秒前
 主進程ID：14425 (v2ray)
    任務數：8 (限制：4915)
   記憶體使用：36.7M
   CGroup：/system.slice/v2ray.service
           └─14425 /usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
```

---

## 常见问题及故障排除

### 启用V2Ray时认证失败

错误信息：

```
==== 正在為 org.freedesktop.systemd1.manage-unit-files 進行身份驗證 ====
需要身份驗證來管理系統服務或單元文件。
身份驗證用戶：Ubuntu (ubuntu)
密碼：
polkit-agent-helper-1: pam_authenticate 失敗：身份驗證失敗
==== 身份驗證失敗 ====
啟用單元失敗：訪問被拒絕
```

解决方案：

确保您使用`sudo`来执行需要管理员权限的命令。

正确命令：

```bash
sudo systemctl enable v2ray
```

---

## 验证

启动V2Ray服务后，请验证其是否正常运行。

### 检查正在运行的进程

```bash
ps aux | grep v2ray
```

示例输出：

```
nobody     14425  4.4  8.6 5460552 36736 ?       Ssl  12:55   0:00 /usr/local/bin/v2ray 運行 -配置 /usr/local/etc/v2ray/config.json
ubuntu     14433  0.0  0.5   7076  2176 pts/1    S+   12:55   0:00 grep --color=auto v2ray
```

### 使用 Telnet 测试连接性

```bash
telnet 你的服务器IP 1080
```

预期行为：

- 如果连接成功，您将看到来自 V2Ray 服务的响应。
- 要退出 Telnet，请按 `Ctrl + ]`，然后输入 `quit`。

---

## 结论

在Ubuntu服务器上设置V2Ray涉及安装软件、配置入站和出站设置、使用`systemctl`管理服务以及验证其运行。按照本指南操作，您应该能够建立一个功能齐全的V2Ray配置，有效增强网络隐私并绕过限制。

如果您遇到任何问题或有疑问，欢迎在下方留言！

（此处没有提供需要翻译的文本，请提供具体内容以便进行翻译。）

## 额外提示

- 安全性：始终确保您的V2Ray UUID和密码得到妥善保管。
- 更新：定期更新V2Ray，以享受最新功能和安全补丁带来的好处。
- 监控：使用位于`/var/log/v2ray/`的日志文件来监控性能并排查问题。

祝您代理愉快！