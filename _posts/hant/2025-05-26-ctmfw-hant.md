---
audio: false
generated: true
lang: hant
layout: post
title: Control-M 中的 ctmfw 指令
translated: true
type: note
---

Control-M 中的 `ctmfw` 指令屬於檔案監控實用工具，用於監控檔案的建立、刪除或傳輸完成等事件。根據 Control-M 文件定義的參數，指令 `ctmfw %%FILENAME CREATE 0 60 10 3 1410` 可解析如下：

- **`ctmfw`**：Control-M 檔案監控實用工具，用於偵測檔案相關事件，並根據條件觸發動作（例如啟動作業或執行指令）。

- **`%%FILENAME`**：代表要監控的檔案名稱或路徑的變數（例如 `datafile.txt` 或模式如 `*.csv`）。實際檔案名稱會在運行時解析，通常在 Control-M 作業或環境中定義。

- **`CREATE`**：操作模式，表示該工具正在監控指定檔案的**建立**。其他可能模式包括 `DELETE`（用於監控檔案刪除）。

- **`0`**：檔案被視為有效所需的最小檔案大小（單位為位元組）。值為 `0` 表示接受任何檔案大小，因此無論檔案大小如何，該工具都會偵測到該檔案。

- **`60`**：連續嘗試檢查檔案存在之間的時間間隔（單位為秒）。該工具每 60 秒檢查一次檔案是否已建立。

- **`10`**：偵測到檔案後，監控檔案大小的嘗試之間的時間間隔（單位為秒）。這確保檔案大小穩定（不再被寫入）。該工具每 10 秒檢查一次檔案大小。

- **`3`**：檔案大小必須保持靜態（未變更）的迭代次數，以確認檔案已完全建立。該工具會檢查檔案大小 3 次（每次間隔 10 秒，總計 30 秒），以確保其穩定。

- **`1410`**：該工具在等待檔案建立並滿足大小條件的最大運行時間（單位為分鐘）。1410 分鐘約等於 23.5 小時。如果在此時間內未偵測到檔案或檔案未穩定，該工具將超時，並可能執行 `DO_NOTOK` 動作（例如報告「檔案未建立」）。

### 運作方式
此指令監控由 `%%FILENAME` 指定的檔案的建立。它每 60 秒檢查一次檔案是否存在。一旦偵測到檔案，它會驗證檔案大小在 3 次迭代（每次間隔 10 秒，總計 30 秒）內保持不變。此過程將持續最多 1410 分鐘（23.5 小時），或直到檔案被偵測到並穩定為止。如果檔案建立並滿足條件，則執行 `DO_OK` 動作（例如觸發作業或指令）。如果未滿足，則執行 `DO_NOTOK` 動作。

### 範例情境
如果 `%%FILENAME` 設定為 `/home/controlm/datafile.txt`，該工具：
- 每 60 秒檢查一次 `datafile.txt`。
- 一旦找到，確保其大小在 30 秒內穩定（3 次檢查，每次間隔 10 秒）。
- 運行最多 23.5 小時或直到檔案穩定。
- 如果成功，可能會觸發作業（例如將檔案移至另一個目錄）。如果超時，可能會記錄「檔案未建立」。

### 注意事項
- `%%FILENAME` 變數必須在 Control-M 作業或環境中定義，否則指令將失敗。
- 該工具會忽略修改時間超過 50 年的檔案。
- 如果在 `%%FILENAME` 中使用萬用字元（例如 `*.csv`），則可能需要其他參數（如 `MONITOR_FILE_SIZE`）來處理多個檔案。
- 對於循環監控（偵測後重複檢查），需要 `CYCLIC_INTERVAL` 參數，但此處未指定。

此解釋基於 Control-M 檔案監控文件，來源包括 BMC 官方文件和社群討論。