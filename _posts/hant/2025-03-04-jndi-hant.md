---
audio: false
generated: true
lang: hant
layout: post
title: Java 命名與目錄介面 (JNDI)
translated: true
---

### 主要要點
- 似乎 `javax.naming` 用於 Java Naming and Directory Interface (JNDI) 來查找和管理服務（如數據庫）中的命名對象。
- 研究表明，您需要一個初始上下文來開始，通常由 Java EE 應用程序伺服器在生產環境中設置，或在測試中手動設置。
- 證據表明使用 `InitialContext` 進行查找，例如使用名稱如 "java:comp/env/jdbc/datasource" 找到 DataSource。

### 開始使用 `javax.naming`
`javax.naming` 是 JNDI 的一部分，幫助 Java 應用程序與命名和目錄服務（如查找數據庫連接）互動。在 Java EE 環境中，應用程序伺服器通常設置這些，使得通過名稱找到資源變得容易。

### 使用範例
這是在 Java EE 應用程序中查找 DataSource 的簡單方法：
```java
InitialContext ctx = new InitialContext();
DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
```
這假設 DataSource 已經在您的伺服器上配置。對於沒有伺服器的測試，您可能需要額外的庫，如 Simple-JNDI。

### 意外細節
您可能不會期望在獨立應用程序中設置 JNDI 需要配置自定義上下文，這在沒有像 Simple-JNDI 這樣的工具的情況下可能會很複雜。

---

### 調查筆記：使用 `javax.naming` 的全面指南

這個筆記提供了使用 `javax.naming` 的詳細探討，這是 Java Naming and Directory Interface (JNDI) 的一部分，它促進了 Java 應用程序與命名和目錄服務的互動。JNDI 設計為獨立於特定服務實現，允許以統一的方式訪問各種服務，如數據庫、LDAP 和文件系統。本節擴展了直接答案，為開發人員提供了全面的理解，包括設置、範例和不同環境的考慮。

#### 了解 `javax.naming` 和 JNDI
`javax.naming` 是 JNDI 的核心包，作為 Java 標準庫的一部分引入，以提供命名和目錄功能。它定義了 `Context` 接口，這是 JNDI 操作的核心，包括查找、綁定、解除綁定和重命名對象的方法，以及創建和銷毀子上下文。`lookup()` 方法通常用於通過名稱檢索對象，這對於企業應用程序中的資源訪問至關重要。

JNDI 在 Java EE 環境中特別有用，它允許應用程序與特定服務詳細信息解耦，從而提高了可攜性和靈活性。例如，它經常用於訪問資源，如數據庫連接（DataSources）、JMS 提供者和 JavaMail 服務，這些資源由應用程序伺服器管理。

#### 設置和使用 JNDI
要使用 `javax.naming`，您從創建一個初始上下文開始，這是命名操作的入口點。這通常使用 `InitialContext` 類完成。設置根據環境而異：

- **在 Java EE 應用程序中：** 應用程序伺服器（例如 Tomcat、JBoss、WebSphere）配置初始上下文。您可以使用標準 JNDI 名稱查找資源，這些名稱通常以 "java:comp/env/" 為前綴。例如，DataSource 可能在 "java:comp/env/jdbc/datasource" 訪問。
- **在獨立應用程序中：** 沒有應用程序伺服器，您需要手動配置初始上下文，指定命名服務提供者和 URL 等屬性。這可能會很複雜，需要額外的庫進行測試，如 Simple-JNDI，它提供了一個內存實現。

這是總結 `javax.naming` 中關鍵類及其角色的表格：

| 類/接口        | 角色                                                                 |
|-------------------------|----------------------------------------------------------------------|
| `Context`              | 命名操作的核心接口，如查找、綁定和解除綁定。   |
| `InitialContext`       | 創建初始上下文以開始 JNDI 操作。             |
| `Name`                 | 表示通用名稱，即有序組件序列。         |
| `NamingException`      | 命名操作期間拋出的異常的基類。            |

#### 實際範例
讓我們探索 Java EE 和獨立情況的範例：

##### 範例 1：在 Java EE 中查找 DataSource
在 Java EE 應用程序中，您可能會查找配置的 DataSource 如下：

```java
import javax.naming.InitialContext;
import javax.sql.DataSource;
import java.sql.*;

public class JNDIExample {
    public static void main(String[] args) throws Exception {
        InitialContext ctx = new InitialContext();
        DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
        Connection conn = ds.getConnection();
        // 使用連接...
        conn.close();
        ctx.close();
    }
}
```

這個範例假設 DataSource 已經在應用程序伺服器中配置，通常在文件如 Tomcat 的 `context.xml` 中。JNDI 名稱 "java:comp/env/jdbc/datasource" 是標準約定，但它可能會根據伺服器配置而異。

##### 範例 2：綁定和查找自定義對象
對於測試或獨立使用，您可能希望創建一個簡單的內存上下文。雖然標準 API 不包括內存上下文工廠，但像 Simple-JNDI 這樣的庫可以幫助。這是一個概念範例，假設這樣的設置：

```java
import javax.naming.*;

public class JNDIExample {
    public static void main(String[] args) throws NamingException {
        Context ctx = new InitialContext();
        ctx.rebind("myObject", "Hello, World!");
        String value = (String) ctx.lookup("myObject");
        System.out.println(value);
        ctx.close();
    }
}
```

注意：這個獨立範例需要使用適當的屬性配置初始上下文，這可能涉及將 `java.naming.factory.initial` 設置為自定義上下文工廠，例如由 Simple-JNDI 提供的工廠。

#### 不同環境的考慮
- **生產（Java EE）：** 在生產中，應用程序伺服器處理 JNDI 設置，使查找資源變得簡單。通常使用 JNDI 進行數據庫連接池，伺服器管理連接，從而提高了可擴展性和安全性。例如，更改數據庫憑證只需更新伺服器配置，而不需要更改應用程序代碼。
- **測試（獨立）：** 對於單元和集成測試，通常需要在沒有應用程序伺服器的情況下運行。像 Simple-JNDI ([Simple-JNDI GitHub](https://github.com/h-thurow/Simple-JNDI)) 這樣的庫允許您模擬 JNDI 環境，以程序方式綁定資源。這對於測試依賴於 JNDI 查找的代碼至關重要，確保它在不部署到伺服器的情況下工作。
- **安全性和最佳實踐：** 對於 JNDI 注入特別小心，特別是在較舊的 Java 版本中，因為它們可能導致安全漏洞，如遠程代碼執行。Oracle 已經解決了許多這樣的問題，更新如 Java 8u191 關閉了 LDAP 向量漏洞。始終驗證輸入並使用最新的 Java 版本以確保安全。

#### 意外細節：獨立設置的複雜性
您可能不會期望在沒有應用程序伺服器的情況下設置 JNDI 的複雜性。雖然 Java EE 通過伺服器管理的上下文簡化了這一點，但獨立設置需要配置上下文工廠和屬性，通常需要第三方庫。這可能是對於新手開發人員來說是一個障礙，但像 Simple-JNDI 這樣的工具通過提供內存實現來緩解這一點。

#### 進一步閱讀和資源
為了更深入的理解，請參考以下資源：
- [Oracle Java 教程：JNDI 概述](https://docs.oracle.com/en/java/tutorial/jndi/overview/index.html) 獲取官方文檔。
- [Baeldung：Java Naming and Directory Interface 概述](https://www.baeldung.com/jndi) 獲取實際範例和現代使用方法。
- [Simple-JNDI GitHub](https://github.com/h-thurow/Simple-JNDI) 獲取在沒有伺服器的情況下測試 JNDI。

這些資源提供了代碼範例、教程和最佳實踐，確保您能夠在各種情況下有效地實現 JNDI。

#### 關鍵引用
- [Oracle Java 教程 JNDI 概述](https://docs.oracle.com/en/java/tutorial/jndi/overview/index.html)
- [Baeldung Java Naming and Directory Interface 概述](https://www.baeldung.com/jndi)
- [Simple-JNDI 通過 JNDI 查找訪問屬性文件](https://github.com/h-thurow/Simple-JNDI)