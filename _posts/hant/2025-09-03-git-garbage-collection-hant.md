---
audio: false
generated: true
image: false
lang: hant
layout: post
title: Git 垃圾收集機制詳解
translated: true
type: note
---

`git gc` 代表 **Git 垃圾收集**。這是一項倉庫維護指令，用於清理和優化你的本地儲存庫。

### 功能說明

* **壓縮檔案歷史**：Git 將物件（提交、樹、資料塊）儲存在資料庫中。隨著時間推移，會累積許多鬆散物件。`git gc` 會將它們打包成緊湊的二進位檔案，節省磁碟空間。
* **清除不可達物件**：如果你刪除了分支或進行了 rebase 操作，某些提交可能不再被任何引用指向。Git 會暫時保留它們以確保安全，但 `git gc` 最終會清理這些物件。
* **優化引用**：它會重新寫入並打包引用（如標籤和分支），以加快查找速度。
* **清理 reflogs**：超過有效期的舊 reflog 記錄（HEAD 變更的歷史記錄）會被移除。

### 自動執行時機

* 當鬆散物件或打包檔案的數量超過閾值時，Git 會**自動在背景執行 `gc`**。例如，如果你進行了大量提交、rebase 或合併操作，Git 可能會觸發自動清理。
* 許多 Git 指令（如 `git fetch`、`git merge` 或 `git rebase`）會檢查是否需要執行 `gc`，並在必要時自動運行。
* 這種機制有助於維持儲存庫的效能，無需手動干預。

### 手動執行時機

* 當你的儲存庫感覺**運行緩慢**或**過於臃腫**時（例如 `.git` 檔案夾體積過大）。
* 在完成**大型清理作業**後（例如刪除分支或從歷史記錄中移除大型檔案）。
* 若需要強制立即清理：

  ```bash
  git gc --prune=now --aggressive
  ```

  *（注意：`--aggressive` 選項可能耗時較長，特別是在大型儲存庫中）*

---

需要我進一步說明如何**檢查 Git 上次自動執行 `gc` 的時間**以及觸發自動清理的閾值設定嗎？