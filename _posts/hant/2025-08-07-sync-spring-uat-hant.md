---
audio: false
generated: true
image: false
lang: hant
layout: post
title: 同步春季用戶驗收測試分支與代碼
translated: true
type: note
---

這是一套可供靈活組合的最佳實踐與模式，能協助你保持三條 UAT 分支同步、維護整潔的提交記錄，並在 Spring 應用程式中處理國家特定程式碼——同時也會探討 AI 如何協助這些流程。

---

## 1. 分支與同步策略

1. **基幹開發與短生命週期功能分支**

   * 保持單一的 **main**（或 **develop**）主分支。
   * 針對每個 Jira 票號（例如 FT-103）與國家，建立命名規則如下的功能分支：

     ```
     feature/FT-103-cn
     feature/FT-103-sg
     feature/FT-103-tw
     ```
   * 當功能完成後，先合併回 **main** 分支，再透過 cherry-pick 或合併方式同步至各 `uat_cn`、`uat_sg`、`uat_tw` 分支。
   * 優勢：只需向 main 進行一次合併；各國家分支僅擷取所需內容。

2. **定期同步 UAT 分支**

   * 設定每日（或每次建置時）自動化任務，將各 `uat_*` 分支 rebase 至 `main` 分支，避免分支間差異過大。
   * 可在 CI 流程中實現自動化（例如透過 GitHub Action 每晚自動 rebase `uat_cn`）。

3. **採用 Pull Request 與審核機制**

   * 所有從功能分支合併至 main 的請求皆需透過 PR 進行。
   * 確保分支名稱與 PR 標題/描述中皆包含「FT-xxx」票號。

---

## 2. 提交訊息規範與壓縮合併

1. **符合 Conventional Commits 規範並標註 JIRA 票號**

   ```
   FT-103: 修復客戶查詢中的空指標異常
   ```

2. **開發期間細分提交 → 合併時壓縮**

   * 開發過程中可持續提交：

     ```
     FT-103 #1: 初始化服務 Bean 配置
     FT-103 #2: 新增驗證邏輯
     FT-103 #3: 更新錯誤處理機制
     ```
   * 發起 PR 合併時，使用「Squash and merge」將所有 FT-103 相關提交壓縮為單一清晰記錄：

     ```
     FT-103: 客戶服務驗證與錯誤處理功能
     ```

3. **票號內部分項編號**

   * 若單一票號中包含多個獨立開發步驟，開發期間可使用編號（`#1`、`#2`）區分。
   * 合併後將所有內容壓縮為 *單一* FT-103 提交，維持歷史記錄簡潔性與功能對應關係。

4. **自動化提交檢驗**

   * 使用 Git hook 或 CI 外掛（如 [commitlint](https://commitlint.js.org)）強制要求提交訊息開頭符合 `FT-\d+` 格式。
   * 可選加入作用域標示：`FT-103(sg): …`。

---

## 3. Spring 專案中的國家特定程式碼處理

1. **設定檔與條件化 Bean**

   * 為每個國家定義 Spring profile：`@Profile("cn")`、`@Profile("sg")`、`@Profile("tw")`。
   * 在 `application-cn.yml`、`application-sg.yml` 等配置檔案中設定國家特定參數。
   * 啟動時透過 `--spring.profiles.active=cn`（或 sg、tw）參數載入對應環境設定。

2. **策略模式與模組化設計**

   * 建立 `PaymentProcessor` 介面並實作三種版本（`CnPaymentProcessor` 等）。
   * 使用 `@Component` + `@Profile` 註解，或透過工廠模式根據執行時旗標動態選取 Bean。

3. **資源檔案與功能開關**

   * 若差異較小（如日期格式、端點網址），可統一程式邏輯並將差異內容外移至屬性檔案或功能開關服務。

4. **模組化分割（適用大型差異）**

   * 當各國邏輯差異顯著時，可拆分為子模組：

     ```
     /core
     /country-cn
     /country-sg
     /country-tw
     ```
   * 主應用程式在建置/部署時僅引入啟用的國家模組。

---

## 4. 任務劃分依據：功能票號優先於人員

* **以票號為單位，非以人員為單位**。任務應圍繞 *功能*（Jira 票號）進行組織，而非依人員劃分。
* 若多位開發者共同處理 FT-103，應協作於同一分支，或從該分支建立主題分支——最終仍合併回單一 FT-103 分支。
* 提交作者資訊保留於 commit 的 author 欄位，無需按作者進行壓縮合併。

---

## 5. AI 輔助開發實踐

1. **自動生成提交訊息**

   * 運用 GitHub Copilot 或 OpenAI 等工具，根據程式差異自動生成符合規範的提交訊息。
   * 整合 pre-commit hook，執行 `ai-commit --preview` 預覽 AI 建議的提交訊息。

2. **PR 描述與更新日誌生成**

   * 透過 AI 助理將票號下的所有提交彙整為連貫的 PR 描述或版本發布說明：

     > 「將 feature/FT-103 的變更內容以要點形式總結。」

3. **程式審查輔助**

   * 採用 AI 強化型檢查工具（如搭載 AI 外掛的 SonarQube、DeepCode），協助標註國家特定程式碼路徑中的問題。

4. **自動化 cherry-pick 與 rebase 流程**

   * 編寫簡易腳本（或使用低程式碼平台），當 FT-103 合併至 `main` 後，自動 cherry-pick 至各 `uat_*` 分支，並在發生合併衝突時自動建立 PR。

---

### 完整工作流程整合

1. **開發階段** 於 `feature/FT-XXX-<cn/sg/tw>` 分支進行。
2. **提交階段** 自由提交（可編號標註），並於訊息中引用 JIRA 票號。
3. **發起 PR** 合併至 main；選擇 **Squash-and-merge** 使每個 FT-XXX 對應單一清晰提交。
4. **CI 任務** 自動將該提交 rebase/合併至各 `uat_cn`、`uat_sg`、`uat_tw` 分支。
5. **執行階段** 透過 Spring profiles 載入對應國家邏輯——無需在三個分支中重複程式碼。
6. **AI 工具** 協助強化提交規範、總結 PR 內容與管理合併流程。

此工作流程能保持提交歷史整潔、確保每個票號在所有環境中皆可追溯至單一提交、透過執行階段設定分離國家邏輯（而非在 Git 歷史中分散），並在最具價值的環節善用 AI 技術。