---
audio: false
generated: true
lang: hant
layout: post
title: 在 Ubuntu 上設定 SFTP 伺服器
translated: true
type: note
---

在 Ubuntu 上設定 SFTP（SSH 檔案傳輸協定）伺服器是一個簡單直接的過程，讓你能透過 SSH 加密在網絡上安全地傳輸檔案。以下是一份完整的逐步指南，協助你完成設定。

---

### 步驟 1：安裝 OpenSSH 伺服器
SFTP 依賴 OpenSSH 伺服器，你需要在 Ubuntu 系統上安裝它。

1. 開啟終端機並更新套件清單：
   ```bash
   sudo apt update
   ```

2. 安裝 OpenSSH 伺服器：
   ```bash
   sudo apt install openssh-server
   ```

3. 檢查 SSH 服務是否正在執行：
   ```bash
   sudo systemctl status ssh
   ```
   - 如果未執行，請啟動它：
     ```bash
     sudo systemctl start ssh
     ```
   - 確保它在開機時自動啟動：
     ```bash
     sudo systemctl enable ssh
     ```

---

### 步驟 2：建立專屬 SFTP 使用者
為了提升安全性，請建立一個專用使用者來進行 SFTP 存取。

1. 新增使用者（例如 `sftpuser`）：
   ```bash
   sudo adduser sftpuser
   ```
   - 按照提示設定密碼並填寫任何可選資料。

2. （可選）防止此使用者透過 SSH 存取 shell：
   ```bash
   sudo usermod -s /bin/false sftpuser
   ```

---

### 步驟 3：設定 SSH 以支援 SFTP
你可以允許所有使用者透過 SFTP 存取自己的家目錄，或將特定使用者限制於特定資料夾。

#### 選項 1：允許所有使用者使用 SFTP
如果你希望所有使用者都能透過 SFTP 存取自己的家目錄，在安裝 OpenSSH 後無需額外設定。請跳至步驟 5。

#### 選項 2：將使用者限制於特定目錄
要將使用者（例如 `sftpuser`）限制於特定目錄：

1. 編輯 SSH 設定檔：
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

2. 在檔案末尾加入以下行：
   ```ini
   Match User sftpuser
       ChrootDirectory /home/sftpuser
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   - 儲存檔案（`Ctrl+O`，然後 `Enter`）並退出（`Ctrl+X`）。

3. 此設定：
   - 將 `sftpuser` 限制於 `/home/sftpuser`。
   - 強制僅使用 SFTP。
   - 停用額外功能如 TCP 轉發。

---

### 步驟 4：設定目錄權限
為了讓限制設定（chroot）生效，請調整權限：

1. 將 chroot 目錄的所有權設為 root：
   ```bash
   sudo chown root:root /home/sftpuser
   ```

2. 為使用者建立可寫入的子目錄（例如 `uploads`）：
   ```bash
   sudo mkdir /home/sftpuser/uploads
   sudo chown sftpuser:sftpuser /home/sftpuser/uploads
   ```
   - 使用者現在可以上傳檔案至 `/home/sftpuser/uploads`。

---

### 步驟 5：重新啟動 SSH 服務
透過重新啟動 SSH 來套用變更：
```bash
sudo systemctl restart ssh
```

---

### 步驟 6：測試你的 SFTP 伺服器
從另一台裝置連線以驗證伺服器是否正常運作。

1. 找出你的 Ubuntu 機器 IP 位址：
   ```bash
   ip addr show
   ```
   - 尋找類似 `192.168.1.100` 的 IP。

2. 測試連線：
   - **從終端機（Linux/macOS）：**
     ```bash
     sftp sftpuser@<ubuntu-ip-address>
     ```
     - 在提示時輸入密碼。
   - **使用 FileZilla（任何作業系統）：**
     - 主機：`sftp://<ubuntu-ip-address>`
     - 使用者名稱：`sftpuser`
     - 密碼：（你的密碼）
     - 埠：22

3. 嘗試上傳檔案至 `uploads` 資料夾或列出目錄內容。

---

### 步驟 7：設定防火牆
如果你使用 Ubuntu 的防火牆（UFW），請允許 SFTP 流量：

1. 檢查防火牆狀態：
   ```bash
   sudo ufw status
   ```

2. 允許 SSH/SFTP（埠 22）：
   ```bash
   sudo ufw allow 22/tcp
   sudo ufw reload
   ```

---

### 全部完成！
你的 SFTP 伺服器現已準備就緒！使用者可以使用 SFTP 用戶端安全地連線並傳輸檔案至指定的目錄。如果你限制了 `sftpuser`，他們將只能存取 `/home/sftpuser/uploads`（或你設定的位置）。享受安全的檔案傳輸吧！