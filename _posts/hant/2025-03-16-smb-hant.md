---
audio: false
generated: true
lang: hant
layout: post
title: 在 Ubuntu 上設置用於媒體共享的 SMB 伺服器
translated: true
type: note
---

以下是在 Ubuntu 系統上設定 SMB（伺服器訊息區塊）伺服器以提供媒體檔案服務的逐步指南。SMB 是一種允許您在網路中共享檔案的協定，非常適合向電腦、電視或行動裝置等設備提供媒體內容。我們將使用 Samba（在 Linux 上提供 SMB 功能的軟體），並將其配置為共享包含媒體檔案的目錄。

---

### 步驟 1：安裝 Samba
首先，您需要在 Ubuntu 系統上安裝 Samba。開啟終端機並執行以下指令：

```bash
sudo apt update
sudo apt install samba
```

- `sudo apt update` 會重新整理套件清單，以確保您獲得最新版本。
- `sudo apt install samba` 會安裝 Samba 套件，其中包含必要的工具和服務。

---

### 步驟 2：備份 Samba 設定檔
在進行變更之前，建議先備份預設的 Samba 設定檔。執行：

```bash
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
```

這會建立原始檔案的副本（`smb.conf.backup`），以便您後續需要還原變更時使用。

---

### 步驟 3：配置媒體共享
Samba 設定檔位於 `/etc/samba/smb.conf`。您將編輯此檔案以定義媒體檔案的共享。在此範例中，假設您的媒體檔案儲存在 `/home/user/media`（請將 `user` 替換為您的實際使用者名稱）。

1. 在文字編輯器（例如 `nano`）中開啟設定檔：
   ```bash
   sudo nano /etc/samba/smb.conf
   ```

2. 滾動至檔案底部並新增以下區段：
   ```ini
   [media]
       path = /home/user/media
       browseable = yes
       read only = yes
       guest ok = yes
   ```

3. 儲存並離開：
   - 在 `nano` 中，按下 `Ctrl+O`，然後按 `Enter` 儲存，再按 `Ctrl+X` 離開。

#### 設定說明：
- `[media]`：共享的名稱，使用者在瀏覽網路時可見。
- `path = /home/user/media`：您要共享的目錄（請根據您的媒體資料夾位置進行調整）。
- `browseable = yes`：使共享在瀏覽網路時可見。
- `read only = yes`：防止使用者修改或刪除檔案（適合用於媒體服務）。
- `guest ok = yes`：允許無需使用者名稱或密碼即可存取，簡化媒體存取流程。

---

### 步驟 4：驗證設定
為確保設定中沒有語法錯誤，請執行：

```bash
testparm
```

此指令會檢查 `smb.conf` 檔案並顯示已載入的服務。如果沒有錯誤，您就可以繼續進行。

---

### 步驟 5：重新啟動 Samba 服務
Samba 執行兩個服務：`smbd`（處理檔案共享）和 `nmbd`（處理網路探索）。重新啟動它們以套用您的變更：

```bash
sudo systemctl restart smbd
sudo systemctl restart nmbd
```

為確保這些服務在開機時自動啟動（通常預設啟用），您可以執行：

```bash
sudo systemctl enable smbd
sudo systemctl enable nmbd
```

---

### 步驟 6：調整檔案權限
為使訪客存取正常運作，媒體目錄及其檔案必須對所有人可讀。使用以下指令設定適當的權限：

```bash
sudo chmod -R 755 /home/user/media
```

- `755` 表示擁有者具有完整權限（讀取、寫入、執行），而其他人具有讀取和執行權限（需要存取和列出檔案）。
- `-R` 會將變更遞迴套用至所有檔案和子目錄。

---

### 步驟 7：配置防火牆
如果 Ubuntu 的防火牆（UFW）處於啟用狀態，您需要允許 SMB 流量。首先，檢查防火牆狀態：

```bash
sudo ufw status
```

如果防火牆已啟用，請開啟必要的連接埠：

```bash
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
```

- 連接埠 139 和 445（TCP）用於 SMB 檔案共享。
- 連接埠 137 和 138（UDP）由 `nmbd` 用於網路探索。

重新載入防火牆以套用變更：

```bash
sudo ufw reload
```

如果防火牆未啟用，您可以跳過此步驟。

---

### 步驟 8：測試 SMB 共享
您的 SMB 伺服器現在應該正在執行。若要進行測試：

1. 找出您的 Ubuntu 機器的 IP 位址：
   ```bash
   ip addr show
   ```
   在您的網路介面（例如 `eth0` 或 `wlan0`）下尋找 IP 位址（例如 `192.168.1.100`）。

2. 從網路上的另一台裝置（例如 Windows PC）：
   - 開啟檔案總管並輸入：`\\<ubuntu-ip-address>\media`（例如 `\\192.168.1.100\media`）。
   - 您應該會看到您的媒體檔案。由於已啟用訪客存取，因此無需登入。

---

### 疑難排解提示
如果您遇到問題：
- **檢查 Samba 記錄檔**：記錄檔位於 `/var/log/samba/`（例如 `log.smbd` 或 `log.nmbd`）。使用 `cat` 或 `tail` 檢視它們：
  ```bash
  sudo tail -f /var/log/samba/log.smbd
  ```
- **本地測試**：使用 `smbclient` 列出您的 Ubuntu 機器上的共享：
  ```bash
  smbclient -L localhost
  ```
  或連接到共享：
  ```bash
  smbclient //localhost/media -N
  ```
  （`-N` 會跳過訪客存取的密碼提示。）

---

### 指令摘要
以下是完整的指令序列：

```bash
sudo apt update
sudo apt install samba
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
sudo nano /etc/samba/smb.conf  # 新增 [media] 區段
testparm
sudo systemctl restart smbd
sudo systemctl restart nmbd
sudo chmod -R 755 /home/user/media
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
sudo ufw reload
```

您的 SMB 伺服器現已設定完成，可從 `/home/user/media` 提供媒體檔案！使用 IP 位址和共享名稱（`\\<ip-address>\media`）從網路上的任何裝置存取它。