---
audio: false
generated: true
image: false
lang: hant
layout: post
model: x-ai/grok-4-fast
title: 高效範圍查詢數據結構
translated: true
type: note
---

### 線段樹與樹狀陣列：概述

線段樹與樹狀陣列（又稱二元索引樹）均為高效資料結構，常用於競程與演算法中處理陣列的區間查詢與更新操作。它們能在對數時間內執行如區間總和查詢或單點更新等運算，對於大型資料集而言，遠比樸素的 O(n) 方法更快。

#### 線段樹
**線段樹** 是一種基於二元樹的結構，透過將陣列分割為多個區段來表示陣列。樹中的每個節點對應陣列的一個範圍：
- 葉節點代表單一元素。
- 父節點代表其子節點範圍的合併（例如子範圍的總和、最小值、最大值）。
- 此樹通常以遞迴方式建立，對於大小為 n 的陣列，樹高為 O(log n)。

**關鍵操作：**
- **建構：** 以 O(n) 時間建立樹結構。
- **更新：** 修改單一元素並在 O(log n) 時間內向上傳播變更。
- **查詢：** 透過遍歷相關節點，在 O(log n) 時間內計算區間聚合值（如總和）。

**應用場景：** 區間總和/最小值/最大值查詢、頻率統計，或任何可結合的運算。線段樹更具彈性，但使用 O(4n) 空間。

**簡單範例（區間總和）：**
假設陣列為 [1, 3, 5, 7]。線段樹可能如下：
- 根節點：區間 [1-7] 的總和 = 16
- 左子節點：區間 [1-3] 的總和 = 4
- 右子節點：區間 [5-7] 的總和 = 12
- 依此類推，直至葉節點。

#### 樹狀陣列
**樹狀陣列**（由 Peter Fenwick 於 1994 年提出）是一種更緊湊的陣列型結構，用於前綴和及類似操作。它利用位元運算高效索引元素，以巧妙的方式追蹤累積和：
- 每個索引儲存以該索引結尾的某範圍總和。
- 更新與查詢使用低位元操作（例如 `index & -index` 來尋找最低有效位元）。

**關鍵操作：**
- **建構：** O(n log n) 或可優化至 O(n)。
- **更新：** 在 O(log n) 時間內於某索引加/減一個值。
- **查詢：** 在 O(log n) 時間內取得至某索引的前綴和；透過前綴差計算區間總和。

**應用場景：** 與線段樹類似，但專為一維前綴和、順序統計或逆序數計數優化。它僅使用 O(n) 空間，更為輕量。

**簡單範例（區間總和）：**
對於陣列 [1, 3, 5, 7]，樹狀陣列可能為 [1, 4, 5, 16]（累積調整值）。查詢區間 [1-3] 的總和：前綴(3) - 前綴(0) = 9。

#### 比較

| 比較項目       | 線段樹                       | 樹狀陣列                     |
|----------------|------------------------------|------------------------------|
| **空間**      | O(4n)                        | O(n)                         |
| **建構時間**  | O(n)                         | O(n log n)                   |
| **彈性**      | 支援任何區間聚合運算         | 最適合前綴和/更新操作        |
| **複雜度**    | 程式碼稍多                   | 實作較簡單                   |

兩者皆是演算法領域的經典工具（例如在 LeetCode 或 Codeforces 上）。若需實作，建議從樹狀陣列入門以簡化流程！

深入閱讀：  
[線段樹教程 - GeeksforGeeks](https://www.geeksforgeeks.org/segment-tree-data-structure/)  
[樹狀陣列詳解 - CP-Algorithms](https://cp-algorithms.com/data_structures/fenwick.html)