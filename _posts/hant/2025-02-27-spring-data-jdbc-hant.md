---
audio: false
generated: true
lang: hant
layout: post
title: Spring Data JDBC
translated: true
type: note
---

Spring Data JDBC 是一個強大的函式庫，它透過提供輕量級、註解驅動的方式來簡化 Spring 應用程式中的資料庫互動。它比 Spring Data JPA 更少主觀性，並專注於以更簡單、更明確的方式將物件映射到資料庫表。下面，我將帶您了解如何使用它的基礎知識。

### 1. **設定您的專案**
要開始使用，您需要在專案中包含 Spring Data JDBC。如果您使用 Maven，請將以下依賴項添加到您的 `pom.xml` 中：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jdbc</artifactId>
</dependency>
```

您還需要一個適用於您資料庫的 JDBC 驅動程式（例如 H2、MySQL、PostgreSQL）。以 H2 為例：

```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

如果您使用 Gradle，對應的依賴項如下：

```gradle
implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
runtimeOnly 'com.h2database:h2'
```

### 2. **配置您的資料庫**
在您的 `application.properties` 或 `application.yml` 中配置資料庫連接。對於 H2 記憶體資料庫，配置可能如下所示：

```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.h2.console.enabled=true
```

對於像 PostgreSQL 這樣的真實資料庫，請相應地調整 URL、使用者名稱和密碼。

### 3. **定義您的領域模型**
建立一個簡單的實體類別來表示資料庫中的一個表。Spring Data JDBC 使用約定：類別名稱映射到表名稱（預設為小寫），欄位映射到列。

```java
import org.springframework.data.annotation.Id;

public class Person {
    @Id
    private Long id;
    private String firstName;
    private String lastName;

    // 預設建構函式（Spring Data JDBC 所需）
    public Person() {}

    public Person(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    // Getter 和 Setter 方法
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getFirstName() { return firstName; }
    public void setFirstName(String firstName) { this.firstName = firstName; }
    public String getLastName() { return lastName; }
    public void setLastName(String lastName) { this.lastName = lastName; }
}
```

- `@Id` 標記主鍵。
- Spring Data JDBC 需要一個無參數建構函式。
- 除非被覆寫，否則表將被命名為 `person`。

### 4. **建立儲存庫**
定義一個繼承 `CrudRepository` 的介面來處理基本的 CRUD 操作：

```java
import org.springframework.data.repository.CrudRepository;

public interface PersonRepository extends CrudRepository<Person, Long> {
}
```

就是這樣！您不需要實作它——Spring Data JDBC 會在執行時生成實作。

### 5. **使用儲存庫**
將儲存庫注入到服務或控制器中並使用它：

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class PersonService {
    private final PersonRepository repository;

    @Autowired
    public PersonService(PersonRepository repository) {
        this.repository = repository;
    }

    public void savePerson() {
        Person person = new Person("John", "Doe");
        repository.save(person);
        System.out.println("Saved person with ID: " + person.getId());
    }

    public void listPeople() {
        Iterable<Person> people = repository.findAll();
        people.forEach(p -> System.out.println(p.getFirstName() + " " + p.getLastName()));
    }
}
```

### 6. **執行您的應用程式**
如果您使用 Spring Boot，建立一個帶有 `@SpringBootApplication` 的主類別並執行它：

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

Spring Boot 將自動配置資料來源和 Spring Data JDBC。

### 7. **可選：自訂查詢**
如果您需要自訂查詢，可以在儲存庫中添加帶有 `@Query` 的方法：

```java
import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;

public interface PersonRepository extends CrudRepository<Person, Long> {
    @Query("SELECT * FROM person WHERE first_name = :name")
    List<Person> findByFirstName(String name);
}
```

### 關鍵要點記住
- **無延遲載入：** 與 JPA 不同，Spring Data JDBC 不支援延遲載入。關聯（例如一對多）需要使用聚合根進行明確建模。
- **聚合根：** 每個實體都是一個聚合的一部分，只有根實體可以直接儲存或檢索。
- **結構描述建立：** Spring Data JDBC 不會自動建立表。您需要提供結構描述（例如透過 `src/main/resources` 中的 `schema.sql`）：

```sql
CREATE TABLE person (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR(255),
    last_name VARCHAR(255)
);
```

### 範例工作流程
1. 啟動您的應用程式。
2. 使用 `repository.save()` 儲存一個 `Person` 物件。
3. 使用 `repository.findById()` 或 `findAll()` 檢索它。

這就是基礎知識！如果您想深入了解關聯、自訂映射或特定內容，請告訴我您的目標，我將根據您的需求調整解釋。目前為止，這些內容對您有幫助嗎？