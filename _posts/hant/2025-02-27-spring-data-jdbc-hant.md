---
audio: false
generated: false
lang: hant
layout: post
title: Spring Data JDBC
translated: true
---

Spring Data JDBC 是一個強大的庫，通過提供輕量級、基於註釋的方法來簡化 Spring 應用程序中的數據庫交互，從而與關聯式數據庫進行工作。它比 Spring Data JPA 更少意見，並專注於更簡單、更明確的將對象映射到數據庫表的方式。以下，我將帶你了解如何使用它的基本知識。

### 1. **設置您的項目**
要開始，您需要在項目中包含 Spring Data JDBC。如果您使用 Maven，請將以下依賴項添加到您的 `pom.xml`：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jdbc</artifactId>
</dependency>
```

您還需要數據庫的 JDBC 驅動程序（例如 H2、MySQL、PostgreSQL）。例如，對於 H2：

```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

如果您使用 Gradle，等效的將是：

```gradle
implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
runtimeOnly 'com.h2database:h2'
```

### 2. **配置您的數據庫**
在 `application.properties` 或 `application.yml` 中配置數據庫連接。對於 H2 內存數據庫，它可能看起來像這樣：

```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.h2.console.enabled=true
```

對於實際數據庫如 PostgreSQL，請相應地調整 URL、用戶名和密碼。

### 3. **定義您的域模型**
創建一個簡單的實體類來表示數據庫中的表。Spring Data JDBC 使用約定，類名映射到表名（默認情況下為小寫），字段映射到列。

```java
import org.springframework.data.annotation.Id;

public class Person {
    @Id
    private Long id;
    private String firstName;
    private String lastName;

    // 默認構造函數（Spring Data JDBC 所需）
    public Person() {}

    public Person(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    // Getters 和 Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getFirstName() { return firstName; }
    public void setFirstName(String firstName) { this.firstName = firstName; }
    public String getLastName() { return lastName; }
    public void setLastName(String lastName) { this.lastName = lastName; }
}
```

- `@Id` 標記主鍵。
- Spring Data JDBC 期望一個無參數構造函數。
- 表將命名為 `person`，除非被覆蓋。

### 4. **創建一個存儲庫**
定義一個擴展 `CrudRepository` 的接口來處理基本的 CRUD 操作：

```java
import org.springframework.data.repository.CrudRepository;

public interface PersonRepository extends CrudRepository<Person, Long> {
}
```

這就是了！您不需要實現它——Spring Data JDBC 會在運行時生成實現。

### 5. **使用存儲庫**
將存儲庫注入到服務或控制器中並使用它：

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class PersonService {
    private final PersonRepository repository;

    @Autowired
    public PersonService(PersonRepository repository) {
        this.repository = repository;
    }

    public void savePerson() {
        Person person = new Person("John", "Doe");
        repository.save(person);
        System.out.println("Saved person with ID: " + person.getId());
    }

    public void listPeople() {
        Iterable<Person> people = repository.findAll();
        people.forEach(p -> System.out.println(p.getFirstName() + " " + p.getLastName()));
    }
}
```

### 6. **運行您的應用程序**
如果您使用 Spring Boot，創建一個帶有 `@SpringBootApplication` 的主類並運行它：

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

Spring Boot 將自動配置數據源和 Spring Data JDBC。

### 7. **可選：自定義查詢**
如果您需要自定義查詢，可以在存儲庫中添加帶有 `@Query` 的方法：

```java
import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;

public interface PersonRepository extends CrudRepository<Person, Long> {
    @Query("SELECT * FROM person WHERE first_name = :name")
    List<Person> findByFirstName(String name);
}
```

### 需要記住的關鍵點
- **無延遲加載**：與 JPA 不同，Spring Data JDBC 不支持延遲加載。關係（例如一對多）需要明確建模，使用聚合根。
- **聚合根**：每個實體都是聚合的一部分，只有根才能直接保存或檢索。
- **模式創建**：Spring Data JDBC 不會自動創建表。您需要提供模式（例如，通過 `src/main/resources` 中的 `schema.sql`）：

```sql
CREATE TABLE person (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR(255),
    last_name VARCHAR(255)
);
```

### 示例工作流
1. 啟動您的應用程序。
2. 使用 `repository.save()` 保存一個 `Person` 對象。
3. 使用 `repository.findById()` 或 `findAll()` 檢索它。

這就是基本知識！如果您想深入了解關係、自定義映射或某些特定內容，請告訴我您的目標，我將根據您的需求進行調整。這樣做對您來說如何？