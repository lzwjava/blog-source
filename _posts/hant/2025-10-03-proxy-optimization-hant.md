---
audio: false
generated: true
image: false
lang: hant
layout: post
model: x-ai/grok-code-fast-1
title: 優化 Clash 代理選擇效能
translated: true
type: note
---

### 優化總結：Clash 代理節點選擇腳本

我優化了 Clash 代理節點選擇腳本，避免測試不會被選中的代理節點，通過減少不必要的速度測試，顯著提升了效能。

#### 優化內容

原始代碼遵循以下低效工作流程：
1. 測試所有可用代理節點的速度。
2. 然後篩選僅保留新加坡/台灣（或香港）代理節點。
3. 這導致浪費時間測試最終會被捨棄的代理節點。

#### 解決方案

修改 `speed.py` 中的 `get_top_proxies()` 函數，使其接受 `name_filter` 參數，並在速度測試前應用篩選：

```python
def get_top_proxies(num_results=5, name_filter=None):
    """
    並行測試 Clash 代理節點速度，並返回前 N 個最快的獨立代理節點。

    參數：
        num_results (int)：要返回的頂部代理節點數量（默認：5）
        name_filter (list)：用於篩選代理節點名稱的字串列表。僅測試名稱中包含
                           任何這些字串的代理節點。
    """
```

#### 效能優勢

- **減少網絡請求**：僅測試您實際打算使用的代理節點。
- **加快執行速度**：消除在不相關代理節點上浪費的時間。
- **更清晰的日誌記錄**：顯示確切的代理節點篩選數量，提高透明度。

#### 簡化配置

移除了 `--hk` 標誌。腳本現在默認僅測試新加坡和台灣代理節點，以實現最大專注度和簡潔性。

#### 成果

這項優化大幅減少了執行時間，因為大多數代理節點的名稱不包含「SG」或「TW」。這使得速度測試階段效率大大提高，在不影響功能的前提下更快地提供結果。