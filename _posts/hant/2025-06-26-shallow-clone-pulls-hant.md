---
audio: false
generated: true
lang: hant
layout: post
title: 使用淺層複製進行 Git Pull 與 Push 操作
translated: true
type: note
---

是的，在使用 `--depth=20` 克隆具有有限歷史記錄的存儲庫後，你仍然可以使用 `git pull` 或 `git push`。但需要注意以下重要事項：

### 1. **`--depth=20` 的作用**
   - `--depth=20` 選項會創建一個*淺克隆*，僅從默認分支（或使用 `--branch` 指定的分支）獲取最近的 20 次提交（或指定數量的提交）。
   - 這會減少下載的歷史記錄量，使克隆速度更快且體積更小，但存儲庫將不包含完整的提交歷史記錄。

### 2. **在淺克隆中使用 `git pull`**
   - **是的，你可以使用 `git pull`** 來獲取並合併遠程存儲庫中的新提交。
   - 默認情況下，`git pull` 會獲取新提交並更新淺歷史記錄，使其與遠程分支保持一致。
   - 如果遠程分支添加了新提交，`git pull` 會獲取它們並擴展本地存儲庫中的歷史記錄，同時仍保持克隆的淺層特性。

   **注意**：如果分支的歷史記錄以影響比你淺歷史記錄更早的提交的方式發生變化（例如，遠程的強制推送或變基），你可能會遇到問題。在這種情況下，你可能需要加深歷史記錄（使用 `git fetch --deepen=<n>` 或 `git fetch --unshallow` 來獲取完整歷史記錄）以解決衝突或繼續工作。

### 3. **在淺克隆中使用 `git push`**
   - **是的，你可以使用 `git push`** 將本地提交推送到遠程存儲庫。
   - 只要遠程接受你的更改，淺克隆不會限制你創建新提交並將其推送到遠程存儲庫的能力。
   - 但是，如果遠程存儲庫需要依賴完整歷史記錄的操作（例如，涉及較舊提交的合併或變基），你可能需要獲取更多歷史記錄才能成功完成推送。

### 4. **淺克隆的限制**
   - **有限的歷史記錄**：某些 Git 操作（如 `git log`、`git blame` 或 `git rebase`）可能會受到限制，因為較舊的提交在本地不可用。
   - **合併和變基**：如果你需要與淺歷史記錄之外的提交進行合併或變基，你可能需要使用 `git fetch --deepen=<n>` 或 `git fetch --unshallow` 獲取更多歷史記錄。
   - **強制推送**：如果遠程分支被重寫（例如，使用 `git push --force`），你的淺克隆可能沒有足夠的上下文來處理更改，需要你加深歷史記錄或重新克隆。

### 5. **如何加深淺克隆（如果需要）**
   如果由於歷史記錄有限而遇到 `git pull` 或 `git push` 的問題，你可以獲取額外的歷史記錄：
   - **按指定提交數量加深**：
     ```bash
     git fetch --deepen=20
     ```
     這會獲取額外 20 次提交的歷史記錄。
   - **獲取完整歷史記錄**：
     ```bash
     git fetch --unshallow
     ```
     這會將你的淺克隆轉換為具有完整歷史記錄的完整克隆。

### 6. **實用建議**
   - 對於大多數工作流程，尤其是當你僅處理近期更改或貢獻小更新時，使用 `--depth=20` 的淺克隆通常足夠。
   - 如果你預期需要完整歷史記錄（例如，用於複雜的合併、變基或調試），請考慮不使用 `--depth` 選項克隆完整存儲庫，或在需要時加深歷史記錄。
   - 在嘗試推送之前，請始終確保你對遠程存儲庫（例如 `git@github.com:cisco/ChezScheme.git`）具有寫入權限。

### 示例工作流程
```bash
# 使用有限歷史記錄進行克隆
git clone git@github.com:cisco/ChezScheme.git --depth=20
cd ChezScheme

# 進行更改並提交
git commit -m "我的更改"

# 拉取最新更改
git pull origin main

# 推送你的更改
git push origin main
```

如果由於淺克隆而遇到問題，請按照上述方法加深歷史記錄。

### 總結
是的，你可以對使用 `--depth=20` 創建的淺克隆使用 `git pull` 和 `git push`。但是，對於某些操作，如果淺歷史記錄不足，你可能需要獲取額外的歷史記錄。使用 `git fetch --deepen` 或 `git fetch --unshallow` 來解決任何限制。