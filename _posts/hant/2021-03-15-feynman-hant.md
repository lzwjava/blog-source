---
audio: false
generated: false
image: true
lang: hant
layout: post
title: mathjax2mobiï¼šå°‡MathJax HTMLè½‰æ›ç‚ºé›»å­æ›¸
translated: true
---

### é …ç›®ç°¡ä»‹

å…ˆå¤§è‡´è¬›è¬›é …ç›®æƒ…æ³ã€‚

![feynman_online](assets/images/feynman/feynman_online.jpg)

<img src="/assets/images/feynman/change.JPG" alt="change" style="zoom:50%;" />

![latex](assets/images/feynman/latex.JPG)

![epub_black](assets/images/feynman/epub_black.JPG)

![epub_beautiful](assets/images/feynman/epub_beautiful.JPG)

åšå®Œé …ç›®å¾Œï¼Œæœ‰é»é–‹å¿ƒã€‚å¯«ä¸‹äº†é€™æ¨£ä¸€æ®µè©±ã€‚

å¯«äº†ä¸€å¤©ä»£ç¢¼ï¼Œçµ‚æ–¼å¾—åˆ°äº†æ¼‚äº®çš„è²»æ›¼ç‰©ç†è¬›ç¾©é›»å­æ›¸ï¼è²»æ›¼ç‰©ç†è¬›ç¾©å…¬é–‹åœ¨ç¶²ä¸Šï¼Œæ˜¯ç”¨`latex`æ¸²æŸ“çš„ã€‚äººå€‘å¸¸ç”¨`latex`ä¾†å¯«è«–æ–‡ï¼Œå®ƒå°æ•¸å­¸å…¬å¼çš„æ¸²æŸ“å¾ˆæ£’ã€‚è€Œå…¬é–‹åœ¨ç¶²ä¸Šï¼Œç”¨åˆ°äº†`mathjax`é€™å€‹åº«ã€‚å®ƒæŠŠ`latex`æºç¢¼è®Šæˆäº†`html`ä»£ç¢¼ï¼Œç”Ÿæˆäº†å¾ˆå¤šçš„`div`å’Œ`span`æ¨™ç±¤ã€‚é›»å­æ›¸å»ä¸æ”¯æŒé€™ç¨®æ–¹å¼ã€‚é€™æ™‚ï¼Œæƒ³æ³•æ˜¯æŠ“å–ç¶²é ï¼Œé€†å‘`mathjax`æ¸²æŸ“ï¼Œæ¥è‘—æ›¿æ›æˆ`svg`åœ–ç‰‡ã€‚å‡ºç¾äº†ä¸å°‘å•é¡Œï¼Œä¸€å€‹æ˜¯æºç¢¼æœ‰å¾ˆå¤šçš„`latex`è‡ªå®šç¾©å®ï¼Œéœ€è¦åŠ ä¸Šï¼›ç¬¬äºŒå€‹æ˜¯å…§åµŒå¾ˆå¤š`svg`æœƒæœ‰å•é¡Œã€‚å¦‚æœæ˜¯å–®å€‹`svg`å€’æ²’å•é¡Œï¼Œå¾ˆå¤šçš„æ™‚å€™æœƒå‡ºç¾å•é¡Œã€‚å¤§æ¦‚æ˜¯ç€è¦½å™¨å’Œ`svg`çš„è©­ç•°Bugã€‚é€™æ™‚åªè¦æŠŠ`svg`ä¿å­˜ç‚ºæ–‡ä»¶ï¼Œç”¨`img`æ¨™ç±¤å¼•å…¥é€²ä¾†å³å¯ã€‚å…¬å¼ä¹Ÿåˆ†ç‚ºå…©ç¨®ï¼Œä¸€ç¨®æ˜¯æ–‡æœ¬ä¸­é–“çš„å…¬å¼ï¼Œä¸€ç¨®æ˜¯å–®è¡Œçš„å…¬å¼ã€‚æ‰€ä»¥ï¼Œæœ€å¾Œå°±å¾—åˆ°äº†æ¼‚äº®çš„é›»å­æ›¸ï¼

### æŸ¥è©¢çš„è³‡æ–™

é€™è£¡è¨˜éŒ„äº†è§£æ±ºé …ç›®éç¨‹ä¸­è¨ªå•çš„è³‡æ–™ã€‚å› ç‚ºé€™æ˜¯ä¸€å€‹æ•™ç¨‹ï¼Œæ‰€ä»¥å‘å­¸ç”Ÿå±•ç¤ºä¸€ä¸‹å¤§æ¦‚åšä¸€å€‹é …ç›®æ˜¯æ€éº¼æ¨£çš„é«”é©—ã€‚

![](assets/images/feynman/s1.PNG)

![](assets/images/feynman/s2.PNG)

![](assets/images/feynman/s3.PNG)

![](assets/images/feynman/s4.PNG)

![](assets/images/feynman/s5.PNG)

![](assets/images/feynman/s6.PNG)

![](assets/images/feynman/s7.PNG)

![](assets/images/feynman/s8.PNG)

### é–‹å§‹é …ç›®

è²»æ›¼ç‰©ç†è¬›ç¾©å·²ç¶“åœ¨å…¬é–‹åœ¨ç¶²ä¸Šå¯ä»¥é–±è®€ã€‚æˆ‘æƒ³åœ¨`Kindle`ä¸Šçœ‹å®ƒã€‚ç„¶è€Œå› ç‚ºå®ƒæœ‰æŒºå¤šçš„æ•¸å­¸å…¬å¼ã€‚å®ƒæœ€åˆçš„ç¨¿å­æ‡‰è©²æ˜¯ç”¨`latex`åšçš„ã€‚å®ƒç”¨`mathjax`é€™å€‹åº«ä¾†æŠŠ`latex`æ ¼å¼çš„å…§å®¹é¡¯ç¤ºåœ¨ç¶²é ä¸Šã€‚

èˆ‰å€‹ä¾‹å­ã€‚

```html
<span class="MathJax_Preview" style="color: inherit; display: none;">
</span>
<div class="MathJax_Display">
    <span class="MathJax MathJax_FullWidth" id="MathJax-Element-10-Frame" tabindex="0" style="">
              <span class="mi" id="MathJax-Span-159" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;">
                </span>  
    </span>
</div>
<script type="math/tex; mode=display" id="MathJax-Element-10">\begin{equation}
\label{Eq:I:13:3}
dT/dt = Fv.
\end{equation}
</script>
```

ä¸Šé¢æ˜¯æˆªå–çš„ä¸€æ®µ`html`ä»£ç¢¼ã€‚é€™ä¸€å¡Š`html`ä»£ç¢¼ä¸­ã€‚`script`æ¨™ç±¤ä¸‹æ˜¯`latex`çš„åŸæ¨£æ–‡æœ¬ã€‚`mathjax`æŠŠå®ƒè®Šæˆå¾ˆå¤šçš„`span`ã€‚ä¾†é¡¯ç¤ºå®ƒã€‚

æˆ‘å€‘ç¾åœ¨æœ‰å€‹æ€è·¯ã€‚å°±æ˜¯æŠŠ`mathjax`çš„é¡¯ç¤ºæ–¹æ³•æ”¹æˆ`svg`åœ–ç‰‡ã€‚

å¾ GitHub ä¸Šæ‰¾åˆ°ä¸€å€‹é …ç›®`tuxu/latex2svg`ã€‚

```python
from latex2svg import latex2svg
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])
```

è©¦è‘—é‹è¡Œï¼Œä½†å‡ºéŒ¯äº†ã€‚

```shell
    raise RuntimeError('latex not found')
RuntimeError: latex not found
```

çœ‹çœ‹ä»£ç¢¼ã€‚

```python
    # Run LaTeX and create DVI file
    try:
        ret = subprocess.run(shlex.split(params['latex_cmd']+' code.tex'),
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                             cwd=working_directory)
        ret.check_returncode()
    except FileNotFoundError:
        raise RuntimeError('latex not found')
```

åŸä¾†é€™ä¹Ÿä¾è³´æ–¼`latex`å‘½ä»¤ã€‚

å®‰è£ä¸€ä¸‹ã€‚

```shell
brew install --cask mactex
==> Caveats
You must restart your terminal window for the installation of MacTex CLI tools to take effect.
Alternatively, Bash and Zsh users can run the command:
  eval "$(/usr/libexec/path_helper)"
==> Downloading http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
==> Downloading from https://mirrors.aliyun.com/CTAN/systems/mac/mactex/mactex-20200407.pkg
######################################################################## 100.0%
All formula dependencies satisfied.
==> Installing Cask mactex
==> Running installer for mactex; your password may be necessary.
installer: Package name is MacTeX
installer: choices changes file '/private/tmp/choices20210315-4643-5884ro.xml' applied
installer: Installing at base path /
installer: The install was successful.
ğŸº  mactex was successfully installed!
```

å®‰è£æˆåŠŸã€‚

```shell
% latex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=latex)
 restricted \write18 enabled.
**
```

```python
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])

svg = open('1.svg', 'w')
svg.write(out['svg'])
svg.close()
```

å¯ä»¥ç”Ÿæˆ`svg`äº†ã€‚

æ‰€ä»¥è©¦è©¦æŠŠ`mathjax`ä¸­å¾—åˆ°çš„`latex`æ–‡æœ¬éƒ½ç”Ÿæˆä¸€ä¸‹ã€‚

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg

file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
content = file.read()

soup = BeautifulSoup(content)

mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    out = latex2svg(mathjax.string)
    print(out['svg'])
```

å¯æƒœå‡ºéŒ¯äº†ã€‚

```python
    raise CalledProcessError(self.returncode, self.args, self.stdout,
subprocess.CalledProcessError: Command '['latex', '-interaction', 'nonstopmode', '-halt-on-error', 'code.tex']' returned non-zero exit status 1.
```

å…·é«”å“ªå€‹å…¬å¼éŒ¯äº†å‘¢ã€‚

```latex
\tfrac{1}{2}mv^2
```

## latex

ä¾†å­¸ç¿’ä¸€ä¸‹`latex`ã€‚

```latex
\documentclass[12pt]{article}
\usepackage{lingmacros}
\usepackage{tree-dvips}
\begin{document}

\section*{Notes for My Paper}

Don't forget to include examples of topicalization.
They look like this:

{\small
\enumsentence{Topicalization from sentential subject:\\ 
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
{ & {\bf R-}clear & {\sc comp} & 
  {\bf IR}.{\sc 3s}-love   & P & him & }
{John, (it's) clear that Mary loves (him).}}
}

\subsection*{How to handle topicalization}

I'll just assume a tree structure like (\ex{1}).

{\small
\enumsentence{Structure of A$'$ Projections:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
}

\subsection*{Mood}

Mood changes when there is a topic, as well as when
there is WH-movement.  \emph{Irrealis} is the mood when
there is a non-subject topic or WH-phrase in Comp.
\emph{Realis} is the mood when there is a subject topic
or WH-phrase.

\end{document}
```

ç¶²ä¸Šæ‰¾åˆ°ä¸€æ®µæ¨£ä¾‹çš„`latex`æºç¢¼ã€‚

```shell
% latex code.tex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=latex)
 restricted \write18 enabled.
entering extended mode
(./code.tex
LaTeX2e <2020-02-02> patch level 5
L3 programming layer <2020-03-06>
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/size12.clo))
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/lingmacros.sty)
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/tree-dvips.sty
tree-dvips version .91 of May 16, 1995
) (/usr/local/texlive/2020/texmf-dist/tex/latex/l3backend/l3backend-dvips.def)
(./code.aux) [1] (./code.aux) )
Output written on code.dvi (1 page, 3416 bytes).
Transcript written on code.log.
```

![latex](assets/images/feynman/latex.png)

ä¾†å°è‘—æºç¢¼å’Œæ¸²æŸ“å¾Œçš„æ•ˆæœï¼Œçœ‹çœ‹èƒ½å­¸åˆ°ä»€éº¼ã€‚

```latex
\begin{document}
\end{document}
```

é€™æ¨£ä¾†æŠŠæ–‡æª”è£¹èµ·ä¾†ã€‚

```latex
\section*{Notes for My Paper}
```

é€™è¡¨ç¤º`section`æ¨™é¡Œé–‹é ­ã€‚

```latex
\subsection*{How to handle topicalization}
```

é€™è¡¨ç¤ºå­æ¨™é¡Œã€‚

```latex
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
```

![shortex](assets/images/feynman/shortex.png)

å¯è¦‹`$_i$`ä¾†è¡¨ç¤ºä¸‹æ¨™ã€‚`{\bf l-}`ä¾†è¡¨ç¤ºåŠ ç²—ã€‚

```latex
\enumsentence{Structure of A$'$ Projections:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
```

<img src="/assets/images/feynman/node.png" alt="node" style="zoom:50%;" />

æ³¨æ„åˆ°`nodeconnect`ä¾†è¡¨ç¤ºé€£ç·šã€‚

### latex è½‰æ›æˆ svg

ç¹¼çºŒé …ç›®ã€‚

```latex
\documentclass[16pt]{article}
\usepackage{amsmath}
\begin{document}

\[\tfrac{1}{2}mv^2\]

\end{document}
```

<img src="/assets/images/feynman/frac.png" alt="frac" style="zoom:50%;" />

é€™æ¨£å¯ä»¥æ­£ç¢ºåœ°è¢«æ¸²æŸ“ã€‚åœ¨ä»£ç¢¼è£¡ç„¡æ³•è¢«æ¸²æŸ“ï¼Œå¯èƒ½æ˜¯å› ç‚ºæ²’æœ‰åŠ ä¸Š`\usepackage{amsmath}`ã€‚

```latex
\documentclass[12pt,preview]{standalone}

\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}

\begin{document}
\begin{preview}
\tfrac{1}{2}mv^2
\end{preview}
\end{document}
```

```shell
! Missing $ inserted.
<inserted text>
                $
l.12 \tfrac{1}{2}
                 mv^2
```

é€™æ¨£å‡ºéŒ¯äº†ã€‚è€Œæ”¹æˆä¸€ä¸‹é€™æ¨£å°±å¯ä»¥ã€‚

```latex
\[\tfrac{1}{2}mv^2\]
```

é€²è¡Œå„ç¨®è©¦æ¢ã€‚

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg

file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
content = file.read()

soup = BeautifulSoup(content, features="lxml")

mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    wrap = '$' + mathjax.string + '$'
    # if 'frac' in mathjax.string:
    #     wrap = '$' + mathjax.string + '$'
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
    out = latex2svg(wrap)
    # print(out)
    node = BeautifulSoup(out['svg'], features="lxml")
    svg = node.find('svg')
    mathjax.insert_after(svg)
    # print(out['svg'])
    # break
    # mathjax.replaceWith(out['svg'])    
    
    # print(dir(mathjax))
    # break
    
    # out = latex2svg(wrap)    
    # print(out['svg'])

# print(len(soup.contents))
    
output_file = open('out.html', 'w')
output_file.write(soup.prettify())
output_file.close()
# print(soup.contents)

# out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])

# svg = open('1.svg', 'w')
# svg.write(out['svg'])
# svg.close()

```

é€™äº›æˆ‘éƒ½åœ¨è©¦æ¢ä»€éº¼å‘¢ã€‚

```python
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
```

é€™è£¡ç•¶è§£æåˆ°æœ‰`FLP`ã€`Fig`ã€`eps`åœ¨`latex`æºç¢¼çš„æ™‚å€™ï¼Œè½‰æ›çš„éç¨‹å‡ºéŒ¯äº†ã€‚

ä¾‹å¦‚ï¼Œåœ¨`HTMLä¸­`ï¼Œæœ‰é€™æ¨£çš„è…³æœ¬ï¼š

```html
<script type="math/tex" id="MathJax-Element-11">\FLPF\cdot\FLPv</script>
```

è§£ææ‹¿åˆ°ï¼š

```latex
\FLPF\cdot\FLPv
```

ç•¶åœ¨ä»£ç¢¼è£¡è½‰æ›çš„æ™‚å€™å‡ºéŒ¯äº†ã€‚ä¹Ÿå³ï¼Œ`latex2svg.py`å‡ºéŒ¯äº†ã€‚é€™è£¡å°±æ˜¯ç”¨`latex`ç¨‹åºä¾†è½‰æ›ã€‚

`code.tex`:

```latex
\documentclass[12pt,preview]{standalone}

\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}

\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}
```

```shell
$latex code.tex
! Undefined control sequence.
l.13     \FLPF
              \cdot\FLPv
?
```

é€™åˆ°åº•æ˜¯ä»€éº¼å•é¡Œã€‚æˆ‘å¾Œä¾†æ‰æ³¨æ„åˆ°åœ¨`html`ä¸­çš„é€™æ®µä»£ç¢¼ã€‚

```html
<script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
        TeX: {
          Macros: {
            FLPvec: ["\\boldsymbol{#1}", 1], Figvec: ["\\mathbf{#1}", 1], FLPC: ["\\FLPvec{C}", 0], FLPF: ["\\FLPvec{F}", 0], FLPa: ["\\FLPvec{a}", 0], FLPb: ["\\FLPvec{b}", 0], FLPr: ["\\FLPvec{r}", 0], FLPs: ["\\FLPvec{s}", 0], FLPv: ["\\FLPvec{v}", 0], ddt: ["\\frac{d#1}{d#2}", 2], epsO: ["\\epsilon_0", 0], FigC: ["\\Figvec{C}", 0]
          }
        }
      });
</script>
```

é€™è¡¨ç¤ºç¶²é åœ¨æ¸²æŸ“çš„æ™‚å€™ï¼Œçµ¦`MathJax`è¨­ç½®ä¸Šäº†å®ã€‚æ‰€ä»¥æˆ‘å€‘çš„`latex`è½‰æ›æºç¢¼è£¡ä¹Ÿæ‡‰è©²åŠ ä¸Šã€‚ä¾†åŠ ä¸Šå®ƒå€‘ã€‚

```latex
\documentclass[12pt,preview]{standalone}

\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}

\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}
```

é€™æ¨£å°±å°äº†ã€‚

![fv1](assets/images/feynman/fv1.png)

### åˆ†æä»£ç¢¼

ä¾†çœ‹çœ‹æœ€å¾Œçš„ä»£ç¢¼ã€‚

```python
import subprocess
from bs4 import BeautifulSoup
from latex2svg import latex2svg

def clean_mathjax(soup, name, cls):
    previews