---
audio: false
generated: true
lang: hant
layout: post
title: 正則表達式
translated: true
type: note
---

正則表達式，常簡稱為「regex」或「regexp」，是一種用於文字模式匹配的強大且多功能工具。它們提供了一種簡潔靈活的方式，根據定義的模式來搜尋、操作和驗證字串。雖然語法初看可能令人卻步，但掌握 regex 能顯著提升你在各種程式語言、文字編輯器和命令列工具中的文字處理能力。

本指南將帶你從基礎到更進階的正則表達式概念。

**I. 基礎：Regex 的構成要素**

核心上，regex 是一串定義搜尋模式的字元。這些字元可以是字面值（匹配自身）或特殊字元（具有特定含義）。

**A. 字面字元：**

regex 中的大多數字元會逐字匹配自身。例如：

* `abc` 將匹配字串中的確切序列 "abc"。
* `123` 將匹配確切序列 "123"。
* `hello` 將匹配確切序列 "hello"。

**B. 元字元：特殊能力**

元字元是賦予 regex 強大功能的構成要素。它們具有特殊含義，不會逐字匹配自身。以下是最常見的元字元：

1.  **`.` (點)：** 匹配除換行字元（預設為 `\n`）外的任何單一字元。
    * `a.c` 將匹配 "abc"、"adc"、"a1c"、"a c"，但不匹配 "ac" 或 "abbc"。

2.  **`^` (脫字號)：**
    * **在字元集合內（見下文）：** 否定該集合，匹配任何*不*在集合內的字元。
    * **在字元集合外：** 匹配字串的開頭（或在多行模式中匹配行的開頭）。
        * `^hello` 將匹配 "hello world" 但不匹配 "say hello"。

3.  **`$` (美元符號)：** 匹配字串的結尾（或在多行模式中匹配行的結尾）。
    * `world$` 將匹配 "hello world" 但不匹配 "world hello"。

4.  **`*` (星號)：** 匹配前面的字元或群組零次或多次。
    * `ab*c` 將匹配 "ac"、"abc"、"abbc"、"abbbc" 等等。

5.  **`+` (加號)：** 匹配前面的字元或群組一次或多次。
    * `ab+c` 將匹配 "abc"、"abbc"、"abbbc"，但不匹配 "ac"。

6.  **`?` (問號)：**
    * 匹配前面的字元或群組零次或一次（使其成為可選）。
        * `ab?c` 將匹配 "ac" 和 "abc"，但不匹配 "abbc"。
    * 作為量詞修飾符使用，使匹配變為非貪婪（見量詞章節）。

7.  **`{}` (大括號)：** 指定前面字元或群組的確切出現次數或範圍。
    * `a{3}` 匹配恰好三個 "a"（例如 "aaa"）。
    * `a{2,4}` 匹配二到四個 "a"（例如 "aa"、"aaa"、"aaaa"）。
    * `a{2,}` 匹配兩個或更多個 "a"（例如 "aa"、"aaa"、"aaaa"、...）。

8.  **`[]` (方括號)：** 定義一個字元集合，匹配括號內的任何單一字元。
    * `[abc]` 將匹配 "a"、"b" 或 "c"。
    * `[a-z]` 將匹配從 "a" 到 "z" 的任何小寫字母（範圍）。
    * `[0-9]` 將匹配從 "0" 到 "9" 的任何數字。
    * `[A-Za-z0-9]` 將匹配任何字母數字字元。
    * `[^abc]`（開頭為 `^`）將匹配除 "a"、"b" 或 "c" 之外的任何字元。

9.  **`\` (反斜線)：** 轉義下一個字元，將元字元視為字面字元，或引入特殊字元序列。
    * `\.` 將匹配字面的點 "."。
    * `\*` 將匹配字面的星號 "*"。
    * `\d` 匹配任何數字（等同於 `[0-9]`）。
    * `\D` 匹配任何非數字字元（等同於 `[^0-9]`）。
    * `\s` 匹配任何空白字元（空格、定位點、換行等）。
    * `\S` 匹配任何非空白字元。
    * `\w` 匹配任何單詞字元（字母數字和底線，等同於 `[a-zA-Z0-9_]`）。
    * `\W` 匹配任何非單詞字元（等同於 `[^a-zA-Z0-9_]`）。
    * `\b` 匹配單詞邊界（單詞字元與非單詞字元之間的位置）。
    * `\B` 匹配非單詞邊界。
    * `\n` 匹配換行字元。
    * `\r` 匹配回車字元。
    * `\t` 匹配定位點字元。

10. **`|` (管道符號)：** 作為 "OR" 運算子，匹配管道符前或後的表達式。
    * `cat|dog` 將匹配 "cat" 或 "dog"。

11. **`()` (圓括號)：**
    * **分組：** 將 regex 的部分組合在一起，允許你對整個群組應用量詞或 OR 運算子。
        * `(ab)+c` 將匹配 "abc"、"ababc"、"abababc" 等等。
        * `(cat|dog) food` 將匹配 "cat food" 或 "dog food"。
    * **捕獲群組：** 捕獲由括號內表達式匹配的文字。這些捕獲的群組可以在之後被引用（例如，用於替換或提取）。

**II. 量詞：控制重複**

量詞指定前面元素（字元、群組或字元集合）可以出現的次數。

* `*`：零次或多次
* `+`：一次或多次
* `?`：零次或一次
* `{n}`：恰好 `n` 次
* `{n,}`：`n` 次或更多次
* `{n,m}`：`n` 到 `m` 次（包含）

**貪婪與非貪婪匹配：**

預設情況下，量詞是**貪婪**的，意味著它們嘗試匹配盡可能多的字串。你可以透過在量詞後面加上 `?` 來使其變為**非貪婪**（或懶惰）。非貪婪量詞嘗試匹配最短可能的字串。

* `a.*b` (貪婪) 在 "axxbxb" 上將匹配 "axxbxb"。
* `a.*?b` (非貪婪) 在 "axxbxb" 上將匹配 "axb" 然後是 "xb"。

**III. 錨點：指定位置**

錨點本身不匹配任何字元，而是斷言字串內的位置。

* `^`：匹配字串（或行）的開頭。
* `$`：匹配字串（或行）的結尾。
* `\b`：匹配單詞邊界。
* `\B`：匹配非單詞邊界。

**IV. 字元類別：預定義集合**

字元類別為常用字元集合提供了簡寫。

* `\d`：匹配任何數字 (0-9)。
* `\D`：匹配任何非數字字元。
* `\s`：匹配任何空白字元（空格、定位點、換行、回車、換頁）。
* `\S`：匹配任何非空白字元。
* `\w`：匹配任何單詞字元（字母數字和底線：a-zA-Z0-9_）。
* `\W`：匹配任何非單詞字元。

**V. 分組與捕獲**

圓括號 `()` 有兩個主要目的：

* **分組：** 允許你對一系列字元應用量詞或 OR 運算子。
* **捕獲：** 建立一個捕獲群組，它儲存了與括號內表達式匹配的字串部分。這些捕獲的群組可以被存取並用於反向引用或替換。

**反向引用：**

你可以使用 `\1`、`\2`、`\3` 等在相同的 regex 內引用先前捕獲的群組，其中數字對應於捕獲群組開括號的順序。

* `(.)\1` 將匹配任何字元後面跟著相同字元（例如 "aa"、"bb"、"11"）。
* `(\w+) \1` 將匹配一個單詞後面跟著一個空格，然後是相同的單詞（例如 "hello hello"）。

**非捕獲群組：**

如果你需要對 regex 的部分進行分組但不建立捕獲群組，可以使用 `(?:...)`。這對於清晰度或效能原因很有用。

* `(?:ab)+c` 將匹配 "abc"、"ababc" 等，但不會捕獲 "ab"。

**VI. 環視：不消耗文字的斷言**

環視是零寬度斷言，它檢查字串中目前位置之前或之後的模式，而不將匹配的環視部分包含在整體匹配中。

* **正向順序環視 `(?=...)`：** 斷言括號內的模式必須跟在目前位置之後。
    * `\w+(?=:)` 將匹配任何後面跟著冒號的單詞，但冒號本身不會是匹配的一部分（例如，在 "name:" 中，它將匹配 "name"）。

* **負向順序環視 `(?!...)`：** 斷言括號內的模式必須*不*跟在目前位置之後。
    * `\w+(?!:)` 將匹配任何後面*不*跟著冒號的單詞（例如，在 "name value" 中，它將匹配 "name" 和 "value"）。

* **正向逆序環視 `(?<=...)`：** 斷言括號內的模式必須在目前位置之前。逆序環視內的模式必須具有固定寬度（不能有可變量詞如 `*` 或 `+`）。
    * `(?<=\$)\d+` 將匹配前面有美元符號的一個或多個數字，但美元符號本身不會是匹配的一部分（例如，在 "$100" 中，它將匹配 "100"）。

* **負向逆序環視 `(?<!...)`：** 斷言括號內的模式必須*不*在目前位置之前。逆序環視內的模式必須具有固定寬度。
    * `(?<!\$)\d+` 將匹配前面*沒有*美元符號的一個或多個數字（例如，在 "100$" 中，它將匹配 "100"）。

**VII. 旗標（修飾符）：控制 Regex 行為**

旗標（或修飾符）用於改變正則表達式引擎的行為。它們通常根據實作方式在 regex 模式的開頭或結尾指定。常見的旗標包括：

* **`i` (不區分大小寫)：** 使匹配不區分大小寫。`[a-z]` 將同時匹配小寫和大寫字母。
* **`g` (全域)：** 在字串中尋找所有匹配項，而不僅僅是第一個。
* **`m` (多行)：** 使 `^` 和 `$` 匹配每行的開頭和結尾（由 `\n` 或 `\r` 分隔），而不僅僅是整個字串的開頭和結尾。
* **`s` (Dotall/單行)：** 使 `.` 元字元匹配任何字元，包括換行字元。
* **`u` (Unicode)：** 為字元類別和其他功能啟用完整的 Unicode 支援。
* **`x` (擴充/詳細)：** 允許你透過忽略模式內的空白和註解來編寫更易讀的 regex（對於複雜的 regex 很有用）。

**VIII. Regex 的實際應用**

Regex 廣泛應用於各個領域：

* **文字編輯器（例如 Notepad++、Sublime Text、VS Code）：** 基於模式尋找和替換文字。
* **程式語言（例如 Python、JavaScript、Java、C#）：**
    * 驗證使用者輸入（例如電子郵件地址、電話號碼、URL）。
    * 從文字中提取特定資訊（例如日期、數字、標籤）。
    * 基於模式替換字串的部分內容。
    * 解析日誌檔案或其他結構化文字資料。
* **命令列工具（例如 `grep`、`sed`、`awk`）：** 搜尋和操作文字檔案。
* **網頁開發：** 表單驗證、URL 路由、內容處理。
* **資料科學：** 資料清理、資料提取、模式識別。
* **安全性：** 入侵檢測、日誌分析。

**IX. 不同程式語言中的 Regex**

大多數現代程式語言都內建支援正則表達式，儘管具體的語法和功能可能略有不同。你通常可以在標準程式庫或模組中找到 regex 功能。

* **Python：** `re` 模組。
* **JavaScript：** 內建的 `RegExp` 物件和字串方法，如 `match()`、`replace()`、`search()`、`split()`。
* **Java：** `java.util.regex` 套件。
* **C# (.NET)：** `System.Text.RegularExpressions` 命名空間。
* **PHP：** 函式如 `preg_match()`、`preg_replace()`、`preg_match_all()`。

**X. 編寫有效 Regex 的技巧**

* **從簡單開始：** 從基本模式開始，逐漸增加複雜度。
* **頻繁測試：** 使用線上 regex 測試器或你程式語言的 regex 工具來針對樣本資料測試你的模式。
* **要具體：** 避免過於寬泛的模式，以免匹配到非預期的文字。
* **明智地使用字元類別和量詞：** 它們功能強大，但如果使用不當也可能導致意外行為。
* **理解貪婪與非貪婪匹配：** 根據你的需求選擇適當的行為。
* **審慎使用分組和捕獲：** 僅捕獲你需要的內容。當不需要捕獲時，使用非捕獲群組。
* **記錄你的 Regex：** 對於複雜的模式，添加註解（特別是在使用 `x` 旗標時）以解釋其目的。
* **考慮邊緣情況：** 思考輸入文字的不同變化，並確保你的 regex 能正確處理它們。
* **分解複雜問題：** 如果你有一個非常複雜的匹配任務，考慮將其分解為多個更簡單的 regex 模式。

**XI. 學習資源**

* **線上 Regex 測試器：** regex101.com, regexr.com, regextester.com
* **語言特定文件：** 參考你所選程式語言的 regex 文件。
* **線上教程和課程：** Coursera、Udemy 和 YouTube 等平台提供全面的 regex 課程。
* **書籍：** Jeffrey Friedl 的《Mastering Regular Expressions》是一個強烈推薦的資源。

**結論**

正則表達式是任何處理文字資料的人不可或缺的工具。雖然初期的學習曲線可能看起來很陡峭，但能夠基於複雜模式高效地搜尋、操作和驗證文字是一項寶貴的技能。通過理解 regex 的基本概念、元字元、量詞和其他功能，你可以在廣泛的應用中顯著提升生產力和解決問題的能力。練習是掌握 regex 的關鍵，所以請勇於嘗試和探索不同模式以應對各種文字處理任務。