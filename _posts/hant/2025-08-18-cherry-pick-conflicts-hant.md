---
audio: false
generated: true
image: false
lang: hant
layout: post
title: 櫻桃挑選衝突與解決方案
translated: true
type: note
---

Git **cherry-pick** 是一個指令，可讓您將某個分支的提交（commit）應用到另一個分支上，而無需合併整個分支歷史。

---

### 運作原理

* 當您執行 `git cherry-pick <commit-hash>` 時，Git 會：

  1. 找出該提交所引入的變更（與其父提交的差異）。
  2. 將這些變更重新應用到您目前的分支上，建立一個具有新哈希值的新提交。
  3. 這表示提交內容會被重複使用，但不會保留原始提交的譜系關係。

這就像是說：
*「只取這個提交的修補檔，並將其貼到我目前的位置。」*

---

### 衝突發生的原因

衝突之所以發生，是因為 cherry-pick 是在**脫離原始脈絡**的情況下應用變更。常見原因包括：

1. **程式碼漂移**
   如果目標分支自原始提交後，在相同的程式碼區域有所變更，Git 將無法乾淨地應用修補檔。例如：

   * 原始提交在 `fileA` 中新增了一個函式。
   * 在目標分支中，有人重新命名或移除了該函式。
     → 在 cherry-pick 時會發生衝突。

2. **缺少依賴提交**
   有時一個提交依賴於先前的提交（例如重構、變數重新命名）。如果您在沒有這些依賴的情況下進行 cherry-pick，脈絡會不同，從而產生衝突。

3. **重疊的變更**
   如果兩個分支都觸及了相同的程式碼行（即使出於不同原因），Git 無法自動決定，並會停止以進行手動解決。

---

### 範例情境

* `feature-branch` 擁有提交 A → B → C。
* 您希望將提交 B 放入 `main` 分支。
* 您執行 `git checkout main && git cherry-pick B`。
* 如果 `main` 分支已經觸及與 B 相同的檔案/程式碼行，Git 會引發衝突。您必須開啟檔案、解決差異、執行 `git add`，然後執行 `git cherry-pick --continue`。

---

👉 簡而言之：**Cherry-pick 是在新脈絡中重新套用修補檔。當該脈絡與原始脈絡差異過大時，就會發生衝突。**

您是否也希望我帶您了解**減少 cherry-pick 衝突的最佳實踐**（例如提交排序、使用 `-x` 或先進行 rebase）？