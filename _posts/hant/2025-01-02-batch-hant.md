---
audio: true
lang: hant
layout: post
title: 批量作业还是逐个处理
---

今天，我们公寓的供水出了点问题，一时半会儿供不了水。吃完饭，看着家人和我留下的一堆堆碗碟，我想到了几个问题。

一是如何让洗碗机在没有自来水供应的情况下继续工作。它可能被设计成可以连接到一个水桶上。此外，水管的连接头应该是灵活的，以便轻松地从公共供水切换到私人自制的桶装水。

另一点是分批还是一次性完成工作的问题。我们可以每顿饭后洗碗，或者等一天或几天后再洗。这是从我们吃饭和洗碗的角度来看的。我们也可以从洗碗机可以容纳多少盘子的角度来看待这个问题。

这让我想起了编程。我们可以批量执行任务，也可以逐一进行。

分批处理工作会带来一个明显的问题：它需要更多的资源。由于我们延迟了清洗，就需要更多的碗碟；同样，由于我们累积数据以推迟处理，就需要更多的内存空间。

现实生活中，一次能处理的空间或物品数量是有限的。例如，洗碗机最多可能只能处理二十个盘子，这就像程序在计算机上有内存限制，或者道路有能通过的汽车数量限制一样。

还有如何分离任务的问题。我们应该一次分离一个任务还是一次分离三个任务？

对于盘子或汽车，将每个物品视为一个单位很简单。这意味着一个盘子就是一个盘子，一辆汽车就是一辆汽车。通常，它们不能被分解成更小的部分。不过也有例外，比如一辆载有许多汽车的大卡车；一辆大卡车可以分解为一个大型单位和许多经过道路的汽车。

在编程中，情况就灵活多了。即使是一个插入或更新SQL，也可以分解成更小的部分，更不用说下载任务、DFS搜索或查询了。

好的，现在我们已经考虑了处理单元的问题。那么，接下来的问题是，我们应该在一个批次中处理多少个单元。这个数量可以是从一到总单元数之间的任意数字。

这里的问题在于，一个任务的批次数量是固定的还是动态的。对于生成式AI而言，输入文本的总字符数是灵活的。它有一定的上下文限制或输入限制，但在其限制范围内，输入是灵活的。

使用洗碗机时，其内部空间是有限的。在这个限制内，餐具的数量可以灵活调整。我们通常会把需要清洗的餐具尽可能多地放入机器中。

对于程序而言，数据库一次处理的SQL批量存在一个上限。在这个上限内，它能够处理的SQL数量是灵活的。但我们需要考虑将SQL从客户端传递到数据库服务器的网络任务量、用户能等待的时间，以及批量中某一单元任务失败时的情况。

因此，对于一批次应处理多少单位任务的问题，我们需要综合考虑工作的目标、下游消费者或处理者的能力限制以及任务失败的可能性。

这种思维方式可以应用到很多事情上。基本上有两个问题需要考虑：什么是单元任务，以及我们应该批量处理多少个单元。通过考虑这些问题，我们可能会找到一个最优的解决方案。

