---
audio: false
generated: true
lang: hant
layout: post
title: 查詢引擎
translated: true
type: note
---

查詢引擎是數據庫管理系統（DBMS）中的一個組件，負責解讀和執行數據庫查詢（通常以 SQL 或類似語言編寫）。其主要功能是處理查詢並返回相應結果。以下是其運作流程的詳細解析：

### 1. **查詢解析：**
   - **詞法分析：** 第一步是解析查詢語法。引擎使用詞法分析器將查詢分解為詞元（例如關鍵字、識別符、運算符）。
   - **語法分析：** 接著將詞元解析為查詢樹或語法樹，以驗證查詢結構的正確性。此過程會檢查查詢是否符合語法規範，並確認引用的資料表、欄位及條件是否有效。

### 2. **優化處理：**
   - **查詢重寫：** 解析完成後，引擎可能會重寫查詢以進行優化。這可能包括簡化查詢的特定部分（例如移除冗餘條件或合併子查詢）。
   - **基於成本的優化：** 查詢優化器會生成多個執行計劃，並根據數據統計資訊（如磁碟 I/O、CPU 使用率等因素）評估每個計劃的「成本」，最終選擇成本最低的計劃執行。優化器可能根據數據統計選擇索引、連接方法（例如巢狀循環、雜湊連接）及存取路徑。

### 3. **執行計劃生成：**
   - 查詢引擎選擇最優執行計劃，包括決定數據擷取方式（使用索引、順序掃描等）及多表連接策略。
   - 計劃可能還包含排序、篩選、分組和聚合等操作。

### 4. **計劃執行：**
   - 引擎按特定順序執行計劃中的必要操作。例如，若需連接兩個資料表，可能根據優化器選擇的計劃採用雜湊連接或巢狀循環連接。
   - 執行過程中，引擎可能從磁碟擷取數據（若未緩存）並處理結果。

### 5. **返回結果：**
   - 執行完成後，查詢引擎將結果返回給用戶或應用程式。結果形式可能是行列數據集（針對 SELECT 查詢）、確認訊息（針對 INSERT/UPDATE 查詢），或在出錯時返回錯誤訊息。

### 查詢引擎核心組件：
- **解析器：** 將 SQL 查詢驗證並解析為內部結構
- **優化器：** 為查詢尋找最佳執行計劃
- **執行器：** 執行所選計劃並從數據庫檢索數據
- **緩存：** 常存取數據可緩存以加速後續查詢執行

### 範例：
假設執行以下查詢：
```sql
SELECT name, age FROM users WHERE age > 30 ORDER BY age;
```

1. **解析：** 查詢被解析為語法樹
2. **優化：** 優化器決定過濾年齡大於 30 歲用戶的最佳方式，可能使用 `age` 欄位的索引（若存在）
3. **執行：** 引擎從 `users` 表檢索相關數據行，應用過濾條件並按 `age` 排序結果
4. **返回結果：** 引擎返回排序後的結果（例如年逾 30 歲的用戶清單）

您是否想深入了解此流程的特定環節？