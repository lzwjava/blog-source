---
audio: false
generated: true
lang: fr
layout: post
title: Configuration d'un serveur SFTP sur Ubuntu
translated: true
type: note
---

Configurer un serveur SFTP (SSH File Transfer Protocol) sur Ubuntu est un processus simple qui vous permet de transférer des fichiers de manière sécurisée sur un réseau en utilisant le chiffrement SSH. Voici un guide complet, étape par étape, pour vous aider à le configurer.

---

### Étape 1 : Installer le serveur OpenSSH
SFTP repose sur le serveur OpenSSH, que vous devez installer sur votre système Ubuntu.

1. Ouvrez un terminal et mettez à jour votre liste de paquets :
   ```bash
   sudo apt update
   ```

2. Installez le serveur OpenSSH :
   ```bash
   sudo apt install openssh-server
   ```

3. Vérifiez que le service SSH est en cours d'exécution :
   ```bash
   sudo systemctl status ssh
   ```
   - S'il n'est pas en cours d'exécution, démarrez-le :
     ```bash
     sudo systemctl start ssh
     ```
   - Assurez-vous qu'il démarre au boot :
     ```bash
     sudo systemctl enable ssh
     ```

---

### Étape 2 : Créer un utilisateur dédié pour SFTP
Pour une meilleure sécurité, créez un utilisateur spécifique pour l'accès SFTP.

1. Ajoutez un nouvel utilisateur (par exemple, `sftpuser`) :
   ```bash
   sudo adduser sftpuser
   ```
   - Suivez les invites pour définir un mot de passe et remplir les détails facultatifs.

2. (Optionnel) Empêchez cet utilisateur d'accéder à un shell via SSH :
   ```bash
   sudo usermod -s /bin/false sftpuser
   ```

---

### Étape 3 : Configurer SSH pour SFTP
Vous pouvez soit autoriser tous les utilisateurs à utiliser SFTP avec leurs répertoires personnels, soit restreindre des utilisateurs spécifiques à certains dossiers.

#### Option 1 : Autoriser SFTP pour tous les utilisateurs
Si vous souhaitez que tous les utilisateurs accèdent à leurs répertoires personnels via SFTP, aucune configuration supplémentaire n'est nécessaire après l'installation d'OpenSSH. Passez à l'Étape 5.

#### Option 2 : Restreindre un utilisateur à un répertoire spécifique
Pour confiner un utilisateur (par exemple, `sftpuser`) à un répertoire spécifique :

1. Modifiez le fichier de configuration SSH :
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

2. Ajoutez les lignes suivantes à la fin du fichier :
   ```ini
   Match User sftpuser
       ChrootDirectory /home/sftpuser
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   - Enregistrez le fichier (`Ctrl+O`, puis `Entrée`) et quittez (`Ctrl+X`).

3. Cette configuration :
   - Limite `sftpuser` à `/home/sftpuser`.
   - Impose l'utilisation de SFTP uniquement.
   - Désactive les fonctionnalités supplémentaires comme le transfert TCP.

---

### Étape 4 : Configurer les permissions des répertoires
Pour que la configuration restrictive (chroot) fonctionne, ajustez les permissions :

1. Faites en sorte que le répertoire chroot appartienne à root :
   ```bash
   sudo chown root:root /home/sftpuser
   ```

2. Créez un sous-répertoire accessible en écriture pour l'utilisateur (par exemple, `uploads`) :
   ```bash
   sudo mkdir /home/sftpuser/uploads
   sudo chown sftpuser:sftpuser /home/sftpuser/uploads
   ```
   - L'utilisateur peut maintenant téléverser des fichiers dans `/home/sftpuser/uploads`.

---

### Étape 5 : Redémarrer le service SSH
Appliquez vos modifications en redémarrant SSH :
```bash
sudo systemctl restart ssh
```

---

### Étape 6 : Tester votre serveur SFTP
Vérifiez que le serveur fonctionne en vous y connectant depuis un autre appareil.

1. Trouvez l'adresse IP de votre machine Ubuntu :
   ```bash
   ip addr show
   ```
   - Cherchez une IP comme `192.168.1.100`.

2. Testez la connexion :
   - **Depuis un terminal (Linux/macOS) :**
     ```bash
     sftp sftpuser@<adresse-ip-ubuntu>
     ```
     - Saisissez le mot de passe lorsqu'il est demandé.
   - **En utilisant FileZilla (n'importe quel OS) :**
     - Hôte : `sftp://<adresse-ip-ubuntu>`
     - Nom d'utilisateur : `sftpuser`
     - Mot de passe : (votre mot de passe)
     - Port : 22

3. Essayez de téléverser un fichier vers le dossier `uploads` ou de lister le contenu du répertoire.

---

### Étape 7 : Configurer le pare-feu
Si vous utilisez le pare-feu d'Ubuntu (UFW), autorisez le trafic SFTP :

1. Vérifiez le statut du pare-feu :
   ```bash
   sudo ufw status
   ```

2. Autorisez SSH/SFTP (port 22) :
   ```bash
   sudo ufw allow 22/tcp
   sudo ufw reload
   ```

---

### Terminé !
Votre serveur SFTP est maintenant prêt ! Les utilisateurs peuvent se connecter de manière sécurisée et transférer des fichiers vers leurs répertoires désignés en utilisant un client SFTP. Si vous avez restreint `sftpuser`, il n'aura accès qu'à `/home/sftpuser/uploads` (ou l'emplacement que vous avez défini). Profitez de transferts de fichiers sécurisés !