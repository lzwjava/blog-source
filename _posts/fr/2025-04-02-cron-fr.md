---
audio: false
generated: true
lang: fr
layout: post
title: Guide Complet de Cron
translated: true
type: note
---

Cron est un puissant planificateur de tâches basé sur le temps dans les systèmes d'exploitation de type Unix qui permet aux utilisateurs de planifier des commandes ou des scripts pour qu'ils s'exécutent automatiquement à des moments ou à des intervalles spécifiés. Voici un guide complet pour comprendre et utiliser cron efficacement.

## Qu'est-ce que Cron ?

Cron est un démon (service en arrière-plan) qui exécute des commandes planifiées. Il lit les fichiers de configuration appelés "crontabs" (tables cron) pour déterminer quand exécuter des commandes particulières. Cron est idéal pour :
- La maintenance système de routine
- Les sauvegardes automatisées
- La planification du traitement périodique des données
- L'exécution de scripts à des moments spécifiques
- Toute tâche qui doit s'exécuter régulièrement sans intervention manuelle

## Composants de Cron

### Le Fichier Crontab

Le crontab (table cron) est un fichier de configuration qui spécifie les commandes shell à exécuter périodiquement. Chaque utilisateur peut avoir son propre crontab, et il existe également un crontab système.

Pour modifier votre crontab personnel :
```bash
crontab -e
```

Pour visualiser votre crontab actuel :
```bash
crontab -l
```

Pour supprimer votre crontab :
```bash
crontab -r
```

### Syntaxe Crontab

Chaque ligne dans un fichier crontab représente une tâche planifiée et suit ce format :

```
* * * * * commande-à-exécuter
│ │ │ │ │
│ │ │ │ └─── Jour de la semaine (0-6, Dimanche=0)
│ │ │ └───── Mois (1-12)
│ │ └─────── Jour du mois (1-31)
│ └───────── Heure (0-23)
└─────────── Minute (0-59)
```

Chaque position peut contenir :
- Un nombre spécifique
- Une plage (par exemple, `1-5`)
- Une liste de valeurs (par exemple, `1,3,5`)
- Un astérisque (`*`) signifiant "tous"
- Une valeur de pas (`*/n`) signifiant "tous les n"

Après les cinq champs de temps/date vient la commande à exécuter.

## Exemples de Planifications Cron Courantes

# Exemples de Planifications Cron Courantes

## Intervalles de Temps de Base

| Expression Cron | Description | Exemple |
|----------------|-------------|---------|
| `* * * * *` | Exécuter toutes les minutes | `* * * * * date >> /tmp/date_log.txt` |
| `*/5 * * * *` | Exécuter toutes les 5 minutes | `*/5 * * * * /scripts/check_server.sh` |
| `0 * * * *` | Exécuter au début de chaque heure | `0 * * * * /scripts/hourly_backup.sh` |
| `0 0 * * *` | Exécuter à minuit chaque jour | `0 0 * * * /scripts/daily_backup.sh` |
| `0 0 * * 0` | Exécuter à minuit les dimanches | `0 0 * * 0 /scripts/weekly_maintenance.sh` |
| `0 0 1 * *` | Exécuter à minuit le premier jour de chaque mois | `0 0 1 * * /scripts/monthly_report.sh` |
| `0 0 1 1 *` | Exécuter à minuit le 1er janvier (annuel) | `0 0 1 1 * /scripts/yearly_cleanup.sh` |

## Heures Spécifiques

| Expression Cron | Description | Exemple |
|----------------|-------------|---------|
| `30 8 * * 1-5` | Exécuter à 8h30 les jours de semaine (Lundi-Vendredi) | `30 8 * * 1-5 /scripts/workday_start.sh` |
| `0 18 * * 1-5` | Exécuter à 18h00 les jours de semaine | `0 18 * * 1-5 /scripts/workday_end.sh` |
| `0 9-17 * * *` | Exécuter au début de chaque heure pendant les heures de bureau (9h - 17h) | `0 9-17 * * * /scripts/hourly_check.sh` |
| `0 0,12 * * *` | Exécuter à minuit et midi | `0 0,12 * * * /scripts/twice_daily.sh` |

## Spécifications de Temps Multiples

| Expression Cron | Description | Exemple |
|----------------|-------------|---------|
| `0 */4 * * *` | Exécuter toutes les 4 heures | `0 */4 * * * /scripts/periodic_task.sh` |
| `0 4,16 * * *` | Exécuter à 4h00 et 16h00 | `0 4,16 * * * /scripts/twice_daily_at_4.sh` |
| `15,45 * * * *` | Exécuter à 15 et 45 minutes après chaque heure | `15,45 * * * * /scripts/quarter_hourly.sh` |

## Spécifications de Temps Spéciales

| Expression Cron | Description | Exemple |
|----------------|-------------|---------|
| `@reboot` | Exécuter une fois au démarrage | `@reboot /scripts/startup_task.sh` |
| `@yearly` ou `@annually` | Exécuter une fois par an (`0 0 1 1 *`) | `@yearly /scripts/annual_task.sh` |
| `@monthly` | Exécuter une fois par mois (`0 0 1 * *`) | `@monthly /scripts/monthly_task.sh` |
| `@weekly` | Exécuter une fois par semaine (`0 0 * * 0`) | `@weekly /scripts/weekly_task.sh` |
| `@daily` ou `@midnight` | Exécuter une fois par jour (`0 0 * * *`) | `@daily /scripts/daily_task.sh` |
| `@hourly` | Exécuter une fois par heure (`0 * * * *`) | `@hourly /scripts/hourly_task.sh` |

## Exemples Complexes

| Expression Cron | Description | Exemple |
|----------------|-------------|---------|
| `0 0 */2 * *` | Exécuter à minuit tous les deux jours | `0 0 */2 * * /scripts/every_other_day.sh` |
| `0 3 * * 1,3,5` | Exécuter à 3h00 les lundi, mercredi et vendredi | `0 3 * * 1,3,5 /scripts/mwf_task.sh` |
| `30 23 * * 2,4` | Exécuter à 23h30 les mardi et jeudi | `30 23 * * 2,4 /scripts/tue_thu_night.sh` |
| `45 11 1-7 * *` | Exécuter à 11h45 pendant la première semaine de chaque mois | `45 11 1-7 * * /scripts/first_week_task.sh` |
| `0 20 * 10,11,12 *` | Exécuter à 20h00 pendant octobre, novembre et décembre | `0 20 * 10,11,12 * /scripts/q4_evening_task.sh` |
| `0 9-17/2 * * 1-5` | Exécuter toutes les deux heures pendant les heures de bureau les jours de semaine | `0 9-17/2 * * 1-5 /scripts/biweekly_workday.sh` |


## Chaînes Spéciales Cron

Cron prend également en charge plusieurs chaînes spéciales pour les spécifications de temps courantes :

- `@reboot` : Exécuter une fois au démarrage
- `@yearly` ou `@annually` : Exécuter une fois par an (équivalent à `0 0 1 1 *`)
- `@monthly` : Exécuter une fois par mois (équivalent à `0 0 1 * *`)
- `@weekly` : Exécuter une fois par semaine (équivalent à `0 0 * * 0`)
- `@daily` ou `@midnight` : Exécuter une fois par jour (équivalent à `0 0 * * *`)
- `@hourly` : Exécuter une fois par heure (équivalent à `0 * * * *`)

## Gestion de la Sortie et des Erreurs

Par défaut, cron envoie la sortie des commandes par email à l'utilisateur propriétaire du crontab. Vous pouvez rediriger la sortie vers un fichier ou la supprimer :

```bash
# Ajouter la sortie à un fichier journal
30 5 * * * /path/to/script.sh >> /path/to/logfile.log 2>&1

# Supprimer toute la sortie
0 12 * * * /path/to/script.sh > /dev/null 2>&1
```

## Variables d'Environnement dans Cron

Les tâches cron s'exécutent avec un environnement minimal, ce qui peut entraîner l'échec des scripts. Vous pouvez définir des variables dans le fichier crontab :

```bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
SHELL=/bin/bash
MAILTO=your-email@example.com

# Les tâches utiliseront maintenant ces variables d'environnement
0 5 * * * /path/to/script.sh
```

## Considérations de Sécurité pour Cron

1. Utilisez des chemins absolus pour toutes les commandes et scripts
2. Restreignez les permissions du fichier crontab
3. Utilisez le principe du moindre privilège lors de la configuration des tâches cron
4. Journalisez et surveillez la sortie des tâches cron pour le débogage
5. Envisagez d'utiliser un utilisateur dédié pour les tâches cron sensibles

## Dépannage des Tâches Cron

Les problèmes courants avec les tâches cron incluent :

1. **La tâche ne s'exécute pas** : Vérifiez les permissions et les chemins
2. **Problèmes de timing** : Vérifiez que le format de l'heure est correct
3. **Problèmes d'environnement** : Assurez-vous que les variables nécessaires sont définies
4. **Erreurs de script** : Testez d'abord le script manuellement

Vérifiez les journaux système pour les messages liés à cron :
```bash
grep CRON /var/log/syslog
```

## Alternatives à Cron

Bien que cron soit très répandu, il existe des alternatives :

- **Anacron** : Mieux adapté aux systèmes qui ne fonctionnent pas 24h/24 et 7j/7
- **Systemd Timers** : Alternative moderne sur les systèmes basés sur systemd
- **Fcron** : Cron amélioré avec des fonctionnalités de type anacron
- **Schedule** : Planificateurs de tâches de haut niveau souvent utilisés dans les applications web

## Utilisation Avancée de Cron

### Exécution de Tâches en Tant Qu'Autres Utilisateurs

Pour modifier le crontab d'un autre utilisateur (nécessite les droits root) :
```bash
sudo crontab -u username -e
```

### Crontabs Système

Les tâches cron système peuvent être ajoutées dans :
- `/etc/crontab`
- Les fichiers dans `/etc/cron.d/`
- Les répertoires comme `/etc/cron.daily/`, `/etc/cron.hourly/`, etc.

La syntaxe pour les crontabs système inclut un champ utilisateur supplémentaire :
```
* * * * * utilisateur commande-à-exécuter
```

### Exécution de Tâches Cron avec un Environnement Spécifique

Créez un script wrapper pour configurer l'environnement avant d'exécuter votre commande réelle :

```bash
#!/bin/bash
source /home/user/.profile
cd /path/to/working/directory
/path/to/actual/command
```

Puis appelez ce script wrapper depuis cron.

## Bonnes Pratiques pour les Tâches Cron

1. **Documentez vos tâches cron** : Ajoutez des commentaires pour expliquer ce que fait chaque tâche
2. **Utilisez des noms de script descriptifs** : Facilite la maintenance
3. **Journalisez les sorties** : Sauvegardez les sorties des tâches pour le dépannage
4. **Surveillez l'exécution des tâches** : Mettez en place une surveillance pour les tâches critiques
5. **Gérez les échecs avec élégance** : Ajoutez la gestion des erreurs à vos scripts
6. **Utilisez des fichiers de verrouillage** : Empêchez l'exécution simultanée lorsque les tâches prennent plus de temps que prévu
7. **Prenez en compte les fuseaux horaires** : Soyez conscient des paramètres de fuseau horaire du système

En suivant ce guide, vous devriez être capable de configurer, gérer et dépanner efficacement les tâches cron sur votre système de type Unix.