---
audio: false
generated: true
image: false
lang: fr
layout: post
model: x-ai/grok-4-fast
title: Désactivation des paquets utilisateur de Python
translated: true
type: note
---

Le paquet **est déjà installé** dans votre répertoire utilisateur (`~/.local/lib/python3.13/site-packages`), mais lorsque vous exécutez le script avec `python3 ./scripts/train/extract_wiki.py`, Python **ne cherche pas dans le répertoire user site-packages** pour une raison quelconque.

C'est un problème très courant avec Python 3.11+ sur de nombreuses distributions Linux (Ubuntu 22.04/24.04, Debian, Arch, etc.) car le `python3` par défaut a souvent la variable d'environnement `PYTHONNOUSERSITE=1` définie ou le flag `-I` (isolated) activé par le gestionnaire de paquets système, ce qui **désactive complètement le chemin user site-packages**.

### Vérifications rapides pour confirmer le problème

Exécutez ces deux commandes :

```bash
python3 -c "import sys, pathlib; print('user site:', pathlib.Path(sys.path[-1]).resolve() if 'site-packages' in sys.path[-1] else 'DISABLED')"
python3 -c "import site; print(site.ENABLE_USER_SITE)"
```

Si vous voyez `DISABLED` ou `False` ou `None`, c'est exactement le problème.

### Solutions (choisissez-en une)

#### Option 1 – Utiliser `python3 -m pip` et exécuter avec le même Python (recommandé)

```bash
# Utilisez toujours la forme module pour être sûr à 100% de la version de Python utilisée pour l'installation
python3 -m pip install --user --upgrade mediawiki-dump

# Puis exécutez votre script avec le même Python
python3 ./scripts/train/extract_wiki.py
```

Si cela échoue encore, forcez l'activation du user site :

```bash
python3 -s ./scripts/train/extract_wiki.py
# ou
PYTHONNOUSERSITE=0 python3 ./scripts/train/extract_wiki.py
```

#### Option 2 – Utiliser un environnement virtuel (meilleure pratique de toute façon)

```bash
cd /home/lzw/projects/blog-source
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install mediawiki-dump   # s'installera dans le venv, pas de problèmes de permissions
python ./scripts/train/extract_wiki.py   # le trouvera définitivement maintenant
```

#### Option 3 – Forcer l'activation permanente du user site (non recommandé pour le Python système)

Ajoutez ceci à votre `~/.bashrc` ou `~/.zshrc` :

```bash
export PYTHONNOUSERSITE=
```

ou créez `~/.config/pythonstartup.py` avec :

```python
import site
import os
os.environ["PYTHONNOUSERSITE"] = ""
```

### Test rapide en une ligne maintenant

Exécutez simplement ceci dans votre shell actuel :

```bash
python3 -s -c "from mediawiki_dump.tokenizer import WikiTokenizer; print('Works!')"
```

Si cela affiche "Works!", alors la solution est simplement de toujours utiliser `python3 -s` ou de créer un venv.

Choisissez la solution avec l'environnement virtuel (Option 2) — cela vous évitera d'innombrables problèmes avec tous les autres paquets aussi. Faites-moi savoir si vous rencontrez une nouvelle erreur après cela !