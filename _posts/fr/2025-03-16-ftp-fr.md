---
audio: false
generated: true
lang: fr
layout: post
title: Serveur FTP
translated: true
type: note
---

Pour configurer un serveur FTP sur Ubuntu afin d'accéder à vos fichiers (comme ces fichiers `.mkv` dans `/var/www/movies/`) depuis votre iPad ou d'autres appareils, vous pouvez utiliser **vsftpd** (Very Secure FTP Daemon), une option légère et sécurisée. Voici un guide étape par étape adapté à votre configuration :

### Prérequis
- Vous êtes sur Ubuntu (par exemple, 22.04 ou 24.04 en date du 15 mars 2025).
- Vous avez les privilèges sudo.
- Votre serveur Nginx est à l'adresse `192.168.1.27`, et les fichiers se trouvent dans `/var/www/movies/`.

### Étape 1 : Installer vsftpd
1. **Mettre à jour la liste des paquets** :
   ```bash
   sudo apt update
   ```
2. **Installer vsftpd** :
   ```bash
   sudo apt install vsftpd -y
   ```
3. **Vérifier l'installation** :
   ```bash
   sudo systemctl status vsftpd
   ```
   - Cela devrait indiquer `active (running)`. Sinon, démarrez-le :
     ```bash
     sudo systemctl start vsftpd
     sudo systemctl enable vsftpd  # Démarrer au boot
     ```

### Étape 2 : Configurer vsftpd
Le fichier de configuration par défaut est `/etc/vsftpd.conf`. Nous allons le modifier pour un accès basique.

1. **Sauvegarder la configuration originale** :
   ```bash
   sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.bak
   ```

2. **Modifier la configuration** :
   ```bash
   sudo nano /etc/vsftpd.conf
   ```
   Apportez ces modifications :
   - Activer les utilisateurs locaux :
     ```bash
     local_enable=YES
     ```
   - Autoriser les téléversements de fichiers (optionnel, si vous souhaitez uploader des fichiers) :
     ```bash
     write_enable=YES
     ```
   - Restreindre les utilisateurs à leurs répertoires personnels (optionnel, pour la sécurité) :
     ```bash
     chroot_local_user=YES
     ```
   - Pointer vers votre répertoire de films (optionnel, voir l'Étape 3 pour la configuration utilisateur) :
     - Par défaut, les utilisateurs accèdent à leurs répertoires personnels. Nous ajusterons cela plus tard.

   Sauvegardez (`Ctrl + O`, Entrée, `Ctrl + X`).

3. **Redémarrer vsftpd** :
   ```bash
   sudo systemctl restart vsftpd
   ```

### Étape 3 : Configurer un utilisateur FTP
Vous pouvez utiliser un utilisateur existant ou en créer un nouveau pour accéder à `/var/www/movies/`.

#### Option 1 : Utiliser un utilisateur existant
Si vous souhaitez utiliser votre utilisateur Ubuntu actuel (par exemple, `user`) :
1. **Vérifier votre nom d'utilisateur** :
   ```bash
   whoami
   ```
2. **Définir un mot de passe (si nécessaire)** :
   ```bash
   sudo passwd user  # Remplacez "user" par votre nom d'utilisateur
   ```
3. **Lier au répertoire des films** :
   - Par défaut, le répertoire personnel de cet utilisateur (par exemple, `/home/user/`) est la racine FTP. Pour accéder à `/var/www/movies/`, créez un lien symbolique :
     ```bash
     ln -s /var/www/movies/ /home/user/movies
     ```
   - Ou, ajustez les permissions (moins sécurisé) :
     ```bash
     sudo chown -R user:user /var/www/movies
     ```

#### Option 2 : Créer un utilisateur FTP dédié
Pour une meilleure sécurité :
1. **Ajouter un utilisateur** :
   ```bash
   sudo adduser ftpuser
   ```
   - Suivez les invites pour définir un mot de passe et les détails.
2. **Définir le répertoire personnel sur Movies** :
   ```bash
   sudo usermod -d /var/www/movies ftpuser
   sudo chown -R ftpuser:ftpuser /var/www/movies
   ```

3. **Restreindre l'accès** (si `chroot_local_user=YES`) :
   - Assurez-vous que `/var/www/movies` est accessible en écriture par `ftpuser` :
     ```bash
     sudo chmod -R 755 /var/www/movies
     ```

### Étape 4 : Ouvrir les ports du pare-feu
FTP utilise les ports 20 et 21 par défaut.
1. **Autoriser FTP dans UFW** :
   ```bash
   sudo ufw allow 21/tcp
   sudo ufw allow 20/tcp
   sudo ufw status
   ```
   - Devrait afficher `20/tcp ALLOW` et `21/tcp ALLOW`.

2. **Redémarrer vsftpd** :
   ```bash
   sudo systemctl restart vsftpd
   ```

### Étape 5 : Tester FTP depuis l'iPad
Vous aurez besoin d'une application client FTP sur votre iPad.

#### Application iPad recommandée : FileZilla ou FE File Explorer
- **FileZilla** (Gratuit) :
  1. Installez depuis l'App Store (recherchez "FileZilla").
  2. Ouvrez FileZilla.
  3. Appuyez sur **New Site** ou **Connect**.
  4. Entrez :
     - Hôte : `192.168.1.27`
     - Utilisateur : `ftpuser` (ou votre nom d'utilisateur)
     - Mot de passe : [votre mot de passe]
     - Port : 21 (par défaut)
  5. Appuyez sur **Connect**.
- **FE File Explorer** (Gratuit avec achats intégrés) :
  1. Installez depuis l'App Store.
  2. Appuyez sur **+** > **FTP**.
  3. Entrez les mêmes détails que ci-dessus.
  4. Connectez-vous.

#### Streaming depuis FTP
- La plupart des applications FTP permettent de parcourir les fichiers. Pour diffuser les fichiers `.mkv` :
  - Appuyez sur le fichier `.mkv` dans l'application.
  - S'il ne se lit pas directement, téléchargez une application de streaming comme **VLC for Mobile** (voir la réponse précédente), puis utilisez son option **Network Stream** avec une URL FTP :
    ```
    ftp://ftpuser:password@192.168.1.27/yourfile.mkv
    ```

### Étape 6 : Vérifier l'accès
- Depuis votre iPad, connectez-vous à `192.168.1.27` via l'application FTP.
- Vous devriez voir le contenu de `/var/www/movies/` (par exemple, `yourfile.mkv`).
- Appuyez pour prévisualiser ou diffuser (selon l'application).

### Dépannage
- **Connexion refusée** : Vérifiez `sudo ufw status` et assurez-vous que les ports 20/21 sont ouverts. Vérifiez que vsftpd est en cours d'exécution (`sudo systemctl status vsftpd`).
- **Permission refusée** : Confirmez que l'utilisateur possède ou peut lire `/var/www/movies/` (`ls -l /var/www/movies/`).
- **404 ou aucun fichier** : Assurez-vous que le chemin du répertoire correspond au répertoire personnel de l'utilisateur ou à la configuration du lien symbolique.

### Notes finales
- **Sécurité** : Pour un réseau local, cette configuration est adaptée. Pour un accès externe, envisagez FTPS (FTP chiffré) en activant SSL dans `vsftpd.conf`.
- **Nginx vs. FTP** : Vous diffusez déjà via HTTP avec Nginx—FTP ajoute la gestion de fichiers. Utilisez VLC sur votre iPad pour la diffusion HTTP si la configuration FTP semble redondante.

Votre iPad a maintenant la "magie" FTP pour accéder aux fichiers de votre serveur Ubuntu ! Faites-moi savoir si vous rencontrez des problèmes.