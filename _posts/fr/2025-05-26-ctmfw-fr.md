---
audio: false
generated: true
lang: fr
layout: post
title: La commande ctmfw dans Control-M
translated: true
type: note
---

La commande `ctmfw` dans Control-M fait partie de l'utilitaire File Watcher, utilisé pour surveiller les fichiers en cas d'événements tels que la création, la suppression ou l'achèvement d'un transfert. La commande spécifique `ctmfw %%FILENAME CREATE 0 60 10 3 1410` peut être décomposée en fonction des paramètres définis dans la documentation Control-M. Voici ce que signifie chaque partie :

- **`ctmfw`** : L'utilitaire Control-M File Watcher, qui détecte les événements liés aux fichiers et déclenche des actions en fonction de conditions, comme le démarrage d'un job ou l'exécution d'une commande.

- **`%%FILENAME`** : Une variable représentant le nom ou le chemin du fichier à surveiller (par exemple, `datafile.txt` ou un motif comme `*.csv`). Le nom réel du fichier est résolu au moment de l'exécution, généralement défini dans le job ou l'environnement Control-M.

- **`CREATE`** : Le mode d'opération, indiquant que l'utilitaire surveille la **création** du fichier spécifié. Les autres modes possibles incluent `DELETE` pour surveiller la suppression d'un fichier.

- **`0`** : La taille minimale du fichier (en octets) requise pour que le fichier soit considéré comme valide. Une valeur de `0` signifie que toute taille de fichier est acceptable, donc l'utilitaire détectera le fichier quelle que soit sa taille.

- **`60`** : L'intervalle (en secondes) entre les tentatives successives de vérification de l'existence du fichier. L'utilitaire vérifie toutes les 60 secondes si le fichier a été créé.

- **`10`** : L'intervalle (en secondes) entre les tentatives de surveillance de la taille du fichier après sa détection. Cela garantit que la taille du fichier est stable (qu'il n'est plus en cours d'écriture). L'utilitaire vérifie la taille du fichier toutes les 10 secondes.

- **`3`** : Le nombre d'itérations pendant lesquelles la taille du fichier doit rester statique (inchangée) pour confirmer que le fichier est entièrement créé. L'utilitaire vérifie la taille du fichier 3 fois (à des intervalles de 10 secondes, soit 30 secondes au total) pour s'assurer qu'elle est stable.

- **`1410`** : Le temps maximum (en minutes) pendant lequel l'utilitaire s'exécutera en attendant que le fichier soit créé et qu'il réponde aux critères de taille. 1410 minutes équivaut à environ 23,5 heures. Si le fichier n'est pas détecté ou ne se stabilise pas dans ce délai, l'utilitaire expire et peut exécuter une action `DO_NOTOK` (par exemple, signaler "FILE WAS NOT CREATED").

### Fonctionnement
Cette commande surveille la création d'un fichier spécifié par `%%FILENAME`. Elle vérifie toutes les 60 secondes l'existence du fichier. Une fois détecté, elle vérifie que la taille du fichier reste inchangée pendant 3 itérations de 10 secondes chacune (30 secondes au total). Le processus se poursuivra pendant un maximum de 1410 minutes (23,5 heures) ou jusqu'à ce que le fichier soit détecté et stable. Si le fichier est créé et remplit les critères, une action `DO_OK` (par exemple, déclencher un job ou une commande) est exécutée. Sinon, une action `DO_NOTOK` est effectuée.

### Exemple de scénario
Si `%%FILENAME` est défini sur `/home/controlm/datafile.txt`, l'utilitaire :
- Vérifie toutes les 60 secondes la présence de `datafile.txt`.
- Une fois trouvé, s'assure que sa taille est stable pendant 30 secondes (3 vérifications à 10 secondes d'intervalle).
- S'exécute pendant un maximum de 23,5 heures ou jusqu'à ce que le fichier soit stable.
- En cas de succès, il peut déclencher un job (par exemple, déplacer le fichier vers un autre répertoire). S'il expire, il peut enregistrer "FILE WAS NOT CREATED".

### Notes
- La variable `%%FILENAME` doit être définie dans le job ou l'environnement Control-M, sinon la commande échouera.
- L'utilitaire ignore les fichiers dont la date de modification est antérieure à 50 ans.
- Si des wildcards sont utilisés dans `%%FILENAME` (par exemple, `*.csv`), des paramètres supplémentaires comme `MONITOR_FILE_SIZE` peuvent être nécessaires pour gérer plusieurs fichiers.
- Pour une surveillance cyclique (vérifications répétées après la détection), un paramètre `CYCLIC_INTERVAL` serait requis, mais il n'est pas spécifié ici.

Cette explication est basée sur la documentation de Control-M File Watcher provenant de sources telles que la documentation officielle de BMC et les discussions communautaires.[](https://documents.bmc.com/supportu/controlm-saas/en-US/Documentation/ctmfw.htm)[](https://documents.bmc.com/supportu/9.0.21/en-US/Documentation/ctmfw.htm)[](https://pdfslide.net/documents/file-watcher-for-control-m.html)