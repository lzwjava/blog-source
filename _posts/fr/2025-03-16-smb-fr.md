---
audio: false
generated: true
lang: fr
layout: post
title: Configuration d'un serveur SMB pour le partage de médias sur Ubuntu
translated: true
type: note
---

Voici un guide étape par étape pour configurer un serveur SMB (Server Message Block) sur Ubuntu afin de servir des fichiers multimédias. SMB est un protocole qui permet de partager des fichiers sur un réseau, ce qui le rend idéal pour diffuser des multimédias vers des appareils comme des ordinateurs, des téléviseurs ou des appareils mobiles. Nous utiliserons Samba, le logiciel qui fournit la fonctionnalité SMB sur Linux, et nous le configurerons pour partager un répertoire contenant vos fichiers multimédias.

---

### Étape 1 : Installer Samba
Vous devez d'abord installer Samba sur votre système Ubuntu. Ouvrez un terminal et exécutez les commandes suivantes :

```bash
sudo apt update
sudo apt install samba
```

- `sudo apt update` actualise la liste des paquets pour garantir d'obtenir la dernière version.
- `sudo apt install samba` installe le paquet Samba, qui inclut les outils et services nécessaires.

---

### Étape 2 : Sauvegarder le fichier de configuration de Samba
Avant d'apporter des modifications, il est recommandé de sauvegarder le fichier de configuration par défaut de Samba. Exécutez :

```bash
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
```

Cela crée une copie du fichier original (`smb.conf.backup`) au cas où vous auriez besoin de revenir en arrière plus tard.

---

### Étape 3 : Configurer le partage multimédia
Le fichier de configuration de Samba se trouve à l'emplacement `/etc/samba/smb.conf`. Vous allez éditer ce fichier pour définir un partage pour vos fichiers multimédias. Pour cet exemple, supposez que vos fichiers multimédias sont stockés dans `/home/user/media` (remplacez `user` par votre nom d'utilisateur réel).

1. Ouvrez le fichier de configuration dans un éditeur de texte, comme `nano` :
   ```bash
   sudo nano /etc/samba/smb.conf
   ```

2. Descendez en bas du fichier et ajoutez la section suivante :
   ```ini
   [media]
       path = /home/user/media
       browseable = yes
       read only = yes
       guest ok = yes
   ```

3. Sauvegardez et quittez :
   - Dans `nano`, appuyez sur `Ctrl+O`, puis `Entrée` pour sauvegarder, et `Ctrl+X` pour quitter.

#### Explication de la configuration :
- `[media]` : Le nom du partage, visible par les utilisateurs parcourant le réseau.
- `path = /home/user/media` : Le répertoire que vous souhaitez partager (ajustez ce chemin pour correspondre à l'emplacement de votre dossier multimédia).
- `browseable = yes` : Rend le partage visible lors du parcours du réseau.
- `read only = yes` : Empêche les utilisateurs de modifier ou de supprimer des fichiers (idéal pour la diffusion de multimédias).
- `guest ok = yes` : Permet l'accès sans nom d'utilisateur ni mot de passe, pour garder l'accès simple pour les multimédias.

---

### Étape 4 : Vérifier la configuration
Pour vous assurer qu'il n'y a pas d'erreurs de syntaxe dans votre configuration, exécutez :

```bash
testparm
```

Cette commande vérifie le fichier `smb.conf` et affiche les services chargés. S'il n'y a pas d'erreurs, vous pouvez poursuivre.

---

### Étape 5 : Redémarrer les services Samba
Samba exécute deux services : `smbd` (gère le partage de fichiers) et `nmbd` (gère la découverte réseau). Redémarrez-les pour appliquer vos modifications :

```bash
sudo systemctl restart smbd
sudo systemctl restart nmbd
```

Pour vous assurer que ces services démarrent automatiquement au boot (généralement activés par défaut), vous pouvez exécuter :

```bash
sudo systemctl enable smbd
sudo systemctl enable nmbd
```

---

### Étape 6 : Ajuster les permissions des fichiers
Pour que l'accès invité fonctionne, le répertoire multimédia et ses fichiers doivent être lisibles par tous. Définissez les permissions appropriées avec :

```bash
sudo chmod -R 755 /home/user/media
```

- `755` signifie que le propriétaire a toutes les permissions (lecture, écriture, exécution), tandis que les autres ont les permissions de lecture et d'exécution (nécessaires pour accéder et lister les fichiers).
- `-R` applique le changement de manière récursive à tous les fichiers et sous-répertoires.

---

### Étape 7 : Configurer le pare-feu
Si le pare-feu d'Ubuntu (UFW) est actif, vous devez autoriser le trafic SMB. Vérifiez d'abord le statut du pare-feu :

```bash
sudo ufw status
```

S'il est actif, ouvrez les ports nécessaires :

```bash
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
```

- Les ports 139 et 445 (TCP) sont utilisés pour le partage de fichiers SMB.
- Les ports 137 et 138 (UDP) sont utilisés par `nmbd` pour la découverte réseau.

Rechargez le pare-feu pour appliquer les modifications :

```bash
sudo ufw reload
```

Si le pare-feu est inactif, vous pouvez ignorer cette étape.

---

### Étape 8 : Tester le partage SMB
Votre serveur SMB devrait maintenant être en cours d'exécution. Pour le tester :

1. Trouvez l'adresse IP de votre machine Ubuntu :
   ```bash
   ip addr show
   ```
   Cherchez l'adresse IP (par exemple, `192.168.1.100`) sous votre interface réseau (comme `eth0` ou `wlan0`).

2. Depuis un autre appareil sur le réseau (par exemple, un PC Windows) :
   - Ouvrez l'Explorateur de fichiers et entrez : `\\<adresse-ip-ubuntu>\media` (par exemple, `\\192.168.1.100\media`).
   - Vous devriez voir vos fichiers multimédias. Comme l'accès invité est activé, aucune connexion n'est requise.

---

### Conseils de dépannage
Si vous rencontrez des problèmes :
- **Vérifiez les journaux Samba** : Les journaux se trouvent dans `/var/log/samba/` (par exemple, `log.smbd` ou `log.nmbd`). Utilisez `cat` ou `tail` pour les visualiser :
  ```bash
  sudo tail -f /var/log/samba/log.smbd
  ```
- **Testez localement** : Utilisez `smbclient` pour lister les partages sur votre machine Ubuntu :
  ```bash
  smbclient -L localhost
  ```
  Ou connectez-vous au partage :
  ```bash
  smbclient //localhost/media -N
  ```
  (`-N` ignore l'invite de mot de passe pour l'accès invité.)

---

### Récapitulatif des commandes
Voici la séquence complète :

```bash
sudo apt update
sudo apt install samba
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
sudo nano /etc/samba/smb.conf  # Ajoutez la section [media]
testparm
sudo systemctl restart smbd
sudo systemctl restart nmbd
sudo chmod -R 755 /home/user/media
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
sudo ufw reload
```

Votre serveur SMB est maintenant configuré pour servir les fichiers multimédias depuis `/home/user/media` ! Accédez-y depuis n'importe quel appareil sur votre réseau en utilisant l'adresse IP et le nom du partage (`\\<adresse-ip>\media`).