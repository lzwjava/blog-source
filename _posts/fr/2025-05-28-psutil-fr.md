---
audio: false
generated: true
lang: fr
layout: post
title: Script Python pour les Connexions TCP
translated: true
type: note
---

La commande PowerShell `Get-NetTCPConnection -LocalPort 80` récupère les informations sur les connexions TCP d'un système Windows qui utilisent le port local spécifié (dans ce cas, le port 80). Pour obtenir une fonctionnalité similaire en Python, vous pouvez utiliser la bibliothèque `psutil`, qui fournit un accès multiplateforme aux détails du système, y compris les connexions réseau.

Voici un script Python qui liste les connexions TCP filtrées par un port local spécifique (par exemple, le port 80), similaire à la commande PowerShell :

```python
import psutil

def get_tcp_connections_by_port(local_port):
    # Récupère toutes les connexions réseau
    connections = psutil.net_connections(kind='tcp')
    
    # Filtre les connexions par port local
    matching_connections = [
        conn for conn in connections
        if conn.laddr.port == local_port and conn.status == 'LISTEN'
    ]
    
    # Affiche les détails des connexions correspondantes
    if not matching_connections:
        print(f"Aucune connexion TCP trouvée en écoute sur le port {local_port}")
        return
    
    print(f"Connexions TCP en écoute sur le port {local_port}:")
    print("PID\tAdresse Locale\tAdresse Distante\tStatut")
    print("-" * 60)
    
    for conn in matching_connections:
        local_addr = f"{conn.laddr.ip}:{conn.laddr.port}" if conn.laddr else "N/A"
        remote_addr = f"{conn.raddr.ip}:{conn.raddr.port}" if conn.raddr else "N/A"
        pid = conn.pid if conn.pid is not None else "N/A"
        status = conn.status if conn.status else "N/A"
        print(f"{pid}\t{local_addr}\t{remote_addr}\t{status}")

if __name__ == "__main__":
    target_port = 80  # Spécifie le port à filtrer (par exemple, 80)
    get_tcp_connections_by_port(target_port)
```

### Explication :
1. **Installer `psutil`** :
   - Vous avez besoin de la bibliothèque `psutil` pour accéder aux détails des connexions réseau. Installez-la en utilisant :
     ```bash
     pip install psutil
     ```

2. **Détails du Script** :
   - `psutil.net_connections(kind='tcp')` récupère toutes les connexions TCP.
   - Le script filtre les connexions où le port local correspond au `local_port` spécifié (par exemple, 80) et où le statut est `LISTEN` (pour imiter le comportement de `Get-NetTCPConnection` pour les ports en écoute).
   - Pour chaque connexion correspondante, il affiche :
     - **PID** : Identifiant du processus de l'application utilisant la connexion.
     - **Adresse Locale** : IP et port locaux.
     - **Adresse Distante** : IP et port distants (le cas échéant ; "N/A" si non connecté).
     - **Statut** : Statut de la connexion (par exemple, "LISTEN").

3. **Sortie** :
   - La sortie est formatée pour ressembler à la sortie tabulaire de `Get-NetTCPConnection`, montrant le PID, l'adresse locale, l'adresse distante et le statut.

### Exemple de Sortie :
Si un serveur web (par exemple, Apache ou Nginx) est en écoute sur le port 80, la sortie pourrait ressembler à ceci :
```
Connexions TCP en écoute sur le port 80:
PID     Adresse Locale         Adresse Distante        Statut
------------------------------------------------------------
1234    0.0.0.0:80            N/A                   LISTEN
```

Si aucun processus n'est en écoute sur le port 80 :
```
Aucune connexion TCP trouvée en écoute sur le port 80
```

### Notes :
- **Multiplateforme** : La bibliothèque `psutil` fonctionne sur Windows, Linux et macOS, contrairement à `Get-NetTCPConnection`, qui est spécifique à Windows.
- **Permissions** : Sur certains systèmes (par exemple, Linux ou macOS), des privilèges root/administrateur peuvent être nécessaires pour accéder à certains détails des connexions.
- **Filtrage** : Le script filtre les connexions `LISTEN` pour correspondre au cas d'utilisation typique de `Get-NetTCPConnection -LocalPort 80`. Vous pouvez modifier le filtre (par exemple, supprimer la condition `conn.status == 'LISTEN'`) pour inclure d'autres états de connexion comme `ESTABLISHED`.
- **Informations Supplémentaires** : Vous pouvez étendre le script pour inclure plus de détails (par exemple, le nom du processus) en utilisant `psutil.Process(conn.pid).name()` si un PID est disponible.

Ce script fournit un équivalent Python à la commande PowerShell, avec une fonctionnalité et une sortie similaires. Si vous avez besoin de fonctionnalités supplémentaires ou d'exigences spécifiques, faites-le-moi savoir !