---
audio: false
generated: true
lang: fr
layout: post
title: Configuration de NPM
translated: true
type: note
---

### Points Clés
- Il semble probable que la configuration de NPM implique la modification du fichier `.npmrc` pour définir les paramètres de proxy et de registre, ce qui peut être fait manuellement ou via des commandes.
- Les recherches suggèrent que les paramètres de proxy nécessitent le format `proxy = http://utilisateur:motdepasse@serveur_proxy:port`, avec les caractères spéciaux encodés en URL.
- Les preuves penchent vers la définition du registre comme `registry = https://registry.npmjs.org/` par défaut, avec des options pour désactiver la vérification SSL si nécessaire.

### Configuration de NPM et Utilisation du Fichier `.npmrc`
NPM, ou Node Package Manager, est un outil de gestion des dépendances JavaScript, et sa configuration implique souvent le fichier `.npmrc` pour des paramètres comme le registre et le proxy.

#### Qu'est-ce que `.npmrc` et Où se Trouve-t-il ?
Le fichier `.npmrc` est un fichier de configuration pour NPM, permettant de personnaliser son comportement. Il peut être :
- **Global** : Trouvé à `~/.npmrc` sur les systèmes de type Unix ou `%APPDATA%\npm\npmrc` sur Windows (généralement `C:\Users\<nom_utilisateur>\AppData\Roaming\npm\npmrc`).
- **Local à un projet** : Situé à `./package/.npmrc` dans le répertoire racine du projet. Les paramètres locaux écrasent les paramètres globaux.

#### Définition du Proxy et du Proxy HTTPS
Pour travailler derrière un proxy, ajoutez ces lignes dans `.npmrc` :
- `proxy = http://utilisateur:motdepasse@serveur_proxy:port`
- `https_proxy = http://utilisateur:motdepasse@serveur_proxy:port`

Notez que même pour `https_proxy`, utilisez `http://` comme protocole. Si votre nom d'utilisateur ou mot de passe contient des caractères spéciaux (par exemple, `\`, `@`), encodez-les en URL (par exemple, `domain\user` devient `domain%5Cuser`). Vous pouvez également les définir via des commandes :
- `npm config set proxy http://utilisateur:motdepasse@serveur_proxy:port`
- `npm config set https_proxy http://utilisateur:motdepasse@serveur_proxy:port`

#### Définition du Registre
Le registre est l'URL que NPM utilise pour récupérer les packages, généralement définie comme :
- `registry = https://registry.npmjs.org/`

Pour des registres personnalisés, remplacez par votre URL (par exemple, un registre privé d'entreprise). Définissez-le via :
- `npm config set registry https://your_custom_registry.com/`

#### Gestion du SSL et de la Vérification
Si vous rencontrez des problèmes SSL, envisagez :
- `strict-ssl = false` dans `.npmrc` pour ignorer les erreurs SSL, bien que ce soit moins sécurisé. Définissez via :
- `npm config set strict-ssl false`

#### Utilisation et Vérification des Configurations
Modifiez `.npmrc` directement à l'aide d'un éditeur de texte, ou utilisez les commandes `npm config set`. Pour vérifier :
- Listez tous les paramètres avec `npm config list`.
- Vérifiez un paramètre spécifique avec `npm config get proxy`.
- Déboguez les problèmes avec `npm install --verbose` pour une sortie détaillée.

Un exemple de fichier `.npmrc` pourrait ressembler à :
```
proxy = http://utilisateur:motdepasse@serveur_proxy:8080
https_proxy = http://utilisateur:motdepasse@serveur_proxy:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

### Note d'Enquête : Guide Complet pour Configurer NPM avec `.npmrc`
Cette section fournit une exploration détaillée de la configuration de NPM, en se concentrant sur le fichier `.npmrc` pour les paramètres de registre et de proxy, élargissant la réponse directe avec un contexte supplémentaire et des détails techniques.

#### Introduction à `.npmrc` et son Rôle
Le fichier `.npmrc` est un fichier de configuration critique pour NPM, permettant la personnalisation des comportements de gestion des packages. Il supporte un format INI avec des paires clé-valeur, où les commentaires commencent par un point-virgule (`;`). Il peut être situé globalement ou localement :
- **Emplacement Global** : Sur les systèmes de type Unix, il se trouve à `~/.npmrc` ; sur Windows, à `%APPDATA%\npm\npmrc`, typiquement `C:\Users\<nom_utilisateur>\AppData\Roaming\npm\npmrc`.
- **Emplacement Local** : Dans le répertoire racine d'un projet sous `./package/.npmrc`. Les paramètres locaux écrasent les paramètres globaux, fournissant des configurations spécifiques au projet.

Cette hiérarchie assure une flexibilité, permettant aux développeurs de gérer les paramètres à la fois au niveau de l'utilisateur et du projet, ce qui est particulièrement utile dans les environnements avec de multiples projets ou des systèmes partagés.

#### Configuration Détaillée du Proxy
Travailler derrière un proxy nécessite de définir à la fois `proxy` et `https_proxy` dans `.npmrc`. Le format est :
- `proxy = http://utilisateur:motdepasse@serveur_proxy:port`
- `https_proxy = http://utilisateur:motdepasse@serveur_proxy:port`

Notamment, `https_proxy` utilise `http://` comme protocole, et non `https://`, car le serveur proxy gère la connexion, et ne la chiffre pas vers le proxy lui-même. C'est un point de confusion courant, car la charge utile vers la destination reste chiffrée par SSL.

Pour l'authentification, incluez le nom d'utilisateur et le mot de passe, mais s'ils contiennent des caractères spéciaux, l'encodage URL est essentiel :
- La barre oblique inversée (`\`) devient `%5C`.
- Le symbole arobase (`@`) devient `%40`.
- Les deux points (`:`) deviennent `%3A`.

Par exemple, si le nom d'utilisateur est `domain\user` et le mot de passe est `pass@word`, cela donnerait `proxy = http://domain%5Cuser:pass%40word@serveur_proxy:8080`. Cet encodage assure un bon parsing par NPM.

Les utilisateurs Windows, en particulier dans les environnements d'entreprise avec Active Directory, peuvent rencontrer des problèmes avec les barres obliques inverses. Certains rapports indiquent que `domain\username` dans `.npmrc` pourrait se convertir en `domain/username` lors de la lecture, causant potentiellement des échecs d'authentification. Dans de tels cas, des outils comme NTLM Authorization Proxy Server ou Cntlm peuvent aider, bien qu'ils soient en dehors de la configuration directe de `.npmrc`.

#### Configuration du Registre et Considérations SSL
Le paramètre de registre définit l'endroit où NPM récupère les packages, par défaut `https://registry.npmjs.org/`. Pour des registres personnalisés ou privés, définissez :
- `registry = https://your_custom_registry.com/`

Si la vérification SSL échoue, souvent à cause de proxies d'entreprise avec des certificats auto-signés, vous pouvez désactiver le SSL strict :
- `strict-ssl = false`

Cependant, cela réduit la sécurité, car il contourne la validation du certificat. Alternativement, configurez l'autorité de certification :
- Utilisez `npm config -g set cafile [VOTRE_REPERTOIRE_CERTIFICAT]/[NOM_CERTIFICAT].crt` pour spécifier un fichier CA de confiance.

Certains développeurs optent pour `registry = http://registry.npmjs.org/` pour éviter complètement le SSL, mais cela n'est pas recommandé pour des raisons de sécurité, surtout en production.

#### Utilisation de `.npmrc` : Édition Manuelle vs Ligne de Commande
Vous pouvez éditer `.npmrc` directement avec n'importe quel éditeur de texte, en vous assurant que chaque paramètre est sur une nouvelle ligne avec le format `key = value`. Les commentaires commencent par `;`, par exemple :
```
; Paramètres de proxy pour le réseau d'entreprise
proxy = http://utilisateur:motdepasse@serveur_proxy:8080
https_proxy = http://utilisateur:motdepasse@serveur_proxy:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

Alternativement, utilisez les commandes NPM pour plus de commodité :
- Définir le proxy : `npm config set proxy http://utilisateur:motdepasse@serveur_proxy:port`
- Définir le registre : `npm config set registry https://registry.npmjs.org/`
- Définir strict-ssl : `npm config set strict-ssl false`

Ces commandes mettent à jour le fichier `.npmrc` approprié en fonction du contexte (global ou local). Pour basculer entre global et local, utilisez `-g` pour global, par exemple, `npm config set -g proxy ...`.

#### Vérification et Dépannage
Pour vérifier les configurations, utilisez :
- `npm config list` pour lister tous les paramètres, montrant à la fois les valeurs effectives et par défaut.
- `npm config get proxy` pour récupérer un paramètre spécifique.

Pour le dépannage, en particulier derrière des proxies, exécutez :
- `npm install --verbose` pour voir les journaux détaillés, ce qui peut aider à identifier les problèmes de connexion, tels que `ECONNREFUSED` ou `socket hang up`.

Si les paramètres ne prennent pas effet, vérifiez les variables d'environnement (`HTTP_PROXY`, `HTTPS_PROXY`) qui pourraient écraser `.npmrc`. Celles-ci peuvent être définies au niveau du système et avoir la priorité, alors assurez la cohérence.

#### Bonnes Pratiques et Considérations Supplémentaires
- **Sécurité** : Évitez `strict-ssl = false` en production ; configurez plutôt des certificats de confiance.
- **Variables d'Environnement** : Soyez conscient que `NODE_ENV` et `HTTPS_PROXY` peuvent écraser les paramètres de `.npmrc`, utiles pour les pipelines CI/CD mais potentiellement déroutants localement.
- **Niveaux de Journalisation** : Ajustez `loglevel` dans `.npmrc` (par exemple, `loglevel = http`) pour une sortie plus détaillée lors du débogage, avec des options allant de `silent` à `silly` (7 niveaux au total).
- **Proxies d'Entreprise** : Pour les proxies NTLM, envisagez des outils comme Cntlm, configurant un serveur proxy local, et configurez `.npmrc` pour pointer vers `localhost:3128`, simplifiant l'authentification.

#### Exemples de Configurations
Voici un tableau résumant les paramètres courants de `.npmrc` pour le proxy et le registre, avec des exemples :

| **Paramètre**  | **Description**                              | **Exemple**                                      |
|----------------|----------------------------------------------|--------------------------------------------------|
| proxy          | URL du serveur proxy HTTP                    | `proxy = http://utilisateur:motdepasse@proxy:8080` |
| https_proxy    | URL du serveur proxy HTTPS                   | `https_proxy = http://utilisateur:motdepasse@proxy:8080` |
| registry       | URL du registre de packages                  | `registry = https://registry.npmjs.org/`         |
| strict-ssl     | Activer/désactiver la vérification SSL       | `strict-ssl = false`                             |
| loglevel       | Niveau de sortie console (silent à silly, 7 niveaux) | `loglevel = http`                                |

Ce tableau aide en référence rapide, surtout pour les développeurs nouveaux avec `.npmrc`.

#### Détail Inattendu : Impact des Paramètres Globaux vs Locaux
Un aspect inattendu est la façon dont les paramètres globaux de `.npmrc` affectent tous les projets, tandis que les paramètres locaux peuvent les écraser pour des projets spécifiques. Cette superposition peut entraîner de la confusion si, par exemple, un proxy global est défini mais qu'un projet local utilise un registre différent, causant potentiellement des problèmes d'authentification. Comprendre cette hiérarchie est crucial pour les environnements multi-projets.

#### Conclusion
Configurer NPM via `.npmrc` pour les paramètres de proxy et de registre est simple avec le bon format et des considérations pour l'encodage et le SSL. En éditant directement ou en utilisant des commandes, et en vérifiant avec `npm config list`, vous assurez une gestion fluide des packages, en particulier dans les réseaux d'entreprise avec des proxies. Pour plus de lecture, consultez la documentation officielle à [NPM CLI Config](https://docs.npmjs.com/cli-config) ou explorez les bonnes pratiques à [Configuring Your .nmprc](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment).

### Citations Clés
- [NPM CLI Config Documentation](https://docs.npmjs.com/cli-config)
- [Configuring Your .nmprc for an Optimal Node.js Environment](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment)
- [How to setup npm proxy settings behind proxy on Windows](https://gist.github.com/zillingen/5c4b8da657025c83ead59e1e547c7436)