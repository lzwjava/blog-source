---
audio: false
generated: true
image: false
lang: ar
layout: post
title: شرح وتعطيل الكتابة الافتراضية في جاكسون
translated: true
type: note
---

في مكتبة جاكسون (مكتبة `com.fasterxml.jackson.databind`)، **الكتابة الافتراضية** هي ميزة في `ObjectMapper` تدرج تلقائيًا بيانات وصفية للنوع (مثل `@class` أو `@type`) في JSON المُسلسل بحيث يمكن إعادة إلغاء تسلسل الكائنات إلى أنواعها الأصلية متعددة الأشكال.

على سبيل المثال، إذا قمت بتسلسل `List<Animal>` تحتوي على كل من `Dog` و `Cat`، فإن الكتابة الافتراضية تضيف حقول JSON إضافية حتى تعرف جاكسون أي فئة فرعية يجب إعادة إنشاء مثيل لها لاحقًا.

---

### كيفية عمل التعطيل

عندما **تعطل الكتابة الافتراضية**، تتوقف جاكسون عن حقن حقل بيانات النوع الوصفية الإضافية تلك. هذا يعني:

* سيكون ناتج JSON "أنظف"، بدون تلميحات `@class`/`@type`.
* عند إلغاء التسلسل، يمكن لجاكسون إعادة بناء الكائنات فقط باستخدام الأنواع الثابتة المُعلن عنها (نوع الهدف الذي تمرره)، وليس أنواع وقت التشغيل الأصلية.
* أي حالات استخدام متعددة الأشكال ستفشل إلا إذا قمت بتكوين `@JsonTypeInfo`، أو `@JsonSubTypes`، أو وحدات مخصصة بشكل صريح.

---

### الطرق ذات الصلة

* **التفعيل** (نمط ما قبل الإصدار 2.10):

  ```java
  objectMapper.enableDefaultTyping();
  ```

  (أصبحت قديمة، لأنها كانت متساهلة جدًا وأدخلت مخاطر أمنية.)

* **التعطيل**:

  ```java
  objectMapper.disableDefaultTyping();
  ```

  أو في الإصدارات الأحدث (2.10+)، يمكنك استدعاء:

  ```java
  objectMapper.activateDefaultTyping(PolymorphicTypeValidator, ObjectMapper.DefaultTyping.NON_FINAL);
  ```

  *لتعطيلها*، يمكنك ببساطة **ألا تستدعي** هذه الطريقة على الإطلاق (لا توجد كتابة افتراضية إلا إذا قمت بتفعيلها)، أو يمكنك استدعاء:

  ```java
  objectMapper.deactivateDefaultTyping();
  ```

---

### الأمنية والمبررات

* **الكتابة الافتراضية معطلة افتراضيًا** في إصدارات جاكسون الحديثة لأنه يمكن استغلالها (حيث يمكن للمهاجمين صياغة JSON يقوم بإنشاء مثيل لفئات خطيرة).
* إذا قمت بتعطيلها، تتصرف جاكسون في "وضع أكثر أمانًا"، حيث يعمل إلغاء التسلسل فقط على الأنواع التي تربطها بشكل صريح، وليس أنواع وقت التشغيل العشوائية.
* إذا كنت بحاجة إلى دعم متعدد الأشكال، فيجب عليك وضع شرح `@JsonTypeInfo` على فئاتك بدلاً من الاعتماد على الكتابة الافتراضية العامة.

---

✅ **باختصار:**
تعطيل الكتابة الافتراضية يخبر جاكسون **بألا** يدرج بيانات وصفية للنوع في JSON، مما يعني أنه لن يعيد بناء الأنواع الفرعية متعددة الأشكال تلقائيًا عند إلغاء التسلسل. هذا يقلل من المرونة ولكنه أكثر أمانًا ويبقي JSON نظيفًا.

هل تريد مني أن أعرض لك **مثال JSON قبل/بعد** مع تفعيل الكتابة الافتراضية مقابل تعطيلها؟