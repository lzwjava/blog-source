---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: إدارة مخطط قاعدة البيانات في CodeIgniter Migrations
translated: true
type: note
---

### ما هي ترحيلات CodeIgniter؟

ترحيلات CodeIgniter (CI) هي ميزة تساعد في إدارة تغييرات مخطط قاعدة البيانات بطريقة خاضعة للتحكم بالإصدار، على غرار أدوات مثل Flyway أو Liquibase. تتيح لك كتابة نصوص PHP تحدد التعديلات على قاعدة البيانات (مثل إنشاء الجداول، أو إضافة أعمدة، أو تعديل البيانات)، ثم تشغيلها بالتسلسل للحفاظ على تحديث مخططك عبر البيئات المختلفة. هذا يمنع أخطاء SQL اليدوية ويدعم التراجع.

تعمل الترحيلات عن طريق:
- تخزين ملفات الترحيل في دليل (افتراضي: `application/migrations/`).
- تتبع "الإصدارات" في جدول قاعدة البيانات لمعرفة أي الترحيلات تم تطبيقها.
- تشغيل النصوص للأمام (up) أو للخلف (down) بناءً على احتياجاتك.

ملف الإعدادات الذي شاركته (`migration.php`) يتحكم في كيفية سلوك الترحيلات. وهو يستخدم مصفوفات PHP لتعيين الخيارات. أدناه، سأشرح الإعدادات الرئيسية مع أمثلة.

### الإعدادات الرئيسية للتكوين

| الإعداد | القيمة في الكود الخاص بك | الشرح | آلية العمل |
|---------|---------------------|-------------|-------------|
| `migration_enabled` | `FALSE` | يُفعّل أو يعطل الترحيلات عالميًا. عندما تكون `FALSE`، لا يمكنك تشغيل الترحيلات (لأسباب أمنية، لأنها تعدل على قاعدة البيانات). | CodeIgniter يتحقق من هذا قبل تنفيذ أي أمر ترحيل. اضبطها على `TRUE` أثناء التطوير، ثم ارجع إلى `FALSE` في بيئة الإنتاج. مثال: إذا كانت مفعلة، شغّلها عبر `$this->migration->current()` في وحدة التحكم (controller). |
| `migration_type` | `'timestamp'` | نمط تسمية الملفات: `'sequential'` (مثل `001_add_blog.php`) أو `'timestamp'` (مثل `20121031104401_add_blog.php`). الطابع الزمني موصى به لتحسين التحكم بالإصدار. | يتم تحميل الملفات بالترتيب الزمني. الطابع الزمني يستخدم تنسيق `YYYYMMDDHHIISS` (مثال: `20121031104401` لـ 31 أكتوبر 2012، الساعة 10:44:01). |
| `migration_table` | `'migrations'` | اسم جدول قاعدة البيانات الذي يتتبع الترحيلات المطبقة. مطلوب. | CodeIgniter ينشئ هذا الجدول إذا لم يكن موجودًا. يخزن أحدث إصدار ترحيل. حذف أو تحديث هذا الجدول يعيد تعيين سجل الترحيل. |
| `migration_auto_latest` | `FALSE` | إذا كانت `TRUE` و `migration_enabled` هي `TRUE`، فإنها تشغل الترحيلات تلقائيًا إلى أحدث إصدار عند تحميل مكتبة Migration (مثلًا، عند تحميل الصفحة). | مفيد في بيئات التطوير لمزامنة المخططات تلقائيًا. اضبطها على `FALSE` لتشغيل الترحيلات يدويًا من أجل التحكم (أكثر أمانًا في الإنتاج). |
| `migration_version` | `0` | الإصدار/الرقم الهدف للترحيل إليه. اضبطه على بادئة اسم الملف (مثل `20121031104401`). `0` تعني عدم تطبيق أي ترحيلات. | تشغيل `$this->migration->version(20121031104401)` يرقّي قاعدة البيانات إلى تلك النقطة. يُستخدم للتراجعات المستهدفة - الأرقام السالبة تخفض الإصدار. |
| `migration_path` | `APPPATH.'migrations/'` | الدليل الذي تُخزن فيه ملفات الترحيل. `APPPATH` هو ثابت في CI يشير إلى `application/`. | CodeIgniter يمسح هذا المجلد بحثًا عن ملفات PHP تطابق اصطلاح التسمية. يجب أن يكون قابلاً للكتابة من قبل خادم الويب. المسارات المخصصة مثل `BASEPATH.'custom/migrations/'` ممكنة. |

### كيفية استخدام الترحيلات (خطوة بخطوة)

1. **تفعيل الترحيلات**: عيّن `$config['migration_enabled'] = TRUE;` مؤقتًا في ملف الإعدادات.

2. **إنشاء ملف ترحيل**: أضف ملف PHP في `application/migrations/` باسم مثل `20121031104401_add_blog.php`. داخله، استخدم صنف Migration في CI:
   ```php
   defined('BASEPATH') OR exit('No direct script access allowed');

   class Migration_Add_blog extends CI_Migration {
       public function up() {
           $this->dbforge->add_field('id');
           $this->dbforge->create_table('blogs');
       }

       public function down() {
           $this->dbforge->drop_table('blogs');
       }
   }
   ```
   - `up()` يطبق التغييرات (مثل إنشاء جدول).
   - `down()` يتراجع عنها (مثل حذف جدول).

3. **تشغيل الترحيلات**:
   - حمّل المكتبة: `$this->load->library('migration');`
   - إلى أحدث إصدار: `$this->migration->current();`
   - إلى إصدار محدد: `$this->migration->version('20121031104401');`
   - من سطر الأوامر (إذا كان CLI مفعلًا): `php index.php migrate current`

4. **الأوامر الشائعة**:
   - `$this->migration->latest()`: اسم مستعار لـ `current()`.
   - `$this->migration->find_migratables()`: يسرد الملفات المتاحة.
   يتم تسجيل الأخطاء في ملفات سجل CI أو ترمي استثناءات.

5. **أفضل الممارسات**:
   - حافظ على كون الترحيلات قابلة لإعادة التشغيل بأمان (Idempotent).
   - اختبر في بيئة التطوير أولاً؛ تجنب تفعيل الترحيل التلقائي في الإنتاج لمنع تغييرات المخطط العرضية.
   - استخدم المعاملات (Transactions) إذا كانت قاعدة البيانات تدعمها لإجراء تغييرات ذرية.
   - عطّل الترحيل بعد الاستخدام: اضبطه مرة أخرى على `FALSE` للأمان.

إذا واجهت مشاكل (مثل أذونات على المسار)، تحقق من سجلات CI أو الوثائق على [codeigniter.com/user_guide/libraries/migration.html](https://codeigniter.com/user_guide/libraries/migration.html). حدّد إصدار CI الخاص بك للحصول على نصائح أكثر تخصيصًا!