---
audio: false
generated: true
lang: ar
layout: post
title: أمر ctmfw في Control-M
translated: true
type: note
---

أمر `ctmfw` في Control-M هو جزء من أداة مراقبة الملفات، ويُستخدم لمراقبة الملفات بحثًا عن أحداث مثل الإنشاء أو الحذف أو اكتمال النقل. يمكن تحليل الأمر المحدد `ctmfw %%FILENAME CREATE 0 60 10 3 1410` بناءً على المعلمات المحددة في وثائق Control-M. إليك ما يعنيه كل جزء:

- **`ctmfw`**: أداة مراقبة ملفات Control-M، التي تكتشف الأحداث المتعلقة بالملفات وتشغل الإجراءات بناءً على الشروط، مثل بدء وظيفة أو تنفيذ أمر.

- **`%%FILENAME`**: متغير يمثل اسم الملف أو مساره للمراقبة (مثل `datafile.txt` أو نمط مثل `*.csv`). يتم تحديد اسم الملف الفعلي أثناء وقت التشغيل، ويُعرّف عادةً في وظيفة Control-M أو البيئة.

- **`CREATE`**: وضع التشغيل، مما يشير إلى أن الأداة تراقب **إنشاء** الملف المحدد. تشمل الأوضاع الأخرى الممكنة `DELETE` لمراقبة حذف الملف.

- **`0`**: الحد الأدنى لحجم الملف (بالبايت) المطلوب لاعتبار الملف صالحًا. القيمة `0` تعني أن أي حجم للملف مقبول، لذا ستكتشف الأداة الملف بغض النظر عن حجمه.

- **`60`**: الفاصل الزمني (بالثواني) بين المحاولات المتتالية للتحقق من وجود الملف. تتحقق الأداة كل 60 ثانية لمعرفة ما إذا كان الملف قد تم إنشاؤه.

- **`10`**: الفاصل الزمني (بالثواني) بين محاولات مراقبة حجم الملف بعد اكتشافه. يضمن هذا أن حجم الملف مستقر (لم يتم الانتهاء من كتابته بعد). تتحقق الأداة من حجم الملف كل 10 ثوانٍ.

- **`3`**: عدد التكرارات التي يجب أن يظل فيها حجم الملف ثابتًا (غير متغير) لتأكيد اكتمال إنشاء الملف. تتحقق الأداة من حجم الملف 3 مرات (على فترات 10 ثوانٍ، بإجمالي 30 ثانية) لضمان استقراره.

- **`1410`**: أقصى وقت (بالدقائق) ستستمر فيه الأداة في العمل أثناء انتظار إنشاء الملف وتحقيقه لمعايير الحجم. 1410 دقيقة تساوي تقريبًا 23.5 ساعة. إذا لم يتم اكتشاف الملف أو لم يستقر خلال هذا الوقت، تنتهي مهلة الأداة وقد تنفذ إجراء `DO_NOTOK` (مثال: الإبلاغ عن "FILE WAS NOT CREATED").

### آلية العمل
يراقب هذا الأمر إنشاء ملف محدد بواسطة `%%FILENAME`. يتحقق كل 60 ثانية من وجود الملف. بمجرد اكتشافه، يتأكد من أن حجم الملف يظل دون تغيير لمدة 3 تكرارات كل منها 10 ثوانٍ (30 ثانية إجمالاً). ستستمر العملية لمدة تصل إلى 1410 دقيقة (23.5 ساعة) أو حتى يتم اكتشاف الملف واستقراره. إذا تم إنشاء الملف واستوفى المعايير، يتم تنفيذ إجراء `DO_OK` (مثل تشغيل وظيفة أو أمر). إذا لم يحدث ذلك، يتم تنفيذ إجراء `DO_NOTOK`.

### مثال على سيناريو
إذا تم تعيين `%%FILENAME` إلى `/home/controlm/datafile.txt`، فإن الأداة:
- تتحقق كل 60 ثانية من وجود `datafile.txt`.
- بمجرد العثور عليه، تضمن استقرار حجمه لمدة 30 ثانية (3 فحوصات على فترات 10 ثوانٍ).
- تعمل لمدة تصل إلى 23.5 ساعة أو حتى يستقر الملف.
- إذا نجحت، فقد تشغل وظيفة (مثل نقل الملف إلى دليل آخر). إذا انتهت المهلة، فقد تُسجل "FILE WAS NOT CREATED".

### ملاحظات
- يجب تعريف المتغير `%%FILENAME` في وظيفة Control-M أو البيئة، وإلا فشل الأمر.
- تتجاهل الأداة الملفات التي يكون وقت تعديلها أقدم من 50 عامًا.
- إذا تم استخدام أحرف البدل في `%%FILENAME` (مثل `*.csv`)، فقد تكون هناك حاجة إلى معلمات إضافية مثل `MONITOR_FILE_SIZE` للتعامل مع ملفات متعددة.
- للمراقبة الدورية (فحوصات متكررة بعد الاكتشاف)، ستكون هناك حاجة إلى معلمة `CYCLIC_INTERVAL`، لكنها غير محددة هنا.

هذا الشرح مبني على وثائق أداة مراقبة ملفات Control-M من مصادر مثل الوثائق الرسمية من BMC ومناقشات المجتمع.[](https://documents.bmc.com/supportu/controlm-saas/en-US/Documentation/ctmfw.htm)[](https://documents.bmc.com/supportu/9.0.21/en-US/Documentation/ctmfw.htm)[](https://pdfslide.net/documents/file-watcher-for-control-m.html)