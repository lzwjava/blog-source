---
audio: false
generated: true
image: false
lang: ar
layout: post
model: google/gemini-2.5-flash
title: إصلاح تلف نظام OverlayFS في Docker على نظام التشغيل macOS
translated: true
type: note
---

الخطأ الذي تراه، `driver "overlay2" failed to remove root filesystem: readdirnames /var/lib/docker/overlay2/.../merged: readdirent merged: bad message`، يشير إلى فساد عميق في آلية التخزين في Docker (OverlayFS) والذي غالبًا ما ينتج عن عملية متقطعة أو مشكلة في نظام الملفات للجهاز المضيف.

بما أنك تستخدم **macOS** (والذي يشغل Docker Desktop)، فإن خادم Docker وتخزينه يتم إدارتهما داخل **آلة افتراضية (VM) مخصصة لنظام Linux**. ليس لديك وصول مباشر إلى `/var/lib/docker/overlay2` كما هو الحال في نظام Linux الأصلي، مما يجعل الإصلاح أبسط وأكثر أمانًا من خلال التركيز على تطبيق Docker Desktop نفسه.

إليك تسلسل الخطوات الأكثر أمانًا وفعالية لحل هذه المشكلة على macOS:

-----

## 1. إيقاف الحاوية قسريًا وإزالتها قسريًا

الحاوية التي فشلت هي `chat-mongodb` (المعرف: `ccd89a3f36a1528cb923c90de8755faeb36e229cab353c2285222948197b8d18`). أولاً، حاول الإزالة القسرية باستخدام اسمها أو معرفها.

1.  **أوقف المكدس بالكامل** (للتأكد من عدم وجود أي عملية خلفية تحتفظ بقفل):

    ```bash
    docker compose stop
    ```

2.  **أزل الحاوية المحددة قسريًا** باستخدام علم `-f`:

    ```bash
    docker rm -f chat-mongodb
    # أو باستخدام المعرف:
    # docker rm -f ccd89a3f36a1528cb923c90de8755faeb36e229cab353c2285222948197b8d18
    ```

3.  **حاول تشغيل الأمر الأصلي مرة أخرى** (`docker compose down` أو ما يعادله). إذا استمر الخطأ، انتقل إلى الخطوة 2.

-----

## 2. إعادة تشغيل Docker Desktop

غالبًا ما يؤدي إعادة التشغيل البسيطة إلى إزالة مشاكل القفل العابرة أو الحالات التالفة داخل الـ VM الداخلي.

### الخيار أ: باستخدام شريط القوائم (مُوصى به)

1.  انقر على **أيقونة حوت Docker** في شريط قوائم macOS.
2.  اختر **Restart**.

### الخيار ب: باستخدام Terminal

يمكنك إجبار التطبيق على الإغلاق وإعادة فتحه:

```bash
killall Docker && open /Applications/Docker.app
```

بعد إعادة تشغيل Docker، انتظر حوالي 30 ثانية لبدء التشغيل الكامل، ثم حاول تشغيل الأمر الأصلي مرة أخرى.

-----

## 3. مسح ذاكرة التخزين المؤقت لـ Docker والبيانات غير المستخدمة (Prune)

إذا فشلت إعادة التشغيل، يمكن لأمر تنظيف قوي أن يحل في كثير من الأحيان مشاكل الفساد الأعمق من خلال إزالة المكونات غير المستخدمة أو "المعلقة" التي قد تكون مرتبطة بالخطأ.

**تحذير:** يزيل هذا الأمر جميع الحاويات المتوقفة، والشبكات غير المستخدمة، والصور المعلقة. إذا كان لديك حاويات متوقفة تريد الاحتفاظ بها (ولكن لم يتم إزالتها)، فاحفظها احتياطيًا أو تخطَّ هذه الخطوة.

شغِّل الأمر التالي في الـ Terminal الخاص بك:

```bash
docker system prune -a --volumes
```

  * **`-a`** (الكل) يزيل جميع الصور غير المستخدمة (ليس فقط المعلقة).
  * **`--volumes`** يزيل وحدات التخزين المجهولة غير المستخدمة (والتي قد تكون مصدر فساد `overlay2`).

سيُطلب منك التأكيد. اكتب `y` واضغط على Enter. بعد اكتمال عملية التنظيف، حاول تشغيل الأمر الأصلي مرة أخرى.

-----

## 4. إعادة ضبط Docker Desktop إلى إعدادات المصنع

هذا هو **الملاذ الأخير** لأنه سيحذف **جميع حاوياتك وصورك ومجلداتك** (بما في ذلك أي بيانات محلية قمت بتخزينها في مجلدات غير مثبتة). فهو يجبر على بدء جديد تمامًا لـ VM Docker الداخلي.

1.  انقر على **أيقونة حوت Docker** في شريط قوائم macOS.
2.  انتقل إلى **Settings (أو Preferences)** $\rightarrow$ **Troubleshoot**.
3.  انقر على **Reset to factory settings...**

بعد إعادة الضبط، سيعيد Docker التشغيل بحالة نظيفة، ويجب أن تكون قادرًا على تشغيل أمر `docker compose up` الخاص بك لإعادة بناء بيئتك.