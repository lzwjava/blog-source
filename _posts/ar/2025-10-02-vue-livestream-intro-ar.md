---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: مكون مقدمة البث المباشر في Vue.js
translated: true
type: note
---

فيما يلي شرح مفصل ومقسّم إلى أقسام للكود المقدم. يبدو أن هذا مكون Vue.js (على الأرجح إصدار 1.x أو إصدار 2.x مبكر، نظرًا للبناء مثل `v-bind:class` و `this.$router.go`) لصفحة تمهيدية لحدث بث مباشر (على سبيل المثال، على منصة مثل تطبيق بث مباشر صيني مدمج مع WeChat). سأقوم بتفصيله إلى أجزائه الرئيسية: **القالب** (الهيكل الشبيه بـ HTML)، **النص البرمجي** (منطق JavaScript)، و **الأنماط** (CSS عبر Stylus). سأصف ما يفعله كل جزء، وكيف يتفاعل، والغرض منه في المكون العام.

إذا كنت جديدًا على Vue، ففكر في هذا على أنه مكون واجهة مستخدم "قابل لإعادة الاستخدام" يعرض تفاصيل البث المباشر، ويتعامل مع تفاعلات المستخدم (مثل الانضمام، الدفع)، ويتكامل مع WeChat للمشاركة والمدفوعات. يفترض الكود وجود تبعيات مثل WeChat SDK، ودوال الأدوات، وطلبات API لجلب بيانات البث المباشر.

### الغرض العام
- **ما يفعله**: هذا هو مكون "IntroView"، الذي يُنشئ صفحة لحدث بث مباشر محدد. يعرض تفاصيل مثل غطاء البث، المالك، الجدول الزمني، الحضور، الوصف، وخيارات الانضمام (على سبيل المثال، عبر الدفع أو المشاركة). يتكامل مع WeChat لميزات الجوال مثل المشاركة والمدفوعات وإنشاء رمز الاستجابة السريعة.
- **الميزات الرئيسية**:
  - جلب وعرض بيانات البث المباشر (مثل العنوان، المشاركين، التفاصيل بتنسيق Markdown).
  - يتعامل مع إجراءات المستخدم: الحضور/الانضمام، الدفع (عبر WeChat)، المشاركة على الخط الزمني لـ WeChat، أو إنشاء رموز الاستجابة السريعة للدفع خارج WeChat.
  - يدعم النوافذ المنبثقة للخيارات (مثل التسجيل المباشر مقابل المشاركة للانضمام)، والإشعارات المنبثقة للتعليقات (مثل التحميل، النجاح)، والتنقل إلى الصفحات ذات الصلة (مثل ملفات تعريف المستخدمين، قوائم الدعوة).
  - تصميم متجاوب للجوال (على الأرجح iOS/Android عبر WeChat).
  - لا توجد مخاوف أمنية مباشرة في هذا الكود (على سبيل المثال، لا توجد أنشطة غير مسموح بها)، لكنه يتعامل مع المدفوعات وبيانات المستخدم.
- **التكامل**: يستخدم WeChat SDK للمشاركة والدفع ومعاينة الصور. يعتمد على واجهات برمجة التطبيقات الخارجية (عبر وحدة `http`) والموجه (router) للتنقل. البيانات تفاعلية (بطريقة Vue)، يتم تحديثها عند تغيير المسار.

الكود هو ملف واحد يجمع بين القالب، والنص البرمجي، والأنماط.

---

### 1. **القالب** (الهيكل الشبيه بـ HTML)
يحدد `<template>` تخطيط واجهة المستخدم باستخدام توجيهات Vue (مثل `v-for` للحلقات، `:src` للسمات الديناميكية). وهو مقسم إلى أقسام تنظم تفاصيل البث المباشر بصريًا.

- **العنصر الجذري**: `<div class="intro-view">` – الحاوية الرئيسية للصفحة بأكملها.
- **التنقل**: `<list-nav :mode="0" :title="introTitle" :live-id="liveId"></list-nav>` – مكون مخصص للتنقل، يمرر عنوان البث (يتم حسابه كـ `${live.owner.username}的直播`) والمعرف.
- **قسم الغطاء**:
  - `<img class="cover-img" :src="live.coverUrl" alt="cover" @click="clickCover"/>` – يعرض صورة الغطاء للبث المباشر. النقر عليها يشغل `clickCover()`، والذي قد يبدأ عملية الحضور/الانضمام.
- **قسم الرأس**: `<div class="header-section card-group">`
  - **صورة المستخدم**: `<user-avatar :user="live.owner"></user-avatar>` – يظهر صورة الملف الشخصي لمالك البث.
  - **التفاصيل**: الموضوع (العنوان) واسم المالك. اسم المالك قابل للنقرة للذهاب إلى ملفه الشخصي.
  - **الوقت والحالة**: يظهر الوقت المحدد، الفارق الزمني (مثل "البث خلال ساعتين")، والحالة (مثل "مباشر" إذا كان البث جاريًا، مع تصميم باستخدام classes).
- **ملخص الحضور**: `<div class="attend-summary-section card-group" @click="goUsers">`
  - يسرد عددًا قليلاً من صور المستخدمين الحاضرين وملخصًا (مثل "X شخص شارك >"). قابل للنقرة لعرض جميع الحضور.
- **ملخص الدعوة**: مشابه للحضور، لكنه خاص بـ "لوحة صدارة الدعوة" – يظهر صور المستخدمين المدعوين وتسمية ("قائمة الدعوة>"). قابل للنقرة لعرض الدعوات.
- **مقدمة المتحدث** (شرطي): `<div class="speaker-section card-group" v-show="live.speakerIntro">` – إذا كان للبث مقدمة متحدث، فسيتم عرضها بتنسيق Markdown (مثل السيرة الذاتية/التفاصيل).
- **تفاصيل البث**: `<div class="detail-section card-group">` – يعرض الوصف الكامل للبث المباشر بتنسيق Markdown، مع دعم معاينة الصور (عبر WeChat SDK لتكبير الصور).
- **معلومات حقوق النشر**: `<div class="copyright-section card-group">` – نص ثابت حول حقوق النشر للفيديو، مُعرض بتنسيق Markdown.
- **المزيد من البثوث**: `<div class="lives-section card-group">` – يعرض قائمة ببثوث مباشرة موصى بها (عبر مكون `recommend-live-list`).
- **قسم الحضور** (ثابت في الأسفل):
  - **الأزرار اليسرى**: أزرار شرطية لـ "بدء البث المباشر" (إذا لم يكن المستخدم هو المالك) أو "تحرير صفحة المقدمة" (إذا كان المالك).
  - **زر الحضور الرئيسي**: نص ديناميكي (يتم حسابه كـ `btnTitle`) بناءً على الحالة (مثل "التسجيل للمشاركة في البث المباشر" للتسجيل المجاني، أو "الدعم والمشاركة في البث المباشر ￥X" للبث المدفوع). يتعامل مع منطق الانضمام/الدفع.
- **النوافذ المنبثقة والإشعارات**:
  - `<overlay>`: للنوافذ المنبثقة (مثل خيارات الدفع، مطالبات المشاركة، رمز الاستجابة السريعة للدفع).
  - `<toast>`: رسائل التحميل/النجاح/الخطأ.

التفاعلات الرئيسية:
- النقرات تشغل طرقًا مثل `goUsers`، `attendLive`، إلخ.
- الفئات الديناميكية (مثل `live-on` للحالة النشطة) والقيم المحسوبة (مثل `timeGap`، `statusText`) تجعلها تفاعلية.

---

### 2. **النص البرمجي** (منطق JavaScript)
هذا هو منطق مكون Vue، الذي يتعامل مع البيانات، والحسابات، ودورة الحياة، والطرق، والأحداث.

- **الواردات**:
  - `wx from 'weixin-js-sdk'`: WeChat SDK للمشاركة والمدفوعات، إلخ.
  - مكونات مثل `UserAvatar`، `Markdown` (لعرض Markdown)، `Overlay` (النوافذ المنبثقة)، إلخ.
  - `util`، `http`، `wechat`: وحدات مخصصة للأدوات المساعدة (مثل حالات التحميل، استدعاءات API)، وطلبات HTTP، ودوال WeChat المحددة (مثل المشاركة).
- **تعريف المكون**:
  - `name: 'IntroView'`: اسم المكون.
  - `components`: يسجل المكونات الفرعية المستوردة.
- **خصائص البيانات** (الحالة التفاعلية):
  - `live`: كائن يحتفظ بتفاصيل البث المباشر (مثل المالك، الموضوع، الحالة، عدد الحضور، معلومات الدفع عبر `needPay`).
  - `attendedUsers`، `invites`: مصفوفات من المستخدمين (الحضور/الدعوات) للعرض.
  - `curUser`: معلومات المستخدم المسجل الدخول حاليًا.
  - `overlayStatus`: يتحكم في رؤية النافذة المنبثقة.
  - `qrcodeUrl`: لمدفوعات رمز الاستجابة السريعة.
  - أعلام أخرى: `positiveShare` (المشاركة التي يبدأها المستخدم)، إلخ.
- **الخصائص المحسوبة** (بيانات تفاعلية مشتقة):
  - `options`: مصفوفة ديناميكية للمطالبة المنبثقة (مثل ["التسجيل المباشر", "المشاركة على Moments للتسجيل (شكرًا لك)"] بناءً على الدفع).
  - `btnTitle`: يولد نص الزر ديناميكيًا (مثل تضمين السعر إذا كان `needPay`، حالة مثل "المشاركة في البث المباشر" أو "مشاهدة البث المسجل").
  - `timeGap`: يظهر الوقت حتى البدء (عبر أداة مساعدة).
  - `statusText`: وصف الحالة (مثل "بث مباشر الآن").
  - `introTitle`: عنوان الصفحة.
  - `thankWord()`: تُرجع "مجانًا" أو "شكرًا 1 يوان" للمشاركات منخفضة التكلفة.
- **بيانات المسار** (دورة الحياة عند تغيير المسار):
  - يحمل البيانات الخاصة بـ `liveId` من معلمات URL. إذا كان نفس `liveId`، فإنه يقوم فقط بتحديث تكوين المشاركة؛ وإلا، فإنه يجلب جميع البيانات عبر `loadAllData()` (الذي يستدعي واجهات برمجة التطبيقات للحصول على تفاصيل البث، والمستخدمين، والدعوات، والمستخدم الحالي، وتكوين WeChat).
  - يمكّن مشاركة WeChat للبث المباشر.
- **الطرق** (الدوال):
  - **تحميل البيانات والإعداد**: `loadAllData()` – يجلب معلومات البث، الحضور، الدعوات، بيانات المستخدم، ويقوم بإعداد WeChat (المشاركة، معاينة الصور).
  - **إجراءات المستخدم**:
    - `attendLive()`: التدفق الأساسي – يتحقق من تسجيل الدخول، اشتراك WeChat، ثم يحضر/يدفع بناءً على `canJoin`، `needPay`، إلخ. يتعامل مع النوافذ المنبثقة للخيارات أو رموز الاستجابة السريعة.
    - `payOrCreateAttend()`: يتفرع إلى الدفع أو التسجيل المجاني.
    - `pay()`: يبدأ دفع WeChat أو رمز الاستجابة السريعة.
    - `createAttend()`: التسجيل المجاني، يسجل من رابط الدعوة إذا كان ذلك ممكنًا.
    - `reloadLive()`: يعيد تحميل بيانات البث بعد الإجراءات.
  - **التنقل**: أدوات مساعدة مثل `goUsers()`، `goInvite()`، `goUserRoom(userId)` (عبر `$router.go()`).
  - **الأدوات المساعدة**: `moneyToYuan()` (تحويل الفين إلى يوان)، `cleanFromUserId()` (يمسح تتبع الدعوة من localStorage)، `thankWord()`، `configPreviewImages()` (يُعدّد تكبير الصور في WeChat)، `playVideo()` (يتعامل مع تشغيل الفيديو، على الرغم من عدم وجود عنصر فيديو في القالب – ميزة اختيارية؟).
  - **أخرى**: `editLive()`، `createLive()`، `intoLive()` (الدخول إلى البث المباشر)، `fetchQrcodeUrlAndShow()` (يعرض رمز الاستجابة السريعة للمدفوعات خارج WeChat).
- **الأحداث** (معالجو الأحداث العامة):
  - `shareTimeline`: يتم تشغيله بعد مشاركة WeChat – يقوم بتحديث بيانات المشاركة، ويعرض إشعارًا، وقد يعيد التحميل/الحضور.
  - `hideOptionsForm`: يتعامل مع اختيارات النافذة المنبثقة (مثل الحضور المباشر مقابل المشاركة).
  - `payFinish`: يعيد التحميل ويدخل البث بعد الدفع.
  - `updateCurUser`: يقوم بتحديث البيانات عند تغيير المستخدم.
- **خطاف التدمير**: يسجل التدمير (لأغراض التصحيح).

---

### 3. **الأنماط** (Stylus CSS)
يستخدم هذا Stylus (معالج مسبق موجز لـ CSS) لتنسيق المكون. القواعد الرئيسية:

- **الأساسي**: يستورد الأنماط المشتركة (مثل `base.styl`، `variables.styl`). نقاط التوقف المتجاوبة عبر `rupture`.
- **التخطيط**:
  - `.intro-view`: حاوية بعرض كامل.
  - الأقسام (مثل `.header-section`، `.cover-section`): الحشو، الخلفيات، تخطيطات Flex.
  - الصور الرمزية: أحجام ثابتة (مثل 80px للرأس، 25px للقوائم).
  - الأزرار: شريط ثابت في الأسفل (ارتفاع 55px)، مع Flex لليسار/اليمين. الألوان: أزرق للحضور (#00BDEF)، رمادي/أخضر للآخرين.
  - الأنماط الشرطية: `.live-on` للحالة (خلفية زرقاء).
  - النص: الخطوط، الألوان (رمادي #828282)، ارتفاعات الأسطر لسهولة القراءة.
  - القوائم: صور رمزية مضمنة للحضور/الدعوات.
- **التفاعلات**: نقرات تشبه التمرير، استجابة الصور.
- **الأولوية للجوال**: Flexbox للتخطيط، الأغطية، أسفل ثابت للأزرار. أقصى عرض 700px على الشاشات الأكبر.

---

### كيف يعمل كل هذا معًا
1. **التحميل**: عند دخول المسار، يجلب البيانات من واجهات برمجة التطبيقات (مثل تفاصيل البث، الحضور) ويقوم بإعداد مشاركة WeChat.
2. **العرض**: يعرض الأقسام بمحتوى ديناميكي (مثل Markdown للتفاصيل، نص زر محسوب).
3. **التفاعل**: ينقر المستخدم على "حضور" → يتحقق من المصادقة/الدفع → يعرض نافذة منبثقة/خيارات → الدفع عبر WeChat/رمز الاستجابة السريعة أو التسجيل المجاني → يدخل البث المباشر.
4. **التحديثات**: البيانات التفاعلية (مثل `live.canJoin`) تغير واجهة المستخدم/الأزرار. الأحداث تتعامل مع الإجراءات غير المتزامنة مثل المشاركات/المدفوعات.
5. **الحالات الخاصة**: يتعامل مع متصفحات غير WeChat (الاحتياطي لرمز الاستجابة السريعة)، المشاركات غير المدفوعة، حالة الوقت، إلخ.

هذا مكون مصقول وغني بالميزات لمقدمات البث المباشر، مع التركيز على التكامل الاجتماعي/الدفع. إذا كانت لديك أسئلة محددة (مثل حول طريقة أو تصحيح خطأ)، فأخبرني! إذا كان هذا كودًا تعمل معه، لاحظ أن Vue 1.x قديم – فكر في الترقية إلى Vue 3 للحصول على الميزات الحديثة.