---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: النشر الساخن في ويب سبير
translated: true
type: note
---

### فهم النشر الساخن والتبديل الساخن في خادم تطبيقات ويب سبير (WAS)

النشر الساخن (المعروف أيضًا باسم إعادة التحميل الساخنة أو التبديل الساخن) هو أسلوب تطوير يسمح لك بتحديث ونشر التغييرات على تطبيقك—مثل الكود، أو التكوين، أو الموارد—دون الحاجة إلى إعادة تشغيل كاملة لخادم التطبيقات. هذا مفيد بشكل خاص خلال دورات التطوير التكراري، حيث أن التغييرات المتكررة في الكود (مثل إصلاح الأخطاء، أو تعديل المنطق، أو تحديث عناصر واجهة المستخدم) ستتباطأ بخلاف ذلك بسبب أوقات بدء التشغيل الطويلة للخادم، خاصة في بيئات المؤسسات مثل IBM WebSphere Application Server (WAS). يمكن أن تستغرق إعادة تشغيل مثيل WAS دقائق أو حتى أكثر للتطبيقات الكبيرة، مما يعطل سير العمل والاختبار.

يركز المقتطف الذي قدمته على الاستراتيجيات العملية لتحقيق تكرارات أسرع في WAS، مع التركيز على نشرات WAR "المفككة" وأدوات التبديل الساخن المحسّن. سأقوم بشرح هذا خطوة بخطوة، موضحًا المفاهيم، وكيفية عملها، وقيودها، ونصائح التنفيذ.

#### 1. النشر كـ WAR "مفكك" (نشر غير معبأ)
ملف WAR (أرشيف تطبيق الويب) هو في الأساس حزمة مضغوطة تحتوي على موارد تطبيق الويب الخاص بك: JSPs، والخوادم الخدمية، وفئات جافا، والملفات الثابتة (HTML/CSS/JS)، والمكتبات (JARs)، وملفات التكوين (مثل web.xml). بشكل افتراضي، يتم نشر ملفات WAR كملفات **معبأة** (مضغوطة)، والتي تعاملها WAS على أنها غير قابلة للتغيير—أي تغيير يتطلب إعادة تعبئة وإعادة نشر الأرشيف بالكامل.

يشير **WAR المفكك** إلى فك ضغط (إلغاء ضغط) ملف WAR إلى بنية دليل قبل النشر. هذا يسمح بتعديل الملفات أو الأدلة الفرعية الفردية مباشرة على نظام ملفات الخادم دون المساس بالأرشيف بالكامل.

**لماذا يتيح تكرارات أسرع:**
- **تحديثات على مستوى الملف:** يمكنك تحرير ملف JSP أو فئة جافا واحدة، ويمكن لـ WAS اكتشاف وإعادة تحميل ذلك المكون فقط.
- **لا حاجة لإعادة التعبئة:** يتجنب عبء ضغط/فك ضغط ملفات WAR الكبيرة بشكل متكرر.
- **التآزر مع إعادة التحميل الساخنة:** يسهل على الخادم مراقبة وتحديث الملفات المتغيرة.

**كيفية نشر WAR مفكك في WAS:**
- **باستخدام وحدة التحكم الإدارية:**
  1. سجل الدخول إلى WAS Integrated Solutions Console (عادة على `http://localhost:9060/ibm/console`).
  2. انتقل إلى **Applications > New Application > New Enterprise Application**.
  3. بدلاً من تحديد ملف WAR معبأ، اشير إلى الدليل الجذر لـ WAR المفكك (مثال: `/path/to/myapp.war/`—لاحظ الشرطة المائلة في النهاية للإشارة إلى أنه دليل).
  4. أكمل معالج النشر، مع التأكد من أن "Deploy Web services" والخيارات الأخرى تتطابق مع تطبيقك.
- **باستخدام wsadmin (أداة البرمجة النصية):**
  ```bash
  wsadmin.sh -c "AdminApp.install('/path/to/myapp', '[ -MapWebModToVH [[myapp .* default_host.* virtual_host ]]]')"
  ```
  استبدل `/path/to/myapp` بدليلك المفكك.
- **الخوادم المخصصة للتطوير (مثال: Liberty Profile):** للاختبار الخفيف، استخدم Open Liberty (نوع فرعي من WAS) مع `server start` وضع تطبيقك المفكك في مجلد `dropins` للنشر التلقائي.

**أفضل الممارسات:**
- استخدم أداة تحكم في المصدر (مثل Git) لمزامنة التغييرات من بيئة التطوير المتكاملة (IDE) إلى الدليل المفكك.
- راقب مساحة القرص، حيث تستهلك النشرات المفككة مساحة تخزين أكبر.
- في الإنتاج، التزم بملفات WAR المعبأة للأمان والاتساق—النشر الساخن مخصص بشكل أساسي للتطوير/الاختبار.

بمجرد النشر بشكل مفكك، يمكن لآليات WAS المدمجة أن تبدأ العمل من أجل إعادة التحميل الجزئي الساخن.

#### 2. دعم إعادة التحميل الساخن المدمج في WAS
توفر WAS دعمًا أصليًا لإعادة التحميل الساخن لمكونات معينة دون إعادة تشغيل كاملة، لكنه محدود. يعتمد هذا على آلية **استطلاع الملفات** في الخادم، حيث تفحص WAS دوريًا دليل النشر المفكك بحثًا عن التغييرات (قابل للتكوين عبر وسيطات JVM مثل `-DwasStatusCheckInterval=5` لفحوصات كل 5 ثوانٍ).

**ما تدعمه WAS افتراضيًا:**
- **JSPs (صفحات خادم جافا):**
  - يتم تجميع JSPs ديناميكيًا إلى خوادم خدمية عند أول وصول. إذا قمت بتعديل ملف JSP في WAR مفكك، يمكن لـ WAS اكتشاف التغيير، وإعادة تجميعه، وإعادة تحميل الخادم الخدمي.
  - **كيف يعمل:** عيّن `reloadInterval` في `ibm-web-ext.xmi` (ضمن WEB-INF) إلى قيمة منخفضة (مثال: 1 ثانية) للفحوصات المتكررة. أو استخدم الإعداد العام في **Servers > Server Types > WebSphere application servers > [اسم_الخادم] > Java and Process Management > Process definition > Java Virtual Machine > Custom properties** مع `com.ibm.ws.webcontainer.invokefilterscompatibility=true`.
  - **القيود:** يعمل فقط مع JSPs التي لم يتم تخزينها مؤقتًا بشكل عدواني. قد تتطلب JSPs المعقدة التي تحتوي على تضمينات أو علامات إعادة تشغيل على مستوى الوحدة.
- **بعض فئات جافا (الخوادم الخدمية وـ EJBs):**
  - بالنسبة للنشرات المفككة، يمكن لـ WAS إعادة تحميل ملفات الفئة الفردية إذا كانت في أدلة WEB-INF/classes أو lib.
  - **كيف يعمل:** فعّل "Application reload" في واصف النشر أو عبر وحدة التحكم: **Applications > [تطبيقك] > Manage Modules > [الوحدة] > Reload behavior > Reload enabled**.
  - يؤدي هذا إلى **إعادة تحميل على مستوى الوحدة**، وهو أسرع من إعادة تشغيل التطبيق بالكامل ولكنه لا يزال يفرغ/يعيد تحميل الوحدة بأكملها (مثال: تطبيق الويب الخاص بك).

**قيود الدعم المدمج:**
- **ليس تبديلًا ساخنًا حقيقيًا:** التغييرات في المنطق الأساسي للتطبيق (مثال: تعديل طريقة في فئة خادم خدمي قيد التشغيل) لن تُفعّل دون تفريغ محمل الفئات القديم. قد ترى `ClassNotFoundException` أو كود قديم.
- **فقدان الحالة:** قد تتم إعادة تعيين الجلسات، أو الكائنات المفردة، أو اتصالات قاعدة البيانات.
- **خصوصيات IBM JDK:** غالبًا ما تستخدم WAS JDK من IBM، والتي بها بعض السلوكيات الغريبة مع إعادة تحميل الفئات مقارنة بـ OpenJDK/HotSpot.
- **لا يدعم التغييرات الهيكلية:** إضافة فئات جديدة، أو تغيير تواقيع الأساليب، أو تحديث التعليقات التوضيحية يتطلب إعادة تشغيل.
- **عبء على الأداء:** يمكن أن ترهق عمليات الاستطلاع المتكررة الموارد في بيئة التطوير.

للتعديلات الأساسية على واجهة المستخدم (تحريرات JSP) أو تحديثات الفئة البسيطة، هذا كافٍ ومجاني. ولكن من أجل "التبديل الساخن الكامل"—حيث يمكنك تحرير الكود قيد التشغيل أثناء التنفيذ دون أي إعادة تحميل—أنت بحاجة إلى أدوات خارجية.

#### 3. حلول التبديل الساخن الكامل
لتحقيق تغييرات كود سلسة (مثال: تحرير جسم طريقة في بيئة تطوير متكاملة (IDE) متصلة بمصحح الأخطاء مثل Eclipse أو IntelliJ، ورؤيتها تُطبق على الفور)، استخدم الإضافات التي ترقع تحميل الفئات وأداة JVM.

**الخيار 1: JRebel (إضافة مدفوعة)**
- **ما هو:** أداة تجارية من Perforce (المعروفة سابقًا باسم ZeroTurnaround) توفر تبديلًا ساخنًا شاملاً لتطبيقات جافا. تقوم بأداة البايت كود عند بدء التشغيل، مما يسمح بإعادة تحميل الفئات، والموارد، وحتى التغييرات الخاصة بالإطار (مثال: Spring beans، كيانات Hibernate).
- **لماذا تستخدمه مع WAS:**
  - تكامل عميق مع WAS، بما في ذلك دعم WARs المفككة، وحزم OSGi، وـ IBM JDK.
  - يتعامل مع سيناريوهات معقدة مثل تغيير تواقيع الأساليب أو إضافة حقول (أبعد من حدود التبديل الساخن القياسية لـ JVMTI).
  - **الميزات:** الكشف التلقائي عن التغييرات من بيئة التطوير المتكاملة الخاصة بك؛ لا حاجة لإعادة النشر يدويًا؛ يحافظ على حالة التطبيق.
- **كيفية إعداده:**
  1. حمّل JRebel من الموقع الرسمي وقم بتثبيته كإضافة لـ Eclipse/IntelliJ.
  2. أنشئ ملف تكوين `rebel.xml` لمشروعك (يتم إنشاؤه تلقائيًا أو يدويًا).
  3. أضف وسيطات JVM إلى خادم WAS الخاص بك: `-javaagent:/path/to/jrebel.jar` (المسار الكامل لـ JAR الوكيل).
  4. ابدأ WAS في وضع التصحيح (`-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000`).
  5. صل مصحح أخطاء بيئة التطوير المتكاملة الخاصة بك وحرر الكود—يقوم JRebel بمزامنة التغييرات مباشرة.
- **التكلفة:** قائمة على الاشتراك (~ 400 دولار / مستخدم / سنة للأفراد؛ يختلف ترخيص المؤسسة). نسخة تجريبية مجانية متاحة.
- **الإيجابيات:** موثوق، سهل الاستخدام، دعم ممتاز لـ WAS.
- **السلبيات:** مدفوع؛ يتطلب إعدادًا لكل مشروع.

**الخيار 2: DCEVM + HotSwapAgent (بديل مجاني)**
- **ما هو:** مزيج مفتوح المصدر للتبديل الساخن المتقدم.
  - **DCEVM (آلة التطور الديناميكي للكود):** JVM معدل يمتد JVMTI لـ HotSpot للسماح بإعادة تعريف الفئات بشكل أكثر عدوانية (مثال: إضافة/إزالة طرق، تغيير التسلسلات الهرمية).
  - **HotSwapAgent:** وكيل يبني على DCEVM، ويوفر تكاملًا مع بيئة التطوير المتكاملة لإعادة تحميل الفئات التلقائي.
- **لماذا تستخدمه مع WAS:**
  - مجاني وقوي للتطوير، يحاكي قدرات JRebel.
  - يدعم تغييرات جسم الأسلوب، وتحديثات الموارد، وحتى بعض إعادة تحميل الأطر (عبر الإضافات).
- **ملاحظة التوافق مع IBM JDK الخاص بـ WAS:**
  - تشحن WAS عادةً مع J9 JDK من IBM، والذي **لا يدعم DCEVM** بشكل أصلي (DCEVM مخصص لـ HotSpot).
  - **الحل البديل:** انتقل إلى OpenJDK/HotSpot للتطوير (مثال: عبر تجاوز `JAVA_HOME` في `setInitial.sh` أو `jvm.options` الخاص بـ Liberty). اختبر بدقة—قد تختلف ميزات جمع القمامة والأمان في IBM JDK.
  - في الإنتاج، ارجع إلى IBM JDK؛ هذا مخصص للتطوير فقط.
- **كيفية إعداده:**
  1. **ثبّت DCEVM:**
     - حمّل أداة ترقيع DCEVM JAR من GitHub (مثال: `dcevm-11.0.0+7-full.jar` لـ JDK 11+).
     - شغّل: `java -jar dcevm.jar /path/to/your/jdk/jre/lib/server/jvm.dll server` (Windows) أو ما يعادله لنظام Linux (`libjvm.so`).
     - يقوم هذا بترقيع ملف JVM الثنائي لـ JDK الخاص بك—احفظ نسخة احتياطية أولاً!
  2. **ثبّت HotSwapAgent:**
     - حمّل `hotswap-agent.jar` من GitHub.
     - أضف إلى وسيطات JVM لـ WAS: `-XXaltjvm=dcevm -XX:+TraceClassLoading -javaagent:/path/to/hotswap-agent.jar=DCEVM` (بالإضافة إلى أي إضافات، مثال: `=hotswap-spring` لـ Spring).
  3. **تكامل بيئة التطوير المتكاملة:**
     - ثبّت إضافة HotSwapAgent لـ IntelliJ/Eclipse.
     - ابدأ WAS بوسيطات التصحيح كما هو مذكور أعلاه.
     - حرر واحفظ الكود في بيئة التطوير المتكاملة—يعيد الوكيل التحميل تلقائيًا.
  4. **اختبار التوافق:**
     - قم بتشغيل اختبار سريع: انشر خادمًا خدميًا بسيطًا، حرر طريقة (مثال: أضف سطر سجل)، استدعِ النقطة الطرفية، وتحقق من التغيير دون إعادة تشغيل.
     - افحص السجلات للبحث عن أخطاء مثل `HotSwap failed: method limit reached` (لـ DCEVM حدود على التغييرات لكل فئة).
- **الإيجابيات:** مجاني، قابل للتخصيص (عبر إضافات لـ Spring، CDI، إلخ)، مدعوم من المجتمع.
- **السلبيات:** الإعداد معقد؛ احتمال عدم الاستقرار مع JVMs غير القياسية؛ مقصور على HotSpot (اختبر تبديل IBM JDK بحذر)؛ ليس أنيقًا مثل JRebel.

#### متى تستخدم ماذا
- **WAR مفكك + إعادة تحميل مدمج:** للتعديلات السريعة على JSP/الملفات الثابتة في التطوير المبكر.
- **JRebel:** إذا سمحت الميزانية وكانت تحتاج إلى موثوقية من مستوى المؤسسة.
- **DCEVM + HotSwapAgent:** للتبديل الساخن الكامل المجاني، لكن خصص وقتًا لاختبار توافق JVM.

باختصار، تحول هذه التقنيات WAS من خادم ثقيل إلى بيئة تطوير أكثر مرونة، مما يقلل أوقات التكرار من دقائق إلى ثوانٍ. ابدأ بـ WARs المفككة لتحقيق مكاسب فورية، ثم أضف الأدوات حسب الحاجة. إذا كنت تواجه أخطاء محددة، شارك المزيد من التفاصيل لاستكشاف الأخطاء وإصلاحها.

**المراجع:**  
[توثيق JRebel لـ WebSphere](https://www.jrebel.com/products/jrebel/tutorials/deploy-jrebel-websphere)  
[مستودع DCEVM على GitHub](https://github.com/dcevm/dcevm)  
[مستودع HotSwapAgent على GitHub](https://github.com/HotswapProjects/HotswapAgent)  
[مركز معرفة IBM: النشر الساخن في WebSphere](https://www.ibm.com/docs/en/was/9.0.5?topic=applications-hot-deployment)