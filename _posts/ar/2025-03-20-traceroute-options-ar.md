---
audio: false
generated: true
lang: ar
layout: post
title: خيارات التتبع
translated: true
type: note
---

يعتبر Traceroute أداة قوية لتشخيص مسارات الشبكة، وبينما يبدو استخدامه الأساسي بسيطًا، فإنه يوفر خيارات متقدمة لتخصيص سلوكه. أدناه، سأوضح الخيارات الشائعة وأشرح كيفية استخدام traceroute بطرق متقدمة، مع التركيز على الأمثلة العملية. تختلف الخيارات الدقيقة حسب نظام التشغيل (مثلًا، يستخدم Windows الأمر `tracert`، بينما يستخدم Linux/macOS الأمر `traceroute`)، لكنني سأغطي الخيارات الأكثر شيوعًا وتطبيقًا.

### الاستخدام الأساسي
- **Linux/macOS**: `traceroute [الوجهة]`
  - مثال: `traceroute google.com`
- **Windows**: `tracert [الوجهة]`
  - مثال: `tracert google.com`

يظهر هذا القفزات (الموجهات) بينك وبين الهدف، إلى جانب أوقات الرحلة ذهابًا وإيابًا (RTT) لكل منها.

---

### خيارات Traceroute الشائعة
إليك نظرة عامة على الخيارات الرئيسية، بشكل أساسي لأمر `traceroute` على أنظمة Unix-like (Linux/macOS). يمتلك الأمر `tracert` في Windows خيارات أقل لكنه يشارك بعض المفاهيم.

1. **`-n` (بدون بحث DNS)**  
   - يتخطى تحويل عناوين IP إلى أسماء نطاقات، مما يسرع العملية ويعرض عناوين IP الخام.
   - الاستخدام: `traceroute -n google.com`
   - السبب: مفيد عندما يكون تحليل DNS بطيئًا أو عندما تهتم فقط بعناوين IP.

2. **`-m [max_hops]` (تعيين أقصى عدد للقفزات)**  
   - يحدد عدد القفزات التي يتحقق منها traceroute قبل أن يتوقف (الافتراضي غالبًا 30).
   - الاستخدام: `traceroute -m 15 google.com`
   - السبب: يمنع التشغيل إلى ما لا نهاية إذا كان الهدف غير قابل للوصول أو بعيدًا.

3. **`-q [nqueries]` (عدد الاستعلامات لكل قفزة)**  
   - يحدد عدد الحزم المرسلة لكل قفزة (الافتراضي هو 3). يظهر كل استعلام قيمة زمن انتقال.
   - الاستخدام: `traceroute -q 1 google.com`
   - السبب: يقلل من فوضى الناتج أو يسرع التتبع؛ زده للحصول على بيانات زمن انتقال أكثر موثوقية.

4. **`-w [waittime]` (وقت الانتظار لكل قفزة)**  
   - يحدد المدة (بالثواني) للانتظار للحصول على استجابة قبل وضع علامة على القفزة على أنها انتهى وقتها.
   - الاستخدام: `traceroute -w 2 google.com`
   - السبب: يتكيف مع الشبكات البطيئة أو يقلل التأخير على الشبكات السريعة.

5. **`-p [port]` (تحديد المنفذ، وضع UDP)**  
   - يحدد منفذ الوجهة لـ traceroute القائم على UDP (الافتراضي غالبًا 33434+).
   - الاستخدام: `traceroute -p 53 google.com`
   - السبب: يستهدف خدمات محددة (مثل DNS على المنفذ 53) أو يتجاوز المرشحات التي تمنع ICMP.

6. **`-I` (استخدام ICMP بدلاً من UDP)**  
   - يتحول من UDP (الافتراضي في العديد من الأنظمة) إلى حزم طلب صدى ICMP.
   - الاستخدام: `traceroute -I google.com`
   - السبب: بعض الشبكات تمنع UDP لكنها تسمح بـ ICMP، مما يحسن الرؤية.

7. **`-T` (وضع TCP)**  
   - يستخدم حزم TCP بدلاً من UDP أو ICMP، غالبًا مع حزم SYN.
   - الاستخدام: `traceroute -T -p 80 google.com`
   - السبب: يتجاوز الجدران النارية التي تمنع ICMP/UDP؛ ممتاز لتتبع مسارات خوادم الويب (المنفذ 80 = HTTP).

8. **`-f [first_ttl]` (البدء بقيمة TTL محددة)**  
   - يحدد قيمة TTL الأولية، متخطيًا القفزات السابقة.
   - الاستخدام: `traceroute -f 5 google.com`
   - السبب: يركز على جزء محدد من المسار، على سبيل المثال، بعد شبكتك المحلية.

9. **`-g [gateway]` (توجيه المصدر المرن)**  
   - يفرض تمرير الحزم عبر بوابة محددة (إذا كانت الشبكة تدعم ذلك).
   - الاستخدام: `traceroute -g 192.168.1.1 google.com`
   - السبب: يختبر مسارات محددة أو يتجاوز التوجيه الافتراضي.

10. **`-4` أو `-6` (إجبار IPv4 أو IPv6)**  
    - يقيد traceroute لاستخدام IPv4 أو IPv6.
    - الاستخدام: `traceroute -6 google.com`
    - السبب: يضمن أنك تختبر بروتوكولًا محددًا، مفيد للشبكات ذات المكدس المزدوج.

---

### خيارات Windows `tracert`
يمتلك Windows خيارات أقل، لكن إليك الرئيسية منها:
- **`-d`**: بدون بحث DNS (مثل `-n`).
- **`-h [max_hops]`**: أقصى عدد للقفزات (مثل `-m`).
- **`-w [timeout]`**: وقت الانتظار بالمللي ثانية (مثل `-w`).
- مثال: `tracert -d -h 20 google.com`

---

### أمثلة الاستخدام المتقدم
إليك كيفية دمج الخيارات لأغراض محددة:

1. **تشخيص اتصال بطيء**  
   - الهدف: تحديد مكان حدوث طفرات زمن الانتقال.
   - الأمر: `traceroute -I -q 5 -w 1 google.com`
   - السبب: ICMP للموثوقية، 5 استعلامات لإحصائيات زمن انتقال أفضل، وقت انتهاء 1 ثانية للتحرك بسرعة.

2. **تجاوز قيود الجدار الناري**  
   - الهدف: تتبع مسار إلى خادم ويب محظور بواسطة مرشحات ICMP.
   - الأمر: `traceroute -T -p 443 google.com`
   - السبب: TCP على المنفذ 443 (HTTPS) يحاكي حركة المرور الشرعية، المسموح بها غالبًا عبر الجدران النارية.

3. **الاختبار بعد مزود خدمة الإنترنت الخاص بك**  
   - الهدف: تخطي القفزات المحلية للتركيز على التوجيه الخارجي.
   - الأمر: `traceroute -f 3 -m 10 google.com`
   - السبب: يبدأ من القفزة 3 (بعد الموجه/مزود خدمة الإنترنت الخاص بك)، يحدد بـ 10 قفزات كحد أقصى.

4. **مقارنة مسارات IPv4 مقابل IPv6**  
   - الهدف: معرفة ما إذا كان اختيار البروتوكول يؤثر على التوجيه.
   - الأوامر: 
     - `traceroute -4 google.com`
     - `traceroute -6 google.com`
   - السبب: يحدد الاختلافات في مسارات الشبكة أو الأداء.

5. **تتبع سريع وصامت للأتمتة**  
   - الهدف: ناتج سريع للأتمتة.
   - الأمر: `traceroute -n -q 1 -w 1 google.com > output.txt`
   - السبب: بدون DNS، استعلام واحد، وقت انتظار قصير، إعادة التوجيه إلى ملف.

---

### نصائح للاستخدام المتقدم
- **الدمج مع أدوات أخرى**: زاوج traceroute مع `ping` (لزمن الانتقال) أو `mtr` (traceroute في الوقت الفعلي) للحصول على رؤى أعمق.
- **فهم سياق الشبكة**: يمكن للجدران النارية أو NAT أو شبكات VPN أن تحجب القفزات (عرض علامات النجمة `*`) — عدّل البروتوكولات (ICMP/TCP) للتكيف.
- **امتيازات الجذر**: في أنظمة Unix، قد تتطلب بعض الخيارات (مثل وضع TCP) استخدام `sudo` للوصول إلى المقابس الخام: `sudo traceroute -T google.com`.

تكمن قوة Traceroute في مرونته. من خلال تعديل الخيارات، يمكنك تخصيصه لاستكشاف مشاكل شبكية محددة، أو تجاوز القيود، أو تحليل سلوك التوجيه بالتفصيل. دعني أعلم إذا كنت تريد الخوض更深 في سيناريو معين!