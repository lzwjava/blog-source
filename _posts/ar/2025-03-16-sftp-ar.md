---
audio: false
generated: true
lang: ar
layout: post
title: إعداد خادم إس إف تي بي على أوبونتو
translated: true
type: note
---

إعداد خادم SFTP (بروتوكول نقل الملفات عبر SSH) على أوبونتو هو عملية مباشرة تتيح لك نقل الملفات بأمان عبر الشبكة باستخدام تشفير SSH. فيما يلي دليل كامل خطوة بخطوة لمساعدتك في إعداده.

---

### الخطوة 1: تثبيت خادم OpenSSH
يعتمد SFTP على خادم OpenSSH، الذي تحتاج إلى تثبيته على نظام أوبونتو الخاص بك.

1. افتح الطرفية وقم بتحديث قائمة الحزم:
   ```bash
   sudo apt update
   ```

2. قم بتثبيت خادم OpenSSH:
   ```bash
   sudo apt install openssh-server
   ```

3. تحقق من أن خدمة SSH تعمل:
   ```bash
   sudo systemctl status ssh
   ```
   - إذا لم تكن تعمل، ابدأها:
     ```bash
     sudo systemctl start ssh
     ```
   - تأكد من بدئها عند الإقلاع:
     ```bash
     sudo systemctl enable ssh
     ```

---

### الخطوة 2: إنشاء مستخدم مخصص لـ SFTP
لأمان أفضل، أنشئ مستخدمًا محددًا للوصول عبر SFTP.

1. أضف مستخدمًا جديدًا (مثل `sftpuser`):
   ```bash
   sudo adduser sftpuser
   ```
   - اتبع المطالبات لتعيين كلمة مرول وملء أي تفاصيل اختيارية.

2. (اختياري) امنع هذا المستخدم من الوصول إلى shell عبر SSH:
   ```bash
   sudo usermod -s /bin/false sftpuser
   ```

---

### الخطوة 3: تكوين SSH لـ SFTP
يمكنك إما السماح لجميع المستخدمين باستخدام SFTP مع مجلداتهم الرئيسية أو تقييد مستخدمين محددين لمجلدات معينة.

#### الخيار 1: السماح بـ SFTP لجميع المستخدمين
إذا كنت تريد أن يتمكن جميع المستخدمين من الوصول إلى مجلداتهم الرئيسية عبر SFTP، لا حاجة لتكوين إضافي بعد تثبيت OpenSSH. انتقل إلى الخطوة 5.

#### الخيار 2: تقييد مستخدم إلى مجلد معين
لقفل مستخدم (مثل `sftpuser`) في مجلد معين:

1. قم بتحرير ملف تكوين SSH:
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

2. أضف الأسطر التالية في نهاية الملف:
   ```ini
   Match User sftpuser
       ChrootDirectory /home/sftpuser
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   - احفظ الملف (`Ctrl+O`، ثم `Enter`) واخرج (`Ctrl+X`).

3. هذا التكوين:
   - يحدد `sftpuser` للمسار `/home/sftpuser`.
   - يفرض استخدام SFTP فقط.
   - يعطل ميزات إضافية مثل تحويل TCP.

---

### الخطوة 4: إعداد أذونات المجلد
لكي يعمل الإعداد المقيد (chroot)، اضبط الأذونات:

1. اجعل مالك مجلد chroot هو root:
   ```bash
   sudo chown root:root /home/sftpuser
   ```

2. أنشئ مجلدًا فرعيًا قابلًا للكتابة للمستخدم (مثل `uploads`):
   ```bash
   sudo mkdir /home/sftpuser/uploads
   sudo chown sftpuser:sftpuser /home/sftpuser/uploads
   ```
   - يمكن للمستخدم الآن رفع الملفات إلى `/home/sftpuser/uploads`.

---

### الخطوة 5: إعادة تشغيل خدمة SSH
طبق التغييرات الخاصة بك بإعادة تشغيل SSH:
```bash
sudo systemctl restart ssh
```

---

### الخطوة 6: اختبار خادم SFTP الخاص بك
تحقق من عمل الخادم عن طريق الاتصال من جهاز آخر.

1. ابحث عن عنوان IP لجهاز الأوبونتو الخاص بك:
   ```bash
   ip addr show
   ```
   - ابحث عن IP مثل `192.168.1.100`.

2. اختبر الاتصال:
   - **من طرفية (Linux/macOS):**
     ```bash
     sftp sftpuser@<ubuntu-ip-address>
     ```
     - أدخل كلمة المرور عند المطالبة.
   - **باستخدام FileZilla (أي نظام تشغيل):**
     - الخادم: `sftp://<ubuntu-ip-address>`
     - اسم المستخدم: `sftpuser`
     - كلمة المرور: (كلمة المرور الخاصة بك)
     - المنفذ: 22

3. حاول رفع ملف إلى مجلد `uploads` أو عرض محتويات المجلد.

---

### الخطوة 7: تكوين الجدار الناري
إذا كنت تستخدم جدار الأوبونتو الناري (UFW)، اسمح بمرور بيانات SFTP:

1. تحقق من حالة الجدار الناري:
   ```bash
   sudo ufw status
   ```

2. اسمح لـ SSH/SFTP (المنفذ 22):
   ```bash
   sudo ufw allow 22/tcp
   sudo ufw reload
   ```

---

### لقد انتهى كل شيء!
خادم SFTP الخاص بك جاهز الآن! يمكن للمستخدمين الاتصال بأمان ونقل الملفات إلى المجلدات المخصصة لهم باستخدام عميل SFTP. إذا قمت بتقييد `sftpuser`، فسيكون لديه حق الوصول فقط إلى `/home/sftpuser/uploads` (أو أينما قمت بالإعداد). استمتع بنقل الملفات الآمن!