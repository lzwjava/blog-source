---
audio: false
generated: false
image: false
lang: ar
layout: post
title: بناء تطبيق قابل للتوسع على Azure
translated: true
---

*هذا المقال تم كتابته مع مساعدة ChatGPT-4o.*

---

### جدول المحتويات
- [المقدمة](#introduction)
- [بدء العمل مع اشتراك Azure](#getting-started-with-azure-subscription)
- [نشر التطبيقات مع خدمة Azure Kubernetes (AKS)](#deploying-applications-with-azure-kubernetes-service-aks)
  - [إنشاء وإدارة مجموعة AKS](#creating-and-managing-an-aks-cluster)
  - [نشر التطبيقات](#deploying-applications)
- [استرجاع السجلات من البودات](#fetching-logs-from-pods)
- [المراقبة والتشخيص مع Azure Application Insights](#monitoring-and-diagnostics-with-azure-application-insights)
- [استخدام آلات Azure الافتراضية (VMs)](#utilizing-azure-virtual-machines-vms)
- [استيعاب البيانات في الوقت الفعلي مع Azure Event Hubs](#real-time-data-ingestion-with-azure-event-hubs)
- [إدارة APIs مع خدمات إدارة APIs في Azure](#managing-apis-with-azure-api-management-services)
- [استخدام قواعد بيانات Azure SQL](#utilizing-azure-sql-databases)
- [استعلام السجلات باستخدام لغة استعلام Kusto (KQL)](#querying-logs-with-kusto-query-language-kql)
- [إعداد التنبيهات للمراقبة الاستباقية](#setting-up-alerts-for-proactive-monitoring)
- [الخاتمة](#conclusion)

### المقدمة

في عالم الحوسبة السحابية، يتفوق Microsoft Azure كمنصة قوية لبناء ونشر وإدارة التطبيقات. في مشروعنا الأخير، استغلنا عدة خدمات Azure، بما في ذلك اشتراك Azure، خدمة Azure Kubernetes (AKS)، Application Insights، آلات افتراضية (VMs)، Event Hubs، خدمات إدارة APIs، وقواعد بيانات SQL، لإنشاء بنية تحتية للتطبيقات قابلة للتوسع ومراقبة. يوضح هذا المقال نهجنا، والأدوات المستخدمة، وأفضل الممارسات، والخطوات المفصلة لإدارة المجموعات، واسترجاع السجلات، واستعلام السجلات.

### بدء العمل مع اشتراك Azure

يشكل اشتراك Azure بوابة الوصول إلى خدمات Azure. يعمل كحاوية تحتوي على جميع مواردك، مثل آلات افتراضية، وقواعد بيانات، ومجموعات Kubernetes.

1. إعداد اشتراك Azure:
   - التسجيل: إذا لم يكن لديك حساب Azure، ابدأ بالتسجيل في [بوابة Azure](https://portal.azure.com/).
   - إنشاء اشتراك: انتقل إلى قسم "الاشتراكات" وانشئ اشتراكًا جديدًا. هذا سيكون حاوية الفواتير والإدارة.

2. تنظيم الموارد:
   - مجموعات الموارد: نظم مواردك في مجموعات الموارد بناءً على دورة حياتها ومعيار الإدارة.
   - التسميات: استخدم التسميات لمعلومات إضافية ومزيد من سهولة إدارة الموارد والفواتير.

### نشر التطبيقات مع خدمة Azure Kubernetes (AKS)

خدمة Azure Kubernetes (AKS) هي خدمة Kubernetes المدارة التي تبسط نشر وإدارة وتوسيع التطبيقات المعبأة في حاويات.

#### إنشاء وإدارة مجموعة AKS

1. إنشاء مجموعة AKS في بوابة Azure:
   - الإعداد: في بوابة Azure، ابحث عن AKS وانشئ مجموعة Kubernetes جديدة.
   - التكوين: اختر حجم المجموعة، وقم بتكوين مجموعات العقد، وإعداد الشبكة.
   - المصادقة: استخدم Azure Active Directory (AAD) لسيطرة الوصول الآمنة.
   - المراقبة: قم تمكين المراقبة والتسجيل أثناء عملية الإعداد.

2. إنشاء مجموعة AKS باستخدام واجهة Azure CLI:
   ```sh
   az aks create \
     --resource-group myResourceGroup \
     --name myAKSCluster \
     --node-count 3 \
     --enable-addons monitoring \
     --generate-ssh-keys
   ```

3. إدارة مجموعة AKS الخاصة بك:
   - توسيع المجموعة:
     ```sh
     az aks scale \
       --resource-group myResourceGroup \
       --name myAKSCluster \
       --node-count 5
     ```
   - تحديث المجموعة:
     ```sh
     az aks upgrade \
       --resource-group myResourceGroup \
       --name myAKSCluster \
       --kubernetes-version 1.21.2
     ```

#### نشر التطبيقات

1. استخدام ملفات التكوين Kubernetes: اكتب ملفات YAML لتنزيلاتك، والخدمات، والأشياء الأخرى في Kubernetes.
   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: myapp
   spec:
     replicas: 2
     selector:
       matchLabels:
         app: myapp
     template:
       metadata:
         labels:
           app: myapp
       spec:
         containers:
         - name: myapp
           image: myregistry.azurecr.io/myapp:latest
           ports:
           - containerPort: 80
   ```

2. النشر باستخدام kubectl:
   ```sh
   kubectl apply -f myapp-deployment.yaml
   ```

3. مخططات Helm: استخدم Helm لإدارة تطبيقات Kubernetes وتحكم في الإصدارات.
   ```sh
   helm install myapp ./mychart
   ```

### استرجاع السجلات من البودات

1. الارتباط ببود وتحميل السجلات:
   ```sh
   kubectl logs <pod-name>
   ```
   - لتدفق السجلات:
     ```sh
     kubectl logs <pod-name> -f
     ```

2. استخدام Sidecar للتسجيل:
   - انشئ حاوية Sidecar للتسجيل في مواصفات البود الخاصة بك لإرسال السجلات إلى خدمة تسجيل مركزية.

   ```yaml
   spec:
     containers:
     - name: myapp
       image: myregistry.azurecr.io/myapp:latest
       ...
     - name: log-shipper
       image: log-shipper:latest
       ...
   ```

### المراقبة والتشخيص مع Azure Application Insights

يوفر Application Insights قدرات قوية للمراقبة والتشخيص لتطبيقاتك.

1. إعداد Application Insights:
   - التكامل: أضف SDK لـ Application Insights إلى كود تطبيقك.
   - مفتاح التجهيز: قم بتكوين تطبيقك مع مفتاح التجهيز من مورد Application Insights الخاص بك.

2. تتبع الأداء:
   - المعايير: راقب أوقات الاستجابة، ومعدلات الفشل، والتبعيات التطبيقية.
   - تدفق المعايير الحية: شاهد المعايير الحية للأداء للحصول على رؤى فورية.

3. التشخيص والإصلاح:
   - خريطة التطبيق: visualize التبعيات وتحديد عوائق الأداء.
   - تشخيص المعاملات: استخدم تتبع التوزيع لتتبع الطلبات عبر الخدمات.

### استخدام آلات Azure الافتراضية (VMs)

توفر آلات Azure الافتراضية المرونة في تشغيل التطبيقات والخدمات المخصصة التي لم تُعبأ في حاويات.

1. توفير آلات افتراضية:
   - إنشاء آلات افتراضية: في بوابة Azure، انشئ آلات افتراضية جديدة واختر الحجم والنظام التشغيل المناسب.
   - تكوين الشبكة: قم بإعداد الشبكات الافتراضية، والشبكات الفرعية، ومجموعات الأمن لتحكم في حركة المرور.

2. تكوين آلات افتراضية:
   - تثبيت البرامج: تثبيت البرامج والمتطلبات اللازمة.
   - الأمن: تطبيق التحديثات والتحديثات بانتظام، وتكوين الحواجز النارية، واستخدام مجموعات الأمن الشبكي (NSGs).

3. إدارة آلات افتراضية:
   - النسخ الاحتياطي واستعادة البيانات: استخدم Azure Backup لنسخ آلات افتراضية احتياطية.
   - المراقبة: راقب أداء آلات افتراضية باستخدام Azure Monitor.

### استيعاب البيانات في الوقت الفعلي مع Azure Event Hubs

Azure Event Hubs هي منصة تدفق البيانات الكبيرة وخدمة استيعاب الأحداث قادرة على استقبال ومعالجة ملايين الأحداث في الثانية.

1. إعداد Event Hubs:
   - إنشاء مساحة اسم Event Hub: في بوابة Azure، انشئ مساحة اسم Event Hub لاستيعاب Event Hubs الخاصة بك.
   - إنشاء Event Hubs: داخل المساحة، انشئ Event Hub أو أكثر لالتقاط تدفقات البيانات الخاصة بك.

2. استيعاب البيانات:
   - المقدمون: قم بتكوين تطبيقك أو الخدمات لإرسال الأحداث إلى Event Hubs باستخدام SDKs المتاحة للعديد من اللغات (مثل .NET، Java، Python).
   - التقسيمات: استخدم التقسيمات لتوسيع معالجة الأحداث، مما يضمن معدل نقل عالٍ وموازنة متوازية.

3. معالجة الأحداث:
   - المستهلكون: استخدم مجموعات المستهلكين لقراءة ومعالجة الأحداث. تقدم Azure عدة خيارات لمعالجة، بما في ذلك Azure Stream Analytics، Azure Functions، ومعالجة مخصصة باستخدام SDK لـ Event Hubs.

4. مراقبة Event Hubs:
   - المعايير: راقب معدل النقل، واللاتنس، ومعايير معالجة الأحداث عبر بوابة Azure.
   - التنبيهات: قم بإعداد التنبيهات لإخطارك بأي مشاكل، مثل اللاتنس العالية أو الرسائل المفقودة.

### إدارة APIs مع خدمات إدارة APIs في Azure

توفر خدمات إدارة APIs في Azure طريقة لإنشاء بوابات APIs حديثة ومتسقة للخدمات الخلفية الموجودة.

1. إعداد إدارة APIs:
   - إنشاء خدمة إدارة APIs: في بوابة Azure، ابحث عن إدارة APIs وانشئ خدمة جديدة.
   - تكوين APIs: حدد واصدر APIs من مواصفات OpenAPI، أو Azure Functions، أو خلفيات أخرى.

2. تأمين APIs:
   - المصادقة والمصادقة: استخدم OAuth2، وتحقق من JWT، وآليات أخرى لتأمين APIs الخاصة بك.
   - تحديد معدل الاستهلاك وتقييده: قم بتطبيق السياسات لحماية APIs الخاصة بك من الاستغلال.

3. المراقبة والتحليل:
   - رؤى APIs: راقب الاستخدام، ومراقبة الأداء، وتحليل السجلات.
   - بوابة المطورين: قدم بوابة للمطورين لاكتشاف واستخدام APIs الخاصة بك.

4. إدارة دورة الحياة:
   - الترقيم والإصدارات: إدارة إصدارات مختلفة وإصدارات APIs الخاصة بك بسلاسة.
   - إدارة السياسات: تطبيق السياسات لتحويل، والتحقق، وتوجيه الطلبات والإجابات.

### استخدام قواعد بيانات Azure SQL

Azure SQL Database هي قاعدة بيانات علاقية مدارة بالكامل مع ذكاء مدمج، وتوفر متانة عالية، وقابلية للتوسع.

1. إعداد قاعدة بيانات Azure SQL:
   - إنشاء قاعدة بيانات SQL: في بوابة Azure، انتقل إلى قواعد بيانات SQL وانشئ قاعدة بيانات جديدة.
   - تكوين قاعدة البيانات: حدد حجم قاعدة البيانات، ومستوى الأداء، وتكوين إعدادات الشبكة.

2. الاتصال بقاعدة بيانات SQL:
   - سلاسل الاتصال: استخدم سلاسل الاتصال المقدمة للاتصال بتطبيقك بقاعدة البيانات SQL.
   - قواعد حائط الحماية: قم بتكوين قواعد حائط الحماية لسماح بالوصول من تطبيقك أو جهازك المحلي.

3. إدارة قاعدة البيانات:
   - النسخ الاحتياطي واستعادة البيانات: استخدم النسخ الاحتياطي التلقائي واستعادة نقطة في الوقت لحماية بياناتك.
   - التوسع: توسيع قاعدة البيانات أو تقليلها بناءً على احتياجات الأداء الخاصة بك.

4. المراقبة وتuning الأداء:
   - رؤى أداء الاستعلامات: راقب وتحسن أداء الاستعلامات.
   - التكوين التلقائي: تمكين ميزات التكوين التلقائي لتحسين الأداء.

### استعلام السجلات باستخدام لغة استعلام Kusto (KQL)

تستخدم لغة استعلام Kusto (KQL) لاستعلام سجلات Azure Monitor، مما يوفر رؤى قوية في بيانات السجلات الخاصة بك.

1. استعلام KQL الأساسي:
   ```kql
   // استرجاع السجلات من جدول معين
   LogTableName
   | where TimeGenerated > ago(1h)
   | project TimeGenerated, Level, Message
   ```

2. ترشيح وتجميع البيانات:
   ```kql
   LogTableName
   | where TimeGenerated > ago(1h) and Level == "Error"
   | summarize Count=count() by bin(TimeGenerated, 5m)
   ```

3. دمج الجداول:
   ```kql
   Table1
   | join kind=inner (Table2) on $left.UserId == $right.UserId
   | project Table1.TimeGenerated, Table1.Message, Table2.AdditionalInfo
   ```

4. إنشاء التنبيهات بناءً على الاستعلامات:
   - في بوابة Azure، انتقل إلى مساحة عمل Log Analytics.
   - انقر على `Logs` وأدخل استعلام KQL الخاص بك.
   - انقر على `New alert rule` لإنشاء تنبيه بناءً على نتائج الاستعلام.

### إعداد التنبيهات للمراقبة الاستباقية

تساعدك التنبيهات في Azure على البقاء على اطلاع دائم بشأن حالة أداء مواردك.

1. إنشاء التنبيهات:
   - التنبيهات المعيارية: قم بإعداد التنبيهات بناءً على المعايير مثل استخدام المعالج، واستخدام الذاكرة، وأوقات الاستجابة.
   - التنبيهات السجلية: انشئ تنبيهات بناءً على استعلامات بحث السجلات باستخدام KQL.

2. تكوين الإجراءات:
   - مجموعات الإجراءات: حدد مجموعات الإجراءات لتحديد من سيخبر وكيف (البريد الإلكتروني، SMS، الويب هوك).
   - التكامل: تكامل مع أدوات ITSM مثل ServiceNow لإدارة الحوادث التلقائية.

3. الاستجابة للتنبيهات:
   - اللوحات: قم بإعداد لوحات Azure لتوفير رؤية مركزية للتنبيهات.
   - التلقائية: استخدم Azure Automation للاستجابة تلقائيًا لبعض التنبيهات.

### الخاتمة

باستخدام اشتراك Azure، AKS، Application Insights، آلات افتراضية، Event Hubs، خدمات إدارة APIs، وقواعد بيانات SQL، بنينا بنية تحتية للتطبيقات قابلة للتوسع، قوية، ومراقبة. تضمن مجموعة أدوات Azure الشاملة أننا نستطيع نشر وإدارة ومراقبة تطبيقاتنا بكفاءة. هذا الإعداد لم يحسن أداء التطبيقات فقط، بل قدم لنا أيضًا رؤى اللازمة للحفاظ على الموارد وتطويرها بشكل استباقي.