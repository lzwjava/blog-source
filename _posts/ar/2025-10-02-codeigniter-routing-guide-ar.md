---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: دليل التوجيه في كود إيجنتر
translated: true
type: note
---

### نظرة عامة على توجيه CodeIgniter

يسمح نظام التوجيه في CodeIgniter بتعيين عناوين URL (URIs) لفئات وأساليب وحدة تحكم محددة، متجاوزًا النمط الافتراضي لعنوان URL `example.com/controller/method/id/`. هذا مفيد لإنشاء عناوين URL ملائمة لمحركات البحث (SEO)، أو التعامل مع واجهات برمجة التطبيقات (RESTful APIs)، أو ببساطة تخصيص طريقة معالجة الطلبات.

مقتطف الكود المقدم هو من ملف التكوين `routes.php` في CodeIgniter. وهو يحدد مصفوفة ترابطية `$route` حيث يكون كل مفتاح نمط URI، والقيمة إما سلسلة نصية (`controller/method`) أو مصفوفة تحدد سلوكيات مختلفة بناءً على طريقة HTTP (مثل GET, POST). يدعم هذا الإعداد كلاً من التوجيه القياسي والتوجيه الخاص بكل طريقة HTTP.

سأقوم بشرح **كيفية تعريف المسارات**، **كيفية عملها**، و**كيفية استخدامها**، بناءً على السلوك القياسي لـ CodeIgniter والمثال في الكود الخاص بك. للحصول على التفاصيل الكاملة، راجع دليل مستخدم CodeIgniter الرسمي حول التوجيه: https://codeigniter.com/userguide4/general/routing.html.

#### 1. **كيفية تعريف المسارات**
يتم تعريف المسارات في `application/config/routes.php` كمصفوفة. تقوم بإضافة إدخالات إلى `$route[]`. إليك الصيغة:

- **المسار الأساسي**: يعين أي طريقة HTTP إلى controller/method.
  ```
  $route['uri_segment'] = 'controller/method';
  ```
  - مثال: `$route['login'] = 'users/login';` يعني أن أي طلب إلى `/login` يتم توجيهه إلى `Users::login()`.

- **المسار الخاص بطريقة HTTP**: لواجهات برمجة التطبيقات RESTful، يمكنك تحديد وحدات تحكم/أساليب مختلفة لكل طريقة HTTP (GET, POST, PUT، إلخ). يستخدم هذا مصفوفة.
  ```
  $route['uri_segment'] = array(
      'METHOD1' => 'controller/method1',
      'METHOD2' => 'controller/method2'
  );
  ```
  - مثال من الكود الخاص بك: `$route['self'] = array('POST' => 'users/update', 'GET' => 'users/self');` يعني:
    - POST إلى `/self` → `Users::update()`.
    - GET إلى `/self` → `Users::self()`.

- **النماذج العامة (Wildcard Placeholders)**: استخدم أنماطًا تشبه التعبيرات النمطية (regex) لالتقاط الأجزاء الديناميكية من عنوان URL (يتم تمريرها كمعاملات إلى الأسلوب).
  - `(:any)`: يطابق أي حرف (باستثناء الشرطات المائلة) – على سبيل المثال، السلاج أو السلاسل النصية.
  - `(:num)` أو `(\d+)`: يطابق الأرقام فقط – للمعرفات.
  - regex مخصص: ضعه بين قوسين، على سبيل المثال `(foo|bar)` للمطابقات المحددة.
  - أمثلة من الكود الخاص بك:
    - `$route['users/(\d+)']['GET'] = 'users/one/$1';`: GET `/users/123` يتم توجيهه إلى `Users::one(123)`.
    - `$route['lives/(\d+)/notify'] = 'lives/notifyLiveStart/$1';`: أي طريقة إلى `/lives/123/notify` يتم توجيهها إلى `Lives::notifyLiveStart(123)`.

- **المسارات المحجوزة**:
  - `$route['default_controller'] = 'welcome';`: وحدة التحكم التي يتم تحميلها إذا لم يتم إعطاء URI (على سبيل المثال، عنوان URL الأساسي → وحدة التحكم `Welcome`).
  - `$route['404_override'] = 'errors/page_missing';`: وحدة التحكم/الأسلوب للمسارات غير المطابقة (404 مخصص).
  - `$route['translate_uri_dashes'] = FALSE;`: إذا كانت TRUE، تقوم بتحويل الشرطات في URIs إلى شرطات سفلية لأسماء وحدة التحكم/الأسلوب (على سبيل المثال، `my-controller` → `my_controller`).

- **الترتيب مهم**: يتم مطابقة المسارات بالترتيب الذي تظهر به. قم بتعريف المسارات المحددة (التي تحتوي على نماذج عامة) قبل المسارات العامة لتجنب التعارضات.
- **طرق HTTP**: إذا لم يتم تحديدها، ينطبق المسار على جميع الطرق. يستخدم الكود الخاص بك مصفوفات للتحديد، وهو أمر رائع لواجهات برمجة التطبيقات.

**نصائح لتعريف المسارات في الكود الخاص بك**:
- أضف مسارات جديدة في النهاية، قبل `$route['translate_uri_dashes']`.
- اختبر باستخدام أدوات مثل Postman للمسارات الخاصة بواجهات برمجة التطبيقات للتأكد من استدعاء وحدة التحكم/الأسلوب الصحيحة.
- للتطبيقات المعقدة، قم بتجميع المسارات حسب القسم (كما فعلت مع التعليقات مثل `// users`).

#### 2. **كيفية عمل المسارات**
يعالج موجه CodeIgniter كل طلب وارد بالترتيب التالي:
1. **تحليل URI**: يقسم عنوان URL إلى أجزاء (على سبيل المثال، `/users/123/edit` → الأجزاء: `users`, `123`, `edit`).
2. **المطابقة مع المسارات**: يتحقق من مصفوفة `$route` من الأعلى إلى الأسفل. يبحث أولاً عن مطابقات تامة، ثم الأنماط التي تحتوي على نماذج عامة.
   - إذا تم العثور على تطابق، فإنه يعين إلى وحدة التحكم/الأسلوب المحدد، ويمرر الأجزاء الديناميكية (على سبيل المثال، `123`) كمعاملات للأسلوب.
   - إذا لم يتم العثور على تطابق، فإنه يعود إلى النمط الافتراضي (`Controller::method/id/`).
3. **تحميل وحدة التحكم والأسلوب**: يقوم CodeIgniter بإنشاء مثيل لوحدة التحكم، واستدعاء الأسلوب، وتمرير أي أجزاء URI أو مجموعات تم التقاطها.
4. **المعالجة الخاصة بطريقة HTTP**: إذا كان المسار عبارة عن مصفوفة (كما في الكود الخاص بك)، فإنه يتحقق من طريقة HTTP (GET, POST، إلخ.) من الطلب.
5. **الاحتياطي (Fallback)**: الطلبات غير المطابقة تطلق خطأ 404، أو `$route['404_override']` إذا تم تعيينها.

**مثال على التدفق**:
- الطلب: `POST https://example.com/lives`
- المطابقة: `$route['lives']['POST'] = 'lives/create';`
- النتيجة: استدعاء `Lives::create()` بدون معاملات.
- إذا كان الطلب `GET https://example.com/lives/456`، فسوف يطابق `$route['lives/(\d+)']['GET'] = 'lives/one/$1';` → `Lives::one(456)`.

**الميكانيكيات الأساسية**:
- **المعاملات الديناميكية**: يتم تمرير المجموعات التي تم التقاطها (على سبيل المثال، `$1`) كمعاملات للأسلوب. تأكد من أن أسلوب وحدة التحكم الخاص بك يتوقعها.
- **الأمان**: تساعد المسارات في منع الوصول المباشر إلى وحدات التحكم الحساسة من خلال إخفاء عناوين URL.
- **الأداء**: عمليات بحث بسيطة في المصفوفات؛ لا يوجد عبء كبير ما لم يكن لديك المئات من المسارات.

#### 3. **كيفية استخدام المسارات**
استخدام المسارات يعني إعدادها كما هو مذكور أعلاه، ثم الاستفادة منها في تطبيقك (وحدات التحكم، العروض، إلخ).

- **في وحدات التحكم**: افترض أن المسار يتعامل مع تعيين عنوان URL؛ اكتب الأساليب التي تتوقع الطلبات الموجهة.
  - مثال: بالنسبة لـ `$route['login']['POST'] = 'users/login';`، أنشئ وحدة تحكم `Users.php` تحتوي على أسلوب `login()` يتعامل مع بيانات POST (على سبيل المثال، عبر `$this->input->post()`).

- **إنشاء عناوين URL**: استخدم `site_url()` أو `base_url()` الخاصة بـ CodeIgniter مع مفاتيح المسار الخاصة بك للروابط/الأزرار.
  - مثال: في عرض، `<a href="<?= site_url('login'); ?>">تسجيل الدخول</a>` يشير إلى عنوان URL الموجه، لكن الكود الخاص بك يحدد وحدة التحكم التي يستهدفها.

- **اختبار المسارات**:
  - استخدم متصفح الويب الخاص بك أو أدوات واجهة برمجة التطبيقات (مثل Postman) لاستدعاء عناوين URL مثل `/users/register`.
  - تحقق من `application/logs/log-{date}.php` للبحث عن الأخطاء إذا فشلت المسارات.
  - أضف تصحيح أخطاء: قم بإعادة تعيين `$route['404_override']` مؤقتًا واستخدم var_dump في وحدة تحكم اختبارية لرؤية المعاملات.

- **الاستخدام بطريقة RESTful (كما في الكود الخاص بك)**: تم إعداد مساراتك لهيكل يشبه واجهة برمجة التطبيقات. على سبيل المثال:
  - إنشاء مورد: أرسل POST إلى `/lives` → ينشئ حدث بث مباشر.
  - القراءة: GET `/lives/123` → جلب حدث البث المباشر رقم 123.
  - التحديث: POST `/lives/123` → تحديث حدث البث المباشر رقم 123.

- **المشاكل الشائعة والنصائح**:
  - **التكرارات**: تجنب المسارات المتداخلة (على سبيل المثال، `lives` و `lives/(\d+)`)؛ ضع المسارات المحددة أولاً.
  - **الطرق غير المحددة**: إذا كان المسار عبارة عن سلسلة نصية، فإنه يعمل لجميع طرق HTTP. استخدم المصفوفات للدقة.
  - **للتطوير**: قم بتمكين أداة Profiler الخاصة بـ CodeIgniter (`$this->output->enable_profiler(TRUE);`) في وحدة تحكم لتصحيح أخطاء التوجيه.
  - **التحكم بالإصدارات**: ملف routes.php الخاص بك موجود في نظام التحكم بالإصدارات – التغييرات تؤثر على التوجيه مباشرة.
  - **الامتدادات**: إذا كنت بحاجة إلى ميزات متقدمة (مثل دعم النطاقات namespaces)، ففكر في CodeIgniter 4 أو المكتبات الخارجية، حيث أن CI 3 (الكود الخاص بك) أقدم.

إذا كان لديك أسئلة محددة حول مسار في ملفك (على سبيل المثال، لماذا يتم استخدام `(\d+)` أو كيفية إضافة مسار جديد)، قدم المزيد من التفاصيل! بالنسبة لإعداد CodeIgniter، تأكد من تعريف `CI_VERSION` في index.php الخاص بك.