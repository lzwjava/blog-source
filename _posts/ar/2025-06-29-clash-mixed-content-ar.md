---
audio: false
generated: true
lang: ar
layout: post
title: إصلاح أخطاء المحتوى المختلط في Clash VPN
translated: true
type: note
---

رسائل الخطأ التي تواجهها تشير إلى مشكلة **المحتوى المختلط** مع تطبيق Clash VPN، على وجه التحديد عندما تحاول الصفحة الموجودة على `https://clash.razord.top/` تحميل موارد من نقطة نهاية غير آمنة `http://127.0.0.1:9090/` (مثل `http://127.0.0.1:9090/version`). تقوم المتصفحات الحديثة بحجب مثل هذه الطلبات لأنها تنتهك سياسات الأمان من خلال محاولة تحميل محتوى HTTP غير الآمن على صفحة HTTPS آمنة. بالإضافة إلى ذلك، هناك أخطاء CORS (مشاركة الموارد عبر المصادر) بسبب قيود التحكم في الوصول. أدناه دليل خطوة بخطوة لحل هذه المشكلة.

---

### لماذا يحدث هذا
- **خطأ المحتوى المختلط**: يتم تقديم صفحة الويب عبر HTTPS، لكنها تحاول جلب الموارد (مثل فحص الإصدار) من `http://127.0.0.1:9090`، وهو غير آمن. تقوم المتصفحات بحجب هذه الطلبات لمنع الثغرات الأمنية المحتملة، مثل هجمات الرجل في المنتصف.
- **خطأ CORS**: يقوم المتصفح بحجب الطلب إلى `http://127.0.0.1:9090` بسبب سياسة CORS، التي تقيد الطلبات عبر المصادر ما لم يسمح بها الخادم صراحةً.
- **سياق Clash**: Clash (أو Clash for Windows) هو تطبيق وكيل يستخدم على الأرجح خادمًا محليًا (`127.0.0.1:9090`) للوحة التحكم أو واجهة برمجة التطبيقات الخاصة به. إذا كان هذا الخادم المحلي لا يدعم HTTPS أو لم يتم تكوينه بشكل صحيح، فإنه يؤدي إلى ظهور هذه الأخطاء عند الوصول إليه عبر صفحة ويب HTTPS.

---

### خطوات إصلاح المشكلة

#### 1. **التحقق من تكوين Clash Core**
   - **التحقق مما إذا كان Clash Core قيد التشغيل**: تأكد من أن خدمة Clash الأساسية (الخدمة الخلفية) قيد التشغيل على جهازك وتستمع على `127.0.0.1:9090`. يمكنك التحقق من ذلك عن طريق:
     - فتح طرفية أو موجه الأوامر.
     - تشغيل الأمر `curl http://127.0.0.1:9090/version` للتحقق مما إذا كانت نقطة النهاية تستجيب بإصدار Clash.
     - إذا لم تستجب، فتأكد من أن خدمة Clash نشطة. أعد تشغيل Clash for Windows أو عملية Clash core.
   - **تمكين HTTPS لـ Clash Core** (إذا كان ذلك ممكنًا):
     - تدعم بعض إصدارات Clash (مثل Clash Premium أو Clash Meta) HTTPS لواجهة برمجة التطبيقات المحلية. تحقق من وثائق Clash أو ملف التكوين (عادةً `config.yaml`) للعثور على خيار لتمكين HTTPS لوحدة التحكم الخارجية (نقطة نهاية واجهة برمجة التطبيقات).
     - ابحث عن إعداد مثل `external-controller` أو `external-ui` في ملف التكوين. على سبيل المثال:
       ```yaml
       external-controller: 127.0.0.1:9090
       external-ui: <path-to-ui>
       ```
       إذا كان HTTPS مدعومًا، فقد تحتاج إلى تكوين شهادة للخادم المحلي. هذا متقدم وقد يتطلب إنشاء شهادة ذاتية التوقيع (انظر الخطوة 4 أدناه).

#### 2. **الوصول إلى لوحة التحكم عبر HTTP (حل مؤقت)**
   - إذا كان يمكن الوصول إلى لوحة تحكم Clash عبر HTTP (مثل `http://clash.razord.top/` بدلاً من HTTPS)، فحاول تحميلها بدون HTTPS لتجنب مشاكل المحتوى المختلط:
     - افتح متصفحك وانتقل إلى `http://clash.razord.top/`.
     - ملاحظة: هذا غير موصى به للاستخدام في بيئة الإنتاج، لأن HTTP غير آمن. استخدم هذا للاختبار فقط أو إذا كان الوصول إلى لوحة التحكم محليًا فقط.
   - إذا كانت لوحة التحكم تتطلب HTTPS، فتابع الخطوات التالية لمعالجة السبب الجذري.

#### 3. **تحديث عناوين URL لاستخدام HTTPS**
   - يشير الخطأ إلى أن لوحة تحكم Clash تحاول جلب الموارد من `http://127.0.0.1:9090`. إذا كان لديك حق الوصول إلى الكود المصدري أو تكوين لوحة تحكم Clash:
     - تحقق من الكود الأمامي (مثل `index-5e90ca00.js` أو `vendor-827b5617.js`) للعثور على المراجع الثابتة لـ `http://127.0.0.1:9090`.
     - قم بتحديثها إلى `https://127.0.0.1:9090` إذا كان Clash core يدعم HTTPS، أو استخدم عنوان URL نسبي (مثل `/version`) للسماح للمتصفح باستخدام نفس البروتوكول المستخدم في الصفحة.
     - إذا لم يكن لديك حق الوصول إلى الكود المصدري، فقد تحتاج إلى تكوين وكيل عكسي (انظر الخطوة 4).

#### 4. **إعداد وكيل عكسي مع HTTPS**
   - لحل مشكلة المحتوى المختلط، يمكنك إعداد وكيل عكسي (مثل استخدام Nginx أو Caddy) لتقديم واجهة برمجة تطبيقات Clash core (`http://127.0.0.1:9090`) عبر HTTPS. هذا يسمح للوحة التحكم بالتواصل مع النواة بشكل آمن.
   - **خطوات استخدام Nginx**:
     1. قم بتثبيت Nginx على نظامك (إذا لم يكن مثبتًا مسبقًا).
     2. قم بإنشاء شهادة SSL ذاتية التوقيع لـ `127.0.0.1`:
        ```bash
        openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout localhost.key -out localhost.crt -subj "/CN=localhost"
        ```
     3. قم بتكوين Nginx لتمرير الطلبات إلى `http://127.0.0.1:9090` عبر HTTPS. قم بإنشاء ملف تكوين (مثل `/etc/nginx/sites-available/clash`):
        ```nginx
        server {
            listen 443 ssl;
            server_name localhost;

            ssl_certificate /path/to/localhost.crt;
            ssl_certificate_key /path/to/localhost.key;

            location / {
                proxy_pass http://127.0.0.1:9090;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
        }
        ```
     4. قم بتمكين التكوين وأعد تشغيل Nginx:
        ```bash
        sudo ln -s /etc/nginx/sites-available/clash /etc/nginx/sites-enabled/
        sudo nginx -t
        sudo systemctl restart nginx
        ```
     5. قم بتحديث لوحة تحكم Clash لاستخدام `https://localhost:443` بدلاً من `http://127.0.0.1:9090` لطلبات واجهة برمجة التطبيقات.
     6. في متصفحك، قبقبل الشهادة ذاتية التوقيع عندما تتم المطالبة بذلك.

   - **بديل باستخدام Caddy**: Caddy أسهل في التكوين ويتعامل تلقائيًا مع HTTPS:
     1. قم بتثبيت Caddy.
     2. قم بإنشاء ملف `Caddyfile`:
        ```caddy
        localhost:443 {
            reverse_proxy http://127.0.0.1:9090
        }
        ```
     3. قم بتشغيل Caddy: `caddy run`.
     4. قم بتحديث لوحة تحكم Clash لاستخدام `https://localhost:443`.

#### 5. **تجاوز قيود CORS (متقدم)**
   - يشير خطأ CORS (`XMLHttpRequest cannot load http://127.0.0.1:9090/version due to access control checks`) إلى أن خادم Clash core لا يرسل رؤوس CORS المناسبة. إذا كنت تتحكم في Clash core:
     - قم بتعديل تكوين Clash core لتضمين رؤوس CORS، مثل:
       ```yaml
       external-controller: 127.0.0.1:9090
       allow-cors: true
       ```
       (تحقق من وثائق Clash للعثور على الصيغة الدقيقة، حيث يعتمد هذا على إصدار Clash.)
     - بدلاً من ذلك، يمكن لإعداد الوكيل العكسي في الخطوة 4 التعامل مع CORS عن طريق إضافة رؤوس مثل:
       ```nginx
       add_header Access-Control-Allow-Origin "https://clash.razord.top";
       add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
       add_header Access-Control-Allow-Headers "*";
       ```
   - إذا لم تكن تتحكم في النواة، يمكنك استخدام إضافة متصفح لتجاوز CORS مؤقتًا (مثل "CORS Unblock" لمتصفح Chrome)، ولكن هذا غير موصى به لأسباب أمنية.

#### 6. **تحديث Clash أو التبديل إلى إصدار متوافق**
   - تأكد من أنك تستخدم أحدث إصدار من Clash for Windows أو Clash Verge، حيث أن الإصدارات القديمة قد تحتوي على أخطاء أو تفتقر إلى دعم HTTPS لوحدة التحكم الخارجية.
   - تحقق من مستودع Clash على GitHub (`github.com/Dreamacro/clash` أو `github.com/Fndroid/clash_for_windows_pkg`) للحصول على التحديثات أو المشكلات المبلغ عنها المتعلقة بالمحتوى المختلط أو CORS.
   - فكر في التبديل إلى **Clash Verge** أو **Clash Meta**، والتي قد يكون لديها دعم أفضل لـ HTTPS وسياسات أمان المتصفحات الحديثة.

#### 7. **السماح بالمحتوى غير الآمن في المتصفح (غير موصى به)**
   - كحل أخير، يمكنك السماح بالمحتوى غير الآمن في متصفحك لـ `https://clash.razord.top/`:
     - **Chrome**:
       1. انقر على أيقونة القفل في شريط العناوين.
       2. انتقل إلى "إعدادات الموقع" > "محتوى غير آمن" > اضبط على "السماح".
     - **Firefox**:
       1. انقر على أيقونة القفل وانتقل إلى "إعدادات الاتصال".
       2. قم بتعطيل "حظر المحتوى الخطير والخادع" مؤقتًا.
     - **تحذير**: يتجاوز هذا إجراءات الحماية الأمنية ويجب استخدامه فقط للاختبار المحلي على شبكات موثوقة.
   - بدلاً من ذلك، يمكنك تشغيل Chrome مع علم `--disable-web-security` (للتطوير فقط):
     ```bash
     google-chrome --disable-web-security --user-data-dir="/tmp/chrome_dev"
     ```

#### 8. **التحقق من وجود إضافات متصفح متضاربة أو جدار حماية**
   - قد تتداخل إضافات المتصفح (مثل مانعات الإعلانات، وأدوات الخصوصية) أو إعدادات جدار الحماية مع الخادم المحلي لـ Clash. قم بتعطيل الإضافات مؤقتًا أو تحقق من جدار الحماية الخاص بك للتأكد من إمكانية الوصول إلى `127.0.0.1:9090`.
   - على نظام Windows، تأكد من أن تطبيق Clash لديه أذونات جدار الحماية:
     - انتقل إلى الإعدادات > الشبكة والإنترنت > جدار حماية Windows > السماح للتطبيق من خلال جدار الحماية.
     - أضف أو مكن Clash for Windows.

#### 9. **الاتصال بدعم Clash أو المجتمع**
   - إذا لم تحل الخطوات المذكورة أعلاه المشكلة، فقم بالإبلاغ عن المشكلة على صفحة مشكلات Clash for Windows على GitHub (`github.com/Fndroid/clash_for_windows_pkg/issues`) أو منتديات مجتمع Clash. قدم تفاصيل عن إعدادك، بما في ذلك:
     - إصدار Clash.
     - نظام التشغيل.
     - ملف التكوين (قم بإخفاء المعلومات الحساسة).
     - المتصفح والإصدار.
   - تحقق من وجود مشكلات مماثلة في المجتمع، حيث قد يكون هذا الخطأ خاصًا بإصدارات أو تكوينات معينة من Clash.

---

### النهج الموصى به
الحل الأكثر أمانًا ومتانة هو **إعداد وكيل عكسي مع HTTPS** (الخطوة 4) لضمان تقديم جميع الطلبات عبر HTTPS، مما يحل مشكلتي المحتوى المختلط و CORS. إذا لم تتمكن من تعديل Clash core أو لوحة التحكم، فقد يكون استخدام إصدار أحدث من Clash (مثل Clash Verge) أو الوصول إلى لوحة التحكم عبر HTTP مؤقتًا (الخطوة 2) من الحلول المؤقتة الأسرع.

---

### ملاحظات إضافية
- إذا كنت تستخدم لوحة تحكم Clash مخصصة أو خدمة تابعة لجهة خارجية مثل `clash.razord.top`، فتحقق من أنها متوافقة مع إصدار Clash core الخاص بك.
- قم دائمًا بعمل نسخة احتياطية من تكوين Clash الخاص بك (`config.yaml`) قبل إجراء أي تغييرات.
- إذا استمرت المشكلة، يمكنك محاولة التبديل إلى عملاء وكيل بديلين مثل v2rayN أو OpenVPN، والتي قد يكون لديها دعم أفضل لـ HTTPS لواجهات برمجة التطبيقات المحلية.

دعني أعرف إذا كنت بحاجة إلى مساعدة في خطوات محددة، مثل إعداد Nginx أو تصحيح تكوين Clash!