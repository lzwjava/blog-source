---
audio: false
generated: true
image: false
lang: ar
layout: post
title: تهيئة OpenWRT كجسر لاسلكي
translated: true
type: note
---

بمساعدة Grok، ما زلت أحاول العمل على ما يلي.

---

لمعالجة استفسارك، "هل هذا صحيح؟" فيما يتعلق بالخطوات اللازمة لتكوين OpenWRT كجسر لاسلكي، وتقديم الطرق الصحيحة لتحقيق ذلك، سأقوم بتقييم الخطوات التي قدمتها وتحسينها بناءً على أفضل الممارسات لـ OpenWRT. هدفك هو إعداد جهاز التوجيه OpenWRT الخاص بك (على سبيل المثال، Xiaomi Mi Router 4C مع OpenWRT 24.10.0) كجسر لاسلكي - أي الاتصال لاسلكيًا بشبكة Wi-Fi موجودة كعميل ومشاركة ذلك الاتصال عبر نقطة الوصول اللاسلكية (AP) الخاصة به أو منافذ Ethernet، مع إبقاء جميع الأجهزة على نفس النطاق الفرعي مثل جهاز التوجيه الرئيسي.

الخطوات التي قدمتها دقيقة إلى حد كبير لكنها تفتقد إلى تعديل حاسم لضمان عمل الجسر بشكل صحيح وتجنب تعارضات IP. أدناه، سأقوم أولاً بتقييم التكوين الخاص بك ثم أعرض الخطوات الصحيحة والكاملة لتحقيق جسر لاسلكي في OpenWRT باستخدام طريقة الجسر البسيط (العميل + AP على نفس الجسر)، وهو ما يتماشى مع هدفك. سأذكر أيضًا بإيجاز بديلاً باستخدام `relayd` للحالات التي تفشل فيها الطريقة البسيطة، على الرغم من أن إعدادك يدعم على الأرجح الطريقة الأبسط.

---

### **تقييم الخطوات التي قدمتها**

تهدف خطواتك إلى:
1.  توصيل جهاز التوجيه OpenWRT كعميل بشبكة Wi-Fi موجودة.
2.  إعداد نقطة وصول (AP) لبث شبكة Wi-Fi جديدة.
3.  جسر واجهات العميل و AP لمشاركة الإنترنت.

إليك مراجعة سريعة:
-   **الخطوة 1: تسجيل الدخول إلى LuCI** - صحيح، الوصول إلى واجهة الويب هو نقطة البداية.
-   **الخطوة 2: تكوين عميل الواي فاي** - الانضمام إلى شبكة Wi-Fi الهدف وتعيينها لشبكة `lan` هو بداية جيدة، لكن التكوين الافتراضي لـ `lan` في OpenWRT (عنوان IP ثابت، عادةً 192.168.1.1) قد يتعارض مع جهاز التوجيه الرئيسي إذا كان يستخدم نفس عنوان IP. هذا يحتاج إلى تعديل.
-   **الخطوة 3: تكوين نقطة الوصول اللاسلكية (AP)** - إعداد نقطة وصول وتعيينها إلى `lan` صحيح لعمل جسر، لكنه يعتمد على تكوين واجهة `lan` بشكل صحيح.
-   **الخطوة 4: جسر الشبكات** - تعيين كلتا الواجهتين إلى `lan` من الناحية النظرية يجسرهما، ولكن بدون تعطيل خادم DHCP أو ضبط إعدادات IP، قد لا يعمل بسلاسة.
-   **الخطوة 5: اختبار الإعداد** - الاختبار ضروري، لكن النجاح يعتمد على أن الخطوات السابقة صحيحة تمامًا.

**ما المفقود أو الخاطئ؟**
-   بشكل افتراضي، تحتوي واجهة `lan` في OpenWRT على عنوان IP ثابت (مثل 192.168.1.1) وتشغل خادم DHCP. إذا كان جهاز التوجيه الرئيسي يستخدم أيضًا 192.168.1.1، فإن هذا يسبب تعارض عناوين IP. تحتاج إلى ضبط واجهة `lan` على وضع عميل DHCP للحصول على عنوان IP من جهاز التوجيه الرئيسي وتعطيل خادم DHCP المحلي للسماح لجهاز التوجيه الرئيسي بتعيين عناوين IP لجميع الأجهزة.
-   تعيين منطقة الجدار الناري إلى `lan` جيد للتبسيط، لكن تكوين IP هو أمر بالغ الأهمية.

مع أخذ هذا في الاعتبار، خطواتك "صحيحة في الغالب" لكنها غير مكتملة بدون ضبط إعدادات واجهة `lan`. أدناه الخطوات المصححة.

---

### **الخطوات الصحيحة لتكوين OpenWRT كجسر لاسلكي (طريقة الجسر البسيط)**

تقوم هذه الطريقة بإعداد جهاز التوجيه OpenWRT الخاص بك للاتصال بشبكة Wi-Fi موجودة كعميل ومشاركة ذلك الاتصال عبر نقطة الوصول (AP) الخاصة به أو منافذ Ethernet، كل ذلك على نفس النطاق الفرعي مثل جهاز التوجيه الرئيسي (مثل 192.168.1.x). إليك كيفية القيام بذلك عبر واجهة الويب LuCI:

#### **المتطلبات الأساسية**
-   OpenWRT مثبت (على سبيل المثال، الإصدار 24.10.0 على Xiaomi Mi Router 4C).
-   لديك SSID وكلمة المرور ونوع التشفير (مثل WPA2-PSK) لشبكة Wi-Fi الرئيسية.
-   الوصول إلى LuCI على `http://192.168.1.1` (أو عنوان IP الحالي) وبيانات اعتماد المسؤول الخاصة بك.

#### **الخطوة 1: تسجيل الدخول إلى LuCI**
-   افتح متصفحًا وانتقل إلى `http://192.168.1.1`.
-   سجل الدخول باستخدام اسم مستخدم OpenWRT الخاص بك (الافتراضي: `root`) وكلمة المرور (تم تعيينها أثناء التثبيت).

#### **الخطوة 2: تكوين عميل الواي فاي**
-   **انتقل إلى إعدادات Wireless:**
    -   انتقل إلى **Network > Wireless**.
-   **مسح الشبكات:**
    -   حدد موقع الراديو الخاص بك (مثل `radio0` لتردد 2.4 GHz على Mi Router 4C).
    -   انقر على **Scan** لسرد شبكات Wi-Fi المتاحة.
-   **الانضمام إلى شبكة Wi-Fi الرئيسية:**
    -   ابحث عن SSID لشبكة Wi-Fi لجهاز التوجيه الرئيسي الخاص بك.
    -   انقر على **Join Network**.
-   **تكوين إعدادات العميل:**
    -   **Wi-Fi Key:** أدخل كلمة المرور لشبكة Wi-Fi الرئيسية.
    -   **Network:** حدد أو عيّن إلى `lan` (هذا يضيف واجهة العميل إلى جسر `br-lan`).
    -   **Firewall Zone:** عيّن إلى `lan` (هذا يبسط قواعد حركة المرور للجسر).
    -   **Interface Name:** قد تقترح LuCI `wwan`؛ يمكنك تركها أو إعادة تسميتها إلى `client` للتوضيح، ولكن تأكد من ارتباطها بـ `lan`.
-   **حفظ وتطبيق:**
    -   انقر على **Save & Apply** للاتصال بشبكة Wi-Fi الرئيسية.

#### **الخطوة 3: ضبط واجهة LAN لتصبح عميل DHCP**
-   **انتقل إلى Interfaces:**
    -   انتقل إلى **Network > Interfaces**.
-   **تحرير واجهة LAN:**
    -   انقر على **Edit** بجوار واجهة `lan`.
-   **تعيين البروتوكول إلى عميل DHCP:**
    -   في القائمة المنسدلة **Protocol**، حدد **DHCP client**.
    -   هذا يسمح لجسر `br-lan` (الذي يتضمن الآن عميل الواي فاي) بالحصول على عنوان IP من خادم DHCP لجهاز التوجيه الرئيسي (مثل 192.168.1.x).
-   **تعطيل خادم DHCP:**
    -   نظرًا لأن `lan` أصبح الآن عميل DHCP، يتم تعطيل خادم DHCP المحلي تلقائيًا. تحقق من هذا تحت **Advanced Settings** أو **DHCP and DNS** — تأكد من تحديد "Ignore interface" إذا ظهر الخيار.
-   **حفظ وتطبيق:**
    -   انقر على **Save & Apply**. سيقوم جهاز التوجيه الآن بطلب عنوان IP من جهاز التوجيه الرئيسي.

#### **الخطوة 4: تكوين نقطة الوصول اللاسلكية (Access Point)**
-   **إضافة شبكة لاسلكية جديدة:**
    -   ارجع إلى **Network > Wireless**.
    -   انقر على **Add** تحت نفس الراديو (مثل `radio0`) لإنشاء واجهة لاسلكية جديدة.
-   **إعداد نقطة الوصول (AP):**
    -   **ESSID:** اختر اسمًا لشبكة Wi-Fi الخاصة بك (مثل `OpenWRT_AP`).
    -   **Mode:** عيّن إلى **Access Point (AP)**.
    -   **Network:** عيّن إلى `lan` (هذا يجسرها مع واجهة العميل ومنافذ Ethernet).
-   **تكوين الأمان:**
    -   انتقل إلى علامة التبويب **Wireless Security**.
    -   **Encryption:** حدد **WPA2-PSK** (موصى به).
    -   **Key:** عيّن كلمة مرور قوية لنقطة الوصول (AP) الخاصة بك.
-   **حفظ وتطبيق:**
    -   انقر على **Save & Apply**. سيقوم جهاز التوجيه الخاص بك الآن ببث شبكة Wi-Fi الخاصة به.

#### **الخطوة 5: التحقق من عمل الجسر**
-   **التحقق من الواجهات:**
    -   انتقل إلى **Network > Interfaces**.
    -   تأكد من أن واجهة `lan` تسرد كلًا من عميل الواي فاي (مثل `wlan0`) ونقطة الوصول (مثل `wlan0-1`) تحت جسر `br-lan`.
-   **التحقق من تعيين IP:**
    -   انتقل إلى **Status > Overview**.
    -   لاحظ عنوان IP المعين لواجهة `lan` من قبل جهاز التوجيه الرئيسي (مثل `192.168.1.100`).

#### **الخطوة 6: اختبار الإعداد**
-   **اختبار Wi-Fi:**
    -   قم بتوصيل جهاز بشبكة `OpenWRT_AP` Wi-Fi.
    -   تحقق من أنه يتلقى عنوان IP من جهاز التوجيه الرئيسي (مثل `192.168.1.x`) وأن لديه اتصالاً بالإنترنت.
-   **اختبار Ethernet (إذا كان مطبقًا):**
    -   قم بتوصيل جهاز بأحد منافذ LAN الخاصة بالموجه.
    -   تأكد من حصوله على عنوان IP من جهاز التوجيه الرئيسي والاتصال بالإنترنت.
-   **الوصول إلى LuCI:**
    -   استخدم عنوان IP الجديد (مثل `http://192.168.1.100`) للوصول إلى واجهة OpenWRT.

---

### **لماذا تعمل هذه الطريقة**
-   يؤدي تعيين كل من واجهتي العميل و AP إلى شبكة `lan` إلى إضافتهما إلى جسر `br-lan`، مما يسمح لحركة مرور Layer 2 بالتدفق بينهما وبين جهاز التوجيه الرئيسي.
-   ضبط `lan` على عميل DHCP يضمن حصول جهاز التوجيه OpenWRT على عنوان IP فريد من جهاز التوجيه الرئيسي، مما يتجنب التعارضات (مثل مع `192.168.1.1`)، ويعطل خادم DHCP المحلي حتى يتمكن جهاز التوجيه الرئيسي من إدارة جميع تعيينات IP.
-   تظهر الأجهزة المتصلة بنقطة الوصول (AP) أو منافذ Ethernet على نفس النطاق الفرعي مثل الشبكة الرئيسية (مثل `192.168.1.x`)، مما يحقق متطلبات الجسر اللاسلكي.

---

### **طريقة بديلة: استخدام relayd (جسر زائف)**
إذا فشلت طريقة الجسر البسيط (على سبيل المثال، بسبب قيود برنامج تشغيل الواي فاي)، يمكنك استخدام حزمة `relayd` لجسر زائف. هذا ينشئ إعدادًا موجهًا حيث يكون عملاء جهاز التوجيه OpenWRT على نطاق فرعي مختلف، ولكنه أكثر موثوقية على بعض الأجهزة. إليك نظرة عامة موجزة:

1.  **تثبيت relayd:**
    -   انتقل إلى **System > Software**، وابحث عن `relayd`، وقم بتثبيته.
2.  **تكوين عميل الواي فاي:**
    -   انضم إلى شبكة Wi-Fi الرئيسية، ولكن عيّنها لواجهة جديدة (مثل `wwan`) مضبوطة على عميل DHCP.
3.  **تكوين LAN:**
    -   عيّن `lan` إلى عنوان IP ثابت (مثل `192.168.2.1`) مع خادم DHCP الخاص به.
4.  **إعداد relayd:**
    -   قم بتكوين `relayd` عبر SSH أو LuCI (تحت **Network > Hostnames**) للتتابع بين `wwan` و `lan`.
5.  **تكوين AP:**
    -   عيّن نقطة الوصول (AP) على شبكة `lan`.
6.  **الاختبار:**
    -   ستكون الأجهزة على `OpenWRT_AP` على النطاق `192.168.2.x`، مع الإنترنت الذي يتم تمريره من جهاز التوجيه الرئيسي.

**ملاحظة:** هذا ليس جسرًا حقيقيًا (نطاقات فرعية مختلفة)، لذا استخدمه فقط إذا لم تنجح الطريقة البسيطة. بالنسبة لـ Xiaomi Mi Router 4C مع OpenWRT 24.10.0، يجب أن تكفي طريقة الجسر البسيط.

---

### **الخلاصة**
خطواتك الأصلية **صحيحة في الغالب** ولكنها غير مكتملة بدون تعيين واجهة `lan` إلى وضع عميل DHCP لتجنب تعارضات IP وضمان عمل الجسر بشكل صحيح. توفر الخطوات المصححة أعلاه طريقة موثوقة لتكوين OpenWRT كجسر لاسلكي. إذا اتبعتهم، سيتصل جهاز التوجيه الخاص بك بشبكة Wi-Fi الرئيسية ويشارك ذلك الاتصال بسلاسة عبر نقطة الوصول (AP) الخاصة به أو منافذ Ethernet، كل ذلك على نفس النطاق الفرعي. اختبر الإعداد، وإذا ظهرت مشاكل (نادرة مع OpenWRT الحديث)، ففكر في بديل `relayd`.