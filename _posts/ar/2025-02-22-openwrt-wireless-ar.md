---
audio: true
lang: ar
layout: post
title: تكوين OpenWRT كجسر لاسلكي
translated: true
---

للتعامل مع استفسارك "هل هذا صحيح؟" بشأن الخطوات لتكوين OpenWRT كجسر لاسلكي، ولتوفير الطرق الصحيحة لتحقيق ذلك، سأقيم الخطوات التي قدمتها وسأعدلها بناءً على أفضل الممارسات في OpenWRT. هدفك هو إعداد موجه OpenWRT (مثل Xiaomi Mi Router 4C مع OpenWRT 24.10.0) كجسر لاسلكي - متصل لاسلكيًا بشبكة Wi-Fi موجودة كعميل، ويشارك هذه الاتصال عبر نقطة الوصول (AP) الخاصة به أو منافذ Ethernet، ويحتفظ بكل الأجهزة في نفس الفرع الفرعي مثل الموجه الرئيسي.

خطواتك المقدمة هي بشكل عام دقيقة ولكن تفتقر لتعديل حاسم لضمان الجسر الصحيح وتجنب تعارضات IP. أدناه، سأقيم أولًا تكوينك، ثم سأقدم الخطوات الصحيحة الكاملة لتحقيق جسر لاسلكي في OpenWRT باستخدام طريقة الجسر البسيطة (عميل + AP على الجسر نفسه)، والتي تتوافق مع نيتك. سأذكر أيضًا بديلًا باستخدام `relayd` في الحالات التي لا يعمل فيها الطريقة البسيطة، على الرغم من أن إعدادك قد يدعم الطريقة الأيسر.

---

### **تقييم الخطوات المقدمة**

تهدف خطواتك إلى:
1. اتصال الموجه OpenWRT كعميل بشبكة Wi-Fi موجودة.
2. إعداد AP لإرسال شبكة Wi-Fi جديدة.
3. جسر واجهات العميل وAP لتشارك الإنترنت.

هنا مراجعة سريعة:
- **خطوة 1: تسجيل الدخول إلى LuCI** - صحيح، الوصول إلى الواجهة الويب هو النقطة البدائية.
- **خطوة 2: تكوين العميل اللاسلكي** - الانضمام إلى Wi-Fi الهدف وتخصيصه إلى شبكة `lan` هو بداية جيدة، ولكن تكوين `lan` الافتراضي في OpenWRT (IP ثابت، عادةً 192.168.1.1) قد يسبب تعارضًا مع الموجه الرئيسي إذا كان يستخدم نفس IP. هذا يحتاج إلى تعديل.
- **خطوة 3: تكوين AP اللاسلكي** - إعداد AP وتخصيصه إلى `lan` صحيح لجسر، ولكن يعتمد على تكوين `lan` بشكل صحيح.
- **خطوة 4: جسر الشبكات** - تخصيص كلتا الواجهتين إلى `lan` نظريًا يجسرهما، ولكن بدون تعطيل خادم DHCP أو تعديل إعدادات IP، قد لا يعمل بشكل سلس.
- **خطوة 5: اختبار الإعداد** - الاختبار ضروري، ولكن النجاح يعتمد على أن تكون الخطوات السابقة صحيحة بالكامل.

**ماذا يفتقر إليه أو ما هو خطأ؟**
- افتراضيًا، `lan` في OpenWRT لديه IP ثابت (مثل 192.168.1.1) ويشغل خادم DHCP. إذا كان الموجه الرئيسي أيضًا 192.168.1.1، فهذا يسبب تعارضًا IP. يجب عليك تعيين `lan` إلى وضع عميل DHCP للحصول على IP من الموجه الرئيسي وتعطيل خادم DHCP المحلي لتسمح للموجه الرئيسي بتخصيص IPs لجميع الأجهزة.
- تعيين منطقة الحائط الناري إلى `lan` مناسب للسهولة، ولكن إعداد IP هو حاسم.

مع هذا في الاعتبار، فإن خطواتك "mostly right" ولكن غير مكتملة بدون تعديل إعدادات `lan`. أدناه هي الخطوات المعدلة.

---

### **الخطوات الصحيحة لتكوين OpenWRT كجسر لاسلكي (طريقة الجسر البسيطة)**

هذه الطريقة تهيئ موجه OpenWRT لتصل إلى شبكة Wi-Fi موجودة كعميل وتشارك ذلك الاتصال عبر AP الخاص به أو منافذ Ethernet، كل ذلك في نفس الفرع الفرعي مثل الموجه الرئيسي (مثل 192.168.1.x). إليك كيفية القيام بذلك عبر الواجهة الويب LuCI:

#### **المتطلبات الأساسية**
- OpenWRT مثبته (مثل الإصدار 24.10.0 على Xiaomi Mi Router 4C).
- لديك SSID وكلمة المرور ونوع التشفير (مثل WPA2-PSK) للشبكة Wi-Fi الرئيسية.
- الوصول إلى LuCI في `http://192.168.1.1` (أو IP الحالي) واسم المستخدم وكلمة المرور الإداري.

#### **خطوة 1: تسجيل الدخول إلى LuCI**
- افتح متصفح الويب واذهب إلى `http://192.168.1.1`.
- سجل الدخول باسم المستخدم (الافتراضي: `root`) وكلمة المرور (محدد أثناء التثبيت).

#### **خطوة 2: تكوين العميل اللاسلكي**
- **الانتقال إلى إعدادات اللاسلكي:**
  - اذهب إلى **شبكة > اللاسلكي**.
- **مسح الشبكات:**
  - ايجاد الراديو الخاص بك (مثل `radio0` ل2.4 GHz على Mi Router 4C).
  - انقر على **مسح** لتسجيل الشبكات Wi-Fi المتاحة.
- **الانضمام إلى الشبكة Wi-Fi الرئيسية:**
  - ايجاد SSID للشبكة Wi-Fi للموجه الرئيسي.
  - انقر على **انضمام إلى الشبكة**.
- **تكوين إعدادات العميل:**
  - **مفتاح Wi-Fi:** ادخل كلمة المرور للشبكة Wi-Fi الرئيسية.
  - **شبكة:** اختر أو تعيين إلى `lan` (هذا يضيف واجهة العميل إلى الجسر `br-lan`).
  - **منطقة الحائط الناري:** تخصيص إلى `lan` (هذا يسهل قواعد حركة المرور لجسر).
  - **اسم الواجهة:** LuCI قد يقترح `wwan`؛ يمكنك تركه أو إعادة تسميته إلى `client` للوضوح، ولكن تأكد من أن يكون مرتبطًا بـ `lan`.
- **حفظ & تطبيق:**
  - انقر على **حفظ & تطبيق** للاتصال بشبكة Wi-Fi الرئيسية.

#### **خطوة 3: تعديل واجهة LAN إلى عميل DHCP**
- **اذهب إلى الواجهات:**
  - اذهب إلى **شبكة > الواجهات**.
- **تحرير واجهة LAN:**
  - انقر على **تحرير** بجوار واجهة `lan`.
- **تحديد البروتوكول إلى عميل DHCP:**
  - في قائمة **البروتوكول**، اختر **عميل DHCP**.
  - هذا يسمح للجسر `br-lan` (الذي الآن يتضمن العميل اللاسلكي) بالحصول على عنوان IP من خادم DHCP للموجه الرئيسي (مثل 192.168.1.x).
- **تعطيل خادم DHCP:**
  - نظرًا لأن `lan` الآن عميل DHCP، خادم DHCP المحلي يتم تعطيله تلقائيًا. تأكد من ذلك تحت **الإعدادات المتقدمة** أو **DHCP و DNS** - تأكد من أن "تجاهل الواجهة" محدد إذا ظهرت الخيار.
- **حفظ & تطبيق:**
  - انقر على **حفظ & تطبيق**. الآن سيعتاد الموجه على طلب IP من الموجه الرئيسي.

#### **خطوة 4: تكوين نقطة الوصول اللاسلكية**
- **إضافة شبكة لاسلكية جديدة:**
  - اذهب مرة أخرى إلى **شبكة > اللاسلكي**.
  - انقر على **إضافة** تحت نفس الراديو (مثل `radio0`) لإنشاء واجهة لاسلكية جديدة.
- **تكوين AP:**
  - **ESSID:** اختر اسمًا لشبكة Wi-Fi (مثل `OpenWRT_AP`).
  - **الوضع:** تعيين إلى **نقطة الوصول (AP)**.
  - **شبكة:** تخصيص إلى `lan` (هذا يجسرها مع واجهة العميل ومنافذ Ethernet).
- **تكوين الأمان:**
  - اذهب إلى **لاسلكي أمان**.
  - **التشفير:** اختر **WPA2-PSK** (موصى به).
  - **المفتاح:** تعيين كلمة مرور قوية لAP.
- **حفظ & تطبيق:**
  - انقر على **حفظ & تطبيق**. الآن سيعرض الموجه Wi-Fi الخاص به.

#### **خطوة 5: التحقق من الجسر**
- **تحقق من الواجهات:**
  - اذهب إلى **شبكة > الواجهات**.
  - تأكد من أن واجهة `lan` تدرج كل من العميل اللاسلكي (مثل `wlan0`) وAP (مثل `wlan0-1`) تحت الجسر `br-lan`.
- **تحقق من تخصيص IP:**
  - اذهب إلى **حالة > نظرة عامة**.
  - اكتب عنوان IP المخصص لواجهة `lan` من الموجه الرئيسي (مثل `192.168.1.100`).

#### **خطوة 6: اختبار الإعداد**
- **اختبار Wi-Fi:**
  - اتصل جهازًا بشبكة `OpenWRT_AP` Wi-Fi.
  - تأكد من أن الجهاز يحصل على IP من الموجه الرئيسي (مثل `192.168.1.x`) ويحصل على الوصول إلى الإنترنت.
- **اختبار Ethernet (إذا كان ذلك ضروريًا):**
  - اكتمل جهازًا في أحد منافذ LAN للموجه.
  - تأكد من أن الجهاز يحصل على IP من الموجه الرئيسي ويصل إلى الإنترنت.
- **الوصول إلى LuCI:**
  - استخدم عنوان IP الجديد (مثل `http://192.168.1.100`) للوصول إلى واجهة OpenWRT.

---

### **لماذا يعمل هذا**
- تخصيص كل من واجهة العميل وAP إلى شبكة `lan` يضيفهما إلى الجسر `br-lan`، مما يسمح بحركة المرور في طبقة 2 بينهما والموجه الرئيسي.
- تعيين `lan` إلى عميل DHCP يضمن أن الموجه OpenWRT يحصل على IP فريد من الموجه الرئيسي، مما يجنب التعارضات (مثل مع `192.168.1.1`), وتعطيل خادم DHCP المحلي لتسمح للموجه الرئيسي بإدارة جميع تخصيصات IP.
- الأجهزة المتصلة بـ AP أو منافذ Ethernet تظهر في نفس الفرع الفرعي مثل الشبكة الرئيسية (مثل `192.168.1.x`), مما يفي بضرورة الجسر اللاسلكي.

---

### **طريقة بديلة: باستخدام relayd (جسر شبه)**
إذا فشلت الطريقة البسيطة للجسر (مثلًا بسبب قيود سائق اللاسلكي)، يمكنك استخدام حزمة `relayd` لجسر شبه. هذا يخلق إعدادًا موجهًا حيث يكون عميل الموجه OpenWRT على فرع فرعي مختلف، ولكن هو أكثر موثوقية على بعض الأجهزة. إليك نظرة عامة:

1. **تثبيت relayd:**
   - اذهب إلى **نظام > برمجيات**، ابحث عن `relayd` وثبته.
2. **تكوين العميل اللاسلكي:**
   - انضم إلى Wi-Fi الرئيسي، ولكن تخصيصه إلى واجهة جديدة (مثل `wwan`) تعيين إلى عميل DHCP.
3. **تكوين LAN:**
   - تعيين `lan` إلى IP ثابت (مثل `192.168.2.1`) مع خادم DHCP الخاص به.
4. **تكوين relayd:**
   - قم بتكوين `relayd` عبر SSH أو LuCI (تحت **شبكة > أسماء المضيفين**) لتوجيه بين `wwan` و`lan`.
5. **تكوين AP:**
   - تعيين AP على شبكة `lan`.
6. **اختبار:**
   - الأجهزة على `OpenWRT_AP` ستكون على `192.168.2.x`، مع الإنترنت موجه من الموجه الرئيسي.

**ملاحظة:** هذا ليس جسرًا حقيقيًا (فرع فرعي مختلف)، لذا استخدمه فقط إذا لم تعمل الطريقة البسيطة. بالنسبة لموجه Xiaomi Mi Router 4C مع OpenWRT 24.10.0، يجب أن يكون الجسر البسيط كافيًا.

---

### **الخاتمة**
خطواتك الأصلية **mostly correct** ولكن غير مكتملة بدون تعيين واجهة `lan` إلى وضع عميل DHCP لتجنب تعارضات IP وضمن الجسر الصحيح. الخطوات المعدلة أعلاه توفر طريقة موثوقة لتكوين OpenWRT كجسر لاسلكي. إذا اتبعتها، سيعمل الموجه على الاتصال بشبكة Wi-Fi الرئيسية ويشارك ذلك الاتصال بشكل سلس عبر AP الخاص به أو منافذ Ethernet، كل ذلك في نفس الفرع الفرعي. اختبر الإعداد، وإذا ظهر أي مشاكل (نادرة مع OpenWRT الحديثة)، فاعتبر البديل `relayd`.