---
audio: true
generated: false
lang: ar
layout: post
title: تكوين OpenWRT كجسر لاسلكي
translated: true
---

مع مساعدة Grok، أنا لا يزال أعمل على ما يلي.

---

لإجابة استفسارك "هل هذا صحيح؟" بشأن الخطوات لتكوين OpenWRT كجسر لاسلكي، ولتوفير الطرق الصحيحة لتحقيق ذلك، سأقيم الخطوات التي قدمتها وسأحسنها بناءً على أفضل الممارسات في OpenWRT. هدفك هو إعداد موجه OpenWRT (مثل Xiaomi Mi Router 4C مع OpenWRT 24.10.0) كجسر لاسلكي - متصل لاسلكيًا بشبكة Wi-Fi موجودة كعميل، ويشارك هذه الاتصال عبر نقطة الوصول (AP) الخاصة به أو منافذ Ethernet، مع الاحتفاظ بكل الأجهزة في نفس الفرع الفرعي كالموجه الرئيسي.

خطواتك المقدمة هي mostly accurate ولكن تفتقر إلى تعديل حاسم لضمان الجسر الصحيح وتجنب تعارضات IP. أدناه، سأقيم أولًا تكوينك ثم سأقدم الخطوات الصحيحة الكاملة لتحقيق جسر لاسلكي في OpenWRT باستخدام طريقة الجسر البسيطة (عميل + AP على الجسر نفسه)، والتي تتوافق مع نيتك. سأذكر أيضًا بديلًا باستخدام `relayd` في الحالات التي لا تعمل فيها الطريقة البسيطة، على الرغم من أن إعدادك ربما يدعم الطريقة الأيسر.

---

### **تقييم الخطوات المقدمة**

تهدف خطواتك إلى:
1. اتصال الموجه OpenWRT كعميل بشبكة Wi-Fi موجودة.
2. إعداد نقطة الوصول (AP) لإرسال شبكة Wi-Fi جديدة.
3. جسر واجهات العميل وAP لتشارك الإنترنت.

هنا مراجعة سريعة:
- **خطوة 1: تسجيل الدخول إلى LuCI** - صحيح، الوصول إلى الواجهة الويب هو نقطة البداية.
- **خطوة 2: تكوين العميل اللاسلكي** - الانضمام إلى Wi-Fi الهدف وتخصيصه إلى شبكة `lan` هو بداية جيدة، ولكن تكوين `lan` الافتراضي في OpenWRT (IP ثابت، عادة 192.168.1.1) قد يتسبب في تعارض مع الموجه الرئيسي إذا كان يستخدم نفس IP. هذا يحتاج إلى تعديل.
- **خطوة 3: تكوين نقطة الوصول اللاسلكية** - إعداد نقطة الوصول وتخصيصها إلى `lan` صحيح للجسر، ولكن يعتمد على تكوين `lan` بشكل صحيح.
- **خطوة 4: جسر الشبكات** - تخصيص كلا الواجهتين إلى `lan` نظريًا يجسرهما، ولكن بدون تعطيل خادم DHCP أو تعديل إعدادات IP، قد لا يعمل بشكل سلس.
- **خطوة 5: اختبار الإعداد** - الاختبار ضروري، ولكن النجاح يعتمد على أن تكون الخطوات السابقة صحيحة تمامًا.

**ما الذي يفتقر إليه أو خطأ؟**
- افتراضيًا، `lan` في OpenWRT لديه IP ثابت (مثل 192.168.1.1) ويشغل خادم DHCP. إذا كان الموجه الرئيسي أيضًا 192.168.1.1، فإن هذا يسبب تعارض IP. يجب عليك تعيين `lan` إلى وضع عميل DHCP للحصول على IP من الموجه الرئيسي وتعطيل خادم DHCP المحلي لتسمح للموجه الرئيسي بتخصيص IPs لجميع الأجهزة.
- تعيين منطقة الحائط الناري إلى `lan` مناسب للبساطة، ولكن إعداد IP هو حاسم.

مع هذا في الاعتبار، فإن خطواتك "mostly right" ولكن غير مكتملة بدون تعديل إعدادات `lan`. أدناه هي الخطوات المصححة.

---

### **الخطوات الصحيحة لتكوين OpenWRT كجسر لاسلكي (طريقة الجسر البسيطة)**

هذه الطريقة تهيئ موجه OpenWRT لتصل إلى شبكة Wi-Fi موجودة كعميل وتشارك هذه الاتصال عبر نقطة الوصول الخاصة به أو منافذ Ethernet، كل ذلك في نفس الفرع الفرعي كالموجه الرئيسي (مثل 192.168.1.x). إليك كيفية القيام بذلك عبر الواجهة الويب LuCI:

#### **المتطلبات مسبقة**
- OpenWRT مثبت (مثل الإصدار 24.10.0 على Xiaomi Mi Router 4C).
- لديك SSID وكلمة المرور ونوع التشفير (مثل WPA2-PSK) للشبكة Wi-Fi الرئيسية.
- الوصول إلى LuCI في `http://192.168.1.1` (أو IP الحالي) واسم المستخدم وكلمة المرور الإداري.

#### **خطوة 1: تسجيل الدخول إلى LuCI**
- افتح متصفح الويب واذهب إلى `http://192.168.1.1`.
- سجل الدخول باستخدام اسم المستخدم (الافتراضي: `root`) وكلمة المرور (تم تعيينها أثناء التثبيت).

#### **خطوة 2: تكوين العميل اللاسلكي**
- **الانتقال إلى إعدادات اللاسلكية:**
  - اذهب إلى **شبكة > لاسلكي**.
- **مسح الشبكات:**
  - ايجاد الراديو الخاص بك (مثل `radio0` ل2.4 GHz على Mi Router 4C).
  - انقر على **Scan** لتسجيل الشبكات Wi-Fi المتاحة.
- **الانضمام إلى الشبكة Wi-Fi الرئيسية:**
  - ايجاد SSID لموجه Wi-Fi الرئيسي.
  - انقر على **Join Network**.
- **تكوين إعدادات العميل:**
  - **Wi-Fi Key:** ادخل كلمة المرور للشبكة Wi-Fi الرئيسية.
  - **Network:** اختر أو قم بتعيينه إلى `lan` (هذا يضيف واجهة العميل إلى الجسر `br-lan`).
  - **Firewall Zone:** تخصيص إلى `lan` (هذا يسيء قواعد حركة المرور للجسر).
  - **Interface Name:** قد يقترح LuCI `wwan`؛ يمكنك تركه أو إعادة تسميته إلى `client` للوضوح، ولكن تأكد من ربطه بـ `lan`.
- **حفظ & تطبيق:**
  - انقر على **Save & Apply** للاتصال بشبكة Wi-Fi الرئيسية.

#### **خطوة 3: تعديل واجهة LAN إلى عميل DHCP**
- **اذهب إلى الواجهات:**
  - اذهب إلى **شبكة > الواجهات**.
- **تحرير واجهة LAN:**
  - انقر على **Edit** بجوار واجهة `lan`.
- **تحديد بروتوكول إلى عميل DHCP:**
  - في قائمة **Protocol**، اختر **DHCP client**.
  - هذا يسمح للجسر `br-lan` (الذي الآن يتضمن العميل اللاسلكي) بالحصول على عنوان IP من خادم DHCP للموجه الرئيسي (مثل 192.168.1.x).
- **تعطيل خادم DHCP:**
  - نظرًا لأن `lan` الآن عميل DHCP، فإن خادم DHCP المحلي يتم تعطيله تلقائيًا. تأكد من ذلك تحت **Advanced Settings** أو **DHCP and DNS** - تأكد من أن "Ignore interface" مفعلة إذا ظهرت الخيار.
- **حفظ & تطبيق:**
  - انقر على **Save & Apply**. الآن سيطلب الموجه عنوان IP من الموجه الرئيسي.

#### **خطوة 4: تكوين نقطة الوصول اللاسلكية**
- **إضافة شبكة لاسلكية جديدة:**
  - اذهب مرة أخرى إلى **شبكة > لاسلكي**.
  - انقر على **Add** تحت نفس الراديو (مثل `radio0`) لإنشاء واجهة لاسلكية جديدة.
- **تكوين AP:**
  - **ESSID:** اختر اسمًا لشبكة Wi-Fi (مثل `OpenWRT_AP`).
  - **Mode:** تعيين إلى **Access Point (AP)**.
  - **Network:** تخصيص إلى `lan` (هذا يجسرها مع واجهة العميل ومنافذ Ethernet).
- **تكوين الأمان:**
  - اذهب إلى **Wireless Security** tab.
  - **Encryption:** اختر **WPA2-PSK** (موصى به).
  - **Key:** تعيين كلمة مرور قوية لAP.
- **حفظ & تطبيق:**
  - انقر على **Save & Apply**. الآن سيبث الموجه شبكة Wi-Fi الخاصة به.

#### **خطوة 5: التحقق من الجسر**
- **تحقق من الواجهات:**
  - اذهب إلى **شبكة > الواجهات**.
  - تأكد من أن واجهة `lan` تدرج كلا من العميل اللاسلكي (مثل `wlan0`) وAP (مثل `wlan0-1`) تحت الجسر `br-lan`.
- **تحقق من تخصيص IP:**
  - اذهب إلى **Status > Overview**.
  - اكتب عنوان IP المخصص لواجهة `lan` من الموجه الرئيسي (مثل `192.168.1.100`).

#### **خطوة 6: اختبار الإعداد**
- **اختبار Wi-Fi:**
  - اتصل جهازًا بشبكة `OpenWRT_AP` Wi-Fi.
  - تأكد من أن الجهاز يحصل على IP من الموجه الرئيسي (مثل `192.168.1.x`) ويحتوي على وصول إلى الإنترنت.
- **اختبار Ethernet (إذا كان ذلك مناسبًا):**
  - اكتمل جهازًا في أحد منافذ LAN للموجه.
  - تأكد من أن الجهاز يحصل على IP من الموجه الرئيسي ويصل إلى الإنترنت.
- **الوصول إلى LuCI:**
  - استخدم عنوان IP الجديد (مثل `http://192.168.1.100`) للوصول إلى واجهة OpenWRT.

---

### **لماذا يعمل هذا**
- تخصيص كلا من واجهة العميل وAP إلى شبكة `lan` يضيفهما إلى الجسر `br-lan`، مما يسمح بحركة المرور في الطبقة 2 بينهما والموجه الرئيسي.
- تعيين `lan` إلى عميل DHCP يضمن أن الموجه OpenWRT يحصل على عنوان IP فريد من الموجه الرئيسي، مما يبعد عن التعارضات (مثل مع `192.168.1.1`), وتعطيل خادم DHCP المحلي لتسمح للموجه الرئيسي بإدارة جميع تخصيصات IP.
- الأجهزة المتصلة بـ AP أو منافذ Ethernet تظهر في نفس الفرع الفرعي كشبكة الرئيسية (مثل `192.168.1.x`), مما يفي باحتياجات الجسر اللاسلكي.

---

### **طريقة بديلة: باستخدام relayd (جسر شبه)**
إذا فشلت طريقة الجسر البسيطة (مثلًا بسبب قيود سائق اللاسلكي)، يمكنك استخدام حزمة `relayd` لجسر شبه. هذا يخلق إعدادًا مرتبًا حيث يكون عميل الموجه OpenWRT على فرع فرعي مختلف، ولكن هو أكثر موثوقية على بعض الأجهزة. إليك نظرة عامة:

1. **تثبيت relayd:**
   - اذهب إلى **System > Software**، ابحث عن `relayd` واسثمر فيه.
2. **تكوين العميل اللاسلكي:**
   - انضم إلى Wi-Fi الرئيسي، ولكن تخصيصه إلى واجهة جديدة (مثل `wwan`) تعيين إلى عميل DHCP.
3. **تكوين LAN:**
   - تعيين `lan` إلى IP ثابت (مثل `192.168.2.1`) مع خادم DHCP الخاص به.
4. **تكوين relayd:**
   - قم بتكوين `relayd` عبر SSH أو LuCI (تحت **شبكة > Hostnames**) لتسليم بين `wwan` و`lan`.
5. **تكوين AP:**
   - تعيين AP على شبكة `lan`.
6. **اختبار:**
   - الأجهزة على `OpenWRT_AP` ستكون على `192.168.2.x`، مع الإنترنت تسليم من الموجه الرئيسي.

**ملاحظة:** هذا ليس جسرًا حقيقيًا (فرع فرعي مختلف)، لذا استخدمه فقط إذا لم تعمل الطريقة البسيطة. بالنسبة لموجه Xiaomi Mi Router 4C مع OpenWRT 24.10.0، يجب أن يكون الجسر البسيط كافيًا.

---

### **الخاتمة**
خطواتك الأصلية **mostly correct** ولكن غير مكتملة بدون تعيين واجهة `lan` إلى وضع عميل DHCP لتجنب تعارضات IP وضمن الجسر الصحيح. الخطوات المصححة أعلاه توفر طريقة موثوقة لتكوين OpenWRT كجسر لاسلكي. إذا اتبعتها، سيقوم الموجه بالاتصال بشبكة Wi-Fi الرئيسية ويشارك هذه الاتصال بشكل سلس عبر نقطة الوصول الخاصة به أو منافذ Ethernet، كل ذلك في نفس الفرع الفرعي. اختبر الإعداد، وإذا ظهر أي مشاكل (نادرًا مع OpenWRT الحديث)، فاستخدم البديل `relayd`.