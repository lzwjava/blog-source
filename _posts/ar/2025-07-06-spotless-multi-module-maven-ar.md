---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: لا عيب في مشاريع Maven متعددة الوحدات
translated: true
type: note
---

### Spotless في مشاريع Maven متعددة الوحدات

Spotless هو إضافة تنسيق التعليمات البرمجية المتاحة لكل من Maven وGradle. بناءً على إشارتك إلى علم `-pl` (قائمة المشروع) في Maven، سأفترض أنك تستخدم **إضافة Spotless لـ Maven** في مشروع Java متعدد الوحدات. هذا يسمح لك بتشغيل فحوصات التنسيق (على سبيل المثال، عبر `spotless:check`) أو تطبيق الإصلاحات (على سبيل المثال، عبر `spotless:apply`) بشكل انتقائي على وحدات محددة، مما يكون فعالاً للمشاريع الكبيرة حيث قد تحتاج فقط إلى تنسيق وحدات معينة (مثلاً أثناء التطوير على وحدة فرعية محددة).

#### المتطلبات الأساسية
- يستخدم مشروعك Maven مع بنية متعددة الوحدات (محددة في ملف `pom.xml` رئيسي يحتوي على `<modules>...</modules>`).
- تم تكوين إضافة Spotless لـ Maven في مشروعك (عادة في ملف POM الرئيسي أو ملفات POM للوحدات الفردية). إذا لم يكن الأمر كذلك، أضفها إلى ملف POM الخاص بك:
  ```xml
  <build>
    <plugins>
      <plugin>
        <groupId>com.diffplug.spotless</groupId>
        <artifactId>spotless-maven-plugin</artifactId>
        <version>2.43.0</version>  <!-- استخدم أحدث إصدار -->
        <configuration>
          <!-- قواعد التنسيق الخاصة بك هنا، مثلاً لـ Java، Groovy -->
        </configuration>
      </plugin>
    </plugins>
  </build>
  ```
  - تتضمن القواعد الشائعة Google Java Format، أو Eclipse JDT لـ Java، أو تخصيصات لعمليات الاستيراد والمسافات، إلخ.
  - يدعم Spotless العديد من أنواع الملفات (Java, Kotlin, XML، إلخ) ويتكامل جيدًا مع أدوات CI لخطافات pre-commit (عبر هدف `spotless:check`، الذي يفشل عمليات البناء في حالة وجود كود غير مُنسق).

#### استخدام `-pl` للتحكم في تنسيق الوحدات
يسمح لك علم `-pl` (قائمة المشروع) في Maven بتحديد قائمة مفصولة بفواصل للوحدات المراد تضمينها في تنفيذ البناء/الإضافة. بشكل افتراضي، يعمل Maven على جميع الوحدات، لكن `-pl` يقيد ذلك، مما يوفر الوقت ويتجنب العمل غير الضروري على الوحدات غير المتأثرة.

- **البنية الأساسية للأمر**:
  - للتحقق من التنسيق (دون تطبيق التغييرات): `mvn spotless:check -pl module1,module2`
  - لتطبيق إصلاحات التنسيق: `mvn spotless:apply -pl module1,module2`
  - استبدل `module1,module2` بأسماء الوحدات الفعلية (على سبيل المثال، المسارات النسبية من الجذر، مثل `core,api`).

- **أمثلة**:
  ١. **التحقق من التنسيق فقط على وحدة `core`**:
     ```
     mvn spotless:check -pl core
     ```
     - يفحص ويُتحقق فقط من ملفات المصدر في `core`. إذا وجدت أي مشاكل في التنسيق، يفشل البناء مع التفاصيل (مثلاً، "Please run `spotless:apply` to fix").

  ٢. **تطبيق التنسيق على وحدات متعددة (`api` و `utils`)**:
     ```
     mvn spotless:apply -pl api,utils
     ```
     - يقوم بتعديل الملفات في مكانها لتتوافق مع قواعد Spotless الخاصة بك. دائمًا قم بحفظ التغييرات بعد ذلك لتجنب مفاجآت في نظام التحكم بالنسخ.

  ٣. **استبعاد وحدات محددة أثناء تشغيل المشروع بالكامل**: استخدم `-pl !moduleToSkip` للتشغيل على كل شيء *ما عدا* وحدات معينة (يدعم Maven 3.2.1+ النفي باستخدام `!`).
     - مثال: `mvn spotless:check -pl !legacy` (يعمل على جميع الوحدات ما عدا `legacy`).

- **نصائح للكفاءة**:
  - **التنفيذ المتوازي**: أضف `-T 4` لعمليات البناء متعددة الخيوط (مثلاً، `mvn spotless:check -pl core,api -T 4`).
  - **التجربة الأولية**: استخدم `spotless:check` أولاً لمعاينة المشاكل دون إجراء تغييرات — إنه ثابت وآمن.
  - **التكامل مع بيئة التطوير المتكاملة/نظام التحكم بالنسخ**: قم بتكوين Spotless ليعمل عند الحفظ/الحفظ المؤقت في بيئة التطوير المتكاملة الخاصة بك (مثلاً، IntelliJ عبر إضافة Spotless) أو استخدمه كخطاف pre-commit (عبر أدوات مثل pre-commit أو خطافات Git) للفحوصات الآلية.
  - **معالجة دقة المفاعل**: إذا كانت تبعيات الوحدة معقدة، يحلها Maven تلقائيًا عند استخدام `-pl`، مما يضمن معالجة الوحدات التابعة أولاً إذا لزم الأمر.
  - **المشاكل الشائعة**:
    - إذا لم يعمل `-pl`، تأكد من تعريف الوحدات في `<modules>` واستخدم المسارات المؤهلة بالكامل إذا كان هناك غموض (مثلاً، `-pl :core` للإعدادات متعددة المستودعات).
    - لمستخدمي Gradle (إذا كنت تقصد إضافة Spotless لـ Gradle بدلاً من ذلك)، فإن المكافئ هو `-p` لمسارات المشروع، لكن استفسارك يحدد `-pl`، لذا يُفترض أنك تستخدم Maven. إذا كان Gradle، فانتقل إلى إضافات مثل `gradle task -p submodule`.

للحصول على الوثائق الكاملة، راجع [وثائق إضافة Spotless لـ Maven](https://github.com/diffplug/spotless/tree/v2.43.0/plugin-maven). إذا كان إعدادك مختلفًا (مثلاً، Gradle)، قدم المزيد من التفاصيل للحصول على نصيحة مخصصة.