---
audio: false
generated: true
lang: ar
layout: post
title: 'الدليل الشامل لفيجوال في إم: تحليل ومراقبة أداء جافا'
translated: true
type: note
---

# الدليل الشامل لـ VisualVM

VisualVM هو أداة قوية ومفتوحة المصدر لتحليل الأداء ومراقبة تطبيقات Java، حيث توفر واجهة رسومية لتحليل أداء تطبيقات Java. وهي مدرجة مع Java Development Kit (JDK) وتكون مفيدة بشكل خاص لتشخيص مشاكل الأداء، تسريبات الذاكرة، والمشاكل المتعلقة بالخيوط. يغطي هذا الدليل ميزات VisualVM، الإعداد، الاستخدام، وأفضل الممارسات للمطورين ومسؤولي النظام.

## جدول المحتويات
1. [ما هو VisualVM؟](#ما-هو-visualvm)
2. [الميزات الرئيسية لـ VisualVM](#الميزات-الرئيسية-لـ-visualvm)
3. [متطلبات النظام](#متطلبات-النظام)
4. [تثبيت VisualVM](#تثبيت-visualvm)
5. [تشغيل VisualVM](#تشغيل-visualvm)
6. [الاتصال بتطبيقات Java](#الاتصال-بتطبيقات-java)
7. [استخدام VisualVM للمراقبة وتحليل الأداء](#استخدام-visualvm-للمراقبة-وتحليل-الأداء)
   - [علامة التبويب نظرة عامة](#علامة-التبويب-نظرة-عامة)
   - [علامة التبويب مراقب](#علامة-التبويب-مراقب)
   - [علامة التبويب الخيوط](#علامة-التبويب-الخيوط)
   - [أداة أخذ العينات](#أداة-أخذ-العينات)
   - [أداة تحليل الأداء](#أداة-تحليل-الأداء)
   - [تحليل Heap Dump](#تحليل-heap-dump)
   - [تحليل Thread Dump](#تحليل-thread-dump)
   - [MBeans](#mbeans)
8. [المراقبة عن بُعد](#المراقبة-عن-بعد)
9. [توسيع VisualVM باستخدام الإضافات](#توسيع-visualvm-باستخدام-الإضافات)
10. [أفضل الممارسات](#أفضل-الممارسات)
11. [استكشاف الأخطاء وإصلاحها الشائعة](#استكشاف-الأخطاء-وإصلاحها-الشائعة)
12. [موارد إضافية](#موارد-إضافية)

## ما هو VisualVM؟

VisualVM هي أداة قائمة على Java تدمج عدة أدوات من JDK (مثل `jstack`، `jmap`، و `jconsole`) في واجهة واحدة سهلة الاستخدام. تسمح للمطورين بمراقبة تطبيقات Java في الوقت الفعلي، وتحليل استخدام وحدة المعالجة المركزية والذاكرة، وتحليل Heap Dumps، وإدارة الخيوط. VisualVM مفيدة بشكل خاص لتحديد اختناقات الأداء، تسريبات الذاكرة، ومشاكل الخيوط في تطبيقات Java المحلية والبعيدة.

تم تطوير VisualVM في الأصل من قبل Sun Microsystems، وهي الآن جزء من Oracle JDK ويتم صيانتها بنشاط كمشروع مفتوح المصدر. وهي تدعم تطبيقات Java التي تعمل على JDK 6 والإصدارات الأحدث.

## الميزات الرئيسية لـ VisualVM

- **المراقبة في الوقت الفعلي**: تتبع استخدام وحدة المعالجة المركزية، استهلاك الذاكرة، نشاط الخيوط، وجمع البيانات غير المرغوب فيها.
- **تحليل الأداء**: تقدم تحليلًا لوحدة المعالجة المركزية والذاكرة لتحديد اختناقات الأداء وأنماط تخصيص الذاكرة.
- **تحليل Heap Dump**: تسمح بفحص محتويات الذاكرة لتشخيص تسريبات الذاكرة.
- **تحليل Thread Dump**: تساعد في تحليل حالات الخيوط واكتشاف حالات التعطل.
- **إدارة MBean**: توفر الوصول إلى Java Management Extensions (JMX) لمراقبة وإدارة التطبيقات.
- **المراقبة عن بُعد**: تدعم مراقبة تطبيقات Java التي تعمل على أجهزة بعيدة.
- **القدرة على التوسع**: تدعم الإضافات لتوسيع الوظائف، مثل التكامل مع أطر عمل محددة أو أدوات تحليل أداء إضافية.
- **خفيفة الوزن وسهلة الاستخدام**: إعداد بسيط مع واجهة رسومية بديهية.

## متطلبات النظام

لاستخدام VisualVM، تأكد من التالي:
- **نظام التشغيل**: Windows، macOS، Linux، أو أي نظام تشغيل يدعم JVM.
- **إصدار Java**: JDK 6 أو أحدث (يتم تضمين VisualVM مع JDK 8 والإصدارات الأحدث).
- **الذاكرة**: 512 ميغابايت على الأقل من ذاكرة الوصول العشوائي الحرة للمراقبة خفيفة الوزن؛ 1 جيجابايت أو أكثر لتحليل Heap Dump.
- **مساحة القرص**: حوالي 50 ميغابايت لتثبيت VisualVM.
- **الأذونات**: قد تكون هناك حاجة إلى صلاحيات إدارية لميزات معينة (مثل الوصول إلى عمليات النظام).

## تثبيت VisualVM

يتم تضمين VisualVM مع Oracle JDK 8 والإصدارات الأحدث، ويقع في دليل `bin` لتثبيت JDK (الملف التنفيذي `jvisualvm`). بدلاً من ذلك، يمكنك تنزيله كتطبيق مستقل:

1. **من JDK**:
   - إذا كان لديك JDK 8 أو إصدار أحدث مثبتًا، فإن VisualVM متاح بالفعل في دليل `JAVA_HOME/bin` كـ `jvisualvm`.
   - قم بتشغيل الملف التنفيذي `jvisualvm` لبدء الأداة.

2. **التنزيل المستقل**:
   - قم بزيارة [موقع VisualVM الإلكتروني](https://visualvm.github.io/) لتنزيل أحدث إصدار مستقل.
   - استخرج ملف ZIP إلى دليل من اختيارك.
   - قم بتشغيل الملف التنفيذي `visualvm` (مثل `visualvm.exe` على Windows).

3. **التحقق من التثبيت**:
   - تأكد من أن متغير البيئة `JRE_HOME` أو `JAVA_HOME` يشير إلى JDK/JRE متوافق.
   - اختبر عن طريق تشغيل VisualVM.

## تشغيل VisualVM

لبدء VisualVM:
- **على Windows**: انقر نقرًا مزدوجًا فوق `jvisualvm.exe` في مجلد `bin` الخاص بـ JDK أو دليل التثبيت المستقل.
- **على macOS/Linux**: قم بتشغيل `./jvisualvm` من الطرفية في دليل `bin`.
- ستفتح واجهة VisualVM، مع عرض قائمة بتطبيقات Java المحلية في اللوحة اليسرى.

## الاتصال بتطبيقات Java

يمكن لـ VisualVM مراقبة تطبيقات Java المحلية والبعيدة.

### التطبيقات المحلية
- عند التشغيل، تكتشف VisualVM تلقائيًا تطبيقات Java قيد التشغيل على الجهاز المحلي.
- انقر نقرًا مزدوجًا فوق تطبيق في اللوحة اليسرى لفتح لوحة المراقبة الخاصة به.
- إذا لم يكن التطبيق مدرجًا، فتأكد من أنه يعمل تحت JVM متوافق.

### التطبيقات البعيدة
لمراقبة تطبيق Java بعيد:
1. قم بتمكين JMX على التطبيق البعيد عن طريق إضافة وسيطات JVM (مثل `-Dcom.sun.management.jmxremote`).
2. في VisualVM، انتقل إلى **File > Add JMX Connection**.
3. أدخل عنوان IP للمضيف البعيد والمنفذ (مثل `hostname:port`).
4. قدم بيانات الاعتماد إذا تم تمكين المصادقة.
5. اتصل وراقب التطبيق.

**ملاحظة**: للاتصالات الآمنة، قم بتكوين SSL والمصادقة حسب الحاجة (انظر [المراقبة عن بُعد](#المراقبة-عن-بعد)).

## استخدام VisualVM للمراقبة وتحليل الأداء

توفر VisualVM عدة علامات تبويب وأدوات لتحليل تطبيقات Java. فيما يلي تفصيل مفصل لكل ميزة.

### علامة التبويب نظرة عامة
- تعرض معلومات عامة حول التطبيق، بما في ذلك:
  - وسيطات JVM
  - خصائص النظام
  - classpath التطبيق
  - PID (معرف العملية)
- مفيدة للتحقق من تكوين التطبيق.

### علامة التبويب مراقب
- توفر رسومًا بيانية في الوقت الفعلي لـ:
  - **استخدام وحدة المعالجة المركزية**: يتتبع استخدام وحدة المعالجة المركزية للتطبيق والنظام.
  - **ذاكرة Heap**: يراقب استخدام الذاكرة (Eden, Old Gen, PermGen/Metaspace) ونشاط جمع البيانات غير المرغوب فيها.
  - **الفئات**: يظهر عدد الفئات المحملة.
  - **الخيوط**: يعرض عدد الخيوط الحية والخيوط daemon.
- تسمح بتشغيل جمع البيانات غير المرغوب فيها أو إنشاء Heap Dumps يدويًا.

### علامة التبويب الخيوط
- تتصور حالات الخيوط (قيد التشغيل، نائمة، في انتظار، إلخ) بمرور الوقت.
- توفر وظيفة Thread Dump لالتقاط الحالة الحالية لجميع الخيوط.
- مفيدة لتحديد حالات التعطل، الخيوط المحظورة، أو الاستخدام المفرط للخيوط.

### أداة أخذ العينات
- تقدم أخذ عينات خفيفة الوزن لوحدة المعالجة المركزية والذاكرة لتحليل الأداء.
- **أخذ عينات وحدة المعالجة المركزية**:
  - تلتقط وقت التنفيذ على مستوى الأسلوب.
  - تحدد الأساليب التي تستهلك أكبر وقت لوحدة المعالجة المركزية.
- **أخذ عينات الذاكرة**:
  - يتتبع تخصيصات الكائنات واستخدام الذاكرة.
  - يساعد في تحديد الكائنات التي تستهلك ذاكرة مفرطة.
- أخذ العينات له عبء أقل من تحليل الأداء ولكنه يوفر بيانات أقل تفصيلاً.

### أداة تحليل الأداء
- توفر تحليلًا متعمقًا لوحدة المعالجة المركزية والذاكرة.
- **تحليل أداء وحدة المعالجة المركزية**:
  - يقيس وقت تنفيذ الأساليب.
  - يحدد اختناقات الأداء على مستوى الأسلوب.
- **تحليل أداء الذاكرة**:
  - يتتبع تخصيصات الكائنات والمراجع.
  - يساعد في اكتشاف تسريبات الذاكرة عن طريق تحديد الكائنات التي تستمر بشكل غير متوقع.
- **ملاحظة**: تحليل الأداء له عبء أعلى من أخذ العينات وقد يبطئ التطبيق.

### تحليل Heap Dump
- Heap Dump هو لقطة للذاكرة الخاصة بالتطبيق.
- لإنشاء Heap Dump:
  1. انتقل إلى علامة التبويب **مراقب**.
  2. انقر فوق **Heap Dump**.
  3. احفظ الـ dump في ملف `.hprof` أو قم بتحليله مباشرة في VisualVM.
- الميزات:
  - عرض مثيلات الفئة، الأحجام، والمراجع.
  - تحديد الكائنات ذات استخدام الذاكرة العالي.
  - اكتشاف تسريبات الذاكرة عن طريق تحليل مسارات الاحتفاظ بالكائنات.
- استخدم وحدة التحكم **OQL (Object Query Language)** للاستعلامات المتقدمة حول الذاكرة.

### تحليل Thread Dump
- يلتقط حالة جميع الخيوط في لحظة محددة.
- لإنشاء Thread Dump:
  1. انتقل إلى علامة التبويب **الخيوط**.
  2. انقر فوق **Thread Dump**.
  3. قم بتحليل الـ dump في VisualVM أو قم بتصديره لأدوات خارجية.
- مفيد لتشخيص:
  - حالات التعطل
  - الخيوط المحظورة
  - مشاكل تنافس الخيوط

### MBeans
- تصل إلى JMX MBeans لإدارة ومراقبة التطبيق.
- الميزات:
  - عرض وتعديل سمات MBean.
  - استدعاء عمليات MBean.
  - مراقبة إشعارات MBean.
- مفيدة للتطبيقات ذات أدوات JMX المخصصة.

## المراقبة عن بُعد

لمراقبة تطبيقات Java البعيدة:
1. **تكوين JVM البعيد**:
   - أضف وسيطات JVM التالية إلى التطبيق البعيد:
     ```bash
     -Dcom.sun.management.jmxremote
     -Dcom.sun.management.jmxremote.port=<port>
     -Dcom.sun.management.jmxremote.ssl=false
     -Dcom.sun.management.jmxremote.authenticate=false
     ```
   - للاتصالات الآمنة، قم بتمكين SSL والمصادقة:
     ```bash
     -Dcom.sun.management.jmxremote.ssl=true
     -Dcom.sun.management.jmxremote.authenticate=true
     -Dcom.sun.management.jmxremote.password.file=<password_file>
     ```
2. **إعداد VisualVM**:
   - أضف اتصال JMX في VisualVM باستخدام عنوان IP والمنفذ للمضيف البعيد.
   - قدم بيانات الاعتماد إذا لزم الأمر.
3. **تكوين الجدار الناري**:
   - تأكد من أن منفذ JMX مفتوح على المضيف البعيد.
   - استخدم نفق SSH للوصول البعيد الآمن إذا لزم الأمر:
     ```bash
     ssh -L <local_port>:<remote_host>:<remote_port> user@remote_host
     ```

## توسيع VisualVM باستخدام الإضافات

تدعم VisualVM الإضافات لتعزيز وظائفها:
1. **تثبيت الإضافات**:
   - انتقل إلى **Tools > Plugins**.
   - تصفح مركز الإضافات للإضافات المتاحة (مثل Visual GC، BTrace، إضافات JConsole).
   - قم بالتثبيت وأعد تشغيل VisualVM.
2. **الإضافات الشائعة**:
   - **Visual GC**: يتصور نشاط جمع البيانات غير المرغوب فيها.
   - **BTrace**: يوفر تتبعًا ديناميكيًا لتطبيقات Java.
   - **إضافات JConsole**: تضيف ميزات متوافقة مع JConsole.
3. **الإضافات المخصصة**:
   - قم بتنزيل الإضافات من موقع VisualVM الإلكتروني أو من مصادر خارجية.
   - ضع ملفات الإضافة في دليل `plugins` وأعد تشغيل VisualVM.

## أفضل الممارسات

- **ابدأ بأخذ العينات**: استخدم أخذ العينات قبل تحليل الأداء لتقليل التأثير على الأداء.
- **حدد نطاق تحليل الأداء**: قم بتحليل حزم أو فئات محددة لتقليل العبء.
- **Heap Dumps منتظمة**: قم بجدولة Heap Dumps دورية للتطبيقات طويلة الأمد لتتبع اتجاهات الذاكرة.
- **راقب جمع البيانات غير المرغوب فيها**: استخدم إضافة Visual GC لتحليل أداء GC.
- **اتصالات بعيدة آمنة**: استخدم دائمًا SSL والمصادقة للمراقبة عن بُعد.
- **احفظ اللقطات**: احفظ Heap و Thread Dumps للتحليل أو التعاون لاحقًا.
- **استخدم OQL للتحليل المتقدم**: تعلم OQL لاستعلامات Heap Dump فعالة.
- **راقب استخدام الموارد**: تأكد من أن VisualVM لديه ذاكرة كافية لـ Heap Dumps كبيرة.

## استكشاف الأخطاء وإصلاحها الشائعة

- **لم يتم اكتشاف التطبيق**:
  - تأكد من أن التطبيق يعمل على JVM متوافق.
  - تحقق مما إذا كان JVM مهيأ للسماح باتصالات JMX.
- **عبء مرتفع أثناء تحليل الأداء**:
  - انتقل إلى أخذ العينات للحصول على عبء أقل.
  - قم بتحليل فئات أو أساليب محددة.
- **مشاكل الاتصال للمراقبة عن بُعد**:
  - تحقق من إعدادات منفذ JMX والجدار الناري.
  - اختبر الاتصال باستخدام `telnet <host> <port>`.
- **OutOfMemoryError في VisualVM**:
  - زد حجم ذاكرة VisualVM عن طريق تحرير ملف `visualvm.conf`:
    ```bash
    -J-Xmx<memory_size>m
    ```
- **تحليل Heap Dump بطيء**:
  - استخدم جهازًا بذاكرة وصول عشوائي أكبر.
  - قم بتصفية الفئات لتقليل نطاق التحليل.

## موارد إضافية

- **الموقع الرسمي**: [visualvm.github.io](https://visualvm.github.io/)
- **التوثيق**: [VisualVM Documentation](https://visualvm.github.io/documentation.html)
- **الدروس**:
  - [دليل Oracle لـ VisualVM](https://www.oracle.com/java/technologies/visualvm.html)
  - [ضبط أداء Java باستخدام VisualVM](https://www.baeldung.com/java-visualvm)
- **المجتمع**:
  - [مشاكل VisualVM على GitHub](https://github.com/visualvm/visualvm.github.io/issues)
  - [وسم VisualVM على Stack Overflow](https://stackoverflow.com/questions/tagged/visualvm)