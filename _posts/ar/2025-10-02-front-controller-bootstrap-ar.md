---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: عملية تمهيد وحدة تحكم واجهة CodeIgniter
translated: true
type: note
---

الكود PHP الذي قدمته هو نقطة الدخول الرئيسية (عادة `index.php`) لتطبيق ويب مبني باستخدام CodeIgniter، وهو إطار عمل PHP مفتوح المصدر. يعمل هذا السكريبت كـ "وحدة تحكم أمامية" تقوم بتهيئة إطار العمل، والتعامل مع طلبات HTTP الواردة، وتوجيهها إلى الأجزاء المناسبة من تطبيقك. لا يقوم بشكل مباشر بعرض صفحات الويب — وظيفته هي إعداد كل شيء حتى يتمكن باقي الإطار (وكودك) من أداء عمله.

سأقوم بشرح كيفية عمله خطوة بخطوة، بناءً على الكود. هذا شرح عالي المستوى للتدفق؛ تم تصميم CodeIgniter للأداء، الأمان، والتعديلية، لذلك يقوم بتحميل المكونات تدريجياً ويستخدم مبادئ البرمجة كائنية التوجه. إذا كنت جديدًا على CodeIgniter، فاعتبر هذا "الموزع" الذي يجهِز الأوركسترا قبل بدء الحفل.

### 1. **الفحوصات الأولية والثوابت**
   - **إصدار CodeIgniter**: يحدد `CI_VERSION` (مثل '3.0.2' هنا)، والذي يتتبع إصدار إطار العمل.
   - **التحقق من الوصول المباشر**: `defined('BASEPATH') OR exit('No direct script access allowed');` تمنع أي شخص من الوصول إلى هذا الملف مباشرة عبر URL (إجراء أماني لحماية الكود الحساس).
   - **تحميل الثوابت**: يقوم بتضمين ملفات التهيئة للثوابت (مثل `APPPATH.'config/'.ENVIRONMENT.'/constants.php'` و `APPPATH.'config/constants.php'`). هذه تحدد المسارات، الإعدادات، والعوامل العامة الأخرى.
   - **تحميل الدوال العامة**: يتطلب `BASEPATH.'core/Common.php'`، والذي يتضمن دوال مساعدة مستخدمة في جميع أنحاء الإطار (مثل تحميل الفئات أو معالجة الأخطاء).

### 2. **إجراءات الأمان**
   - **فحص إصدار PHP**: يتأكد من تشغيل PHP 5.4 أو أعلى.
   - **تحسينات الأمان**:
     - يعطل `magic_quotes_runtime` (ميزة قديمة).
     - يتعامل مع "register globals" (ميزة قديمة أخرى يمكن أن تعرض المتغيرات بشكل عام). يقوم بفحص superglobals (`$_GET`, `$_POST`، إلخ.) وإلغاء تعيين تلك غير المحمية لمنع هجمات الحقن.
   هذا القسم يحمي من الثغرات الشائعة في إصدارات PHP القديمة.

### 3. **معالجة الأخطاء**
   - يضع معالجات أخطاء مخصصة (`_error_handler`, `_exception_handler`) ودالة إغلاق (`_shutdown_handler`) لتسجيل أخطاء/استثناءات PHP. هذا يضمن تتبع المشاكل بدلاً من عرض أخطاء خام للمستخدمين.

### 4. **تجاوزات التهيئة**
   - يتحقق من وجود تجاوز لـ `subclass_prefix` (من متغيرات `index.php`) ويحمله عبر `get_config()`. هذا يسمح لك بتوسيع الفئات الأساسية.

### 5. **Composer Autoloader (اختياري)**
   - إذا كان `composer_autoload` مفعلًا في تهيئتك، فإنه يحمل محمل Composer التلقائي (لمكتبات الطرف الثالث). إذا لم يتم العثور عليه، يقوم بتسجيل خطأ.

### 6. **بدء القياس المعياري**
   - يحمل فئة `Benchmark` ويبدأ المؤقتات (مثل `total_execution_time_start` و `loading_time:_base_classes_start`). يتتبع CodeIgniter الأداء هنا — يتم تسجيل/وضع علامات على الأوقات لأغراض التصحيح.

### 7. **نظام الخطاطيف**
   - يحمل فئة `Hooks`.
   - يستدعي خطاف `pre_system`. تسمح الخطاطيف لك بحقن كود مخصص في نقاط رئيسية (مثل الإضافات أو الامتدادات).
   - لاحقًا، سيتحقق من وجود خطاطيف أخرى ويستدعيها مثل `post_system`.

### 8. **إنشاء مثيل للفئات الأساسية (تحميل المكونات الرئيسية)**
   - **فئة Config**: الأولى التي يتم تحميلها، حيث تعتمد الفئات الأخرى عليها. تتعامل مع التهيئة (مثل إعدادات قاعدة البيانات). إذا تم تعيين `$assign_to_config` (من `index.php`)، فإنه يطبق التجاوزات.
   - **معالجة مجموعة الأحرف والتشفير الموحد**: يهيء `mbstring` و `iconv` لدعم UTF-8، ويضع إعدادات افتراضية لمنع مشاكل التشفير.
   - **ملفات التوافق**: يحمل polyfills لإصدارات PHP القديمة (مثل للتجزئة، كلمات المرور).
   - **الفئات الأساسية**: ينشئ مثيلات للفئات الأساسية مثل:
     - `Utf8`: لدعم التشفير الموحد.
     - `URI`: يحلل مسار URL/الطلب الوارد.
     - `Router`: يربط URL بوحدة تحكم/دالة (مثل `/users/profile` → وحدة تحكم Users، دالة profile).
     - `Output`: يتعامل مع عرض الاستجابة (HTML، JSON، إلخ.).
   - **فحص الذاكرة المخبأة**: إذا كان هناك ذاكرة مخبأة صالحة لهذا الطلب، فإنه يتخطى الباقي ويخرج النسخة المخبأة مباشرة (لتحسين الأداء).
   - **المزيد من الفئات**: يحمل `Security` (الحماية من CSRF/XSS)، و `Input` (تنقية بيانات GET/POST)، و `Lang` (اللغة/التوطين).

### 9. **تحميل وحدة التحكم وفحوصات السلامة**
   - يحدد دالة عامة `get_instance()` (تُرجع كائن وحدة التحكم الرئيسي).
   - يحمل `Controller.php` الأساسي وأي فئة فرعية (وحدة تحكم ممتدة من تطبيقك).
   - **فحوصات السلامة**: يتأكد من وجود وحدة التحكم/الدالة المطلوبة وأنها صالحة:
     - يتحقق مما إذا كانت فئة وحدة التحكم موجودة (مثل `Users.php`).
     - يتأكد من أن الدالة ليست خاصة (بادئة `_`) أو محددة مسبقًا في `CI_Controller`.
     - إذا كان يستخدم `_remap`، فإنه يعدل التوجيه.
     - إذا كانت غير صالحة، يضع علم خطأ 404.
   - **معالجة خطأ 404**: إذا كان `$e404` صحيحًا، فإنه يحاول استخدام مسار `404_override` (من التهيئة) أو يعرض صفحة 404.
   - يوقف القياس المعياري لـ "loading_time".

### 10. **تنفيذ الطلب**
   - يستدعي خطاف `pre_controller`.
   - **إنشاء مثيل لوحدة التحكم**: ينشئ مثيلاً لفئة وحدة التحكم المطلوبة (مثل `$CI = new Users();`).
   - يستدعي خطاف `post_controller_constructor`.
   - **استدعاء الدالة**: يستخدم `call_user_func_array()` لتنفيذ دالة وحدة التحكم (مثل `profile()`) مع المعاملات من URL.
   - يقيس وقت تنفيذ وحدة التحكم.
   - يستدعي خطاف `post_controller`.

### 11. **الإخراج والتنظيف**
   - إذا لم يحظره خطاف `display_override`، فإنه يستخدم `Output` لإرسال الاستجابة النهائية إلى المتصفح (مثل عرض view/html).
   - يستدعي خطاف `post_system`.
   - ينتهي السكريبت هنا — يتعامل PHP مع الباقي (إرسال الإخراج).

### المفاهيم الأساسية وكيفية تجميعها معًا
- **نمط MVC**: يتبع CodeIgniter النمط Model-View-Controller. يقوم هذا السكريبت بالتوجيه إلى Controller (منطقك)، والذي قد يحمل Model (البيانات/قاعدة البيانات) و View (قالب/إخراج).
- **الخطاطيف**: تسمح بالقابلية للتوسعة — مثل تشغيل كود مخصص قبل/بعد أجزاء من التدفق.
- **الوعي بالبيئة**: يتحقق من `ENVIRONMENT` (مثل 'production') لتحميل تهيئات محددة للبيئة.
- **الأداء**: يستخدم التحميل البطيء (يتم إنشاء الفئات فقط عند الحاجة) والذاكرة المخبأة للحفاظ على السرعة.
- **الأخطاء الشائعة**: إذا تعطل شيء ما (مثل 404)، فغالبًا ما يكون بسبب مسارات غير مهيأة بشكل صحيح، أو وحدات تحكم مفقودة، أو مسارات ملفات لا تطابق `APPPATH`.
- **ملاحظة حول الإصدار**: هذا من CodeIgniter 3.x. الإصدارات الأحدث (4.x) لها هيكل مختلف.

إذا تم تشغيل هذا السكريبت بنجاح، فإن تطبيقك يتم تحميله. يمكن التحقق من الأخطاء المسجلة هنا في السجلات. للغوص بشكل أعمق، راجع [وثائق CodeIgniter الرسمية](https://codeigniter.com/user_guide/general/index.html). إذا كنت تقصد شيئًا محددًا (مثل "كيف يعمل التوجيه؟")، قدم المزيد من التفاصيل!