---
audio: false
generated: true
lang: ar
layout: post
title: ูุดููุฉ ูููู ุงูุงูุชุดุงุฑ ุงููุณุชูุฑ
translated: true
type: note
---

ุงุณุชูุงุฏูุง ุฅูู ุงูุฎุทุฃ ูุจูุฆุชูุ ุฅููู ููููุฉ ุฅุตูุงุญ ูุดููุฉ "ูุฎุทุท ุบูุฑ ูุนุฑูู ูุนููุงู ุงููููู":

### ุงูุญู:
ูุญุฏุซ ูุฐุง ุงูุฎุทุฃ ูุฃู **`httpx` ูุง ูุฏุนู ูููุงุก `socks://` ุงูุชุฑุงุถููุง**. ูุฏูู ุฎูุงุฑุงู:

#### ุงูุฎูุงุฑ 1: ุฅุฒุงูุฉ ุงูุฅุดุงุฑุฉ ุฅูู ูููู SOCKS
1. ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุฎุงุตุฉ ุจู ุจุญุซูุง ุนู ุฅุนุฏุงุฏุงุช ุงููููู ุงูุดุงุฑุฏุฉ:
   ```bash
   env | grep -i proxy
   ```
   ุงุจุญุซ ุนู ุงูุฅุดุงุฑุงุช ุฅูู `socks://` (ุฎุงุตุฉ `ALL_PROXY` ุฃู `http_proxy`).

2. ุฃูุบ ุชุนููู ุงููุชุบูุฑ ุงููุดูู (ุงุณุชุจุฏู `VAR_NAME` ุจุงูุงุณู ุงููุนูู ุงูุฐู ูุฌุฏุชู ุฃุนูุงู):
   ```bash
   unset VAR_NAME  # ูุซุงู: unset ALL_PROXY
   ```

#### ุงูุฎูุงุฑ 2: ุฅุถุงูุฉ ุฏุนู SOCKS ุฅูู `httpx`
1. ูุนูู ุจูุฆุฉ Python ุงูุงูุชุฑุงุถูุฉ ุงูุฎุงุตุฉ ุจู:
   ```bash
   source /home/lzw/Projects/stable-diffusion-webui/venv/bin/activate
   ```

2. ูู ุจุชุซุจูุช ุงูุชุจุนูุงุช ุงููุทููุจุฉ:
   ```bash
   pip install -U "httpx[socks]"
   ```

3. ุฎุฑุฌ ูู ุงูุจูุฆุฉ:
   ```bash
   deactivate
   ```

### ููุงุฐุง ูุญุฏุซ ูุฐุง:
- ุชุณุชุฎุฏู ูููุงุฆู ุงูุฑุฆูุณููู (`HTTP_PROXY/HTTPS_PROXY`) `http://` (ูุฏุนูู)ุ ูููู ุดูุฆูุง ูุง (ุนูู ุงูุฃุฑุฌุญ ุชุทุจูู ุฃู ุจุฑูุงูุฌ ูุตู ุขุฎุฑ) ูููู ุจุชุนููู ูููู `socks://` ูุง ูููู ูู `httpx` ุงูุชุนุงูู ูุนู ุจุฏูู ุญุฒู ุฅุถุงููุฉ.
- ููุธูุฑ ุชุชุจุน ุงูููุฏุณ ุฃู Gradio/`httpx` ูุญุงูู ุงุณุชุฎุฏุงู `socks://127.0.0.1:7891`ุ ูุงูุฐู ูู ูุธูุฑ ูู ูุงุชุฌ `checkproxy` ุงูุฎุงุต ุจู.

### ุงูุชุญูู:
ุจุนุฏ ุงูุฅุตูุงุญุ ุดุบูู:
```bash
./webui.sh
```
ูุฌุจ ุฃู ูุฎุชูู ุฎุทุฃ ูููู SOCKS.

> ๐ก **ููุงุญุธุฉ**: ุฅุฐุง ูู ุชูู ุจุชุนููู ูููู SOCKS ุนู ูุตุฏุ ูุชุญูู ูู ุงูุชุทุจููุงุช ุงูุชู ูุฏ ุชูููุฆ ุงููููุงุก ุชููุงุฆููุง (ูุซู ุดุจูุงุช VPNุ ุฃู ูุฏูุฑู ุงูุดุจูุฉุ ุฃู ูููุงุช ุชููุฆุฉ shell ูุซู `~/.bashrc`).

---

ูุดูุฑ ุงูุฎุทุฃ `Torch is not able to use GPU; add --skip-torch-cuda-test to COMMANDLINE_ARGS variable to disable this check` ุฅูู ุฃู PyTorchุ ุงูุฐู ุชุณุชุฎุฏูู ูุงุฌูุฉ ุงูููุจ ูู Stable Diffusionุ ูุง ููููู ุงูุชุดุงู ุฃู ุงููุตูู ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ ูุชูุงููุฉ. ููุฑุฌุญ ุฃู ูููู ูุฐุง ุจุณุจุจ ููุฏุงู ููุชุจุงุช CUDAุ ุฃู ูุฌูุฏ ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ ุบูุฑ ูุชูุงููุฉุ ุฃู ูุดุงูู ูู ุจุฑุงูุฌ ุงูุชุดุบููุ ุฃู ูุดููุฉ ูู ุงูุชููุฆุฉ. ูููุง ููู ุฎุทูุงุช ุฅุตูุงุญ ูุฐู ุงููุดููุฉุ ูุฎุตุตุฉ ูุจูุฆุชู (glibc 2.35, Python 3.10.12, GCC 11.4.0ุ ููุฑุฌุญ Ubuntu 22.04 ุจูุงุกู ุนูู ุฅุตุฏุงุฑ glibc).

### ุฎุทูุงุช ุฅุตูุงุญ ุงููุดููุฉ

#### 1. **ุงูุชุญูู ูู ุชูุงูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ู CUDA**
   - **ุชุญูู ููุง ุฅุฐุง ูุงู ูุฏูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ ูู NVIDIA**:
     ุดุบูู:
     ```bash
     lspci | grep -i nvidia
     ```
     ูุณุฑุฏ ูุฐุง ุงูุฃุฌูุฒุฉ ูู NVIDIA. ุฅุฐุง ูู ูุธูุฑ ุฃู ูุงุชุฌุ ููุฏ ูุง ูุญุชูู ูุธุงูู ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ ูู NVIDIAุ ููุชุทูุจ PyTorch ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ ูู NVIDIA ูุฏุนู CUDA.
   - **ุชุญูู ูู ุชุซุจูุช ุจุฑูุงูุฌ ุชุดุบูู NVIDIA**:
     ุดุบูู:
     ```bash
     nvidia-smi
     ```
     ุฅุฐุง ูุงู ูุซุจุชูุงุ ูุณููุนุฑุถ ุฌุฏูููุง ูุญุชูู ุนูู ุชูุงุตูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ (ูุซู ุฅุตุฏุงุฑ ุจุฑูุงูุฌ ุงูุชุดุบููุ ุฅุตุฏุงุฑ CUDA). ุฅุฐุง ูู ููู ูุซุจุชูุงุ ููู ุจุชุซุจูุช ุจุฑูุงูุฌ ุชุดุบูู NVIDIA:
     ```bash
     sudo apt-get update
     sudo apt-get install nvidia-driver-<version> nvidia-utils-<version> -y
     ```
     ุงุณุชุจุฏู `<version>` ุจุฃุญุฏุซ ุฅุตุฏุงุฑ ูุณุชูุฑ ูุจุฑูุงูุฌ ุงูุชุดุบูู (ูุซู `535` ุฃู `550`). ุงุจุญุซ ุนู ุฅุตุฏุงุฑ ุจุฑูุงูุฌ ุงูุชุดุบูู ุงูููุงุณุจ ุจุงุณุชุฎุฏุงู:
     ```bash
     ubuntu-drivers devices
     sudo ubuntu-drivers autoinstall
     ```
   - **ุชุญูู ูู ุฅุตุฏุงุฑ CUDA**:
     ูุชุทูุจ PyTorch ููุชุจุงุช CUDA. ุชุญูู ูู ุฅุตุฏุงุฑ CUDA ุงููุซุจุช:
     ```bash
     nvcc --version
     ```
     ุฅุฐุง ูู ููู ูุซุจุชูุงุ ููู ุจุชุซุจูุช CUDA Toolkit:
     ```bash
     sudo apt-get install nvidia-cuda-toolkit -y
     ```
     ุจุฏูุงู ูู ุฐููุ ููููู ุชูุฒูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ูู CUDA Toolkit ูู ูููุน NVIDIA (ูุซู CUDA 11.8 ุฃู 12.1) ูุงุชุจุน ุฏููู ุงูุชุซุจูุช ุงูุฎุงุต ุจูู.

#### 2. **ุงูุชุญูู ูู ุชุซุจูุช PyTorch**
   ูุดูุฑ ุงูุฎุทุฃ ุฅูู ุฃู PyTorch ูุซุจุช ููููู ูุง ููููู ุงุณุชุฎุฏุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ. ุชุฃูุฏ ูู ุฃู ูุฏูู ุงูุฅุตุฏุงุฑ ุงูุตุญูุญ ูู PyTorch ูุน ุฏุนู CUDA.
   - **ุชุญูู ูู ุชุซุจูุช PyTorch**:
     ุดุบูู:
     ```bash
     python3 -c "import torch; print(torch.__version__); print(torch.cuda.is_available())"
     ```
     ูุฌุจ ุฃู ูุชุถูู ุงููุงุชุฌ ุงููุชููุน ุฅุตุฏุงุฑ PyTorch (ูุซู `2.0.1`) ู `True` ูู `torch.cuda.is_available()`. ุฅุฐุง ูุงูุช `False`ุ ูุฅู PyTorch ูุง ููุชุดู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ.
   - **ุฃุนุฏ ุชุซุจูุช PyTorch ูุน ุฏุนู CUDA**:
     ุจุงููุณุจุฉ ูู Python 3.10 ู CUDA (ูุซู 11.8)ุ ูู ุจุชุซุจูุช PyTorch ูู ุจูุฆุฉ Stable Diffusion ุงูุฎุงุตุฉ ุจู:
     ```bash
     cd /home/lzw/Projects/stable-diffusion-webui
     source venv/bin/activate
     pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
     ```
     ุงุณุชุจุฏู `cu118` ุจุฅุตุฏุงุฑ CUDA ุงูุฎุงุต ุจู (ูุซู `cu121` ูู CUDA 12.1). ุชุญูู ูู ุงูุฅุตุฏุงุฑุงุช ุงููุฏุนููุฉ ูู ุงููููุน ุงูุฑุณูู ูู PyTorch.
   - **ุชุญูู ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุซุจูุช**:
     ูู ุจุชุดุบูู ุงููุญุต ูุฑุฉ ุฃุฎุฑู:
     ```bash
     python3 -c "import torch; print(torch.cuda.is_available()); print(torch.cuda.get_device_name(0))"
     ```

#### 3. **ุชุฌุงูุฒ ูุญุต CUDA (ุญู ูุคูุช)**
   ุฅุฐุง ููุช ุชุฑูุฏ ุชุดุบูู Stable Diffusion ุจุฏูู ุฏุนู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ (ูุซููุง ููุงุฎุชุจุงุฑ ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ)ุ ูุชุฌุงูุฒ ูุญุต CUDA ุนู ุทุฑูู ุฅุถุงูุฉ `--skip-torch-cuda-test` ุฅูู ูุณุงุฆุท ุณุทุฑ ุงูุฃูุงูุฑ.
   - ุญุฑุฑ `webui-user.sh` (ุฃู ุฃูุดุฆู ุฅุฐุง ูู ููู ููุฌูุฏูุง):
     ```bash
     nano /home/lzw/Projects/stable-diffusion-webui/webui-user.sh
     ```
     ุฃุถู ุฃู ุนุฏูู ุณุทุฑ `COMMANDLINE_ARGS`:
     ```bash
     export COMMANDLINE_ARGS="--skip-torch-cuda-test"
     ```
     ุงุญูุธ ุงูููู ูุงุฎุฑุฌ.
   - ุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู:
     ```bash
     ./webui.sh
     ```
     ูุฐุง ูุณูุญ ูู Stable Diffusion ุจุงูุนูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉุ ูููู ุงูุฃุฏุงุก ุณูููู ุฃุจุทุฃ ุจุดูู ููุญูุธ.

#### 4. **ุชุฃูุฏ ูู ุชููุฆุฉ TCMalloc ุจุดูู ุตุญูุญ**
   ููุธูุฑ ูุงุชุฌู ุฃู TCMalloc (`libtcmalloc_minimal.so.4`) ุชู ุงูุชุดุงูู ูุฑุจุทู ุจู `LD_PRELOAD`. ุชุฃูุฏ ูู ุฃูู ูุนูู:
   ```bash
   echo $LD_PRELOAD
   ```
   ุฅุฐุง ุฃุฎุฑุฌ `/lib/x86_64-linux-gnu/libtcmalloc_minimal.so.4`ุ ูุฃูุช ุฌุงูุฒ. ุฅุฐุง ูู ููู ูุฐููุ ููู ุจุชุนูููู ูุฏูููุง:
   ```bash
   export LD_PRELOAD=/lib/x86_64-linux-gnu/libtcmalloc_minimal.so.4
   ```
   ุฃู ุฃุถูู ุฅูู `webui-user.sh`:
   ```bash
   export LD_PRELOAD=/lib/x86_64-linux-gnu/libtcmalloc_minimal.so.4
   ```

#### 5. **ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูุงููุณุงุฑุงุช**
   ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ุจูุฆุชู ุจุดูู ุตุญูุญ:
   - **ุชุญูู ูู LD_LIBRARY_PATH**:
     ูุฌุจ ุฃู ุชููู ููุชุจุงุช CUDA ูุงุจูุฉ ูููุตูู. ุฃุถููุง ุฅุฐุง ูุฒู ุงูุฃูุฑ:
     ```bash
     export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
     ```
     ุฃุถู ูุฐุง ุฅูู `~/.bashrc` ุฃู `webui-user.sh` ููุงุณุชูุฑุงุฑูุฉ.
   - **ูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ**:
     ุฏุงุฆููุง ูุนูู ุจูุฆุฉ Stable Diffusion ุงูุงูุชุฑุงุถูุฉ ูุจู ุงูุชุดุบูู:
     ```bash
     cd /home/lzw/Projects/stable-diffusion-webui
     source venv/bin/activate
     ```

#### 6. **ุญุฏูุซ ูุงุฌูุฉ ุงูููุจ ูู Stable Diffusion**
   ูุฏ ูููู ูุฅุตุฏุงุฑู (`v1.10.1`ุ commit `82a973c`) ูุดุงูู ุชูุงูู. ุญุฏูุซ ุฅูู ุฃุญุฏุซ ุฅุตุฏุงุฑ:
   ```bash
   cd /home/lzw/Projects/stable-diffusion-webui
   git pull
   ```
   ุซูุ ุฃุนุฏ ุชุซุจูุช ุงูุชุจุนูุงุช:
   ```bash
   ./webui.sh
   ```

#### 7. **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง**
   - **ุฅุฐุง ูุดู `nvidia-smi`**: ุฃุนุฏ ุชุซุจูุช ุจุฑูุงูุฌ ุชุดุบูู NVIDIA ุฃู ุชุญูู ูู ูุฌูุฏ ูุดุงูู ูู ุฃุฌูุฒุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ.
   - **ุฅุฐุง ูู ููุชุดู PyTorch ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ุจุนุฏ**:
     - ุชุฃูุฏ ูู ุชุซุจูุช CUDA ู cuDNN ุจุดูู ุตุญูุญ. ูู ุจุชุซุจูุช cuDNN ุฅุฐุง ูุงู ููููุฏูุง:
       ```bash
       sudo apt-get install libcudnn8
       ```
     - ุชุญูู ูู ุชูุงูู ุฅุตุฏุงุฑ CUDA ูุน ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ุงูุฎุงุตุฉ ุจู ู PyTorch. ุนูู ุณุจูู ุงููุซุงูุ ูุฏ ูุง ุชุฏุนู ูุญุฏุงุช ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ุงููุฏููุฉ (ูุซู ุณูุณูุฉ Kepler) CUDA 12.
   - **ุฅุฐุง ุงุณุชูุฑุช ุงูุฃุฎุทุงุก**: ุชุญูู ูู ุณุฌูุงุช Stable Diffusion ููุญุตูู ุนูู ุฃุฎุทุงุก ููุตูุฉ:
     ```bash
     cat /home/lzw/Projects/stable-diffusion-webui/log/webui.log
     ```
     ุดุงุฑู ุฃู ุฃุฎุทุงุก ูุญุฏุฏุฉ ููุฒูุฏ ูู ุงููุณุงุนุฏุฉ.
   - **ูููุฏ ุงูุฃุฌูุฒุฉ**: ุฅุฐุง ูุงูุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ุงูุฎุงุตุฉ ุจู ูุฏููุฉ ุฌุฏูุง (ูุซู ูุญุฏุงุช ูุนุงูุฌุฉ ุฑุณูููุฉ NVIDIA ูุจู ุนุงู 2016)ุ ููุฏ ูุง ุชุฏุนู ุฅุตุฏุงุฑุงุช CUDA ุงูุญุฏูุซุฉ. ูู ูุฐู ุงูุญุงูุฉุ ุงุณุชุฎุฏู `--skip-torch-cuda-test` ุฃู ูู ุจุชุฑููุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ุงูุฎุงุตุฉ ุจู.

#### 8. **ุชุดุบูู ุงูุชุทุจูู**
   ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญุงุชุ ุดุบูู ูุงุฌูุฉ ุงูููุจ:
   ```bash
   cd /home/lzw/Projects/stable-diffusion-webui
   ./webui.sh
   ```
   ุฅุฐุง ููุช ุจุฅุตูุงุญ ูุดููุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉุ ููุฌุจ ุฃู ูุฎุชูู ุงูุฎุทุฃ. ุฅุฐุง ููุช ุชุณุชุฎุฏู `--skip-torch-cuda-test`ุ ูุณูุนูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.

### ููุงุญุธุงุช
- **ูุนูููุงุช ุงููุธุงู**: ูุดูุฑ ุฅุนุฏุงุฏู (glibc 2.35, Python 3.10.12, GCC 11.4.0) ุฅูู Ubuntu 22.04ุ ููู ูุชูุงูู ูุน ุฅุตุฏุงุฑุงุช CUDA 11.8 ุฃู 12.1 ูุฅุตุฏุงุฑุงุช PyTorch ุงูุญุฏูุซุฉ.
- **ุงูุฃุฏุงุก**: ุงูุชุดุบูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (ุจุงุณุชุฎุฏุงู `--skip-torch-cuda-test`) ูู ุญู ุจุฏูู ููููู ุณูููู ุจุทูุฆูุง. ูููุตู ุจุฅุตูุงุญ ุฏุนู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉ ูู Stable Diffusion.
- **TCMalloc**: ูุจุฏู ุฃู ูุดููุฉ TCMalloc ูุฏ ุญูููุช ุจูุงุกู ุนูู ูุงุชุฌู. ุชุฃูุฏ ูู ุจูุงุก `LD_PRELOAD` ูุนูููุง ุฅุฐุง ูุงุฌูุช ูุดุงูู ูุชุนููุฉ ุจุงูุฐุงูุฑุฉ.

ุฅุฐุง ููุช ูุง ุชุฒุงู ุชูุงุฌู ูุดุงูู ุฃู ุชุญุชุงุฌ ุฅูู ูุณุงุนุฏุฉ ูู ุฑุณุงุฆู ุฎุทุฃ ูุญุฏุฏุฉุ ูุฑุฌู ุชูุฏูู ุชูุงุตูู ุฅุถุงููุฉ (ูุซู ุทุฑุงุฒ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงูุฑุณูููุฉุ ุฅุตุฏุงุฑ CUDAุ ุฃู ุงูุณุฌูุงุช ุงููุงููุฉ)ุ ููููููู ุชุญุณูู ุงูุญู!