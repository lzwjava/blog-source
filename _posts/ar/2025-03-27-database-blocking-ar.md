---
audio: false
generated: true
lang: ar
layout: post
title: منع قاعدة البيانات
translated: true
type: note
---

أفترض أنك تطلب أمثلة على حظر قاعدة البيانات في سياق أنظمة إدارة قواعد البيانات (DBMS). يحدث الحظر عندما تمنع معاملة واحدة في قاعدة البيانات معاملة أخرى من المتابعة لأنها تحاول الوصول إلى نفس البيانات أو تعديلها في وقت واحد. يتم إدارة هذا عادةً باستخدام الأقفال لضمان اتساق وسلامة البيانات. فيما يلي بعض الأمثلة على سيناريوهات حظر قاعدة البيانات:

---

### المثال 1: الحظر بين القراءة والكتابة
- **السيناريو**: المعاملة T1 تقوم بتحديد صف في جدول (مثل تغيير رصيد عميل)، والمعاملة T2 تحاول قراءة نفس ذلك الصف.
- **ما يحدث**: تكتسب T1 قفلًا حصريًا على الصف لتمنع المعاملات الأخرى من قراءته أو تعديله حتى يكتمل التحديث. يتم حظر T2 ويجب أن تنتظر حتى تقوم T1 بالإقفال أو التراجع.
- **مثال SQL**:
  ```sql
  -- المعاملة T1
  BEGIN TRANSACTION;
  UPDATE Accounts SET Balance = Balance - 100 WHERE AccountID = 1;

  -- المعاملة T2 (محظورة)
  SELECT Balance FROM Accounts WHERE AccountID = 1;
  ```
  تنتظر T2 حتى تنتهي T1 بسبب القفل الحصري على الصف.

---

### المثال 2: الحظر بين الكتابة والكتابة
- **السيناريو**: المعاملة T1 تقوم بتحديث كمية المخزون لمنتج ما، والمعاملة T2 تحاول تحديث مخزون نفس المنتج في نفس الوقت.
- **ما يحدث**: تحتفظ T1 بقفل حصري على الصف، ويتم حظر T2 حتى تكتمل T1. هذا يمنع التحديثات المتضاربة التي قد تؤدي إلى عدم اتساق البيانات.
- **مثال SQL**:
  ```sql
  -- المعاملة T1
  BEGIN TRANSACTION;
  UPDATE Products SET Stock = Stock - 5 WHERE ProductID = 100;

  -- المعاملة T2 (محظورة)
  UPDATE Products SET Stock = Stock + 10 WHERE ProductID = 100;
  ```
  يتم حظر T2 حتى تقوم T1 بالإقفال أو التراجع.

---

### المثال 3: الجمود (الحظر المؤدي إلى طريق مسدود)
- **السيناريو**: المعاملة T1 تقفل الصف A وتحتاج إلى تحديث الصف B، بينما المعاملة T2 تقفل الصف B وتحتاج إلى تحديث الصف A.
- **ما يحدث**: يتم حظر T1 بواسطة قفل T2 على الصف B، ويتم حظر T2 بواسطة قفل T1 على الصف A. هذا يخلق حالة جمود، ويجب على نظام إدارة قواعد البيانات التدخل (مثلًا، عن طريق التراجع عن إحدى المعاملات).
- **مثال SQL**:
  ```sql
  -- المعاملة T1
  BEGIN TRANSACTION;
  UPDATE Table1 SET Value = 10 WHERE ID = 1;  -- تقفل الصف A
  UPDATE Table2 SET Value = 20 WHERE ID = 2;  -- محظورة بواسطة T2

  -- المعاملة T2
  BEGIN TRANSACTION;
  UPDATE Table2 SET Value = 30 WHERE ID = 2;  -- تقفل الصف B
  UPDATE Table1 SET Value = 40 WHERE ID = 1;  -- محظورة بواسطة T1
  ```
  لا يمكن لأي من المعاملتين المتابعة حتى يحل نظام إدارة قواعد البيانات حالة الجمود.

---

### المثال 4: الحظر على مستوى الجدول
- **السيناريو**: المعاملة T1 تقوم بتحديث كبير على جدول بأكمله دون وجود فهرسة مناسبة، والمعاملة T2 تحاول قراءة صف واحد من نفس الجدول.
- **ما يحدث**: قد ترفع T1 أقفالها على مستوى الصف إلى قفل على مستوى الجدول، مما يحجب T2 من قراءة حتى الصفوف غير المرتبطة حتى تكتمل T1.
- **مثال SQL**:
  ```sql
  -- المعاملة T1
  BEGIN TRANSACTION;
  UPDATE Employees SET Salary = Salary * 1.1;  -- تقفل الجدول بأكمله

  -- المعاملة T2 (محظورة)
  SELECT Name FROM Employees WHERE EmployeeID = 5;
  ```
  يتم حظر T2 لأن T1 لديها قفل حصري على مستوى الجدول.

---

### كيف تتم إدارة الحظر
- **الأقفال**: تستخدم قواعد البيانات أقفالًا مشتركة (للقراءة) وأقفالًا حصرية (للكتابة) للتحكم في الوصول.
- **مستويات العزل**: تزيد مستويات العزل الأعلى (مثل Serializable) من الحظر لضمان الاتساق، بينما تقلل المستويات الأقل (مثل Read Uncommitted) من الحظر ولكنها تخاطر بالقراءات غير النظيفة.
- **المهلات**: يمكن أن تنتهي مهلة المعاملات إذا تم حظرها لفترة طويلة جدًا، مما يجبر على التراجع.
- **كشف الجمود**: يكشف نظام إدارة قواعد البيانات عن حالات الجمود ويحلها عن طريق إنهاء إحدى المعاملات.

دعني أعلم إذا كنت تريد المزيد من التفاصيل أو أمثلة محددة لنظام معين لقاعدة البيانات (مثل MySQL أو PostgreSQL أو SQL Server)!