---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: دليل فحص السجلات في كيبانا
translated: true
type: note
---

كيبانا هو أداة مفتوحة المصدر لتصور واستكشاف البيانات طورتها إلاستك. وهو مكون أساسي في **مجموعة ELK** (إلاستيك سيرش، لوجستاش، كيبانا)، التي تُستخدم على نطاق واسع للتسجيل المركزية والمراقبة والتحليلات. يوفر كيبانا واجهة ويب للتفاعل مع البيانات المخزنة في إلاستيك سيرش، مما يسمح لك بالبحث وتصور وتحليل السجلات في الوقت الفعلي. إنه قوي بشكل خاص للتحقق من السجلات من التطبيقات أو الخوادم أو خدمات السحابة.

يركز هذا الدليل على استخدام كيبانا لفحص واستعلام السجلات. سنغطي الإعداد والاستخدام الأساسي وسير عمل فحص السجلات والنصائح المتقدمة. افترض أنك تعمل مع إعداد أساسي لـ ELK؛ إذا كنت جديدًا في ELK، ابدأ بتثبيت إلاستيك سيرش ولوجستاش أولاً (كيبانا يتطلب إلاستيك سيرش ليعمل).

## 1. المتطلبات الأساسية
قبل استخدام كيبانا:
- **إلاستيك سيرش**: الإصدار 8.x أو أحدث (كيبانا مرتبط بشكل وثيق بإصدارات إلاستيك سيرش). حمله من [elastic.co](https://www.elastic.co/downloads/elasticsearch).
- **جافا**: إلاستيك سيرش يتطلب JDK 11 أو أحدث.
- **متطلبات النظام**: 4 جيجابايت من الذاكرة العشوائية على الأقل للتطوير؛ والمزيد للبيئة الإنتاجية.
- **مصدر البيانات**: السجلات التي تم استهلاكها عبر لوجستاش، أو Filebeat، أو مباشرة إلى إلاستيك سيرش (مثل تنسيق JSON مع الطوابع الزمنية).
- **وصول الشبكة**: كيبانا يعمل على المنفذ 5601 افتراضيًا؛ تأكد من إمكانية الوصول إليه.

إذا لم يكن لديك سجلات بعد، استخدم أدوات مثل Filebeat لإرسال سجلات عينة (مثل سجلات النظام) إلى إلاستيك سيرش.

## 2. تثبيت كيبانا
تثبيت كيبانا مباشر ولا يعتمد على المنصة. حمّل أحدث إصدار من [elastic.co/downloads/kibana](https://www.elastic.co/downloads/kibana) (طابقه مع إصدار إلاستيك سيرش الخاص بك).

### على لينكس (ديبيان/أوبونتو):
1. أضف مستودع إلاستك:
   ```
   wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
   sudo apt-get install apt-transport-https
   echo "deb https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list
   sudo apt-get update && sudo apt-get install kibana
   ```
2. ابدأ كيبانا:
   ```
   sudo systemctl start kibana
   sudo systemctl enable kibana  # للبدء التلقائي عند الإقلاع
   ```

### على ويندوز:
1. حمّل أرشيف ZIP واستخرجه إلى `C:\kibana-8.x.x-windows-x86_64`.
2. افتح موجه الأوامر كمسؤول وانتقل إلى المجلد المستخرج.
3. شغّل: `bin\kibana.bat`

### على macOS:
1. استخدم Homebrew: `brew tap elastic/tap && brew install elastic/tap/kibana-full`.
2. أو حمّل TAR.GZ، واستخرجه، وشغّل `./bin/kibana`.

لـ Docker: استخدم الصورة الرسمية:
```
docker run --name kibana -p 5601:5601 -e ELASTICSEARCH_HOSTS=http://elasticsearch:9200 docker.elastic.co/kibana/kibana:8.10.0
```

## 3. التهيئة الأساسية
قم بتحرير ملف التهيئة `kibana.yml` (الموجود في `/etc/kibana/` على لينكس، أو مجلد `config/` على الأنظمة الأخرى).

الإعدادات الرئيسية لفحص السجلات:
```yaml
# الاتصال بـ إلاستيك سيرش (الافتراضي هو localhost:9200)
elasticsearch.hosts: ["http://localhost:9200"]

# إعدادات الخادم
server.port: 5601
server.host: "0.0.0.0"  # الربط بجميع الواجهات للوصول عن بُعد

# الأمان (فعّله للبيئة الإنتاجية)
# elasticsearch.username: "elastic"
# elasticsearch.password: "your_password"

# التسجيل
logging.verbose: true  # لتصحيح أخطاء كيبانا نفسه

# نمط الفهرس (افتراضي اختياري)
defaultIndex: "logs-*"
```
- أعد تشغيل كيبانا بعد التغييرات: `sudo systemctl restart kibana`.
- إذا كنت تستخدم ميزات الأمان (X-Pack)، فقم بتوليد الشهادات أو استخدم المصادقة الأساسية.

## 4. بدء كيبانا والوصول إليه
- ابدأ إلاستيك سيرش أولاً (مثل `sudo systemctl start elasticsearch`).
- ابدأ كيبانا كما ورد أعلاه.
- افتح متصفح ويب واذهب إلى `http://localhost:5601` (أو IP الخادم الخاص بك:5601).
- عند أول تسجيل دخول، سترى معالج الإعداد. أنشئ مستخدمًا مسؤولاً إذا طُلب منك (الافتراضي: elastic/changeme).

تتضمن الواجهة تطبيقات مثل **Discover** (للسجلات)، و **Visualize**، و **Dashboard**، و **Dev Tools**، و **Management**.

## 5. تحضير البيانات: أنماط الفهرس
يتم تخزين السجلات في إلاستيك سيرش في **فهارس** (مثل `logs-2023-10-01`). لاستعلامها في كيبانا، أنشئ **نمط فهرس**.

1. انتقل إلى **Stack Management** > **Index Patterns** (الشريط الجانبي الأيسر، قائمة Hamburger > Management).
2. انقر على **Create index pattern**.
3. أدخل نمطًا مثل `logs-*` (يطابق جميع فهارس السجلات) أو `filebeat-*` (لسجلات Filebeat).
4. اختر **حقل الوقت** (مثل `@timestamp` للطوابع الزمنية للسجلات—أمر بالغ الأهمية للاستعلامات المستندة إلى الوقت).
5. انقر على **Create index pattern**.
   - يعين هذا حقولاً مثل `message` (نص السجل)، و `host.name`، و `level` (خطأ/تحذير/معلومة)، إلخ.

حدث الحقول إذا تغيرت سجلاتك. استخدم **Discover** للمعاينة.

## 6. استخدام Discover لفحص السجلات
تطبيق **Discover** هو أداتك الأساسية لفحص السجلات. إنه مثل عارض سجلات قابل للبحث.

### التنقل الأساسي:
1. انقر على **Discover** في الشريط الجانبي الأيسر.
2. اختر نمط الفهرس الخاص بك من القائمة المنسدلة (أعلى اليسار).
3. عيّن نطاق الوقت (أعلى اليمين): استخدم خيارات سريعة مثل "Last 15 minutes" أو مخصص (مثل Last 7 days). يقوم هذا بتصفية السجلات حسب `@timestamp`.

### عرض السجلات:
- **عدد النتائج**: يظهر إجمالي السجلات المطابقة (مثل 1,234 نتيجة).
- **جدول المستندات**: يعرض إدخالات السجلات الخام كـ JSON أو نص منسق.
  - الأعمدة: الافتراضي هو `@timestamp` و `_source` (السجل الكامل). اسحب الحقول من الشريط الجانبي الأيسر (مثل `message`، `host.name`) لإضافة أعمدة.
  - وسّع صفًا (انقر على السهم) لرؤية مستند JSON الكامل.
- **الرسم البياني**: يظهر المخطط العلوي حجم السجلات عبر الوقت. كبّر بالسحب.

### البحث في السجلات:
استخدم شريط البحث (أعلى) للاستعلامات. يستخدم كيبانا **KQL (لغة استعلام كيبانا)** افتراضيًا—وهي بسيطة وبديهية.

- **البحث الأساسي**:
  - ابحث عن كلمة مفتاحية: `error` (يجد السجلات التي تحتوي على "error").
  - محدد بالحقل: `host.name:webserver AND level:error` (سجلات من "webserver" بمستوى خطأ).
  - العبارات: `"user login failed"` (مطابقة تامة).

- **المرشحات**:
  - أضف من الشريط الجانبي: انقر على قيمة حقل (مثل `level: ERROR`) > Add filter (يثبته على الاستعلام).
  - المنطق البولياني: `+error -info` (يجب أن يحتوي على "error"، استثني "info").
  - النطاق: للأرقام/الأوقات، مثل `bytes:>1000` (الحقل > 1000).

- **الاستعلامات المتقدمة**:
  - انتقل إلى **بناء جملة استعلام Lucene** (عبر القائمة المنسدلة للغة الاستعلام) للاحتياجات المعقدة: `message:(error OR warn) AND host.name:prod*`.
  - استخدم **Query DSL** في Dev Tools للاستعلامات الأصلية لـ إلاستيك سيرش (مثل POST /logs-*/_search مع جسم JSON).

### حفظ عمليات البحث:
- انقر على **Save** (أعلى اليمين) لتخزين بحث لإعادة استخدامه.
- شاركه عبر **Share** > CSV/URL للتصدير.

مثال على سير العمل: فحص سجلات التطبيق
1. استهلك السجلات (مثلًا عبر لوجستاش: إدخال ملف > مرشح grok/تحليل > إخراج إلاستيك سيرش).
2. في Discover: نطاق الوقت "Last 24 hours".
3. بحث: `app.name:myapp AND level:ERROR`.
4. أضف مرشحات: `host.name` = خادم محدد.
5. افحص: انظر إلى `message` لآثار المكدس، ورابطها مع `@timestamp`.

## 7. تصور السجلات
بينما Discover مخصص للفحص الخام، استخدم التصور للأنماط.

### إنشاء التصورات:
1. انتقل إلى **Visualize Library** > **Create new visualization**.
2. اختر النوع:
   - **Lens** (سهل): اسحب الحقول إلى المجموعات (مثل المحور X: `@timestamp`، المحور Y: عدد الأخطاء).
   - **Area/Line Chart**: لحجم السجلات عبر الوقت (المقاييس: Count، المجموعات: Date Histogram على `@timestamp`).
   - **Data Table**: ملخص جدولي للسجلات.
   - **Pie Chart**: تفصيل حسب `level` (خطأ 40%، معلومة 60%).
3. طبق المرشحات/عمليات البحث من Discover.
4. احفظ وأضف إلى **Dashboard** (Analytics > Dashboard > Create new > Add visualization).

مثال: لوحة مراقبة معدل الخطأ
- تصور: مخطط خطي لسجلات الأخطاء في الساعة.
- مرشح: نطاق وقت عام.
- تضمين في Dashboard للمراقبة.

## 8. الميزات المتقدمة لتحليل السجلات
- **التنبيهات والمراقبة**:
  - استخدم **Alerts** (Stack Management > Rules) للإشعار بأنماط السجلات (مثل البريد الإلكتروني إذا ظهرت "critical" أكثر من 5 مرات/ساعة).
  - **Uptime Monitoring** أو **APM** لسجلات التطبيقات.

- **التعلم الآلي**:
  - فعّل وظائف ML (Stack Management > Machine Learning) للكشف عن الشذوذ في أحجام السجلات.

- **Dev Tools**:
  - وحدة التحكم للاستعلامات الخام لـ إلاستيك سيرش: مثل،
    ```
    GET logs-*/_search
    {
      "query": { "match": { "message": "error" } },
      "sort": [ { "@timestamp": "desc" } ]
    }
    ```
  - اختبر أنماط الفهرس أو استهلك البيانات.

- **الأدوار والأمان**:
  - في البيئة الإنتاجية، استخدم **Spaces** لعزل عروض السجلات (مثل dev/prod).
  - الوصول القائم على الأدوار: قيّد المستخدمين لفهارس محددة.

- **التصدير/الاستيراد**:
  - صدّر عمليات البحث/لوحات المراقبة كـ NDJSON عبر **Stack Management > Saved Objects**.
  - استورد السجلات عبر **Console** أو Beats.

- **نصائح الأداء**:
  - استخدم **Field Analyzer** (Index Patterns > field) للتعيينات المخصصة.
  - رقّم النتائج الكبيرة: اضبط عدد النتائج لكل صفحة (إعدادات Discover).
  - للبيانات الضخمة، شظّف الفهارس واستخدم ILM (إدارة دورة حياة الفهرس).

## 9. التكامل مع مصادر السجلات
- **Filebeat/Logstash**: انقل السجلات إلى إلاستيك سيرش.
  - مثال تهيئة Filebeat (`filebeat.yml`):
    ```yaml
    filebeat.inputs:
    - type: log
      paths: [/var/log/*.log]
      fields:
        app: myapp
    output.elasticsearch:
      hosts: ["localhost:9200"]
      index: "logs-%{+yyyy.MM.dd}"
    ```
  - شغّل: `./filebeat -e`.
- **سجلات السحابة**: تكامل مع AWS S3، أو Azure، أو Elastic Cloud للإعدادات المدارة.

## 10. استكشاف الأخطاء وإصلاحها الشائعة
- **لا توجد بيانات في Discover**:
  - تحقق من اتصال إلاستيك سيرش: `curl localhost:9200/_cat/indices`.
  - تحقق من تطابق نمط الفهرس مع الفهارس (مثل عدم وجود عدم تطابق `*`).
  - تأكد من تعيين `@timestamp` كتاريخ.

- **كيبانا لا يبدأ**:
  - السجلات: تحقق من `/var/log/kibana/kibana.log` أو ناتج وحدة التحكم.
  - الأسباب الشائعة: المنفذ 5601 قيد الاستخدام، أو إلاستيك سيرش لا يعمل/آمن.

- **الاستعلامات البطيئة**:
  - حسّن: استخدم حقول الكلمات المفتاحية للمرشحات، وتجنب الأحرف البدلة على النصوص الكبيرة.
  - زد الذاكرة: حرر `jvm.options` لـ إلاستيك سيرش (مثل `-Xms4g -Xmx4g`).

- **أخطاء في السجلات**:
  - 403/401: مشاكل المصادقة—فعّل الأمان في `elasticsearch.yml`.
  - عدم تطابق الإصدار: تأكد من أن إصدار كيبانا == إصدار إلاستيك سيرش.

- **الموارد**:
  - الوثائق الرسمية: [elastic.co/guide/en/kibana/current](https://www.elastic.co/guide/en/kibana/current/index.html).
  - المنتديات: Elastic Discuss أو Stack Overflow.
  - بيانات عينة: حمّلها عبر كيبانا (Stack Management > Kibana > Sample Data).

يجب أن يبدأك هذا الدليل مع كيبانا لفحص السجلات. ابدأ صغيرًا: أنشئ مجموعة ELK محلية، واستهلك سجلات عينة، وجرّب في Discover. للبيئة الإنتاجية، فكر في Elastic Cloud لسهولة الاستخدام. إذا كان لديك إعداد محدد (مثل Docker، AWS)، قدم المزيد من التفاصيل للحصول على نصائح مخصصة!