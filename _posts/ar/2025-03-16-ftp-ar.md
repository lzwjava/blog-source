---
audio: false
generated: true
lang: ar
layout: post
title: خادم FTP
translated: true
type: note
---

لإعداد خادم FTP على أوبونتو حتى تتمكن من الوصول إلى ملفاتك (مثل ملفات `.mkv` الموجودة في `/var/www/movies/`) من جهاز iPad أو الأجهزة الأخرى، يمكنك استخدام **vsftpd** (خادم FTP الآمن جدًا)، وهو خيار خفيف الوزن وآمن. إليك دليلًا خطوة بخطوة مخصصًا لإعدادك:

### المتطلبات الأساسية
- أنت تستخدم أوبونتو (مثل الإصدار 22.04 أو 24.04 اعتبارًا من 15 مارس 2025).
- لديك صلاحيات `sudo`.
- خادم Nginx الخاص بك على العنوان `192.168.1.27`، والملفات موجودة في `/var/www/movies/`.

### الخطوة 1: تثبيت vsftpd
1. **تحديث قائمة الحزم**:
   ```bash
   sudo apt update
   ```
2. **تثبيت vsftpd**:
   ```bash
   sudo apt install vsftpd -y
   ```
3. **التحقق من التثبيت**:
   ```bash
   sudo systemctl status vsftpd
   ```
   - يجب أن تظهر الحالة `active (running)`. إذا لم تكن، ابدأ الخدمة:
     ```bash
     sudo systemctl start vsftpd
     sudo systemctl enable vsftpd  # للبدء التلقائي عند التشغيل
     ```

### الخطوة 2: تكوين vsftpd
ملف التكوين الافتراضي هو `/etc/vsftpd.conf`. سنقوم بتعديله للوصول الأساسي.

1. **إنشاء نسخة احتياطية للتكوين الأصلي**:
   ```bash
   sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.bak
   ```

2. **تحرير التكوين**:
   ```bash
   sudo nano /etc/vsftpd.conf
   ```
   قم بإجراء هذه التغييرات:
   - تمكين المستخدمين المحليين:
     ```bash
     local_enable=YES
     ```
   - السماح برفع الملفات (اختياري، إذا كنت تريد رفع الملفات):
     ```bash
     write_enable=YES
     ```
   - تقييد المستخدمين في مجلداتهم الرئيسية (اختياري، للأمان):
     ```bash
     chroot_local_user=YES
     ```
   - الإشارة إلى مجلد الأفلام الخاص بك (اختياري، راجع الخطوة 3 لإعداد المستخدم):
     - افتراضيًا، يصل المستخدمون إلى مجلداتهم الرئيسية. سنضبط هذا لاحقًا.

   احفظ الملف (`Ctrl + O`، Enter، `Ctrl + X`).

3. **إعادة تشغيل vsftpd**:
   ```bash
   sudo systemctl restart vsftpd
   ```

### الخطوة 3: إعداد مستخدم FTP
يمكنك استخدام مستخدم موجود أو إنشاء مستخدم جديد للوصول إلى `/var/www/movies/`.

#### الخيار 1: استخدام مستخدم موجود
إذا كنت تريد استخدام مستخدم أوبونتو الحالي (مثال: `user`):
1. **التحقق من اسم المستخدم**:
   ```bash
   whoami
   ```
2. **تعيين كلمة المرور (إذا لزم الأمر)**:
   ```bash
   sudo passwd user  # استبدل "user" باسم المستخدم الخاص بك
   ```
3. **ربط مجلد الأفلام**:
   - افتراضيًا، المجلد الرئيسي لهذا المستخدم (مثال: `/home/user/`) هو جذر FTP. للوصول إلى `/var/www/movies/`، أنشئ رابطًا رمزيًا:
     ```bash
     ln -s /var/www/movies/ /home/user/movies
     ```
   - أو، اضبط الصلاحيات (أقل أمانًا):
     ```bash
     sudo chown -R user:user /var/www/movies
     ```

#### الخيار 2: إنشاء مستخدم مخصص لـ FTP
لأمان أفضل:
1. **إضافة مستخدم**:
   ```bash
   sudo adduser ftpuser
   ```
   - اتبع المطالبات لتعيين كلمة مرور وتفاصيل.
2. **تعيين المجلد الرئيسي إلى مجلد الأفلام**:
   ```bash
   sudo usermod -d /var/www/movies ftpuser
   sudo chown -R ftpuser:ftpuser /var/www/movies
   ```

3. **تقييد الوصول** (إذا `chroot_local_user=YES`):
   - تأكد من أن `/var/www/movies` قابل للكتابة من قبل `ftpuser`:
     ```bash
     sudo chmod -R 755 /var/www/movies
     ```

### الخطوة 4: فتح منافذ الجدار الناري
FTP يستخدم المنافذ 20 و 21 افتراضيًا.
1. **السماح لـ FTP في UFW**:
   ```bash
   sudo ufw allow 21/tcp
   sudo ufw allow 20/tcp
   sudo ufw status
   ```
   - يجب أن تظهر `20/tcp ALLOW` و `21/tcp ALLOW`.

2. **إعادة تشغيل vsftpd**:
   ```bash
   sudo systemctl restart vsftpd
   ```

### الخطوة 5: اختبار FTP من iPad
ستحتاج إلى تطبيق عميل FTP على جهاز iPad.

#### تطبيقات iPad الموصى بها: FileZilla أو FE File Explorer
- **FileZilla** (مجاني):
  1. ثبّت من متجر التطبيقات (ابحث عن "FileZilla").
  2. افتح FileZilla.
  3. انقر على **New Site** أو **Connect**.
  4. أدخل:
     - الخادم: `192.168.1.27`
     - اسم المستخدم: `ftpuser` (أو اسم المستخدم الخاص بك)
     - كلمة المرور: [كلمة المرور الخاصة بك]
     - المنفذ: 21 (افتراضي)
  5. انقر على **Connect**.
- **FE File Explorer** (مجاني مع مشتريات داخل التطبيق):
  1. ثبّت من متجر التطبيقات.
  2. انقر على **+** > **FTP**.
  3. أدخل نفس التفاصيل المذكورة أعلاه.
  4. اتصل.

#### البث من FTP
- معظم تطبيقات FTP تتيح لك تصفح الملفات. لبث ملفات `.mkv`:
  - انقر على ملف `.mkv` في التطبيق.
  - إذا لم يعمل التشغيل مباشرة، حمّل تطبيق بث مثل **VLC for Mobile** (راجع الرد السابق)، ثم استخدم خيار **Network Stream** مع عنوان URL لـ FTP:
    ```
    ftp://ftpuser:password@192.168.1.27/yourfile.mkv
    ```

### الخطوة 6: التحقق من الوصول
- من iPad، اتصل بـ `192.168.1.27` عبر تطبيق FTP.
- يجب أن ترى محتويات `/var/www/movies/` (مثال: `yourfile.mkv`).
- انقر للمعاينة أو البث (حسب التطبيق).

### استكشاف الأخطاء وإصلاحها
- **رفض الاتصال**: تحقق من `sudo ufw status` وتأكد من أن المنافذ 20/21 مفتوحة. تحقق من أن vsftpd يعمل (`sudo systemctl status vsftpd`).
- **تم رفض الإذن**: تأكد من أن المستخدم يملك أو يمكنه قراءة `/var/www/movies/` (`ls -l /var/www/movies/`).
- **404 أو لا توجد ملفات**: تأكد من أن مسار المجلد يتطابق مع إعداد المجلد الرئيسي للمستخدم أو الرابط الرمزي.

### ملاحظات نهائية
- **الأمان**: للشبكة المحلية، هذا الإعداد جيد. للوصول الخارجي، فكر في استخدام FTPS (FTP مشفر) عن طريق تمكين SSL في `vsftpd.conf`.
- **Nginx مقابل FTP**: أنت already تقوم بالبث عبر HTTP مع Nginx — يضيف FTP إدارة الملفات. استخدم VLC على iPad للبث عبر HTTP إذا شعرت أن إعداد FTP زائد عن الحاجة.

الآن iPad لديه "سحر" FTP للوصول إلى ملفات خادم أوبونتو الخاص بك! أعلمني إذا واجهت أي مشاكل.