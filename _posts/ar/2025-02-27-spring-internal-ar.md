---
audio: false
generated: true
lang: ar
layout: post
title: آليات الربيع الداخلية
translated: true
type: note
---

دعنا نتعمق في إطار عمل Spring وآلية عمله الداخلية. Spring هو إطار عمل قوي لبناء تطبيقات جافا، وسأعالج كل جزء من استفسارك خطوة بخطوة مع تقديم تفسيرات واضحة.

### كيف يعمل Spring؟
يعمل Spring على مبدأ **عكس التحكم (IoC)**. هذا يعني أنه بدلاً من أن يتحكم كود تطبيقك في إنشاء وإدارة الكائنات، فإن Spring هو من يتولى المهمة. ويقوم بذلك من خلال مكون يسمى **حاوية IoC**. حاوية IoC مسؤولة عن:

- **إنشاء** الكائنات (تسمى beans في Spring).
- **تكوينها** بناءً على مواصفاتك.
- **تجميعها** من خلال إدارة التبعيات بينها.

هذا النهج يقلل من الاقتران الشديد في الكود الخاص بك، مما يجعله أكثر نمطية وأسهل في الصيانة.

### كيف يدير Spring الـ Beans؟
في Spring، **الـ beans** هي الكائنات التي تديرها حاوية IoC. إليك كيف يتعامل Spring معها:

1. **التعريف**: يمكنك تعريف الـ beans إما في:
   - **ملفات تكوين XML**.
   - **تكوين قائم على جافا** باستخدام annotations مثل `@Bean`، `@Component`، `@Service`، إلخ.
2. **الإنشاء**: عندما يبدأ التطبيق، تقرأ حاوية IoC هذه التعريفات وتنشئ الـ beans.
3. **حقن التبعية (DI)**: يقوم Spring تلقائيًا بحقن التبعيات (الـ beans الأخرى) في الـ bean حيثما تكون هناك حاجة، باستخدام:
   - **حقن عبر المُنشئ (Constructor injection)**.
   - **حقن عبر الطرق setter (Setter injection)**.
   - **حقن مباشر للحقول (Field injection)** (عبر `@Autowired`).

تدير الحاوية دورة الحياة الكاملة لهذه الـ beans – من الإنشاء إلى التدمير – وتضمن أنها متاحة عند الحاجة.

### الفرق بين Service و Controller
في سياق **Spring MVC** (إطار عمل الويب الخاص بـ Spring)، يخدم هذان المكونان أغراضًا مختلفة:

- **Controller**:
  - يتعامل مع **طلبات HTTP** من المستخدمين.
  - يعالج الإدخال، يستدعي منطق الأعمال، ويقرر أي **عرض (view)** (مثل صفحة ويب) سيتم إرجاعه.
  - يُعلّم بـ `@Controller` أو `@RestController`.
  - يوجد في **طبقة الويب (web layer)**.

- **Service**:
  - يغلف **منطق الأعمال (business logic)** للتطبيق.
  - ينفذ مهامًا مثل الحسابات، معالجة البيانات، أو التفاعل مع قواعد البيانات.
  - يُعلّم بـ `@Service`.
  - يوجد في **طبقة الأعمال (business layer)**.

**مثال**:
- قد يستقبل الـ controller طلبًا لعرض ملف تعريف مستخدم ويستدعي service لجلب بيانات المستخدم.
- يقوم الـ service باسترجاع البيانات من قاعدة البيانات ويرجعها إلى الـ controller، والذي بدوره يرسلها إلى العرض.

باختصار: **يدير الـ Controllers تفاعلات الويب**، بينما **تتعامل الـ Services مع الوظائف الأساسية**.

### ماذا يقدم Spring؟
Spring هو إطار عمل شامل يقدم مجموعة واسعة من الأدوات للتطبيقات enterprise. تشمل الميزات الرئيسية:

- **حقن التبعية (Dependency Injection)**: يبسط إدارة تبعيات الكائنات.
- **البرمجة الموجهة نحو الجوانب (AOP)**: يضيف اهتمامات cross-cutting مثل التسجيل (logging) أو الأمان.
- **إدارة المعاملات (Transaction Management)**: يضمن اتساق البيانات عبر العمليات.
- **Spring MVC**: لبناء تطبيقات ويب قوية.
- **Spring Boot**: يبسط الإعداد مع إعدادات افتراضية مسبقة وخوادم مضمنة (embedded servers).
- **Spring Data**: يبسط الوصول إلى قواعد البيانات.
- **الأمان (Security)**: يوفر أدوات المصادقة والتفويض.

يتيح التصميم النمطي لـ Spring لك اختيار الميزات التي تحتاجها فقط.

### كيف يبحث Spring عن الكائنات أو الـ Beans؟
عند بدء تشغيل تطبيق Spring:

1. يتم تهيئة **حاوية IoC**.
2. تفحص الحاوية بحثًا عن **تعريفات الـ beans** في:
   - ملفات XML.
   - الفئات المُعلّمة (مثل `@Component`، `@Bean`).
3. تنشئ الحاوية الـ beans وتخزنها في **خريطة (map)**، مُفهرسة بالاسم أو النوع.
4. عندما تكون هناك حاجة إلى bean (على سبيل المثال، للحقن أو الاسترجاع المباشر)، توفرها الحاوية باستخدام:
   - **البحث بالاسم (By-name lookup)**.
   - **البحث بالنوع (By-type lookup)** (على سبيل المثال، عبر `@Autowired`).

تضمن هذه العملية أن الـ beans متاحة بسهولة في جميع أنحاء التطبيق.

### كيفية استخدام Tomcat أو Netty كخادم؟
Spring Boot، وهو امتداد لـ Spring، يبسط إعداد الخادم من خلال تضمين الخوادم مباشرة في تطبيقك. إليك كيف يعمل مع **Tomcat** و **Netty**:

- **Tomcat** (قائم على Servlet):
  - الخادم الافتراضي في dependency التالي لـ Spring Boot: `spring-boot-starter-web`.
  - أضف هذا إلى ملف `pom.xml` الخاص بك:
    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    ```
  - يقوم Spring Boot بتضمين Tomcat، ويعمل تطبيقك كـ JAR قابل للتنفيذ بشكل مستقل.

- **Netty** (غير قائم على Servlet):
  - يُستخدم لتطبيقات الويب التفاعلية (reactive) (مثلًا مع Spring WebFlux).
  - استبدل Tomcat عن طريق استبعاده وإضافة Netty:
    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
    ```
  - يقوم Spring Boot بتضمين Netty بدلاً من ذلك، مما يدعم الإدخال/الإخراج غير المتزامن وغير المُعطل (asynchronous, non-blocking I/O).

يمكنك تكوين الخادم عبر `application.properties` (على سبيل المثال، ضبط المنفذ بـ `server.port=8080`). لا حاجة لنشر خادم خارجي – حيث يتولى Spring Boot كل شيء.

### ملخص
- **أساس Spring**: يستخدم حاوية IoC لإدارة الكائنات.
- **إدارة الـ Beans**: تُعرّف عبر XML أو annotations، مع حقن التبعيات تلقائيًا.
- **Service مقابل Controller**: تتعامل الـ Services مع منطق الأعمال؛ بينما تدير الـ Controllers طلبات الويب.
- **الميزات**: يقدم DI، AOP، دعم الويب، والمزيد.
- **البحث عن الـ Beans**: تجد الحاوية وتوفر الـ beans من التكوينات.
- **الخوادم**: يقوم Spring Boot بتضمين Tomcat أو Netty مع تغييرات بسيطة في dependencies.