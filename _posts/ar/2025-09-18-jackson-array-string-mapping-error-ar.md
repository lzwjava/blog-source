---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: خطأ تعيين مصفوفة جاكسون إلى سلسلة نصية
translated: true
type: note
---

### نظرة عامة على المشكلة
إذا كنت تستخدم مكتبة جاكسون (مكتبة جافا شائعة لتحويل JSON إلى كائنات وبالعكس) وتحاول تحويل مصفوفة JSON (مثل `[1, 2, 3]` أو `["a", "b"]`) مباشرة إلى حقل في جافا مُعلن كـ `String`، فإن العملية ستفشل أثناء التحويل. لا توفر جاكسون تحويلًا افتراضيًا من مصفوفات JSON إلى سلاسل نصية، لأنها fundamentally أنواع بيانات مختلفة. هذا يؤدي إلى حدوث خطأ في وقت التشغيل.

### الخطأ المتوقع
عادة ما تطلق جاكسون استثناء `JsonMappingException` برسالة تشير إلى عدم تطابق الأنواع. على سبيل المثال:
- إذا حاولت تحويل `[1, 2, 3]` إلى حقل من نوع `String`، فسترى رسالة مثل:  
  `Cannot deserialize instance of 'java.lang.String' out of START_ARRAY token`

قد تختلف الرسالة الدقيقة قليلاً حسب إصدار جاكسون (شائع في الإصدار 2.x)، لكن السبب الجذري يعود إلى `com.fasterxml.jackson.core.JsonMappingException`.

### لماذا يحدث هذا
- تستخدم جاكسون تلميحات النوع أو توقيعات الحقول لتحديد كيفية تحليل JSON. تبدأ مصفوفة JSON بالرمز `[` (START_ARRAY)، الذي تتوقع جاكسون أن يتم تحويله إلى أنواع مصفوفات أو قوائم مثل `List<String>`، أو `int[]`، أو arrays.
- يتوقع حقل `String` قيمة JSON بدائية (مثل `"hello"`) أو null، وليس مصفوفة.
- لا يوجد في جاكسون محول مدمج يسمح بهذا التباين لأسباب تتعلق بالسلامة، على عكس بعض التحويلات الأخف للأرقام/السلاسل.

### كيفية الإصلاح أو الالتفاف حول المشكلة
- **تغيير نوع الحقل في جافا**: استخدم نوع مصفوفة أو مجموعة متوافق، مثل `List<String>`، أو `String[]`، أو `Object` إذا كنت تحتاج إلى مرونة.
- **تحويل مخصص**: ضع الشرح `@JsonDeserialize(using = CustomDeserializer.class)` على الحقل وقم بتعيين محول مخصص لتحويل المصفوفة حسب الحاجة (مثل دمج عناصرها).
- **إذا كنت تتوقع تمثيلاً نصياً**: تأكد من أن JSON يرسل سلسلة نصية (مثل `"[1, 2, 3]"`) وقم بالتحويل وفقًا لذلك.
- **نصيحة للاختبار**: استخدم `ObjectMapper` التابع لجاكسون مع try-catch للتعامل مع مثل هذه الأخطاء بأسلوب سلس والرجوع إلى الإعدادات الافتراضية.

لمزيد من التفاصيل، راجع وثائق جاكسون حول استثناءات التحويل. إذا كان هذا لا يتطابق مع سيناريو حالتك بالضبط، قدم مقاطع الكود الخاصة بك للحصول على مساعدة أفضل!