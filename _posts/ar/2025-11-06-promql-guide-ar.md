---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: دليل لغة استعلام PromQL
translated: true
type: note
---

PromQL (لغة استعلام Prometheus) هي لغة استعلام وظيفية تُستخدم لتحديد بيانات السلاسل الزمنية وتجميعها في الوقت الفعلي من Prometheus. تدعم الاستعلامات الفورية (يتم تقييمها عند نقطة زمنية واحدة) واستعلامات النطاق (يتم تقييمها على خطوات متعددة خلال نطاق زمني). يمكن أن تُرجع تعبيرات PromQL أحد أربعة أنواع من البيانات: **متجه فوري**، **متجه نطاق**، **عدد قياسي**، أو **سلسلة نصية**.

---

## مقدمة

تمكن PromQL المستخدمين من:
- تحديد السلاسل الزمنية باستخدام **محددات المتجه الفوري**.
- استرجاع البيانات خلال نطاق زمني باستخدام **محددات متجه النطاق**.
- تطبيق **المشغلات** (الحسابية، والمقارنة، والمنطقية، والتجميع).
- استخدام **الدوال** مثل `rate()`، `sum()`، `avg()` للتحليل.
- استعلام البيانات عبر **واجهة برمجة التطبيقات HTTP**.

يتم تقييم التعبيرات في واجهة مستخدم Prometheus:
- **علامة تبويب الجدول**: استعلامات فورية.
- **علامة تبويب الرسم البياني**: استعلامات نطاق.

---

## محددات السلسلة الزمنية

تحدد محددات السلسلة الزمنية المقاييس والوسوم المراد استرجاعها.

### محددات المتجه الفوري

تحدد أحدث عينة لكل سلسلة زمنية متطابقة.

**بناء الجملة**:  
```
<metric_name>{<label_matchers>}
```

**أمثلة**:
- جميع السلاسل الزمنية ذات المقياس `http_requests_total`:
  ```
  http_requests_total
  ```
- وظيفة ومجموعة محددة:
  ```
  http_requests_total{job="prometheus", group="canary"}
  ```
- تطابق نمطي على البيئة واستبعاد طريقة GET:
  ```
  http_requests_total{environment=~"staging|testing|development", method!="GET"}
  ```
- تطابق على `__name__`:
  ```
  {__name__=~"job:.*"}
  ```

**مطابقات الوسم**:
- `=` : تطابق تام
- `!=` : غير متساوي
- `=~` : تطابق نمطي (مرتكز)
- `!~` : لا يتطابق نمطياً

> ملاحظة: `{job=~".+"}` صالح؛ `{}` بمفردها غير صالحة.

---

### محددات متجه النطاق

تحدد نطاقاً من العينات عبر الزمن.

**بناء الجملة**:  
```
<instant_selector>[<duration>]
```

**مثال**:
- آخر 5 دقائق من `http_requests_total` لوظيفة `prometheus`:
  ```
  http_requests_total{job="prometheus"}[5m]
  ```

> النطاق **مفتوح من اليسار، مغلق من اليمين**: يستبعد وقت البدء، ويشمل وقت الانتهاء.

---

### معدل الإزاحة

يُزمن وقت التقييم للأمام أو للخلف.

**بناء الجملة**:  
```
<selector> offset <duration>
```

**أمثلة**:
- قيمة `http_requests_total` منذ 5 دقائق:
  ```
  http_requests_total offset 5m
  ```
- المعدل من أسبوع مضى:
  ```
  rate(http_requests_total[5m] offset 1w)
  ```
- نظرة مستقبلية (إزاحة سالبة):
  ```
  rate(http_requests_total[5m] offset -1w)
  ```

> يجب أن يتبع المحدد فوراً.

---

### معدل `@`

يقيم عند طابع زمني محدد.

**بناء الجملة**:  
```
<selector> @ <timestamp>
```

**أمثلة**:
- القيمة عند الطابع الزمني Unix `1609746000`:
  ```
  http_requests_total @ 1609746000
  ```
- المعدل عند وقت محدد:
  ```
  rate(http_requests_total[5m] @ 1609746000)
  ```
- استخدام `start()` أو `end()`:
  ```
  http_requests_total @ start()
  rate(http_requests_total[5m] @ end())
  ```

> يمكن دمجه مع `offset`.

---

## المعدل والتجميعات

تدعم PromQL **المعدل** و **مشغلات التجميع** لحساب المقاييس عبر الزمن أو عبر السلاسل.

### دالة المعدل

تحسب متوسط معدل الزيادة في الثانية.

**مثال**:
```
rate(http_requests_total[5m])
```

> تُستخدم على **متجهات النطاق**.

---

### مشغلات التجميع

تُطبق على المتجهات الفورية لدمج السلاسل الزمنية.

**أمثلة**:
- مجموع كل `http_requests_total`:
  ```
  sum(http_requests_total)
  ```
- المتوسط لكل instance:
  ```
  avg by (instance)(http_requests_total)
  ```
- العدد لكل وظيفة:
  ```
  count by (job)(http_requests_total)
  ```

> يتطلب التجميع سلاسل متطابقة؛ استخدم عبارات `by` أو `without`.

---

## المشغلات

تدعم PromQL عدة أنواع من المشغلات.

### المشغلات الحسابية

| المشغل | الوصف              | مثال                           |
|--------|--------------------|---------------------------------|
| `+`    | جمع                | `rate(a[5m]) + rate(b[5m])`     |
| `-`    | طرح                | `rate(a[5m]) - rate(b[5m])`     |
| `*`    | ضرب                | `http_requests_total * 60`      |
| `/`    | قسمة               | `rate(a[5m]) / rate(b[5m])`     |
| `%`    | باقي القسمة        | `http_requests_total % 100`     |

> يجب أن تكون المعاملات متوافقة (نفس النوع والشكل).

---

### مشغلات المقارنة

تقارن متجهين فوريين.

| المشغل | الوصف              | مثال                             |
|--------|--------------------|-----------------------------------|
| `==`   | يساوي              | `rate(a[5m]) == rate(b[5m])`      |
| `!=`   | لا يساوي           | `rate(a[5m]) != 0`                |
| `>`    | أكبر من            | `http_requests_total > 100`       |
| `<`    | أصغر من            | `http_requests_total < 10`        |
| `>=`   | أكبر من أو يساوي   | `rate(a[5m]) >= 2`                |
| `<=`   | أصغر من أو يساوي   | `http_requests_total <= 5`        |

> تُرجع متجه فوري منطقي.

---

### المشغلات المنطقية

تدمج التعبيرات المنطقية.

| المشغل | الوصف              | مثال                                  |
|--------|--------------------|---------------------------------------|
| `and`  | AND منطقي          | `rate(a[5m]) > 1 and rate(b[5m]) > 1` |
| `or`   | OR منطقي           | `rate(a[5m]) > 1 or rate(b[5m]) > 1`  |
| `unless` | استثناء           | `rate(a[5m]) unless rate(b[5m]) > 0`  |

> يجب أن تكون المعاملات متجهات منطقية من نفس الأهمية.

---

## الدوال

تتضمن PromQL دوال مدمجة للتحويل والتحليل.

**الدوال الشائعة**:
- `rate(v range-vector)` – المعدل في الثانية.
- `irate(v range-vector)` – المعدل اللحظي (آخر نقطتين).
- `avg(v)` – القيمة المتوسطة.
- `sum(v)` – مجموع القيم.
- `count(v)` – عدد العناصر.
- `min(v)`, `max(v)` – الحد الأدنى/الأقصى.
- `quantile(v instant-vector, q)` – النسبة المئوية.

**مثال**:
```
quantile by (job)(0.95, http_request_duration_seconds_bucket[5m])
```

> راجع [توثيق دوال Prometheus](https://prometheus.io/docs/prometheus/latest/querying/functions/) للحصول على القائمة الكاملة.

---

## واجهة برمجة التطبيقات HTTP للاستعلام

يمكن إرسال استعلامات PromQL عبر واجهة برمجة التطبيقات HTTP.

### الاستعلامات الفورية

**النقطة النهائية**: `/api/v1/query`

**الطريقة**: `GET`

**المعاملات**:
- `query`: تعبير PromQL
- `time`: طابع زمني للتقييم (ثواني Unix، اختياري)
- `timeout`: مهلة الاستعلام (مثال: `30s`)

**مثال**:
```
GET /api/v1/query?query=http_requests_total{job="prometheus"}&time=1609746000
```

**الاستجابة**: JSON يحتوي على `status`، `data.result` (متجه فوري أو عدد قياسي).

---

### استعلامات النطاق

**النقطة النهائية**: `/api/v1/query_range`

**المعاملات**:
- `query`: تعبير PromQL
- `start`: وقت البدء (ثواني Unix)
- `end`: وقت الانتهاء (ثواني Unix)
- `step`: خطوة الدقة (مثال: `15s`)

**مثال**:
```
GET /api/v1/query_range?query=rate(http_requests_total[5m])&start=1609746000&end=1609746600&step=10s
```

**الاستجابة**: JSON يحتوي على بيانات السلسلة الزمنية عند كل خطوة.

---

## ملاحظات إضافية

- **القيم الحرفية**:
  - السلاسل النصية: `"hello"`, `'world'`, `` `raw` ``
  - الأعداد العشرية: `3.14`, `-2.5e-3`, `1_000`, `0xFF`
  - المدد الزمنية: `5m`, `1h30m`, `500ms`

- **التعليقات**: تبدأ بـ `#`

- **القدم**: تصبح السلسلة قديمة بعد 5 دقائق (افتراضي) دون تحديثات.

- **الاستعلام الفرعي**: تشغيل استعلام فوري عبر نطاق:
  ```
  rate(http_requests_total[10m:5m])[5m]
  ```

---

يغطي هذا الدليل أساسيات PromQL للمستخدمين من المبتدئين إلى المتوسطين. للاستخدام المتقدم، راجع [أساسيات استعلام Prometheus](https://prometheus.io/docs/prometheus/latest/querying/basics/) والصفحات المرتبطة.