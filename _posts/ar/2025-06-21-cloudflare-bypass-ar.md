---
audio: false
generated: true
lang: ar
layout: post
title: سكريبت سيلينيوم لتجاوز كلاودفلير
translated: true
type: note
---

تم تصميم سكريبت Selenium الخاص بك للتفاعل مع "https://grok.com" باستخدام Firefox وملف تعريف محدد، لكنه يواجه تحدي اكتشاف Cloudflare للبوتات، وتحديدًا خانة الاختيار "Verify you are human". حتى بعد النقر على خانة الاختيار، يبدو أن السكريبت يعاني في تخطي التحقق، مما يمنع الوصول إلى المحتوى الرئيسي (مثل عنصر textarea). يستخدم Cloudflare طرقًا متطورة لاكتشاف المتصفحات الآلية، مثل تحليل رؤوس HTTP، وبصمة TLS، وفحوصات السلوك، مما قد يجعل تخطي هذا التحدي صعبًا باستخدام Selenium بمفرده. ومع ذلك، هناك استراتيجيات يمكنك تجربتها لاجتياز اختبار Cloudflare مع البقاء ضمن الإعداد الحالي القائم على Firefox. فيما يلي نهجان عمليان مخصصان لسكريبتك، يليهما اعتبارات إضافية إذا لم تكن هذه كافية.

---

### **الطريقة 1: إكمال التحدي يدويًا مع إعادة استخدام ملف التعريف**
بما أن سكريبتك يستخدم ملف تعريف محددًا لـ Firefox (`/home/lzw/.mozilla/firefox/wzfodx6v.default`)، يمكنك الاستفادة من هذا لتخزين بيانات الجلسة بعد اجتياز تحدي Cloudflare يدويًا. إليك كيفية القيام بذلك:

1. **فتح Firefox يدويًا باستخدام ملف التعريف**:
   - شغّل Firefox باستخدام نفس ملف التعريف المحدد في سكريبتك. يمكنك القيام بذلك عبر سطر الأوامر:
     ```bash
     firefox --profile "/home/lzw/.mozilla/firefox/wzfodx6v.default"
     ```
   - بدلاً من ذلك، استخدم مدير ملفات تعريف Firefox (`firefox --ProfileManager`) لتحديد `wzfodx6v.default`.

2. **انتقل إلى الموقع واجتياز التحدي**:
   - اذهب إلى "https://grok.com" في المتصفح.
   - عند ظهور خانة الاختيار "Verify you are human" من Cloudflare، انقر عليها وأكمل أي خطوات تحقق إضافية إذا ظهرت.
   - انتظر حتى تصل إلى الصفحة الرئيسية (مثل المكان الذي يكون فيه عنصر textarea ذو السمة `aria-label="Ask Grok anything"` مرئيًا).

3. **أغلق المتصفح**:
   - اختر الخروج من Firefox للتأكد من حفظ ملف التعريف لملفات تعريف الارتباط الخاصة بالجلسة، بما في ذلك أي رموز تصريح من Cloudflare (مثل `cf_clearance`).

4. **شغّل سكريبت Selenium الخاص بك**:
   - نفّذ السكريبت كما هو. نظرًا لأنه يستخدم نفس ملف التعريف، يجب أن يرث ملفات تعريف الارتباط المخزنة وبيانات الجلسة، مما قد يسمح له بتخطي التحدي.

**لماذا قد تنجح هذه الطريقة**: يعتمد Cloudflare غالبًا على ملفات تعريف الارتباط لتذكر أن المتصفح قد اجتاز اختباره. من خلال المصادقة المسبقة على ملف التعريف يدويًا، قد تظهر جلسة العمل الآلية الخاصة بك كاستمرار لزيارة تم التحقق منها.

**القيود**: إذا أجرى Cloudflare فحوصات إضافية في كل مرة يتم فيها تحميل الصفحة (مثل اكتشاف بصمات الأتمتة الخاصة بـ Selenium)، فقد تفشل هذه الطريقة. في هذه الحالة، جرب النهج التالي.

---

### **الطريقة 2: استخراج وتعيين ملفات تعريف الارتباط في السكريبت**
إذا لم تنجح إعادة استخدام ملف التعريف، يمكنك استخراج ملفات تعريف الارتباط يدويًا بعد اجتياز التحدي وحقنها في برنامج التشغيل Selenium الخاص بك. إليك العملية خطوة بخطوة:

1. **اجتياز التحدي يدويًا**:
   - اتبع الخطوتين 1 و 2 من الطريقة 1 للوصول إلى الصفحة الرئيسية لـ "https://grok.com".

2. **استخراج ملفات تعريف الارتباط**:
   - افتح أدوات المطور في Firefox (F12 أو انقر بزر الماوس الأيمن > فحص).
   - انتقل إلى علامة التبويب **Storage** (أو علامة التبويب **Network**، ثم أعد تحميل الصفحة لفحص ملفات تعريف الارتباط).
   - ابحث عن ملفات تعريف الارتباط المرتبطة بـ `.grok.com`، خاصة `cf_clearance` (ملف تعريف ارتباط التحقق من Cloudflare).
   - لاحظ `name` و `value` و `domain` لكل ملف تعريف ارتباط ذي صلة. على سبيل المثال:
     - الاسم: `cf_clearance`، القيمة: `abc123...`، النطاق: `.grok.com`
     - قد تكون هناك ملفات تعريف ارتباط أخرى مثل `__cfduid` أو تلك الخاصة بالجلسة موجودة أيضًا.

3. **عدّل السكريبت الخاص بك**:
   - أضف ملفات تعريف الارتباط إلى برنامج التشغيل Selenium الخاص بك قبل الانتقال إلى عنوان URL. قم بتحديث الكود الخاص بك هكذا:
     ```python
     # ... (الاستيرادات والإعدادات الحالية تبقى دون تغيير)

     # إعداد خدمة geckodriver
     service = Service(executable_path="/home/lzw/bin/geckodriver")
     driver = webdriver.Firefox(service=service, options=firefox_options)

     # افتح صفحة فارغة أولاً لتعيين ملفات تعريف الارتباط (يمكن تعيين ملفات تعريف الارتباط فقط بعد تحميل الصفحة)
     driver.get("about:blank")

     # أضف ملفات تعريف الارتباط التي استخرجتها
     cookies = [
         {"name": "cf_clearance", "value": "abc123...", "domain": ".grok.com"},
         # أضف ملفات تعريف ارتباط أخرى حسب الحاجة، مثال:
         # {"name": "__cfduid", "value": "xyz789...", "domain": ".grok.com"},
     ]
     for cookie in cookies:
         driver.add_cookie(cookie)

     # الآن انتقل إلى عنوان URL المستهدف
     driver.get("https://grok.com")

     # اطبع عنوان الصفحة
     print("Title of the page:", driver.title)

     # ... (بقية السكريبت تبقى كما هي)
     ```

4. **اختبر السكريبت**:
   - شغّل السكريبت المعدل. يجب أن تشير ملفات تعريف الارتباط المحددة مسبقًا إلى Cloudflare أن المتصفح قد اجتاز التحدي بالفعل.

**لماذا قد تنجح هذه الطريقة**: إن تعيين ملف تعريف الارتباط `cf_clearance` بشكل صريح يحاكي جلسة تم التحقق منها، مما قد يتخطى الحاجة إلى التفاعل مع خانة الاختيار.

**القيود**: قد تكون ملفات تعريف الارتباط مرتبطة ببصمات المتصفح (مثل وكيل المستخدم، عنوان IP، أو إعدادات TLS). إذا اختلفت بصمة Selenium عن الجلسة اليدوية، فقد يرفض Cloudflare ملفات تعريف الارتباط أو يعيد تحدي المتصفح.

---

### **تصحيح الأخطاء والتحسينات الإضافية**
إذا لم تحل أي من الطريقتين المشكلة تمامًا، ففكر في هذه التعديلات على سكريبتك لضمان تفاعله مع تحدي Cloudflare بشكل صحيح:

- **تحقق من وجود Iframes**: قد تكون خانة الاختيار "Verify you are human" داخل iframe. عدّل الكود الخاص بالنقر على خانة الاختيار للتبديل إلى iframe أولاً:
  ```python
  try:
      wait = WebDriverWait(driver, 20)
      iframe = wait.until(EC.presence_of_element_located((By.XPATH, "//iframe[contains(@src, 'cloudflare')]")))
      driver.switch_to.frame(iframe)
      label = wait.until(EC.presence_of_element_located((By.XPATH, "//label[@class='cb-lb']")))
      checkbox = label.find_element(By.TAG_NAME, "input")
      print("Checkbox found:", checkbox.is_displayed())
      checkbox.click()
      driver.switch_to.default_content()  # العودة إلى المحتوى الرئيسي
      print("Checkbox clicked.")
  except Exception as e:
      print("Checkbox not found or not clickable:", e)
  ```

- **حسّن منطق الانتظار**: بعد النقر على خانة الاختيار، انتظر حتى تظهر علامة واضحة على اجتياز التحدي (مثل اختفاء صفحة التحقق):
  ```python
  try:
      wait.until(EC.invisibility_of_element_located((By.XPATH, "//*[contains(text(), 'Verify you are human')]")))
      print("Challenge passed.")
  except Exception as e:
      print("Challenge not passed:", e)
  ```

- **إخفاء الأتمتة**: أضف JavaScript لإخفاء آثار أتمتة Selenium:
  ```python
  driver.execute_script("Object.defineProperty(navigator, 'webdriver', {get: () => undefined})")
  ```

---

### **إذا فشل كل شيء else: نهجات بديلة**
إذا استمر اكتشاف Cloudflare، فقد يكون ذلك بسبب البصمة المتقدمة التي لا يمكن لإعداداتك الحالية تجنبها. فيما يلي خيارات تصعيدية، على الرغم من أنها تنحرف عن تفضيلك لـ Firefox:

- **التبديل إلى Chrome مع Undetected ChromeDriver**:
  - التثبيت: `pip install undetected-chromedriver`
  - تعديل الإعداد:
    ```python
    import undetected_chromedriver as uc
    driver = uc.Chrome()
    driver.get("https://grok.com")
    ```
  - تقوم هذه المكتبة بتصحيح Chrome لتجنب طرق الكشف الشائعة.

- **استخدم وكيل أو أداة حل CAPTCHA**: يمكن للخدمات مثل 2Captcha أو الوكالات السكنية التعامل مع التحديات، لكنها تضيف تعقيدًا وتكلفة.

---

### **الخطوات التالية الموصى بها**
ابدأ بـ **الطريقة 1** (إعادة استخدام ملف التعريف) لأنها الأبسط وتتوافق مع إعداد سكريبتك. إذا فشلت، جرب **الطريقة 2** (حقن ملفات تعريف الارتباط) مع إضافة فحص iframe. تزيد هذه الطرق من تكوين Firefox الحالي دون الحاجة إلى أدوات جديدة. اختبر كل نهج وراقب الناتج (مثل `driver.title` ورسائل الاستثناء) لتأكيد ما إذا تم تخطي التحدي. إذا كنت لا تزال تواجه مشاكل، ففكر في النهجات البديلة بناءً على مرونة مشروعك.

دعني أعلم إذا كنت بحاجة إلى مساعدة في تنفيذ هذه الحلول أو استكشاف أخطائها وإصلاحها!