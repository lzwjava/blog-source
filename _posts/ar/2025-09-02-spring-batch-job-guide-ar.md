---
audio: false
generated: true
image: false
lang: ar
layout: post
title: دليل تنفيذ وظائف Spring Batch
translated: true
type: note
---

Spring Batch هو إطار عمل مفتوح المصدر وخفيف الوزن من نظام Spring البيئي، مُصمم خصيصًا **لمعالجة الدُفعات** — أي تنفيذ المهام التي تتضمن قراءة ومعالجة وكتابة كميات كبيرة من البيانات بطريقة موثوقة وقابلة للتوسع.

إليك شرحًا شاملًا لكيفية عمل مهمة Spring Batch:

---

## 1. المفاهيم الأساسية

*   **المهمة (Job)**
    تمثل المهمة الكيان الأعلى مستوى. وهي تمثل عملية المعالجة بالدفعات بأكملها وتتكون من خطوة واحدة أو أكثر.

*   **الخطوة (Step)**
    تمثل كل خطوة مرحلة داخل المهمة (مثال: قراءة → معالجة → كتابة). يمكن أن تكون الخطوات قائمة على القطع (chunk-oriented) أو قائمة على المهام (tasklet-oriented).

*   **منطلق المهمة (JobLauncher)**
    مكون مسؤول عن بدء تشغيل المهمة، عادةً ما يتم تشغيله عبر الكود، أو أداة جدولة (مثل Quartz، cron)، أو سطر الأوامر.

*   **مستودع المهمة (JobRepository)**
    مخزن مدعوم بقاعدة بيانات يحتفظ ببيانات وصفية حول تنفيذ المهام، مثل الحالة، وأوقات البدء/الانتهاء، ورموز الخروج، ونقاط إعادة التشغيل.

*   **تنفيذ المهمة وتنفيذ الخطوة (JobExecution & StepExecution)**
    يمثلان الحالة التشغيلية للمهمة وخطواتها، بما في ذلك النجاح، أو الفشل، أو الإكمال الجزئي.

---

## 2. تدفق التنفيذ

1.  **إطلاق المهمة**
    يبدأ `JobLauncher` المهمة عن طريق تمرير نسخة من `Job` و `JobParameters`.

2.  **نسخة المهمة والبيانات الوصفية**
    يتحقق الإطار من `JobRepository` لمعرفة ما إذا كانت نسخة المهمة ذات تلك المعاملات موجودة بالفعل.

    *   إذا كانت موجودة، فقد تستمر/تُعاد.
    *   إذا لم تكن موجودة، فإنه ينشئ نسخة جديدة.

3.  **تنفيذ الخطوة**
    تعمل كل خطوة بشكل تسلسلي (ما لم تقم بتكوين تدفقات متوازية).

    *   إذا فشلت خطوة ولم يتم تعيينها على "السماح بالإعادة"، تتوقف المهمة.
    *   وإلا، تستمر المهمة إلى الخطوة التالية.

4.  **المعالجة القائمة على القطع (Chunk-Oriented Processing)** (الأكثر شيوعًا)

    *   **القارئ (Reader)**: يقرأ قطعة من البيانات (مثال: 100 سجل من ملف أو قاعدة بيانات).
    *   **المعالج (Processor)**: يقوم بتحويل أو التحقق من صحة البيانات بشكل اختياري.
    *   **الكاتب (Writer)**: يكتب القطعة المُعالجة إلى الهدف (مثال: قاعدة بيانات، ملف، واجهة برمجة تطبيقات API).
    *   بعد الإيداع، يحفظ Spring Batch نقطة التحقق في `JobRepository`.

5.  **تحمل الأخطاء (Fault Tolerance)**

    *   منطق إعادة المحاولة، وسياسات التخطي، وإمكانيات إعادة التشغيل مدمجة في الإطار.
    *   إذا تعطلت المهمة، يمكنها إعادة التشغيل من آخر نقطة تحقق تم إيداعها.

---

## 3. مثال

تخيل معالجة ملف CSV يحتوي على معاملات:

*   **القارئ**: `FlatFileItemReader` يقوم بتحميل الصفوف من ملف CSV.
*   **المعالج**: فئة مخصصة تقوم بالتحقق من صحة البيانات وتحويلها إلى كائنات نطاق (domain objects).
*   **الكاتب**: `JdbcBatchItemWriter` يقوم بإدراجها في قاعدة بيانات على شكل دفعات.
*   **تدفق المهمة**:

    *   الخطوة 1: قراءة/معالجة/كتابة المعاملات.
    *   الخطوة 2: إنشاء تقرير ملخص.

---

## 4. المزايا

*   تكوين تصريحي (Java config أو XML).
*   قابلة للتوسع (خطوات متوازية، تقسيم، معالجة عن بعد للقطع).
*   معالجة قوية للأخطاء وإمكانية إعادة التشغيل.
*   التكامل مع نظام Spring البيئي (Spring Boot، Spring Data، إلخ).

---

✅ باختصار: **مهمة Spring Batch هي خط أنابيب مُنظم جيدًا من الخطوات حيث تتدفق البيانات من المدخلات → المعالجة → المخرجات، مع إدارة معاملات مدمجة، وتحمل للأخطاء، وإمكانية إعادة التشغيل.**

---

هل تريد مني أيضًا أن أعرض لك **مثالًا بسيطًا على كود التكوين باستخدام Java** لمهمة Spring Batch (مع قارئ، ومعالج، وكاتب) حتى تتمكن من رؤية كيف يبدو في التطبيق العملي؟