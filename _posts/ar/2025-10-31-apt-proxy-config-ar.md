---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: فحص تكوين واستخدام وكيل APT
translated: true
type: note
---

### التحقق مما إذا كان APT يستخدم بروكسي

لتأكيد ما إذا كان APT (مدير الحزم في أنظمة Debian/Ubuntu) مُهيأ لاستخدام بروكسي—وما إذا كان يتم تطبيقه فعليًا أثناء العمليات—يمكنك اتباع هذه الخطوات. يتضمن ذلك فحص ملفات التهيئة واختبار الاتصال. لاحظ أن APT لا يسجل استخدام البروكسي بشكل صريح بطريقة بسيطة، لذا فإن "التأكيد" يعني عادةً التحقق من الإعدادات ومراقبة السلوك أثناء التشغيل التجريبي.

#### 1. **فحص تهيئة البروكسي في APT**
   يتم تخزين إعدادات بروكسي APT في `/etc/apt/apt.conf` أو الملفات الموجودة في `/etc/apt/apt.conf.d/` (مثل `99proxy` أو ما شابه). ابحث عن الأسطر التي تُعرِّف `Acquire::http::Proxy` أو `Acquire::https::Proxy`.

   - **أمر للتحقق من جميع إعدادات البروكسي ذات الصلة**:
     ```
     apt-config dump | grep -i proxy
     ```
     - **ما يفعله**: يُخرج التهيئة الفعالة لـ APT ويُرشح المدخلات المتعلقة بالبروكسي. إذا رأيت ناتجًا مثل `Acquire::http::Proxy "http://proxy.example.com:8080/"`، فهذا يعني أنه مُهيأ.
     - **مثال على الناتج إذا تم تعيين بروكسي**:
       ```
       Acquire::http::Proxy "http://username:password@proxy.example.com:8080";
       Acquire::https::Proxy "http://proxy.example.com:8080";
       ```

   - **الفحص اليدوي للملفات**:
     ```
     grep -r "Proxy" /etc/apt/apt.conf* /etc/apt/apt.conf.d/
     ```
     - **ما يفعله**: يبحث في جميع ملفات تهيئة APT عن الكلمات المفتاحية "Proxy".

   إذا لم تظهر أي أسطر بروكسي، فإن APT **لا** يستخدم واحدًا (أي يتصل مباشرة).

#### 2. **اختبار ما إذا كان البروكسي يُستخدم فعليًا**
   التهيئة وحدها لا تؤكد الاستخدام—اختبر من خلال محاكاة عملية APت تقوم جلب البيانات من المستودعات (والتي ستوجه عبر البروكسي إذا تم تعيينه).

   - **اختبار أساسي: تشغيل تحديث**:
     ```
     sudo apt update
     ```
     - **ما يفعله**: يجلب قوائم الحزم من المستودعات. راقب الناتج:
       - النجاح (مثل "Hit:1 http://archive.ubuntu.com ...") يشير إلى الاتصال، على الأرجح عبر البروكسي إذا كان مُهيأ.
       - الأخطاء مثل "Failed to fetch" أو انتهاء المهلة تشير إلى مشاكل في البروكسي (مثل بيانات اعتماد خاطئة أو بروكسي غير قابل للوصول).
     - لرؤية المزيد من التفاصيل، أضف الوضوح: `sudo apt update -o Debug::Acquire::http=true`.

   - **اختبار التنزيل فقط (بدون إجراء تغييرات على النظام)**:
     ```
     sudo apt clean
     sudo apt -d --reinstall install hostname
     ```
     - **ما يفعله**: يمسح الذاكرة المؤقتة، ثم يتظاهر بإعادة تثبيت الحزمة الصغيرة المضمنة `hostname` دون التثبيت الفعلي (علم `-d` يقوم بالتنزيل فقط). تحقق من الناتج لمعرفة ما إذا كانت عمليات الجلب ناجحة. إذا نجح، فقد تم استخدام البروكسي (بافتراض أنه مُهيأ).

   - **متقدم: تتبع استدعاءات الشبكة (يتطلب `strace`)**:
     إذا أردت تأكيد اتصالات البروكسي أثناء التشغيل:
     ```
     sudo strace -e trace=connect sudo apt update 2>&1 | grep -i proxy
     ```
     - **ما يفعله**: يتتبع استدعاءات النظام الخاصة باتصالات الشبكة. ابحث عن اتصالات إلى IP/Port البروكسي الخاص بك بدلاً من خوادم المستودعات المباشرة (مثل `archive.ubuntu.com`).

#### المشاكل الشائعة والإصلاحات
- **إذا تطلب البروكسي المصادقة**: تأكد من أن التهيئة تستخدم `http://username:password@proxyhost:port`.
- **متغيرات البيئة**: يتجاهل APT بروكسي shell (`$http_proxy`)، لذا اعتمد على التهيئة المحددة لـ APT.
- **بخصوص أمرك `sudo apt --fix-broken install`**: يُصلح التبعيات المعطلة عن طريق إعادة تثبيت الحزم. إذا كان يفشل (مثل أخطاء الشبكة)، قم بتشغيله بعد التأكد من البروكسي باستخدام الاختبارات المذكورة أعلاه. غالبًا ما تظهر مشاكل البروكسي كفشل في الجلب—أصلح التهيئة أولاً، ثم أعد المحاولة.

إذا لم تحل هذه الخطوات المشكلة، شارك ناتج الخطأ لمزيد من المساعدة.

**المراجع**:
- [How to check if apt proxy configuration is correct? (Unix Stack Exchange)](https://unix.stackexchange.com/questions/49781/how-to-check-if-apt-proxy-configuration-is-correct)
- [How to Use APT with Proxy on Ubuntu and Debian (Linuxiac)](https://linuxiac.com/how-to-use-apt-with-proxy/)