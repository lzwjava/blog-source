---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: نظرة عامة على نظام التخزين المؤقت في كود إيجنتر
translated: true
type: note
---

### نظرة عامة على مكتبة التخزين المؤقت في CodeIgniter

فئة `CI_Cache` في CodeIgniter هي نظام تخزين مؤقت مرن يوفر واجهة موحدة لتخزين واسترجاع البيانات عبر مختلف أنظمة الخلفية (مثل الذاكرة، أو القائمة على الملفات، أو الخدمات الخارجية). وهي تمتد من `CI_Driver_Library`، التي تقوم بتحميل برامج التشغيل ديناميكيًا. تجرد الفئة عمليات التخزين المؤقت، مما يسمح للمطورين بالتبديل بين أنظمة الخلفية بسهولة عبر التكوين دون تغيير كود التطبيق. جميع الطرق تفوض إلى "المحول" النشط (فئة برنامج التشغيل)، مع دعم للاسترجاع لضمان الموثوقية.

يهتم النظام بالأداء، والقابلية للنقل، وتحمل الأخطاء—على سبيل المثال، فإنه يتراجع إلى برنامج تشغيل "دمى" (بدون عمليات) إذا فشلت البرامج الأخرى، مما يضمن أن التطبيق لا يتعطل بسبب مشاكل التخزين المؤقت.

### برامج تشغيل ومحولات التخزين المؤقت المدعومة

تدعم الفئة عدة برامج تشغيل، محددة في `$valid_drivers`:
- **apc**: يستخدم APC الخاص بـ PHP (بديل تخزين PHP المؤقت) للتخزين في الذاكرة (سريع، مدمج).
- **dummy**: عنصر نائب لا يفعل شيئًا (دائمًا ما يعود بـ TRUE أو FALSE)؛ يُستخدم كخيار استرجاع للتطوير/الاختبار.
- **file**: يخزن البيانات كملفات مُسلسلة في دليل (محدد بواسطة `$_cache_path`)، مناسب للمواقع ذات الحركة المنخفضة.
- **memcached**: واجهة لخدمة Memcached للتخزين المؤقت الموزع في الذاكرة (عالٍ الأداء، قابل للتطوير).
- **redis**: واجهة لـ Redis، وهو مخزن آخر في الذاكرة للمفتاح-قيمة مع ميزات مثل النشر/الاشتراك والعمليات الذرية.
- **wincache**: مخصص لنظام Windows لـ IIS (يستخدم Microsoft WinCache).

كل برنامج تشغيل هو فئة منفصلة (مثل `CI_Cache_memcached`) تنفذ طرقًا مثل `get()`, `save()`، إلخ. تقوم المكتبة بتحميل برنامج التشغيل ديناميكيًا بناءً على المصفوفة `$config['adapter']` التي يتم تمريرها إلى المُنشئ.

### التهيئة والتكوين

- **المنشئ**: يأخذ مصفوفة `$config` تحتوي على مفاتيح لـ `adapter` (برنامج التشغيل الأساسي)، و `backup` (برنامج التشغيل الاحتياطي)، و `key_prefix` (سلسلة تُضاف قبل جميع مفاتيح التخزين المؤقت للتسمية/العزل).
  - مثال على التكوين: `array('adapter' => 'redis', 'backup' => 'file', 'key_prefix' => 'myapp_')`.
- **منطق الاسترجاع**: بعد التهيئة، يتحقق مما إذا كان المحول الأساسي مدعومًا باستخدام `is_supported($driver)` (الذي يستدعي طريقة `is_supported()` لبرنامج التشغيل، لاختبار امتدادات PHP أو الخدمات المطلوبة).
  - إذا فشل الأساسي، فإنه ينتقل إلى برنامج التشغيل الاحتياطي. إذا فشل كلاهما، فإنه يسجل خطأ ويفترض استخدام "الدمى" (عبر `log_message()`).
  - يضمن هذا أن نظام التخزين المؤقت لديه دائمًا محول يعمل، مما يمنع التعطل.

يتم تعيين `$_cache_path` لبرامج التشغيل القائمة على الملفات، ولكنها لا تتم تهيئتها هنا—على الأرجح يتم التعامل معها في فئة برنامج تشغيل الملفات.

### الطرق الرئيسية وكيفية عملها

تضيف الطرق `key_prefix` إلى المعرفات للتحديد الفريد للنطاق (مثل `'myapp_user123'`) وتفوض إلى المحول النشط. جميع العمليات تعيد قيمًا منطقية، أو مصفوفات، أو بيانات مختلطة عند النجاح/الفشل.

- **get($id)**: يسترجع البيانات المخزنة مؤقتًا بواسطة المعرف.
  - مثال: `$data = $cache->get('user_profile');` — يستدعي طريقة `get()` للمحول.
  - إذا كان المفتاح موجودًا ولم ينتهي صلاحيته، فإنه يعيد البيانات؛ وإلا يعيد FALSE.
  - لا يوجد فرض مباشر لـ TTL هنا؛ يتم التعامل معه بواسطة برنامج التشغيل (مثل Redis أو Memcached يفرضان TTL داخليًا).

- **save($id, $data, $ttl = 60, $raw = FALSE)**: يخزن البيانات مع وقت الانتهاء (TTL) بالثواني.
  - مثال: `$cache->save('user_profile', $profile_data, 3600);` — يخزن مع انتهاء الصلاحية بعد ساعة واحدة.
  - علم `$raw` (افتراضيًا false) يشير إلى ما إذا كانت البيانات مُسلسلة—تقوم برامج التشغيل بالتعامل مع التسلسل إذا لزم الأمر (مثلاً، المصفوفات/الكائنات تتحول إلى سلاسل).
  - يعيد TRUE عند النجاح، مما يسهل المنطق الشرطي (مثلاً، إنشاء البيانات وتخزينها مؤقتًا إذا فشل الحفظ).

- **delete($id)**: يزيل عنصر تخزين مؤقت محدد.
  - مثال: `$cache->delete('user_profile');` — إزالة دائمة.

- **increment($id, $offset = 1)** و **decrement($id, $offset = 1)**: عمليات ذرية للقيم الرقمية (مفيدة للعدادات).
  - مثال: `$new_counter = $cache->increment('hits', 5);` — يزيد بمقدار 5 إذا كان مدعومًا من قبل برنامج التشغيل (مثل Redis/Memcached ذري؛ القائم على الملفات قد يحاكي ذلك).
  - ليس جميع برامج التشغيل تدعم raw/inc/dec (الدمى تفشل دائمًا)؛ يعيد القيمة الجديدة أو FALSE.

- **clean()**: يمسح جميع بيانات التخزين المؤقت لبرنامج التشغيل الحالي.
  - مثال: `$cache->clean();` — مفيد للتنظيف بعد التحديثات.
  - النوع "user" يستهدف البيانات المحددة للمستخدم، وليس ذاكرة التخزين المؤقت للنظام.

- **cache_info($type = 'user')**: يعيد بيانات وصفية عن التخزين المؤقت (مثل إحصائيات الخادم، أو أعداد المفاتيح، أو مسارات الملفات).
  - مثال: `$info = $cache->cache_info();` — مصفوفة من التفاصيل من برنامج التشغيل.

- **get_metadata($id)**: يحصل على تفاصيل عن عنصر مخزن مؤقت محدد (مثل وقت الانتهاء، الحجم).
  - مثال: `$meta = $cache->get_metadata('key');` — يساعد في التصحيح أو التحسين.

- **is_supported($driver)**: يتحقق من توفر برنامج التشغيل (يخزن النتائج باستخدام مصفوفة `$support` ثابتة لتجنب الفحوصات المتكررة).

### آليات إضافية

- **إضافة البادئة للمفتاح**: تُطبق تلقائيًا على جميع المعرفات (مثلاً، لعزل التطبيق أو تعدد المستأجرين). يتم تمكينها عبر التكوين لمنع تعارض المفاتيح عبر البيئات.
- **التسجيل**: يستخدم `log_message()` لرسائل التصحيح/الخطأ (مثل حالات الاسترجاع)، متكاملًا مع نظام التسجيل في CodeIgniter.
- **المرونة وتحمل الأخطاء**: من خلال تجريد أنظمة الخلفية، يمكنك التبديل من التخزين المؤقت للملفات (رخيص، محلي) إلى Redis (سريع، موزع) مع حد أدنى من التغييرات. يعني خيار الاسترجاع "الدمى" أن فشل التخزين المؤقت لا يوقف التطبيق—الطرق تعيد FALSE فقط، مما يسمح للكود بالمتابعة (مثلاً، جلب البيانات من قاعدة البيانات بدلاً من ذلك).
- **ملاحظات الأداء**: برامج التشغيل مثل APC/Redis تكون في الذاكرة (وصول سريع، أقل من جزء من الألف من الثانية). القائمة على الملفات أبطأ بسبب إدخال/إخراج القرص. يتم الالتزام بـ TTLs بشكل عام من قبل برامج التشغيل إلا في حالات نادرة محددة ببرنامج التشغيل.

هذا التصميم يجعل التخزين المؤقت في CodeIgniter معياريًا وموثوقًا. للحصول على تفاصيل حول برامج تشغيل محددة، تحقق من ملفات برنامج التشغيل (مثل `Cache_memcached.php`). ارجع دائمًا إلى وثائق CodeIgniter الرسمية للفروق الدقيقة الخاصة بالإصدار، حيث أن هذا الكود من إصدار أقدم (حوالي 2.0-3.x). إذا كان لديك طريقة أو برنامج تشغيل محدد في الاعتبار، يمكنني الخوض في تفاصيل أعمق!