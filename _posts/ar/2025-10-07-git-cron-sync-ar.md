---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: مزامنة جيت الآلية عبر كرون
translated: true
type: note
---

للمزامنة التلقائية للتحديثات من عمليات دفع Git في كمبيوتر محمول إلى نسخة مستنسخة في كمبيوتر محمول آخر (بدون `git pull` يدوي)، لا يمكنك الاعتماد على Git وحده للتحديثات "التلقائية" الفورية عبر الأجهزة — حيث أن Git يعتمد على آلية السحب (pull) في تصميمه. ومع ذلك، يمكنك إعداد مهمة مجدولة على الكمبيوتر المحمول الثاني لجلب ودمج التغييرات من المستودع البعيد (GitHub في حالتك) بشكل دوري. هذه هي الطريقة الأبسط والأكثر موثوقية لإعداد شخصي مثل إعدادك.

إليك كيفية القيام بذلك على جهاز Mac (بما أنك تستخدم MacBook Air). سنستخدم `cron` للجدولة، حيث إنه أداة مدمجة في النظام وخفيفة الوزن. افترض أن كلا الكمبيوترين المحمولين بهما نسخ مستنسخة من `github.com:lzwjava/blog-source`، وأنك تعمل على الفرع `main`.

### الخطوة 1: التأكد من إعداد مستودع الكمبيوتر المحمول الثاني بشكل صحيح
على الكمبيوتر المحمول الثاني:
1. انتقل إلى المستودع الخاص بك: `cd /path/to/blog-source`
2. تأكد من أنه يتتبع المستودع البعيد: `git remote -v` (يجب أن يظهر `origin` كمستودع GitHub الخاص بك).
3. إذا لم يكن مضافًا، أضفه: `git remote add origin git@github.com:lzwjava/blog-source.git`
4. احضر الحالة الحالية: `git fetch origin`
5. انتقل إلى الفرع main: `git checkout main`
6. عيّن الفرع المنبع (upstream): `git branch --set-upstream-to=origin/main main`

اختبر عملية السحب يدويًا: `git pull origin main`. يجب أن تعمل كما في الناتج الذي حصلت عليه.

### الخطوة 2: إنشاء نص برمجي (سكريبت) للسحب التلقائي
أنشئ نصًا برمجيًا بسيطًا (shell script) للتعامل مع عملية السحب بأمان (بحيث يجلب التحديثات، ويفحص وجود تعارضات، ويسحب إذا كان الوضع نظيفًا).

1. في المجلد الجذري لمستودعك، أنشئ ملف `auto-pull.sh`:
   ```bash:disable-run
   #!/bin/bash
   cd "$(dirname "$0")"  # الانتقال إلى دليل المستودع
   git fetch origin
   if git diff HEAD origin/main --quiet; then
       git pull origin main
       echo "Auto-pull completed: $(date)"
   else
       echo "Warning: Local changes detected. Skipping pull. Resolve manually: $(date)"
       # اختياري: إرسال بريد إلكتروني أو إشعار (انظر أدناه)
   fi
   ```

2. اجعله قابلاً للتنفيذ: `chmod +x auto-pull.sh`

هذا النص البرمجي:
- يجلب التحديثات دون دمج.
- يتحقق مما إذا كان الفرع المحلي نظيفًا (لا توجد تغييرات غير محفوظة).
- يسحب التحديثات فقط إذا كان الوضع آمنًا؛ وإلا، يحذرك.

### الخطوة 3: جدولته باستخدام Cron
يعمل Cron على تشغيل المهام بشكل دوري. سنقوم بتشغيله كل 5 دقائق (يمكنك تعديل الفترة حسب الحاجة، مثلاً كل ساعة).

1. افتح محرر crontab: `crontab -e` (استخدم nano إذا طُلب منك: `nano ~/.crontab`).

2. أضف هذا السطر في النهاية (لكل 5 دقائق):
   ```
   */5 * * * * /path/to/blog-source/auto-pull.sh >> /path/to/blog-source/pull-log.txt 2>&1
   ```
   - استبدل `/path/to/blog-source` بمسار المستودع الفعلي (مثال: `~/blog-source`).
   - الأمر `>> pull-log.txt` يسجل الناتج في ملف لأغراض التصحيح.

3. احفظ الملف واخرج (في nano: Ctrl+O، Enter، ثم Ctrl+X).
4. تحقق: `crontab -l` (يجب أن يظهر السطر الذي أضفته).
5. اختبر: انتظر 5 دقائق أو قم بتشغيل `crontab -e` مرة أخرى لإضافة `* * * * *` مؤقتًا (كل دقيقة)، ثم ارجع إلى الإعداد السابق.

يعمل Cron باسم المستخدم الخاص بك، وبالتالي يحترم مفتاح SSH الخاص بك للمصادقة على GitHub (كما في ناتج عملية السحب الخاصة بك).

### تحسينات اختيارية
- **معالجة التعارضات/الإشعارات**: إذا اكتشف النص البرمجي وجود مشاكل، أضف إشعارًا. قم بتعديل `auto-pull.sh` بإضافة:
  ```bash
  # في حالة التحذير، أرسل إشعار macOS
  osascript -e 'display notification "Git pull skipped due to local changes" with title "Blog Repo Sync"'
  ```
- **التشغيل عند الدفع (من الكمبيوتر المحمول الأول)**: لمزامنة أشبه بـ "الدفع"، استخدم GitHub Actions على الكمبيوتر المحمول الأول. أنشئ ملف `.github/workflows/sync.yml`:
  ```yaml
  name: Auto Sync
  on: [push]
  jobs:
    sync:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - name: Notify (e.g., via webhook to second laptop)
          run: curl -X POST https://your-second-laptop-webhook-endpoint  # قم بإعداد خادم بسيط على الكمبيوتر المحمول الثاني
  ```
  لكن هذا يتطلب وجود مستمع (listener) على الجهاز الثاني (عبر أداة مثل ngrok + تطبيق Flask صغير)، وهو أمر مبالغ فيه لمعظم الحالات.
- **مقايضة التكرار**: كل 5 دقائق مناسب لمستودع مدونة. للوقت الفعلي، فكر في استخدام أدوات مثل `watch` في طرفية (`watch -n 300 git pull`)، لكن cron يعمل دون تدخل.
- **ملاحظة حول الوكيل (Proxy)**: يظهر في ناتجك وجود HTTP/HTTPS proxies — سيرث cron هذه الإعدادات، لذا يجب أن تعمل عمليات السحب كما هي.

الآن، عندما تقوم بالدفع من الكمبيوتر المحمول الأول (`git push origin main`)، سيقوم الثاني بالمزامنة تلقائيًا كل 5 دقائق. راجع ملف `pull-log.txt` لمعرفة السجل.

إذا واجهت مشاكل في المصادقة أو الوكيل في cron، أضف `export HTTP_PROXY=http://127.0.0.1:7890` إلخ. إلى النص البرمجي. بالنسبة للكمبيوتر المحمول الآخر الذي يعمل بنظام Windows، استخدم "جدولة المهام" (Task Scheduler) بدلاً من ذلك.