---
audio: false
generated: true
lang: ar
layout: post
title: دليل شامل لكرون
translated: true
type: note
---

كرون هو مجدِّد زمني قائم على الوقت في أنظمة التشغيل الشبيهة بيونكس يسمح للمستخدمين بجدولة أوامر أو نصوص برمجية لتشغيل تلقائي في أوقات أو فترات محددة. إليك دليل شامل لفهم واستخدام كرون بفعالية.

## ما هو كرون؟

كرون هو برنامج خفي (خدمة خلفية) ينفذ الأوامر المجدولة. يقرأ ملفات الإعداد المسماة "crontabs" (جداول كرون) لتحديد وقت تشغيل أوامر معينة. كرون مثالي لـ:
- صيانة النظام الروتينية
- النسخ الاحتياطي الآلي
- جدولة معالجة البيانات الدورية
- تشغيل النصوص البرمجية في أوقات محددة
- أي مهمة تحتاج إلى التشغيل بانتظام دون تدخل يدوي

## مكونات كرون

### ملف Crontab

crontab (جدول كرون) هو ملف إعداد يحدد أوامر shell للتشغيل بشكل دوري. يمكن أن يكون لكل مستخدم crontab خاص به، وهناك أيضًا crontab شامل للنظام.

لتعديل crontab الشخصي:
```bash
crontab -e
```

لعرض crontab الحالي:
```bash
crontab -l
```

لإزالة crontab:
```bash
crontab -r
```

### بناء جملة Crontab

يمثل كل سطر في ملف crontab مهمة مجدولة ويتبع هذا التنسيق:

```
* * * * * command-to-execute
│ │ │ │ │
│ │ │ │ └─── يوم الأسبوع (0-6, الأحد=0)
│ │ │ └────ـ الشهر (1-12)
│ │ └──────ـ يوم الشهر (1-31)
│ └────────ـ الساعة (0-23)
└──────────ـ الدقيقة (0-59)
```

يمكن أن يحتوي كل موضع على:
- رقم محدد
- نطاق (مثال: `1-5`)
- قائمة قيم (مثال: `1,3,5`)
- علامة النجمة (`*`) وتعني "كل"
- قيمة خطوة (`*/n`) وتعني "كل n"

بعد حقول الوقت/التاريخ الخمسة تأتي الأمر المراد تنفيذه.

## أمثلة جداول كرون الشائعة

# أمثلة جداول كرون الشائعة

## الفواصل الزمنية الأساسية

| تعبير كرون | الوصف | مثال |
|----------------|-------------|---------|
| `* * * * *` | التشغيل كل دقيقة | `* * * * * date >> /tmp/date_log.txt` |
| `*/5 * * * *` | التشغيل كل 5 دقائق | `*/5 * * * * /scripts/check_server.sh` |
| `0 * * * *` | التشغيل عند بداية كل ساعة | `0 * * * * /scripts/hourly_backup.sh` |
| `0 0 * * *` | التشغيل عند منتصف الليل يوميًا | `0 0 * * * /scripts/daily_backup.sh` |
| `0 0 * * 0` | التشغيل عند منتصف الليل أيام الأحد | `0 0 * * 0 /scripts/weekly_maintenance.sh` |
| `0 0 1 * *` | التشغيل عند منتصف الليل في اليوم الأول من كل شهر | `0 0 1 * * /scripts/monthly_report.sh` |
| `0 0 1 1 *` | التشغيل عند منتصف الليل في 1 يناير (سنويًا) | `0 0 1 1 * /scripts/yearly_cleanup.sh` |

## أوقات محددة

| تعبير كرون | الوصف | مثال |
|----------------|-------------|---------|
| `30 8 * * 1-5` | التشغيل الساعة 8:30 صباحًا في أيام الأسبوع (الاثنين-الجمعة) | `30 8 * * 1-5 /scripts/workday_start.sh` |
| `0 18 * * 1-5` | التشغيل الساعة 6:00 مساءً في أيام الأسبوع | `0 18 * * 1-5 /scripts/workday_end.sh` |
| `0 9-17 * * *` | التشغيل عند بداية كل ساعة خلال ساعات العمل (9 صباحًا - 5 مساءً) | `0 9-17 * * * /scripts/hourly_check.sh` |
| `0 0,12 * * *` | التشغيل عند منتصف الليل والظهر | `0 0,12 * * * /scripts/twice_daily.sh` |

## مواصفات زمنية متعددة

| تعبير كرون | الوصف | مثال |
|----------------|-------------|---------|
| `0 */4 * * *` | التشغيل كل 4 ساعات | `0 */4 * * * /scripts/periodic_task.sh` |
| `0 4,16 * * *` | التشغيل الساعة 4:00 صباحًا و4:00 مساءً | `0 4,16 * * * /scripts/twice_daily_at_4.sh` |
| `15,45 * * * *` | التشغيل عند الدقيقة 15 و45 من كل ساعة | `15,45 * * * * /scripts/quarter_hourly.sh` |

## مواصفات زمنية خاصة

| تعبير كرون | الوصف | مثال |
|----------------|-------------|---------|
| `@reboot` | التشغيل مرة واحدة عند بدء التشغيل | `@reboot /scripts/startup_task.sh` |
| `@yearly` أو `@annually` | التشغيل مرة واحدة سنويًا (`0 0 1 1 *`) | `@yearly /scripts/annual_task.sh` |
| `@monthly` | التشغيل مرة واحدة شهريًا (`0 0 1 * *`) | `@monthly /scripts/monthly_task.sh` |
| `@weekly` | التشغيل مرة واحدة أسبوعيًا (`0 0 * * 0`) | `@weekly /scripts/weekly_task.sh` |
| `@daily` أو `@midnight` | التشغيل مرة واحدة يوميًا (`0 0 * * *`) | `@daily /scripts/daily_task.sh` |
| `@hourly` | التشغيل مرة واحدة كل ساعة (`0 * * * *`) | `@hourly /scripts/hourly_task.sh` |

## أمثلة معقدة

| تعبير كرون | الوصف | مثال |
|----------------|-------------|---------|
| `0 0 */2 * *` | التشغيل عند منتصف الليل كل يومين | `0 0 */2 * * /scripts/every_other_day.sh` |
| `0 3 * * 1,3,5` | التشغيل الساعة 3:00 صباحًا يوم الاثنين والأربعاء والجمعة | `0 3 * * 1,3,5 /scripts/mwf_task.sh` |
| `30 23 * * 2,4` | التشغيل الساعة 11:30 مساءً يومي الثلاثاء والخميس | `30 23 * * 2,4 /scripts/tue_thu_night.sh` |
| `45 11 1-7 * *` | التشغيل الساعة 11:45 صباحًا خلال الأسبوع الأول من كل شهر | `45 11 1-7 * * /scripts/first_week_task.sh` |
| `0 20 * 10,11,12 *` | التشغيل الساعة 8:00 مساءً خلال أكتوبر، نوفمبر، وديسمبر | `0 20 * 10,11,12 * /scripts/q4_evening_task.sh` |
| `0 9-17/2 * * 1-5` | التشغيل كل ساعتين خلال ساعات العمل في أيام الأسبوع | `0 9-17/2 * * 1-5 /scripts/biweekly_workday.sh` |


## سلاسل كرون الخاصة

يدعم كرون أيضًا عدة سلاسل خاصة للمواصفات الزمنية الشائعة:

- `@reboot`: التشغيل مرة واحدة عند بدء التشغيل
- `@yearly` أو `@annually`: التشغيل مرة واحدة سنويًا (مكافئ لـ `0 0 1 1 *`)
- `@monthly`: التشغيل مرة واحدة شهريًا (مكافئ لـ `0 0 1 * *`)
- `@weekly`: التشغيل مرة واحدة أسبوعيًا (مكافئ لـ `0 0 * * 0`)
- `@daily` أو `@midnight`: التشغيل مرة واحدة يوميًا (مكافئ لـ `0 0 * * *`)
- `@hourly`: التشغيل مرة واحدة كل ساعة (مكافئ لـ `0 0 * * *`)

## التعامل مع المخرجات والأخطاء

بشكل افتراضي، يرسل كرون مخرجات الأوامر عبر البريد الإلكتروني إلى المستخدم الذي يمتلك crontab. يمكنك توجيه المخرجات إلى ملف أو تجاهلها:

```bash
# إلحاق المخرجات بملف سجل
30 5 * * * /path/to/script.sh >> /path/to/logfile.log 2>&1

# تجاهل كل المخرجات
0 12 * * * /path/to/script.sh > /dev/null 2>&1
```

## متغيرات البيئة في كرون

تعمل مهام كرون ببيئة محدودة، مما قد يتسبب في فشل النصوص البرمجية. يمكنك تعيين المتغيرات في ملف crontab:

```bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
SHELL=/bin/bash
MAILTO=your-email@example.com

# ستستخدم المهام الآن متغيرات البيئة هذه
0 5 * * * /path/to/script.sh
```

## اعتبارات أمنية لكرون

1. استخدم المسارات المطلقة لجميع الأوامر والنصوص البرمجية
2. قيد أذونات ملف crontab
3. استخدم مبدأ الامتياز الأقل عند إعداد مهام كرون
4. سجل وراقب مخرجات مهام كرون لتصحيح الأخطاء
5. فكر في استخدام مستخدم مخصص لمهام كرون الحساسة

## استكشاف أخطاء مهام كرون وإصلاحها

تشمل المشكلات الشائعة مع مهام كرون:

1. **المهمة لا تعمل**: تحقق من الأذونات والمسارات
2. **مشكلات التوقيت**: تحقق من صحة تنسيق الوقت
3. **مشكلات البيئة**: تأكد من تعيين المتغيرات اللازمة
4. **أخطاء النص البرمجي**: اختبر النص البرمجي يدويًا أولاً

تحقق من سجلات النظام للرسائل المتعلقة بكرون:
```bash
grep CRON /var/log/syslog
```

## بدائل كرون

بينما كرون منتشر، هناك بدائل:

- **Anacron**: أفضل للأنظمة التي لا تعمل 24/7
- **Systemd Timers**: بديل حديث في الأنظمة القائمة على systemd
- **Fcron**: كرون محسن بميزات تشبه anacron
- **Schedule**: مجدِّدات مهام عالية المستوى تُستخدم غالبًا في تطبيقات الويب

## استخدام كرون المتقدم

### تشغيل المهام كمستخدمين مختلفين

لتعديل crontab لمستخدم آخر (يتطلب صلاحيات root):
```bash
sudo crontab -u username -e
```

### جداول Crontab الشاملة للنظام

يمكن إضافة مهام كرون شاملة للنظام إلى:
- `/etc/crontab`
- الملفات في `/etc/cron.d/`
- أدلة مثل `/etc/cron.daily/`، `/etc/cron.hourly/`، إلخ.

يشمل بناء جملة crontabs النظام حقل مستخدم إضافي:
```
* * * * * user command-to-execute
```

### تشغيل مهام كرون ببيئة محددة

أنشئ نصًا برمجيًا غلافيًا لإعداد البيئة قبل تشغيل الأمر الفعلي:

```bash
#!/bin/bash
source /home/user/.profile
cd /path/to/working/directory
/path/to/actual/command
```

ثم استدعِ هذا النص البرمجي الغلافي من كرون.

## أفضل الممارسات لمهام كرون

1. **وثِّق مهام كرون**: أضف تعليقات لشرح ما تفعله كل مهمة
2. **استخدم أسماء نصوص برمجية وصفيّة**: يسهل الصيانة
3. **سجل المخرجات**: احفظ مخرجات المهام لاستكشاف الأخطاء وإصلاحها
4. **راقب تنفيذ المهام**: نفِّذ المراقبة للمهام الحرجة
5. **تعامل مع الإخفاقات بأسلوب أنيق**: أضف معالجة الأخطاء إلى نصوصك البرمجية
6. **استخدم ملفات القفل**: امنع التنفيذ المتداخل عندما تستغرق المهام وقتًا أطول من المتوقع
7. **ضع في اعتبارك المناطق الزمنية**: كن على علم بإعدادات المنطقة الزمنية للنظام

باتباع هذا الدليل، يجب أن تكون قادرًا على إعداد وإدارة واستكشاف أخطاء مهام كرون على نظامك الشبيه بيونكس وإصلاحها بفعالية.