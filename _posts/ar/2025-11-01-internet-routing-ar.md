---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: كيفية عمل توجيه الإنترنت
translated: true
type: note
---

نعم، أنت محق تمامًا بشأن التدفق عالي المستوى — بمجرد أن يحصل جهاز الكمبيوتر الخاص بك على عنوان IP (مثل 106.63.15.9 لـ weibo.com)، يبدأ اتصالًا يقفز عبر شبكتك المحلية، والموجه الخاص بك، وبنية مزود خدمة الإنترنت التحتية، وعبر الموجهات المترابطة للإنترنت ("طبقة تلو الأخرى") حتى يصل إلى الخادم الهدف. يتم التعامل مع كل هذا تلقائيًا من خلال مجموعة بروتوكولات TCP/IP، دون أن تقوم بأي شيء يدوي سوى كتابة الرابط أو تشغيل أمر مثل `ping`.

سأقوم بشرح ذلك خطوة بخطوة، مع ربط ناتج `ping` و `traceroute` الخاص بك للسياق. سأحافظ على الطابع العملي وأركز على ما يحدث خلف الكواليس، بافتراض إعداد منزلي نموذجي مثل إعدادك (جهاز Mac على Wi-Fi/Ethernet خلف موجه).

### 1. **تحليل DNS (الحصول على عنوان IP)**
   - قبل أي اتصال، يقوم جهاز الكمبيوتر الخاص بك أولاً بترجمة اسم النطاق (مثل "weibo.com") إلى عنوان IP عبر نظام اسم النطاق (DNS). يحدث هذا من خلال محلل DNS الخاص بنظام التشغيل الخاص بك، والذي يستعلم عن خوادم DNS العامة (مثل 8.8.8.8 من جوجل).
   - في حالتك، `ping weibo.com` يقوم تلقائيًا بإجراء هذا التحليل، مؤكدًا أن 106.63.15.9 هو عنوان IPv4. (ملاحظة: الوكالات مثل الوكيل المحلي الخاص بك على 127.0.0.1:7890 تتعامل عادةً مع حركة مرور HTTP/HTTPS، ولكن `ping` يستخدم IP/ICMP مباشرًا، لذا فهو يتجاوز الوكيل.)
   - إذا فشل تحليل DNS، لا يحدث أي اتصال—كل شيء يتوقف هنا.

### 2. **جهازك يُجهز الحزمة (الجانب المحلي)**
   - بمجرد حصوله على عنوان IP، يقوم جهاز Mac الخاص ببناء **حزمة** (قطعة من البيانات) باستخدام طبقات TCP/IP:
     - **طبقة التطبيق**: الأمر أو التطبيق (مثل المتصفح أو `ping`) يطلب البيانات. يرسل `Ping` طلب ICMP "echo request" (رسالة بسيطة "مرحبًا، هل أنت موجود؟").
     - **طبقة النقل**: يضيف رؤوس TCP/UDP (للموثوقية/أرقام المنافذ) أو ICMP لـ ping. يستخدم ping الخاص بك ICMP، مع 56 بايت من البيانات + الرؤوس = حزم 64-بايت.
     - **طبقة الشبكة (IP)**: يغلّفها في رأس IP مع المصدر (عنوان IP المحلي الخاص بك، مثل 192.168.1.x) والوجهة (106.63.15.9). هنا تبدأ قرارات التوجيه.
     - **طبقة الربط (Ethernet/Wi-Fi)**: يضيف عناوين MAC للقفزة المحلية على الشبكة. يستخدم جهاز الكمبيوتر الخاص بك ARP (بروتوكول تحليل العنوان) للعثور على عنوان MAC الخاص بالموجه.
     - **الطبقة المادية**: يحولها إلى إشارات كهربائية عبر الكابل/Wi-Fi الخاص بك.
   - يعرف جهاز الكمبيوتر الخاص بك أنه لا يمكنه الوصول إلى 106.63.15.9 مباشرة (فهو ليس على شبكتك المحلية 192.168.1.0/24)، لذا يرسل الحزمة إلى **البوابة الافتراضية** — الموجه الخاص بك على 192.168.1.1.

### 3. **القفزة المحلية: الكمبيوتر → الموجه**
   - هذه هي الخطوة الأولى (والأسرع)، كما هو موضح في ناتج `traceroute` الخاص بك:
     ```
     1  192.168.1.1 (192.168.1.1) 26.903 ms 3.150 ms 3.161 ms
     ```
     - `Traceroute` (الذي يرسل حزمًا بزيادة TTL — وقت العيش — لرسم المسار) يؤكد أن هذه القفزة تستغرق حوالي 3-27 مللي ثانية ذهابًا وإيابًا.
     - يستقبل الموجه الخاص بك الحزمة، يزيل رأس Ethernet المحلي، ويعيد تغليفها للقفزة التالية. يستخدم جدول التوجيه الخاص به لإعادة توجيهها نحو الإنترنت (عبر اتصال WAN/مزود الخدمة الخاص به).
     - الوكالات لا تؤثر على هذا — الوكيل المحلي الخاص بك (المنفذ 7890) مخصص فقط لحركة مرور مستوى التطبيق مثل تصفح الويب، وليس لتوجيه IP المباشر.

### 4. **الموجه → مزود الخدمة → العمود الفقري للإنترنت (التوجيه "طبقة تلو الأخرى")**
   - يتصل الموجه الخاص بك بمزود خدمة الإنترنت الخاص بك (على سبيل المثال، عبر PPPoE، أو DHCP، أو المودم) ويسلم الحزمة إلى موجه حافة مزود الخدمة. قد يتضمن هذا NAT (ترجمة عنوان الشبكة) على الموجه الخاص بك، حيث يتم استبدال عنوان IP الخاص بك (192.168.1.x) بالعنوان العام الذي يعيّنه مزود الخدمة الخاص بك.
   - من هنا، إنها سلسلة من **الموجهات** عبر الإنترنت:
     - **موجهات مزود الخدمة**: يقوم مزود الخدمة الخاص بك (مثل Comcast أو China Telecom) بتوجيهها عبر شبكته الأساسية. كل موجه يقلل TTL (يبدأ عند 64 في traceroute الخاص بك) ويوجه بناءً على جداول BGP (بروتوكول البوابة الحدودية) — وهي في الأساس خريطة عالمية لأفضل مسار إلى 106.63.15.9.
     - **القفزات بين مزودي الخدمة/العمود الفقري**: تعبر الحزم "نقاط التبادل" بين مزودي الخدمة (على سبيل المثال، عبر الكابلات تحت البحر، الألياف البصرية). قد يكون هذا 5-20 قفزة إجمالاً، اعتمادًا على الجغرافيا. عنوان IP لـ Weibo.com (106.63.15.9) موجود في الصين، لذا من موقعك (تخمين US/EU بناءً على الوكيل)، سيمر عبر الطرق عبر المحيط الهادئ.
     - كل قفزة هي موجه يفحص رأس IP، يقرر البوابة التالية، ويعيد التوجيه. لا يوجد جهاز واحد يعرف المسار الكامل — إنه نظام موزع.
   - تم قطع `traceroute` الخاص بك (ربما تم إيقافه مؤقتًا بـ ^Z)، ولكن إذا قمت بتشغيله بالكامل، فسترى 10-15 سطرًا إضافيًا مثل:
     ```
     2  [عنوان IP لموجه مزود الخدمة] 10 مللي ثانية ...
     3  [نواة مزود الخدمة] 15 مللي ثانية ...
     ...
     15  106.63.15.9  40 مللي ثانية ...
     ```
     - تضيف الأوقات: يظهر ping الخاص بك ~40 مللي ثانية إجمالي RTT (وقت الذهاب والإياب)، لذا فإن الوقت من طرف إلى طرف للخادم هو ~20 مللي ثانية.

### 5. **الخادم الهدف يستقبل ويستجيب**
   - تصل الحزمة إلى خادم Weibo (أو موازن حمل على 106.63.15.9). يعكس العملية: يرد برد ICMP echo reply (لـ ping) أو TCP SYN-ACK (لاتصال ويب).
   - يتبع الرد مسارًا مشابهًا للعودة، غالبًا نفس المسار ولكن ليس دائمًا (توجيه الإنترنت غير متماثل).
   - يؤكد `ping` الخاص بك النجاح: TTL=52 يعني ~12 قفزة (64-52=12)، وزمن الانتقال 40 مللي ثانية يتطابق مع رحلة ذهاب وإياب بين الصين والولايات المتحدة.

### لماذا يشعرك بأنه "سحري" (والمشاكل الشائعة)
- **الأتمتة**: يتعامل نظام التشغيل/النواة الخاص بك مع كل هذا عبر مكدس الشبكة (على سبيل المثال، يظهر `ifconfig` أو `ip route` مساراتك). لا حاجة للتكوين اليدوي إلا إذا كنت تبحث عن الأخطاء وتصلحها.
- **الوكيل الخاص بك**: إنه شفاف لـ ping/traceroute ولكنه سيعترض حركة مرور المتصفح إلى weibo.com، ويوجهها عبر 127.0.0.1:7890 (على الأرجح لتجاوز VPN/الرقابة). قم بتعطيله باستخدام `unset HTTP_PROXY HTTPS_PROXY` إذا كنت تختبر حركة مرور مباشرة.
- **إذا فشل**: الجدران النارية، عدم تطابق MTU، أو انقطاع المسار يمكن أن يتسبب في فقدان الحزم. تتيح لك أدوات مثل `tcpdump` أو Wireshark مراقبة هذا محليًا.
- **ملاحظة أمنية**: يمكن أن تتغير عناوين IP (TTL لـ DNS)، ويضيف HTTPS التشفير فوق هذا (مصافحة TLS بعد اتصال TCP).

باختصار، نعم — الكمبيوتر → الموجه → مزود الخدمة → شبكة الموجهات العالمية → الخادم. إنه نظام موزع جميل مبني على توجيه IP. إذا شاركت traceroute كاملًا أو أردت الخوض في جزء محدد (مثل مصافحة TCP للويب)، دعني أعلم!

[TCP/IP Illustrated (كتاب عن أساسيات الشبكات)](https://www.oreilly.com/library/view/tcp-ip-illustrated-volume/0201633469/)  
[كيف يعمل Traceroute (شرح Cloudflare)](https://www.cloudflare.com/learning/network-layer/what-is-traceroute/)