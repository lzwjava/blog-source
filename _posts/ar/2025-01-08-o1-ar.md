---
audio: true
lang: ar
layout: post
title: إصلاح تدفق عمل GitHub LaTeX باستخدام ChatGPT o1
translated: true
---

أخيرًا، واجهت مشكلة مع حزمة `fontawesome5` في تدفق GitHub. لم ينجح الحل المقترح من قبل 4o-mini (استخدام TeX Live 2021 و `tlmgr install fontawesome5`)، لكن 4o اقترح نهجًا أفضل (استخدام TeX Live 2023 وما زلنا نستخدم `tlmgr` لتثبيت `fontawesome5`)، وأنا أجربه حاليًا. لم يحل ذلك المشكلة تمامًا، ولكن التحويل إلى TeX Live 2023 بدلاً من 2021 أحدث تحسنًا كبيرًا.

---

## إجابة 4o-mini

الخطأ الذي تراه يتعلق بأن `tlmgr` (مدير TeX Live) لم يتم تهيئته بشكل صحيح في وضع المستخدم. تشير الرسالة `tlmgr: user mode not initialized, please read the documentation!` إلى أن `tlmgr` لا يتم إعداده بشكل صحيح في بيئة المستخدم.

إليك تفسيرًا لكيفية إصلاح ذلك:

### إصلاح خطأ `tlmgr` في وضع المستخدم

1. **تعيين `tlmgr` إلى وضع المستخدم بشكل صحيح**:
   تحتاج إلى إخبار `tlmgr` بالتشغيل في وضع المستخدم والتأكد من تهيئته بشكل صحيح. للقيام بذلك في نصك، اتبع الخطوات التالية:

   - تأكد من استخدام `tlmgr` في وضع المستخدم من خلال تعيين المتغير البيئي المناسب.
   - يمكنك أيضًا تهيئة دليل TeX Live الخاص بالمستخدم قبل استخدام `tlmgr`.

2. **تهيئة `tlmgr` في وضع المستخدم**:
   قبل تشغيل أوامر `tlmgr`، تأكد من تهيئة `tlmgr` باستخدام الأمر التالي:
   bash
   tlmgr init-usertree
   

   سيقوم هذا بإنشاء شجرة TeX Live الخاصة بالمستخدم في `~/texmf`. بمجرد التهيئة، يمكنك بعد ذلك تشغيل أوامر `tlmgr update` و `install`.

3. **تعديل ملف تدفق GitHub Actions**:
   قم بتحديث ملف تدفق GitHub Actions ليتضمن خطوة التهيئة. إليك مثال على كيفية تعديل التدفق:

   yaml
   - name: تعيين tlmgr إلى وضع المستخدم
     run: |
       # تهيئة دليل TeX Live الخاص بالمستخدم
       tlmgr init-usertree
       tlmgr update --self
       tlmgr install fontawesome5
   

### مثال كامل:

إذا كنت تشغل هذا كجزء من تدفق GitHub Actions أكبر، يمكنك دمج هذه التغييرات في قسم الوظيفة المعني:

yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: تثبيت TeX Live (xelatex)
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-xetex
          tlmgr init-usertree  # تهيئة شجرة TeX Live الخاصة بالمستخدم
          tlmgr update --self  # تحديث tlmgr نفسه
          tlmgr install fontawesome5  # تثبيت الحزمة المطلوبة


### شرح الأوامر:

- `tlmgr init-usertree`: تهيئة شجرة TeX Live الخاصة بالمستخدم (عادة ما تكون في `~/texmf`).
- `tlmgr update --self`: تحديث الحزمة `tlmgr` نفسها إلى الإصدار الأحدث.
- `tlmgr install fontawesome5`: تثبيت الحزمة `fontawesome5`.

### ملاحظات إضافية:

- **الأذونات**: تأكد من أن المستخدم الذي يشغل تدفق GitHub Actions لديه الأذونات لتثبيت وتعديل الملفات في دليل TeX Live الخاص بالمستخدم.
- **متغيرات البيئة**: إذا كنت تعمل مع مسارات مخصصة، فقد تحتاج إلى تعديل `TEXMFSYSVAR` أو `TEXMFHOME` للإشارة إلى دلائلك المحددة.

من خلال التأكد من أن `tlmgr` مهيأ في وضع المستخدم وإعداده بشكل صحيح في تدفق GitHub Actions، يجب حل الخطأ. دعني أعرف إذا كان هذا يعمل أو إذا واجهت أي مشاكل أخرى!

### إجابة o1

أفهم أنك تواجه مشاكل مع `tlmgr` (مدير TeX Live) في تدفق GitHub Actions، وبالتحديد عند محاولة تثبيت الحزمة `fontawesome5`. تشير الرسالة الخطأ:


TLPDB: not a directory, not loading: /home/runner/texmf
tlmgr: user mode not initialized, please read the documentation!
Error: Process completed with exit code 2.


إلى أن `tlmgr` غير قادر على العمل في "وضع المستخدم" لأن الدلائل والإعدادات اللازمة لم يتم إعدادها بشكل صحيح. تنشأ هذه المشكلة غالبًا عند استخدام تثبيتات TeX Live التي يوفرها مديرو الحزم مثل `apt-get`، والتي قد تكون لها وظائف محدودة مقارنة بتثبيت TeX Live كامل من TUG (مجموعة مستخدمي TeX).

لحل ذلك، أنصح بـ **تثبيت TeX Live 2023 يدويًا** ضمن تدفق GitHub Actions. يضمن هذا النهج أن `tlmgr` يتمتع بوظائف كاملة ويمكنه تثبيت حزم إضافية مثل `fontawesome5` دون مشاكل.

### الحل خطوة بخطوة:

1. **إزالة تثبيت TeX Live النظامي**:
   - تجنب استخدام `apt-get install texlive-xetex` حيث يوفر تثبيتًا جزئيًا لـ TeX Live بوظائف `tlmgr` محدودة.

2. **تثبيت TeX Live 2023 يدويًا**:
   - قم بتنزيل وتثبيت TeX Live مباشرة من TUG.

3. **تكوين متغير البيئة PATH**:
   - تأكد من أن ثنائيات TeX Live متاحة من خلال تحديث متغير البيئة PATH.

4. **استخدام `tlmgr` لتثبيت الحزم المطلوبة**:
   - قم بتحديث `tlmgr` وتثبيت `fontawesome5`.

5. **تحسين التدفق مع التخزين المؤقت (اختياري)**:
   - قم بتخزين تثبيت TeX Live لتسريع تشغيلات التدفق المستقبلية.

### تدفق GitHub Actions محدث:

فيما يلي نسخة محدثة من تدفق GitHub Actions الخاص بك الذي يتضمن تثبيت TeX Live 2023 يدويًا ويضبط `tlmgr` لتثبيت الحزمة `fontawesome5`.

yaml
name: Deploy Jekyll with GitHub Pages dependencies preinstalled

on:
  push:
    branches: ["master"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  awesome-cv-copy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Make
        run: sudo apt-get update && sudo apt-get install -y make

      - name: Cache TeX Live
        uses: actions/cache@v3
        with:
          path: /usr/local/texlive/2023
          key: ${{ runner.os }}-texlive-2023
          restore-keys: |
            ${{ runner.os }}-texlive-

      - name: Install TeX Live 2023
        if: steps.cache-texlive.outputs.cache-hit != 'true'
        run: |
          # Install dependencies for TeX Live installer
          sudo apt-get update
          sudo apt-get install -y perl wget xz-utils

          # Download TeX Live installer
          wget http://mirror.ctan.org/systems/texlive/tlnet/install-tl-unx.tar.gz
          tar -xzf install-tl-unx.tar.gz
          cd install-tl-*/

          # Create a texlive.profile for automated installation
          cat <<EOF > texlive.profile
          selected_scheme scheme-full
          TEXDIR /usr/local/texlive/2023
          TEXMFCONFIG ~/.texlive2023/texmf-config
          TEXMFHOME ~/texmf
          TEXMFLOCAL /usr/local/texlive/2023/texmf-local
          TEXMFSYSCONFIG /usr/local/texlive/2023/texmf-config
          TEXMFSYSVAR /usr/local/texlive/2023/texmf-var
          binary_x86_64-linux 1
          collection-basic 1
          collection-latex 1
          collection-fontsrecommended 1
          EOF

          # Run the installer with the profile
          sudo ./install-tl --profile=texlive.profile

      - name: Add TeX Live to PATH
        run: echo "/usr/local/texlive/2023/bin/x86_64-linux" >> $GITHUB_PATH

      - name: Update tlmgr and Install fontawesome5
        run: |
          tlmgr update --self
          tlmgr install fontawesome5

      - name: Run make awesome-cv-copy
        run: make awesome-cv-copy

  build:
    runs-on: ubuntu-latest
    needs: awesome-cv-copy
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python 3
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install python-frontmatter

      - name: Generate notes links
        run: |
          python scripts/generate_notes_link.py

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Build with Jekyll
        uses: actions/jekyll-build-pages@v1
        with:
          source: ./
          destination: ./_site

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4


### شرح مفصل:

1. **التحقق من المستودع**:
   - يستخدم الإجراء `actions/checkout@v4` لاستنساخ المستودع.

2. **إعداد Make**:
   - يقوم بتثبيت `make` باستخدام `apt-get`، مما يضمن توفره لبناء السيرة الذاتية الخاصة بك.

3. **تخزين TeX Live في الذاكرة المؤقتة**:
   - يستخدم `actions/cache@v3` لتخزين تثبيت TeX Live الموجود في `/usr/local/texlive/2023`. يقلل هذا بشكل كبير من وقت التثبيت للإجراءات المستقبلية.

4. **تثبيت TeX Live 2023**:
   - **التنفيذ المشروط**: يضمن الشرط `if: steps.cache-texlive.outputs.cache-hit != 'true'` أن TeX Live يتم تثبيته فقط إذا لم يكن مخزنًا في الذاكرة المؤقتة.
   - **تثبيت التبعيات**: يقوم بتثبيت التبعيات اللازمة مثل Perl و `wget` و `xz-utils`.
   - **تنزيل واستخراج المثبت**: يقوم بتنزيل أحدث مثبت TeX Live من CTAN واستخراجه.
   - **إنشاء ملف التثبيت**: يتم إنشاء `texlive.profile` لتلقائية عملية التثبيت. يحدد هذا الملف:
     - **`selected_scheme scheme-full`**: يقوم بتثبيت التوزيع الكامل لـ TeX Live. يمكنك تعديله لتثبيت مخطط مصغر إذا رغبت.
     - **الدلائل**: يحدد مكان تثبيت TeX Live وإعداداته.
     - **المجموعات**: يحدد مجموعات أساسية مثل `basic` و `latex` و `fontsrecommended`.
   - **تشغيل المثبت**: يقوم بتشغيل المثبت باستخدام الملف المحدد، وتثبيت TeX Live 2023 إلى `/usr/local/texlive/2023`.

5. **إضافة TeX Live إلى PATH**:
   - يقوم بتحديث متغير البيئة PATH من خلال إضافة دليل الثنائيات TeX Live. يضمن هذا أن أوامر `tlmgr` و TeX Live الأخرى متاحة في الخطوات اللاحقة.

6. **تحديث `tlmgr` وتثبيت `fontawesome5`**:
   - **تحديث `tlmgr`**: يضمن أن `tlmgr` نفسه على آخر إصدار.
   - **تثبيت `fontawesome5`**: يستخدم `tlmgr` لتثبيت الحزمة `fontawesome5`، مما يحل مشكلتك الأولية.

7. **تشغيل أمر make**:
   - يقوم بتنفيذ `make awesome-cv-copy` لبناء السيرة الذاتية الخاصة بك باستخدام الإعداد المثبت لـ TeX Live.

8. **مهام البناء والنشر**:
   - تبقى هذه إلى حد كبير دون تغيير، ولكنها تضمن توفر تثبيت TeX Live عبر التدفق بسبب متغير البيئة PATH المحدث.

### توصيات إضافية:

- **وقت تثبيت TeX Live**:
  - **التخزين المؤقت**: تضمين خطوة `actions/cache@v3` تساعد في التقليل من وقت التثبيت من خلال تخزين TeX Live بعد التشغيل الأول. تأكد من أن مفتاح الذاكرة المؤقتة (`${{ runner.os }}-texlive-2023`) يعكس إصدار TeX Live بدقة لتجنب تعارض الذاكرة المؤقتة.

- **تخصيص تثبيت TeX Live**:
  - إذا لم تكن بحاجة إلى التوزيع الكامل لـ TeX Live، يمكنك تعديل `texlive.profile` لتثبيت مجموعات محددة فقط، مما يقلل من وقت التثبيت واستخدام القرص. على سبيل المثال، استبدل `scheme-full` بـ `scheme-basic` وحدد المجموعات الضرورية فقط.

- **معالجة PATH بشكل صحيح**:
  - استخدام `echo "/usr/local/texlive/2023/bin/x86_64-linux" >> $GITHUB_PATH` يضمن إضافة ثنائيات TeX Live إلى PATH لجميع الخطوات اللاحقة في الوظيفة. هذا مهم لضمان عمل أوامر `tlmgr` و LaTeX بشكل صحيح.

### نصائح لاستكشاف الأخطاء:

1. **مشاكل الذاكرة المؤقتة**:
   - تأكد من أن مفتاح الذاكرة المؤقتة يعكس إصدار TeX Live بدقة. إذا قمت بتحديث TeX Live أو تغيير مسار التثبيت، قم بتحديث مفتاح الذاكرة المؤقتة بشكل مناسب.

2. **فشل في التثبيت**:
   - تحقق من سجلات GitHub Actions لمعرفة أي أخطاء أثناء تثبيت TeX Live. المشاكل الشائعة تتضمن مشاكل الشبكة عند تنزيل المثبت أو الأذونات غير الكافية.

3. **أخطاء تثبيت الحزم**:
   - إذا فشل `tlmgr` في تثبيت `fontawesome5`، تحقق من أن اسم الحزمة صحيح وأنه متاح في مستودع TeX Live.

4. **مشاكل PATH**:
   - تأكد من تحديث PATH بشكل صحيح. يمكنك إضافة خطوة لطباعة PATH للتصحيح:
     yaml
     - name: Print PATH
       run: echo $PATH
     

5. **قيود سعة القرص**:
   - تستخدم مشغلات GitHub Actions مساحة قرص محدودة. يمكن أن يستهلك تثبيت TeX Live الكامل مساحة كبيرة. إذا واجهت مشاكل مساحة، جرب تثبيت توزيع TeX Live مصغر.

### مثال نهائي للتدفق مع التحقق:

إليك تدفقًا أكثر شمولاً يتضمن خطوات تحقق للتأكد من إعداد كل شيء بشكل صحيح:

yaml
name: Deploy Jekyll with GitHub Pages dependencies preinstalled

on:
  push:
    branches: ["master"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  awesome-cv-copy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Make
        run: sudo apt-get update && sudo apt-get install -y make

      - name: Cache TeX Live
        uses: actions/cache@v3
        with:
          path: /usr/local/texlive/2023
          key: ${{ runner.os }}-texlive-2023
          restore-keys: |
            ${{ runner.os }}-texlive-

      - name: Install TeX Live 2023
        if: steps.cache-texlive.outputs.cache-hit != 'true'
        run: |
          # Install dependencies for TeX Live installer
          sudo apt-get update
          sudo apt-get install -y perl wget xz-utils

          # Download TeX Live installer
          wget http://mirror.ctan.org/systems/texlive/tlnet/install-tl-unx.tar.gz
          tar -xzf install-tl-unx.tar.gz
          cd install-tl-*/

          # Create a texlive.profile for automated installation
          cat <<EOF > texlive.profile
          selected_scheme scheme-full
          TEXDIR /usr/local/texlive/2023
          TEXMFCONFIG ~/.texlive2023/texmf-config
          TEXMFHOME ~/texmf
          TEXMFLOCAL /usr/local/texlive/2023/texmf-local
          TEXMFSYSCONFIG /usr/local/texlive/2023/texmf-config
          TEXMFSYSVAR /usr/local/texlive/2023/texmf-var
          binary_x86_64-linux 1
          collection-basic 1
          collection-latex 1
          collection-fontsrecommended 1
          EOF

          # Run the installer with the profile
          sudo ./install-tl --profile