---
audio: false
generated: true
lang: ar
layout: post
title: اختبار سجل NPM باستخدام طلبات HTTP الخام
translated: true
type: note
---

لاختبار سجل NPM الخاص بك باستخدام طلبات HTTP الخام مع أدوات مثل `curl` أو Insomnia، يمكنك التحقق من وظائفه عن طريق فحص الاتصال، والمصادقة، والقدرة على تقديم بيانات الحزمة — كل ذلك دون الاعتماد على عميل NPM. نظرًا لأن سجلك يتطلب اسم مستخدم وكلمة مرور، ستحتاج إلى التعامل مع المصادقة يدويًا في طلباتك. فيما يلي دليل كامل لاختبار السجل الخاص بك باستخدام طلبات HTTP الخام، بافتراض أنه سجل متوافق مع NPM (مثل Verdaccio أو Nexus أو تنفيذ مخصص) يدعم المصادقة القائمة على الرمز أو المصادقة الأساسية.

---

## خطوات اختبار السجل باستخدام طلبات HTTP الخام

### 1. المصادقة والحصول على رمز (إذا لزم الأمر)

تستخدم معظم سجلات NPM المصادقة القائمة على الرمز، مما يتطلب منك تسجيل الدخول للحصول على رمز قبل إجراء مزيد من الطلبات. قد تدعم بعض السجلات أيضًا المصادقة الأساسية مباشرة. إليك كيفية المصادقة باستخدام `curl`:

#### استخدام `curl` لتسجيل الدخول
أرسل طلب PUT إلى نقطة نهاية المصادقة الخاصة بالسجل للحصول على رمز:

```bash
curl -X PUT \
  -H "Content-Type: application/json" \
  -d '{"name": "<username>", "password": "<password>"}' \
  <registry-url>/-/user/org.couchdb.user:<username>
```

- **استبدل**:
  - `<username>`: اسم المستخدم في السجل.
  - `<password>`: كلمة مرور السجل.
  - `<registry-url>`: عنوان URL الكامل للسجل (مثال: `https://my-registry.example.com`).
- **الاستجابة المتوقعة**: في حالة النجاح، ستحصل على استجابة JSON تحتوي على رمز:
  ```json
  {
    "token": "your-auth-token"
  }
  ```
- **احفظ الرمز**: انسخ قيمة `your-auth-token` لاستخدامها في الطلبات اللاحقة.

**ملاحظة**: إذا كان سجلك يستخدم نقطة نهاية أو طريقة مصادقة مختلفة (مثل المصادقة الأساسية أو واجهة برمجة تطبيقات مخصصة)، فتحقق من وثائقه. إذا كان يدعم المصادقة الأساسية مباشرة، يمكنك تخطي هذه الخطوة وإدراج `-u "<username>:<password>"` في الطلبات اللاحقة بدلاً من ذلك.

---

### 2. اختبار اتصال السجل (Ping)

اختبر الاتصال الأساسي بالسجل عن طريق إرسال طلب GET إلى عنوان URL الجذر أو نقطة نهاية ping.

#### استخدام `curl` لاختبار الاتصال
```bash
curl -H "Authorization: Bearer your-auth-token" <registry-url>
```

- **استبدل**:
  - `your-auth-token`: الرمز من الخطوة 1.
  - `<registry-url>`: عنوان URL الخاص بسجلك.
- **الاستجابة المتوقعة**: قد تُرجع الاستجابة الناجحة (HTTP 200) الصفحة الرئيسية للسجل أو رسالة حالة بسيطة (مثال: `{"db_name":"registry"}` للسجلات القائمة على CouchDB).
- **بديل**: تقدم بعض السجلات نقطة نهاية `/-/ping`:
  ```bash
  curl -H "Authorization: Bearer your-auth-token" <registry-url>/-/ping
  ```

**إذا كنت تستخدم المصادقة الأساسية**: إذا كان سجلك لا يستخدم الرموز ويدعم المصادقة الأساسية:
```bash
curl -u "<username>:<password>" <registry-url>
```

---

### 3. استرداد بيانات وصف الحزمة (Metadata)

تحقق من قدرة السجل على تقديم بيانات وصف الحزمة عن طريق طلب تفاصيل حزمة محددة.

#### استخدام `curl` للحصول على بيانات الوصف
```bash
curl -H "Authorization: Bearer your-auth-token" <registry-url>/<package-name>
```

- **استبدل**:
  - `<package-name>`: حزمة تعرف أنها موجودة في سجلك (مثال: `lodash` إذا كان يقوم بالوكيل للسجل العام، أو حزمة خاصة مثل `my-org-utils`).
- **الاستجابة المتوقعة**: كائن JSON يحتوي على بيانات وصف الحزمة، بما في ذلك الإصدارات والتبعيات وعناوين URL لأرشيفات الحزم. مثال:
  ```json
  {
    "name": "lodash",
    "versions": {
      "4.17.21": {
        "dist": {
          "tarball": "<registry-url>/lodash/-/lodash-4.17.21.tgz"
        }
      }
    }
  }
  ```

**إذا كنت تستخدم المصادقة الأساسية**:
```bash
curl -u "<username>:<password>" <registry-url>/<package-name>
```

- **النجاح**: تؤكد استجابة 200 OK مع بيانات الوصف أن السجل يقدم بيانات الحزمة بشكل صحيح.

---

### 4. تنزيل أرشيف الحزمة (اختياري)

لاختبار السجل بشكل كامل، قم بتنزيل أرشيف حزمة للتأكد من قدرته على تسليم ملفات الحزمة الفعلية.

#### استخدام `curl` لتنزيل الأرشيف
1. من بيانات الوصف في الخطوة 3، ابحث عن عنوان URL الخاص بـ `tarball` لإصدار محدد (مثال: `<registry-url>/lodash/-/lodash-4.17.21.tgz`).
2. قم بتنزيله:
```bash
curl -H "Authorization: Bearer your-auth-token" -O <tarball-url>
```

- **استبدل**: `<tarball-url>` بالعنوان URL من بيانات الوصف.
- **علم `-O`**: يحفظ الملف باسمه الأصلي (مثال: `lodash-4.17.21.tgz`).
- **إذا كنت تستخدم المصادقة الأساسية**:
  ```bash
  curl -u "<username>:<password>" -O <tarball-url>
  ```
- **النجاح**: يتم تنزيل الملف بنجاح، ويمكنك فك ضغطه (مثال: باستخدام `tar -xzf <filename>`) للتحقق من محتوياته.

---

## الاختبار باستخدام Insomnia

إذا كنت تفضل أداة واجهة مستخدم رسومية مثل Insomnia، فاتبع هذه الخطوات:

### 1. إعداد المصادقة
- أنشئ طلبًا جديدًا في Insomnia.
- انتقل إلى علامة التبويب **Auth**:
  - **Bearer Token**: إذا حصلت على رمز في الخطوة 1، فحدد "Bearer Token" والصق `your-auth-token`.
  - **Basic Auth**: إذا كان السجل يستخدم المصادقة الأساسية، فحدد "Basic Auth" وأدخل `<username>` و `<password>`.

### 2. اختبار اتصال السجل (Ping)
- **الطريقة**: GET
- **العنوان**: `<registry-url>` أو `<registry-url>/-/ping`
- انقر على **Send**.
- **الاستجابة المتوقعة**: حالة 200 OK مع نص استجابة بسيط.

### 3. استرداد بيانات وصف الحزمة
- **الطريقة**: GET
- **العنوان**: `<registry-url>/<package-name>`
- تأكد من تعيين المصادقة في علامة التبويب Auth.
- انقر على **Send**.
- **الاستجابة المتوقعة**: حالة 200 OK مع بيانات وصف الحزمة بتنسيق JSON.

### 4. تنزيل الأرشيف
- **الطريقة**: GET
- **العنوان**: عنوان URL للأرشيف من بيانات الوصف (مثال: `<registry-url>/<package-name>/-/<package-name>-<version>.tgz`).
- انقر على **Send and Download** لحفظ الملف محليًا.
- **النجاح**: يتم تنزيل الملف، مما يؤكد أن السجل يقدم الحزم.

---

## استكشاف الأخطاء وإصلاحها

- **401 Unauthorized**:
  - تحقق من الرمز أو بيانات الاعتماد الخاصة بك.
  - تأكد من تنسيق رأس `Authorization` أو المصادقة الأساسية بشكل صحيح.
- **404 Not Found**:
  - تحقق من وجود الحزمة في السجل.
  - إذا كنت تختبر حزمًا عامة (مثل `lodash`)، فتأكد من أن السجل يعمل كوسيط للسجل العام لـ NPM.
- **أخطاء الاتصال**:
  - راجع عنوان `<registry-url>` مرة أخرى (مثال: قم بتضمين `https://` إذا لزم الأمر).
  - بالنسبة للسجلات التي تستخدم HTTPS، إذا ظهرت أخطاء SSL مع `curl`، فأضف `-k` لتجاوز فحص الشهادة (لأغراض الاختبار فقط).
- **سلوك السجل المخصص**:
  - إذا فشلت هذه الخطوات، فاستشر وثائق السجل الخاص بك للحصول على نقاط نهاية أو طرق مصادقة محددة.

---

## خاتمة

باتباع هذه الخطوات باستخدام `curl` أو Insomnia، يمكنك اختبار اتصال سجل NPM الخاص بك، والمصادقة، وقدرات تقديم الحزم باستخدام طلبات HTTP الخام. ابدأ بالمصادقة (إذا لزم الأمر)، ثم اختبر اتصال السجل، واسترجع بيانات وصف لحزمة معروفة، وقم بتنزيل الأرشيف اختياريًا. يضمن هذا النهج أن سجلك يعمل بكامل طاقته على مستوى HTTP.