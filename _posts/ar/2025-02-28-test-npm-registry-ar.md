---
audio: false
generated: false
lang: ar
layout: post
title: اختبار سجل NPM باستخدام طلبات HTTP الخام
translated: true
---

لاختبار سجل NPM الخاص بك باستخدام طلبات HTTP الخام باستخدام أدوات مثل `curl` أو Insomnia، يمكنك التحقق من وظيفته من خلال التحقق من الاتصال، المصادقة، وقدرة على تقديم بيانات الحزمة—كل ذلك دون الاعتماد على عميل NPM. نظرًا لأن سجلك يتطلب اسم مستخدم وكلمة مرور، عليك معالجة المصادقة يدويًا في طلباتك. أدناه دليل شامل لاختبار سجلك باستخدام طلبات HTTP الخام، مع افتراض أنه سجل NPM متوافق (مثل Verdaccio، Nexus، أو تنفيذ مخصص) يدعم المصادقة بناءً على الرمز أو المصادقة الأساسية.

---

## خطوات اختبار السجل باستخدام طلبات HTTP الخام

### 1. المصادقة واستخراج الرمز (إذا لزم الأمر)

يستخدم معظم سجلات NPM المصادقة بناءً على الرمز، مما يتطلب منك تسجيل الدخول للحصول على رمز قبل إجراء طلبات أخرى. قد يدعم بعض السجلات المصادقة الأساسية مباشرة. إليك كيفية المصادقة باستخدام `curl`:

#### باستخدام `curl` للتسجيل الدخول
أرسل طلب PUT إلى نقطة النهاية المصادقة للسجل للحصول على رمز:

```bash
curl -X PUT \
  -H "Content-Type: application/json" \
  -d '{"name": "<username>", "password": "<password>"}' \
  <registry-url>/-/user/org.couchdb.user:<username>
```

- **الاستبدال**:
  - `<username>`: اسم مستخدم سجلك.
  - `<password>`: كلمة مرور سجلك.
  - `<registry-url>`: عنوان URL الكامل للسجل (مثل `https://my-registry.example.com`).
- **الرد المتوقع**: إذا كان النجاح، ستحصل على رد JSON يحتوي على رمز:
  ```json
  {
    "token": "your-auth-token"
  }
  ```
- **حفظ الرمز**: انقر على `your-auth-token` قيمة للاستخدام في الطلبات اللاحقة.

**ملاحظة**: إذا استخدم سجلك نقطة النهاية المصادقة أو طريقة مختلفة (مثل المصادقة الأساسية أو API مخصص)، تحقق من وثائقها. إذا دعمت المصادقة الأساسية مباشرة، يمكنك تخطي هذه الخطوة وضمن `-u "<username>:<password>"` في الطلبات اللاحقة بدلاً من ذلك.

---

### 2. إرسال إشارة إلى السجل

اختبر الاتصال الأساسي بالسجل بإرسال طلب GET إلى عنوان URL الجذر أو نقطة النهاية الإرسالية.

#### باستخدام `curl` لإرسال إشارة
```bash
curl -H "Authorization: Bearer your-auth-token" <registry-url>
```

- **الاستبدال**:
  - `your-auth-token`: الرمز من الخطوة 1.
  - `<registry-url>`: عنوان URL للسجل.
- **الرد المتوقع**: رد ناجح (HTTP 200) قد يعيد الصفحة الرئيسية للسجل أو رسالة حالة بسيطة (مثل `{"db_name":"registry"}` للسجلات القائمة على CouchDB).
- **البديل**: بعض السجلات تقدم نقطة النهاية `/-/ping`:
  ```bash
  curl -H "Authorization: Bearer your-auth-token" <registry-url>/-/ping
  ```

**إذا استخدمت المصادقة الأساسية**: إذا لم يستخدم سجلك الرموز وي podpor المصادقة الأساسية:
```bash
curl -u "<username>:<password>" <registry-url>
```

---

### 3. استرجاع بيانات الحزمة

تحقق من أن السجل يمكن تقديم بيانات الحزمة من خلال طلب تفاصيل حزمة معينة.

#### باستخدام `curl` للحصول على البيانات
```bash
curl -H "Authorization: Bearer your-auth-token" <registry-url>/<package-name>
```

- **الاستبدال**:
  - `<package-name>`: حزمة تعرف أنها موجودة على سجلك (مثل `lodash` إذا كان يعمم السجل العام، أو حزمة خاصة مثل `my-org-utils`).
- **الرد المتوقع**: كائن JSON يحتوي على بيانات الحزمة، بما في ذلك الإصدارات، التبعيات، وURL ملفات tarball. على سبيل المثال:
  ```json
  {
    "name": "lodash",
    "versions": {
      "4.17.21": {
        "dist": {
          "tarball": "<registry-url>/lodash/-/lodash-4.17.21.tgz"
        }
      }
    }
  }
  ```

**إذا استخدمت المصادقة الأساسية**:
```bash
curl -u "<username>:<password>" <registry-url>/<package-name>
```

- **النجاح**: رد 200 OK مع البيانات يؤكد أن السجل يقدم بيانات الحزمة بشكل صحيح.

---

### 4. تحميل ملف tarball للحزمة (اختياري)

لاختبار السجل بالكامل، قم بتحميل ملف tarball للحزمة لضمان أنه يمكن تقديم ملفات الحزمة الفعلية.

#### باستخدام `curl` لتحميل ملف tarball
1. من البيانات في الخطوة 3، ايجاد URL `tarball` لإصدار معين (مثل `<registry-url>/lodash/-/lodash-4.17.21.tgz`).
2. قم بتحميله:
```bash
curl -H "Authorization: Bearer your-auth-token" -O <tarball-url>
```

- **الاستبدال**: `<tarball-url>` مع URL من البيانات.
- **علامة `-O`**: يحفظ الملف باسمه الأصلي (مثل `lodash-4.17.21.tgz`).
- **إذا استخدمت المصادقة الأساسية**:
  ```bash
  curl -u "<username>:<password>" -O <tarball-url>
  ```
- **النجاح**: يتم تحميل الملف بنجاح، ويمكنك استخراجه (مثلًا باستخدام `tar -xzf <filename>`) للتحقق من محتواته.

---

## اختبار باستخدام Insomnia

إذا كنت تفضل أداة واجهة المستخدم مثل Insomnia، اتبع هذه الخطوات:

### 1. إعداد المصادقة
- انشئ طلبًا جديدًا في Insomnia.
- اذهب إلى علامة التبويب **Auth**:
  - **Bearer Token**: إذا حصلت على رمز في الخطوة 1، اختر "Bearer Token" واسقط `your-auth-token`.
  - **Basic Auth**: إذا استخدم السجل المصادقة الأساسية، اختر "Basic Auth" واكتب `<username>` و`<password>`.

### 2. إرسال إشارة إلى السجل
- **الطريقة**: GET
- **URL**: `<registry-url>` أو `<registry-url>/-/ping`
- انقر على **Send**.
- **الرد المتوقع**: حالة 200 OK مع جسم الرد البسيط.

### 3. استرجاع بيانات الحزمة
- **الطريقة**: GET
- **URL**: `<registry-url>/<package-name>`
- تأكد من إعداد المصادقة في علامة التبويب Auth.
- انقر على **Send**.
- **الرد المتوقع**: حالة 200 OK مع بيانات الحزمة في JSON.

### 4. تحميل ملف tarball
- **الطريقة**: GET
- **URL**: URL ملف tarball من البيانات (مثل `<registry-url>/<package-name>/-/<package-name>-<version>.tgz`).
- انقر على **Send and Download** لحفظ الملف محليًا.
- **النجاح**: يتم تحميل الملف، مما يؤكد أن السجل يقدم الحزم.

---

## حل المشكلات

- **401 غير مسموح**:
  - تحقق من رمزك أو بيانات المصادقة.
  - تأكد من أن رأس `Authorization` أو المصادقة الأساسية مصفوفة بشكل صحيح.
- **404 غير موجود**:
  - تحقق من وجود الحزمة على السجل.
  - إذا كنت تستخد الحزم العامة (مثل `lodash`), تأكد من أن السجل يعمم السجل العام NPM.
- **أخطاء الاتصال**:
  - تحقق من `<registry-url>` (مثلًا، أضف `https://` إذا لزم الأمر).
  - بالنسبة للسجلات HTTPS، إذا حصلت على أخطاء SSL مع `curl`, أضف `-k` لتخطي التحقق من الشهادات (للاختبار فقط).
- **سلوك السجل المخصص**:
  - إذا فشلت هذه الخطوات، استشرف وثائق السجل الخاص بك للحصول على نقاط النهاية أو طرق المصادقة المحددة.

---

## الخاتمة

بمتابعة هذه الخطوات باستخدام `curl` أو Insomnia، يمكنك اختبار قدرة سجل NPM الخاص بك على الاتصال، المصادقة، وخدمات الحزم باستخدام طلبات HTTP الخام. ابدأ بالمصادقة (إذا لزم الأمر)، ثم ارسل إشارة إلى السجل، استرجع البيانات لمعرف حزمة، واختياريًا تحميل ملف tarball. هذا النهج يضمن أن سجلك يعمل بشكل كامل على مستوى HTTP.