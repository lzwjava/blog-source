---
audio: false
generated: true
lang: ar
layout: post
title: ترقية قاعدة الشيفرات البرمجية القديمة إلى إصدار أحدث من JDK
translated: true
type: note
---

ترقية قاعدة شيفرة كبيرة (عشرات الآلاف من الأسطر) من JDK 8 و Spring 5.2.2 إلى إصدار أحدث من JDK مثل 11 أو 17 أو 21 تتطلب تخطيطًا دقيقًا لتقليل حالات التوقف، خاصة مع استخدام مشغلات IBM DB2 JCC، والاعتماد الكبير على Spring، والنشر على WebSphere Liberty. أدناه، سأوضح الاعتبارات الرئيسية، بما في ذلك التوافق، والتغييرات المحتملة غير المتوافقة، وخطوات الهجرة، والتوصيات. نظرًا لأنك ذكرت أنه يمكنك ترقية Spring أيضًا، سأغطي السيناريوهات التي قد يكون ذلك فيها ضروريًا أو مفيدًا.

### اعتبارات عامة لترقية JDK
- **التوافق مع الإصدارات السابقة والتغييرات غير المتوافقة**: تهدف Java إلى تحقيق توافق قوي مع الإصدارات السابقة، لكن الترقيات من JDK 8 تُدخل تغييرات قد تؤثر على شيفرتك:
  - **واجهات برمجة التطبيقات (APIs) المزالة/المهملة**: أزالت إصدارات JDK 9+ واجهات برمجة التطبيقات الداخلية مثل `sun.misc.Unsafe` وبعض حزم `sun.*`. إذا كانت شيفرتك (أو التبعيات) تستخدم هذه، فستحتاج إلى بدائل (على سبيل المثال، عبر بدائل `Unsafe` في مكتبات الطرف الثالث أو `VarHandle` الخاصة بـ Java).
  - **نظام الوحدات (JPMS من JDK 9)**: يغلف واجهات برمجة التطبيقات الداخلية، مما قد يتسبب في أخطاء "وصول غير قانوني". استخدم وسيطات `--add-opens` أو `--add-exports` بشكل مؤقت، ولكن اسعَ لإعادة الهيكلة لتكون معيارية.
  - **تغييرات جامع القمامة (Garbage Collection)**: تحول جامع القمامة الافتراضي من Parallel إلى G1 في JDK 9، وإلى تعديلات إضافية في الإصدارات اللاحقة (مثل Shenandoah أو ZGC في 11+). اختبر تأثيرات الأداء على الأجزاء كثيفة استخدام الذاكرة.
  - **تغييرات أخرى**: تحسين التغليف، وإزالة دعم البرنامج المساعد للمتصفح/التطبيقات الصغيرة (applet)، وتحديثات مديري الأمان (تم إهمالهم في 17 وإزالتهم في 21)، وميزات اللغة مثل السجلات (records) (14+)، والفئات المُختومة (sealed classes) (17)، والخيوط الافتراضية (virtual threads) (21). هذه الميزات إضافية في الغالب ولكنها قد تتطلب تعديلات على الشيفرة إذا كنت تستخدم الانعكاس (reflection) بشكل مكثف.
  - من 8 إلى 11: تغييرات متوسطة (على سبيل المثال، لا توجد وحدات Java EE مثل JAXB، والتي أزيلت في 9؛ أضفها كتبعيات).
  - من 11 إلى 17: اضطرابات أقل، بشكل رئيسي تحسينات مثل مطابقة الأنماط (pattern matching) الأفضل.
  - من 17 إلى 21: حد أدنى من التغييرات غير المتوافقة؛ في الغالب ميزات جديدة مثل مطابقة الأنماط لتعليمة switch (21) ولا توجد إزالات رئيسية.
- **الهجرة التدريجية**: لا تنتقل مباشرة إلى 21. قم بالترقية بشكل تدريجي (على سبيل المثال، 8 ← 11 ← 17 ← 21) لعزل المشكلات. استخدم أدوات مثل OpenRewrite أو jdeps لفحص عدم التوافق.
- **الاختبار والأدوات**:
  - قم بتشغيل اختبارات شاملة (اختبارات الوحدة، والتكامل، والحمل) على JDK الجديد. يمكن للأدوات مثل إضافات Maven/Gradle (على سبيل المثال، `maven-enforcer-plugin`) فرض التوافق.
  - حدّث أدوات البناء: تأكد من دعم Maven/Gradle لـ JDK الجديد (معظمها يدعم، ولكن تحقق من الإضافات مثل Surefire).
  - الاختبار متعدد الإصدارات: استخدم Docker أو CI/CD (مثل GitHub Actions) للاختبار ضد إصدارات JDK متعددة.
- **التبعيات والمكتبات**: افحص جميع مكتبات الطرف الثالث للتأكد من التوافق. استخدم أدوات مثل `mvn dependency:tree` أو OWASP Dependency-Check.
- **الأداء والأمان**: تقدم إصدارات JDK الأحدث أداءً أفضل (مثل وقت بدء أسرع في 17+)، وإصلاحات أمنية، ودعم طويل الأمد (LTS: 11 حتى 2026، و17 حتى 2029، و21 حتى 2031+).
- **الجهد لقاعدة شيفرة كبيرة**: مع الاستخدام المكثف لـ Spring، ركز على المكونات المدارة بواسطة Spring (مثل beans، وAOP). خصص وقتًا لإعادة الهيكلة (على سبيل المثال، 1-2 أسبوع لكل قفزة إصدار رئيسي، مع التدرج حسب حجم الشيفرة).

### اعتبارات محددة حسب JDK المستهدف
#### الترقية إلى JDK 11
- **الإيجابيات**: LTS مع استقرار جيد؛ أقرب إلى JDK 8، لذا تغييرات أقل. نهاية دورة الحياة تقترب (2026)، لكنه لا يزال مدعومًا على نطاق واسع.
- **السلبيات**: يفتقد الميزات الحديثة مثل الخيوط الافتراضية (21) أو جامع القمامة المحسن (17+).
- **توافق Spring**: Spring 5.2.2 يعمل على JDK 11، ولكن قم بالترقية إلى Spring 5.3.x (أحدث إصدار في سلسلة 5.x) للحصول على دعم أفضل لـ JDK 11/17 وإصلاحات الأخطاء. لا توجد حاجة لتغييرات رئيسية في Spring.
- **مشغل DB2 JCC**: متوافق مع إصدارات المشغل الحديثة (مثل 4.x+). كانت بعض المشغلات الأقدم بها مشاكل مع OpenJDK 11، لذا حدّث إلى أحدث إصدار (على سبيل المثال، من موقع IBM) واختبر الاتصالات.
- **WebSphere Liberty**: مدعوم بالكامل (يعمل Liberty على JDK 8/11/17/21).
- **التغييرات الرئيسية من JDK 8**:
  - أضف تبعيات للوحدات المزالة (على سبيل المثال، `javax.xml.bind:jaxb-api` لـ JAXB).
  - أصلح أي وصول انعكاسي غير قانوني (شائع في المكتبات القديمة).
  - كيفية الهجرة: حدّث ملف البناء الخاص بك (على سبيل المثال، Maven `<java.version>11</java.version>`)، وأعد التجميع، وقم بتشغيل الاختبارات. استخدم دليل هجرة Oracle's JDK 11 للفحوصات خطوة بخطوة.
- **الجهد**: منخفض إلى متوسط؛ حد أدنى من تغييرات الشيفرة إذا لم يكن هناك استخدام لواجهات برمجة التطبيقات الداخلية.

#### الترقية إلى JDK 17
- **الإيجابيات**: LTS الحالي مع اعتماد قوي؛ يتضمن ميزات مثل كتل النص (text blocks)، والسجلات (records)، وتحسينات على تعليمة switch. أداء أفضل من 11.
- **السلبيات**: تم إهمال SecurityManager (إذا كان مستخدمًا، خطط للإزالة). قد تحتاج بعض المكتبات للتحديث.
- **توافق Spring**: Spring 5.3.x يدعم بالكامل JDK 17 (تم اختباره على إصدارات LTS). قم بالترقية من 5.2.2 إلى 5.3.x للحصول على توافق أمثل — لا توجد تغييرات غير متوافقة في Spring نفسه.
- **مشغل DB2 JCC**: مدعوم صراحةً في الإصدارات الحديثة (مثل JCC 4.29+ لـ DB2 11.5). تؤكد وثائق IBM دعم وقت تشغيل JDK 17؛ اختبر لأي تحسينات في SQLJ.
- **WebSphere Liberty**: مدعوم بالكامل.
- **التغييرات الرئيسية من JDK 11**:
  - تغليف أكثر صرامة؛ المزيد من التحذيرات حول الميزات المهملة.
  - واجهات برمجة تطبيقات جديدة (مثل `java.net.http` لعملاء HTTP/2) يمكنها تحديث الشيفرة ولكنها ليست إلزامية.
  - كيفية الهجرة: بعد JDK 11، انتقل إلى 17 في عمليات البناء. استخدم أدلة الهجرة للتحقق من إزالات applet/corba (إن وجدت).
- **الجهد**: متوسط؛ يبني على هجرة JDK 11.

#### الترقية إلى JDK 21
- **الإيجابيات**: أحدث إصدار LTS مع ميزات متطورة (مثل الخيوط الافتراضية للتزامن، والمجموعات المتسلسلة). الأفضل لضمان المستقبل.
- **السلبيات**: يتطلب ترقية Spring (انظر أدناه)； مشاكل محتملة مع المكتبات القديمة جدًا.
- **توافق Spring**: Spring 5.x لا يدعم رسميًا JDK 21 (الحد الأقصى هو JDK 17). يجب أن تقوم بالترقية إلى Spring 6.1+ (والتي تتطلب خط أساسي JDK 17+). هذا تحول رئيسي:
  - **هجرة Jakarta EE**: ينتقل Spring 6 من Java EE (javax.*) إلى Jakarta EE 9+ (jakarta.*). غيّر الاستيرادات (على سبيل المثال، `javax.servlet` → `jakarta.servlet`)، حدّث التكوينات، وأعد هيكلة أي شيفرة مرتبطة بـ EE (مثل JPA، وServlets، وJMS).
  - **تغييرات غير متوافقة**: إزالة واجهات برمجة التطبيقات المهملة (على سبيل المثال، مدراء المعاملات القدامى)； دعم تجميع AOT؛ يتطلب تحديث التبعيات مثل Hibernate (إلى 6.1+).
  - **دليل الهجرة**: اتبع الدليل الرسمي لـ Spring: حدّث إلى Spring 5.3.x أولاً، ثم إلى 6.0/6.1. استخدم أدوات مثل وصفات OpenRewrite لعمليات الاستبدال الآلية من javax إلى jakarta. بالنسبة لقاعدة الشيفرة الكبيرة الخاصة بك، قد يتضمن هذا مئات التغييرات — اختبر في وحدات.
  - إذا كنت تستخدم Spring Boot (مُستنتج من استخدام Spring)، فإن Boot 3.x يتماشى مع Spring 6 و JDK 17+.
- **مشغل DB2 JCC**: متوافق عبر التوافق مع الإصدارات السابقة مع دعم JDK 17؛ حدّث إلى أحدث مشغل (مثل 4.32+) وتحقق.
- **WebSphere Liberty**: مدعوم بالكامل (حتى JDK 24).
- **التغييرات الرئيسية من JDK 17**:
  - تمت إزالة SecurityManager؛ إذا كان مستخدمًا، استبدله ببدائل.
  - الميزات الجديدة مثل قوالب النص (معاينة) لن تكسر الشيفرة الحالية.
  - كيفية الهجرة: ابنِ على JDK 17 أولاً، ثم انتقل. لا توجد تغييرات غير متوافقة متعمدة رئيسية بين 17 و 21.
- **الجهد**: مرتفع إذا قمت بترقية Spring؛ وإلا فهو مشابه لـ 17.

### اعتبارات إضافية خاصة بالمشروع
- **مكتبة IBM DB2 JCC**: تأكد من تطابق إصدار المشغل الخاص بك مع إصدار DB2 (على سبيل المثال، لـ DB2 11.5، استخدم JCC 4.29+). اختبر اتصالات JDBC، وSQLJ، وأي استعلامات مخصصة — قد تكشف إصدارات JDK الأحدث عن مشاكل في مجموعة الأحرف أو المنطقة الزمنية.
- **النشر على WebSphere Liberty**: لا توجد عوائق؛ Liberty مرن مع إصدارات JDK. حدّث server.xml إذا لزم الأمر لوسيطات JVM (مثل `--add-opens` لمشاكل الوحدات). اختبر عمليات النشر مبكرًا.
- **قاعدة الشيفرة الكبيرة واستخدام Spring**: رتب أولويات الترقيات المعيارية (على سبيل المثال، قم بترقية الخدمات الأساسية أولاً). إذا كان Spring متكاملًا بعمق (مثل MVC، وData، وSecurity)، فقم بمراجعة الميزات المهملة في 5.2.2. تجلب ترقية Spring فوائد مثل AOT أفضل وإمكانية المراقبة ولكنها تضيف تكلفة.
- **المخاطر والتخفيفات**: توقف عن العمل due لعدم التوافق؛ خفف من خلال خطط التراجع. خصص ميزانية لدعم البائع إذا كنت تستخدم DB2/Liberty تجاريًا.
- **التكاليف**: الوقت (أسابيع إلى أشهر للهجرة الكاملة)، والتراخيص المحتملة (مثل JDKs تجارية مثل Oracle's)، والتدريب على الميزات الجديدة.

### التوصيات
- **المسار المفضل**: ابدأ بـ JDK 11 أو 17 مع الاحتفاظ/الترقية إلى Spring 5.3.x — مخاطر أقل لقاعدة الشيفرة الخاصة بك. انتقل إلى 21 فقط إذا كنت بحاجة إلى ميزاته (مثل الخيوط الافتراضية) ومستعد للترقية إلى Spring 6 (والذي قد يتطلب جهدًا كبيرًا بسبب تغييرات Jakarta).
- **الخطوات التالية**:
  1. افحص الشيفرة باستخدام jdeps/jlink للكشف عن المشكلات.
  2. أنشئ فرعًا لاختبار الهجرة.
  3. استشر الأدلة الرسمية: Oracle JDK Migration Guide، Spring Versions Wiki، IBM DB2 JDBC Downloads، Liberty Java Support.
  4. إذا قمت بترقية Spring إلى 6، فاتبع دليل الهجرة لتغييرات Jakarta.

إذا قدمت المزيد من التفاصيل (على سبيل المثال، وحدات Spring محددة أو إصدار DB2)، يمكنني تحسين هذا further.