---
audio: false
generated: true
lang: ar
layout: post
title: إضافة إصدار Maven
translated: true
type: note
---

إليك دليل شامل حول كيفية استخدام **إضافة Maven للإصدار** لإدارة وأتمتة عملية إصداري لمشروع Maven الخاص بك.

---

### ما هي إضافة Maven للإصدار؟

**إضافة Maven للإصدار** هي أداة تؤتمت عملية إصدار مشروع Maven. فهي تتعامل مع مهام مثل:

- تحديث أرقام الإصدار في ملف (ملفات) POM لمشروعك.
- إيداع التغييرات في نظام التحكم في المصدر (VCS) الخاص بك، مثل Git.
- إنشاء علامة للإصدار في نظام التحكم في المصدر.
- بناء ونشر قطع أثرية الإصدار.
- تحضير المشروع لدورة التطوير التالية عن طريق تحديث أرقام الإصدار مرة أخرى.

الهدفان الأساسيان للإضافة هما:

- **`release:prepare`**: يحضر المشروع للإصدار عن طريق تحديث الإصدارات، وإيداع التغييرات، ووضع علامة على الإصدار في نظام التحكم في المصدر.
- **`release:perform`**: يبني وينشر الإصدار باستخدام الكود الموسوم من نظام التحكم في المصدر.

---

### دليل خطوة بخطوة لاستخدام إضافة Maven للإصدار

#### 1. إضافة إضافة Maven للإصدار إلى ملف POM الخاص بك

لاستخدام الإضافة، تحتاج إلى تضمينها في ملف `pom.xml` لمشروعك. أضفها تحت قسم `<build><plugins>` كما يلي:

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-release-plugin</artifactId>
            <version>2.5.3</version> <!-- استخدم أحدث إصدار مستقر -->
        </plugin>
    </plugins>
</build>
```

**ملاحظة**: تحقق من [صفحة إضافة Maven للإصدار الرسمية](https://maven.apache.org/maven-release/maven-release-plugin/) للحصول على أحدث إصدار واستبدل `2.5.3` وفقًا لذلك.

#### 2. تكوين قسم SCM (إدارة التحكم في المصدر)

تتفاعل الإضافة مع نظام التحكم في المصدر الخاص بك (مثل Git) لإيداع التغييرات وإنشاء علامات. يجب عليك تحديد تفاصيل نظام التحكم في المصدر الخاص بك في قسم `<scm>` من ملف `pom.xml` الخاص بك. لمستودع Git مستضاف على GitHub، قد يبدو كما يلي:

```xml
<scm>
    <connection>scm:git:git://github.com/username/project.git</connection>
    <developerConnection>scm:git:git@github.com:username/project.git</developerConnection>
    <url>https://github.com/username/project</url>
</scm>
```

- استبدل `username` و `project` باسم مستخدم GitHub الفعلي واسم المستودع الخاص بك.
- اضبط عناوين URL إذا كنت تستخدم خدمة استضافة Git مختلفة (مثل GitLab، Bitbucket).
- تأكد من أن لديك بيانات الاعتماد اللازمة (مثل مفاتيح SSH أو رمز وصول شخصي) مُكونة لدفع التغييرات إلى المستودع.

#### 3. جهز مشروعك للإصدار

قبل تشغيل أوامر الإصدار، تأكد من أن مشروعك جاهز:

- جميع الاختبارات تمر (`mvn test`).
- لا توجد تغييرات غير مودعة في دليل العمل الخاص بك (شغل `git status` للتحقق).
- أنت على الفرع الصحيح (مثل `master` أو `main`) للإصدار.

#### 4. شغل `release:prepare`

هدف `release:prepare` يحضر مشروعك للإصدار. نفذ الأمر التالي في الطرفية:

```bash
mvn release:prepare
```

**ما يحدث أثناء `release:prepare`**:

- **يفحص التغييرات غير المودعة**: يتأكد من أن دليل العمل الخاص بك نظيف.
- **يطلب الإصدارات**: يطلب إصدار الإصدار والإصدار التالي للتطوير.
  - مثال: إذا كان إصدارك الحالي هو `1.0-SNAPSHOT`، فقد يقترح `1.0` للإصدار و `1.1-SNAPSHOT` للإصدار التالي للتطوير. يمكنك قبول الافتراضيات أو إدخال إصدارات مخصصة (مثل `1.0.1` لإصدار تصحيحي).
- **يحدث ملفات POM**: يغير الإصدار إلى إصدار الإصدار (مثل `1.0`)، يودع التغيير، ويضع عليه علامة في نظام التحكم في المصدر (مثل `project-1.0`).
- **يحضر للدورة التالية**: يحدث POM إلى إصدار التطوير التالي (مثل `1.1-SNAPSHOT`) ويودعه.

**تجربة اختيارية**: لاختبار العملية دون إجراء تغييرات، استخدم:

```bash
mvn release:prepare -DdryRun=true
```

هذا يحاكي خطوات التحضير دون الإيداع أو وضع العلامات.

#### 5. شغل `release:perform`

بعد تحضير الإصدار، ابنه وانشره باستخدام:

```bash
mvn release:perform
```

**ما يحدث أثناء `release:perform`**:

- يسحب الإصدار الموسوم من نظام التحكم في المصدر.
- يبني المشروع.
- ينشر القطع الأثرية إلى المستودع المحدد في قسم `<distributionManagement>` في ملف POM الخاص بك.

**كونفجير `<distributionManagement>`** (إذا كان النشر إلى مستودع بعيد):

```xml
<distributionManagement>
    <repository>
        <id>releases</id>
        <url>http://my-repository-manager/releases</url>
    </repository>
    <snapshotRepository>
        <id>snapshots</id>
        <url>http://my-repository-manager/snapshots</url>
    </snapshotRepository>
</distributionManagement>
```

- استبدل عناوين URL بعناوين مدير المستودع الخاص بك (مثل Nexus، Artifactory).
- تأكد من إعداد بيانات الاعتماد في ملف `~/.m2/settings.xml` الخاص بك تحت `<servers>` مع `id` مطابقة.

#### 6. تحقق من الإصدار

بعد `release:perform`، تحقق من الإصدار:

- تحقق من مدير المستودع الخاص بك للتأكد من نشر القطع الأثرية (مثل JARs، المصادر).
- اختبر الإصدار المُصدر في مشروع آخر عن طريق إضافته كاعتماد في ملف POM الخاص به.

---

### تكوين إضافي ونصائح

#### التعامل مع الإخفاقات

- **التنظيف**: إذا فشلت عملية الإصدار، استخدم:
  ```bash
  mvn release:clean
  ```
  لإزالة الملفات المؤقتة التي أنشأتها الإضافة.
- **التراجع**: للتراجع عن التغييرات التي أجراها `release:prepare`:
  ```bash
  mvn release:rollback
  ```
  كن حذرًا وتحقق من التغييرات التي تم التراجع عنها.

#### مشاريع متعددة الوحدات

بالنسبة للمشاريع متعددة الوحدات، تقوم الإضافة بتحديث الإصدارات عبر جميع الوحدات بشكل متناسق افتراضيًا. تأكد من أن POM الأب يتضمن تكوين الإضافة و SCM.

#### الوضع الدفعي للأتمتة

لتشغيل الإصدار بشكل غير تفاعلي (مثلًا، في خط أنابيب CI/CD)، استخدم علم `-B` وحدد الإصدارات:

```bash
mvn release:prepare -B -DreleaseVersion=1.0 -DdevelopmentVersion=1.1-SNAPSHOT
mvn release:perform -B
```

#### مشاكل شائعة وحلول

- **أخطاء نظام التحكم في المصدر**: تأكد من أن أوامر Git (مثل `git commit`، `git push`) تعمل يدويًا. تحقق من المصادقة (مفاتيح SSH، الرموز).
- **إخفاقات البناء**: تحقق من نجاح البناء محليًا (`mvn clean install`) وحل الاعتمادية بشكل صحيح.
- **استراتيجية الإصدار**: خصص الإصدارات أثناء المطالبات أو عبر الخصائص إذا كانت الافتراضيات لا تناسب احتياجاتك.

---

### ملخص للأوامر

1. **حضر الإصدار**:
   ```bash
   mvn release:prepare
   ```
2. **نفذ الإصدار**:
   ```bash
   mvn release:perform
   ```
3. **تجربة اختيارية**:
   ```bash
   mvn release:prepare -DdryRun=true
   ```
4. **التنظيف أو التراجع إذا لزم الأمر**:
   ```bash
   mvn release:clean
   mvn release:rollback
   ```

---

### خاتمة

تبسط إضافة Maven للإصدار عملية الإصدار من خلال أتمتة إدارة الإصدار، وتفاعلات نظام التحكم في المصدر، والنشر. من خلال إضافة الإضافة إلى ملف POM الخاص بك، وتكوين نظام التحكم في المصدر الخاص بك، واتباع خطوات `release:prepare` و `release:perform`، يمكنك إصدار مشاريع Maven الخاصة بك بكفاءة. دائمًا اختبر التكوين الخاص بك بتجربة جافة وتحقق من النتائج لضمان عملية إصدار سلسة.