---
audio: false
generated: true
image: false
lang: ar
layout: post
title: دليل استخدام جاكوكو لاختبارات واجهة برمجة التطبيقات في بايثون
translated: true
type: note
---

سؤال جيد — هذه مشكلة تكامل كلاسيكية بين **أدوات تغطية كود جافا** (JaCoCo) و **أُطُر اختبار غير جافا** (مثل `unittest` في بايثون الذي يضرب نقاط نهاية REST الخاصة بك).

---

### لماذا يعمل JaCoCo مع JUnit ولكن ليس مباشرة مع اختبارات بايثون

* يعمل JaCoCo من خلال إرفاق **عميل جافا** (`-javaagent:jacocoagent.jar`) بـ JVM.
* عندما تعمل اختباراتك **داخل نفس JVM** (JUnit، TestNG، إلخ)، يمكن لـ JaCoCo رؤية الفئات والطرق التي تم تحميلها/تنفيذها وإنشاء تقارير تغطية مفصلة.
* إذا استخدمت `unittest` في بايثون + `requests` لضرب نقاط نهاية API الخاصة بك، فأنت تختبر **الخادم قيد التشغيل** من خارج JVM.
  هذا يعني أن JaCoCo لا يرى التغطية تلقائيًا، إلا إذا كانت عملية الخادم نفسها تحتوي على العميل المرفق.

---

### كيف يمكنك الحصول على تغطية دقيقة مع JaCoCo واختبارات بايثون

لا تحتاج إلى التبديل إلى JUnit. لا يزال بإمكانك استخدام JaCoCo، ولكن يجب عليك **إرفاق العميل بـ JVM حيث يعمل مشروع جافا الكبير الخاص بك (الخادم)**، وليس إلى مشغل الاختبار.

1. **شغّل تطبيق جافا الخاص بك مع عميل JaCoCo**
   أضف العميل إلى بدء تشغيل خادم جافا الخاص بك:

   ```bash
   java -javaagent:/path/to/jacocoagent.jar=destfile=jacoco-it.exec,output=file,append=false \
        -jar myserver.jar
   ```

   هذا سيجمع بيانات التنفيذ (`jacoco-it.exec`) بينما تضرب اختبارات بايثون نقاط النهاية.

2. **شغّل اختبارات بايثون الخاصة بك بشكل طبيعي**

   ```bash
   python -m unittest discover tests/
   ```

   نظرًا لأن الخادم يعمل بالفعل مع العميل، سيتم تسجيل جميع الفئات والطرق التي تم ضربها بواسطة طلبات HTTP.

3. **أوقف تشغيل الخادم**
   سيتم تفريغ ملف `.exec`.

4. **أنشئ تقرير تغطية**
   استخدم إضافة Maven أو سطر الأوامر لتحويل ملف `.exec` إلى تقارير HTML/XML:

   ```bash
   mvn jacoco:report -Djacoco.dataFile=jacoco-it.exec
   ```

   أو باستخدام سطر الأوامر:

   ```bash
   java -jar jacococli.jar report jacoco-it.exec \
        --classfiles target/classes \
        --sourcefiles src/main/java \
        --html report
   ```

---

### وضعان للاختبار مع JaCoCo

* **اختبارات الوحدة (داخل JVM مع JUnit):** تعامل مباشرة مع إضافة Maven (`prepare-agent` + `report`).
* **اختبارات التكامل (عملاء خارجيون مثل بايثون):** يتطلب بدء JVM مع العميل، ثم دمج بيانات `.exec` مرة أخرى في التقارير.

---

### حول فكرة log4j الخاصة بك

عد عبارات السجل لكل ملف هو أمر تقريبي للغاية:

* ليس كل طريقة تسجل.
* السجلات لا تغطي الشروط أو الفروع.
* التغطية ليست موثوقة.

في المقابل، يقيس JaCoCo **تغطية الفئة، والطريقة، والخط، والفرع** — وهي تفاصيل أدق بكثير.

---

✅ **الإجابة:** نعم، يمكنك استخدام نهج JaCoCo بشكل مطلق حتى لو كانت اختباراتك في بايثون. الحيلة هي **إرفاق JaCoCo بعملية جافا قيد الاختبار** (خادمك)، وليس بمشغل الاختبار. ثم أنشئ التقرير بعد ذلك. بهذه الطريقة ستحصل على نفس تغطية مستوى الطريقة ومستوى الفرع كما هو الحال مع JUnit.

---

هل تريد مني صياغة **مثال إعداد Maven** الذي ينشئ ملفًا خاصًا لـ "اختبارات التكامل" مع JaCoCo، حتى تتمكن من تشغيل خادمك، وضربه باختبارات بايثون، ثم إنشاء التغطية في أمر واحد؟