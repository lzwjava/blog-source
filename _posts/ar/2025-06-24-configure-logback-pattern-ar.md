---
audio: false
generated: true
lang: ar
layout: post
title: تهيئة Logback لتنسيق السجلات المخصص
translated: true
type: note
---

لتحقيق تنسيق السجلات الذي قدمته، ستحتاج إلى تكوين ملف `logback.xml` الخاص بك. المفتاح هو استخدام `PatternLayout` داخل الـ appender الخاص بك وتعيين خاصية `pattern` بشكل صحيح.

إليك تحليلًا لمكونات تنسيق السجل المطلوب وكيفية تعيينها لمحولات نمط Logback:

*   **`2025-06-15T01:37:52.452+08:00`**: هذا هو الطابع الزمني. ستستخدم `%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX}` لهذا.
    *   `yyyy-MM-dd'T'HH:mm:ss.SSS`: التاريخ والوقت مع ميلي ثانية.
    *   `XXX`: إزاحة ISO 8601 من التوقيت العالمي المنسق (UTC) (مثال: `+08:00`).
*   **`DEBUG`**: هذا هو مستوى التسجيل. ستستخدم `%-5p` (محاذاة لليسار، بعرض 5 أحرف).
*   **`302244`**: هذا هو معرف العملية (Process ID). لا يعرض Logback معرف العملية مباشرة في محولاته القياسية. ومع ذلك، فهو *يعرض* **معرف الخيط** (`%t` أو `%thread`). إذا كان "302244" في مثالك هو في الواقع معرف خيط (وهو شائع جدًا في سجلات التطبيقات)، فإن `%thread` هو ما تحتاجه. إذا *كان يجب* أن يكون معرف عملية نظام التشغيل، فقد تحتاج إلى محول Logback مخصص أو خاصية نظام إذا سمح بيئتك. بالنسبة لتطبيقات Spring Boot النموذجية، هذا عادة ما يكون معرف الخيط. سأفترض أنه معرف الخيط لهذا المثال.
*   **`---`**: سلسلة حرفية ثابتة.
*   **`[nio-8090-exec-1]`**: هذا هو اسم الخيط. ستستخدم `[%thread]` أو `%-40.40thread` إذا أردت عرضه بعرض ثابت.
*   **`o.s.w.s.m.m.a.HttpEntityMethodProcessor`**: هذا هو اسم المسجل (عادة اسم الفئة الكامل). ستستخدم `%-40.40logger{39}` للحصول على اسم مسجل مبتور ومحاذ لليمين يصل إلى 39 حرفًا.
*   **`:`**: نقطتان رأسيتان حرفية.
*   **`Writing ["{"vnstatversion":"2.9","jsonversion":"2","interfaces":[{"name":"enp4s0","alias":"","created":{"date" (truncated)..."]`**: هذه هي رسالة السجل. ستستخدم `%msg%n`.

إليك نموذج تكوين `logback.xml` الذي يجب أن ينتج输出ًا مشابهًا جدًا:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %highlight(%-5p) %thread --- [%thread] %-40.40logger{39} : %msg%n</pattern>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>

    <logger name="org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor" level="DEBUG"/>
    <logger name="org.springframework.web.servlet.DispatcherServlet" level="DEBUG"/>

</configuration>
```

**شرح `pattern`:**

*   `%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX}`: التاريخ والوقت بتنسيق ISO 8601 مع ميلي ثانية وإزاحة التوقيت.
*   `%highlight(%-5p)`: سيخرج هذا مستوى التسجيل (مثل DEBUG، INFO) بمحاذاة لليسار بعرض 5 أحرف، وإذا كنت تخرج إلى وحدة التحكم، فسيحاول Logback تلوينه.
*   `%thread`: اسم الخيط الذي سجل الحدث. (إذا كنت بحاجة إلى معرف العملية، فهذا أكثر تعقيدًا، ولكن بالنسبة لتطبيقات Spring، عادة ما يكون معرف الخيط هو ما يهم هنا).
*   `---`: فاصل سلسلة حرفية ثابتة.
*   `[%thread]`: اسم الخيط محاطًا بأقواس معقوفة.
*   `%-40.40logger{39}`: اسم المسجل (عادة اسم الفئة).
    *   `%-40`: محاذاة لليسار ومبطن إلى 40 حرفًا.
    *   `.40logger`: يقطع اسم المسجل إذا كان أطول من 40 حرفًا.
    *   `{39}`: يخبر Logback بعرض 39 حرفًا كحد أقصى من اسم المسجل، بدءًا من نهاية اسم الحزمة (مثال: `o.s.w.s.m.m.a.HttpEntityMethodProcessor` قد يصبح `o.s.w.s.m.m.a.HttpEntityMethodProcessor` إذا كان مناسبًا، أو `...HttpEntityMethodProcessor` إذا تم اقتطاعه من البداية). يمكنك ضبط هذا الرقم.
*   ` :  `: نقطتان رأسيتان ومسافة حرفية.
*   `%msg%n`: رسالة السجل الفعلية متبوعة بفاصل سطر.

**ملاحظات هامة:**

1.  **الموضع:** احفظ ملف XML هذا باسم `logback.xml` في دليل `src/main/resources` الخاص بمشروع Spring Boot الخاص بك.
2.  **معرف العملية مقابل معرف الخيط:** كما ذكر، لا تعرض محولات النمط القياسية في Logback معرف عملية نظام التشغيل مباشرة. إذا *كان يجب* أن يكون `302244` هو معرف العملية، فعادة ما يتعين عليك تنفيذ `PatternLayoutConverter` مخصص أو تعيين خاصية نظام عند بدء التشغيل يمكنك بعد ذلك الرجوع إليها في نمط سجلك. ومع ذلك، بالنسبة لمعظم تسجيل التطبيقات، يكون معرف الخيط (`%thread`) كافيًا وشائع الاستخدام في هذا الموضع.
3.  **الإعدادات الافتراضية لـ Spring Boot:** غالبًا ما يوفر Spring Boot تكوين Logback الافتراضي الخاص به إذا لم تقدم واحدًا. من خلال وضع `logback.xml` في `src/main/resources`، فإنك تتجاوز الإعداد الافتراضي.
4.  **مستويات المسجل:** تأكد من تعيين المسجلات المحددة (مثل `HttpEntityMethodProcessor` و `DispatcherServlet`) على مستوى `DEBUG` إذا كنت تريد رؤية رسائل DEBUG الخاصة بها. إذا كان المستوى الجذري `INFO`، فلن يتم عرض رسائل DEBUG افتراضيًا إلا إذا قمت بتعيين المستوى بشكل صريح لمسجلات محددة.

يجب أن يقرّبك هذا التكوين كثيرًا من تنسيق السجل المطلوب.