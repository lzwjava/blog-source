---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: تحسين جمع القمامة في جيت موضح
translated: true
type: note
---

### ما الذي يفعله Git GC
Git GC (جمع القمامة) هو أمر صيانة يُحسّن مستودع Git الخاص بك عن طريق تنظيف الملفات غير الضرورية وضغط البيانات لتوفير المساحة وتحسين الأداء. يعمل على دليل `.git`، الذي يخزن كل التاريخ والكائنات وبيانات التعريف للمستودع.

الإجراءات الرئيسية التي ينفذها:
- **تقليم الكائنات غير القابلة للوصول**: يزيل الحفظات والأشجار والكائنات الثنائية التي لم يعد يتم الرجوع إليها (مثلًا بعد إعادة التوجيه أو حذف الفروع). تصبح هذه "كائنات فضفاضة" في `.git/objects`، وتقوم GC بتنظيفها.
- **إعادة حزم الكائنات**: يضغط الكائنات الفضفاضة (المخزنة بشكل فردي) في ملفات حزمة (`.git/objects/pack`)، والتي تكون أكثر كفاءة. يستخدم هذا ضغط دلتا لتخزين الاختلافات بين الملفات المتشابهة، مما يقلل من استخدام القرص.
- **تحديث المراجع**: ينعش الحالة الداخلية للمستودع، مثل إعادة كتابة فهرس الحزمة للبحث الأسرع.
- **تشغيل الأدوات ذات الصلة**: غالبًا ما يستدعي أوامر مثل `git prune`، و`git repack`، و`git rerere` (لإعادة استخدام القرار) كجزء من العملية.

الدليل: من الوثائق الرسمية لـ Git (مثل `git gc --help`)، تم تصميم GC "لترتيب" المستودعات. على سبيل المثال، قد يتقلص مستودع به 10,000 كائن فضفاض من مئات الميغابايت إلى جزء بسيط بمجرد حزمه، حيث يستغل ضغط دلتا أوجه التشابه (مثلًا بين إصدارات الملفات في سجل الكود).

### كيف يعمل داخليًا
1. **المشغلات**: تعمل GC يدويًا عبر `git gc` أو تلقائيًا عندما يكتشف Git ظروفًا معينة (انظر أدناه). لا تعمل في كل أمر لتجنب إبطاء الأداء.
2. **العملية**:
   - تعد الكائنات الفضفاضة وملفات الحزمة.
   - إذا تم تجاوز العتبات (مثلًا >6,700 كائن فضفاض افتراضيًا، يمكن التكوين عبر `gc.auto`)، فإنها تعيد الحزم بشكل عدواني.
   - تنشئ ملفات مؤقتة (مثل `.git/objects/tmp_*`) لتجنب فقدان البيانات، ثم تقوم بتبديلها بشكل ذري.
   - أوضاع أخف مثل `git gc --auto` تقوم بالتقليم فقط دون إعادة حزم كاملة.
3. **تفاصيل الضغط**: يستخدم zlib للضغط. تقوم إعادة الحزم ببناء ملفات الحزمة حيث يتم تخزين الكائنات كدلتا (اختلافات) من الكائنات الأساسية، مما يجعلها فعالة للمستودعات ذات الكود المتطور — على سبيل المثال، إضافة سطر إلى ملف في قاعدة كود كبيرة ينشئ دلتا صغيرة بدلاً من تكرار الملف بأكمله.

هذا مدعوم من خلال الكود المصدري لـ Git (المتاح على GitHub)، والذي ينفذ GC كسلسلة من استدعاءات shell لأدوات التقليم والحزم من أجل الموثوقية.

### لماذا يعمل فجأة
غالبًا ما يتم تشغيل GC "فجأة" لأنه تلقائي، وليس في الوقت الفعلي، لتحقيق التوازن في الأداء. الأسباب الشائعة:
- **تم الوصول إلى العتبات**: بعد تراكم الكائنات الفضفاضة (مثلًا من عمليات الحفظ المتكررة أو الجلب دون حزم). يتحقق Git من هذا بعد عمليات مثل `git commit`، أو `git merge`، أو `push`. إذا تجاوزت الكائنات الفضفاضة حد `gc.auto` (الافتراضي: حوالي 6,700)، فإنه يعمل. هذا هو السبب في أنه قد يحدث بعد نشاط مكثف، مما يجعله يبدو "مفاجئًا".
- **جدول التقليم**: إذا تم تعيين `gc.prune`، فإنه يقوم بتقليم المراجع البالية بشكل دوري، لكن الـ GC التلقائي الرئيسي يعتمد على أعداد الكائنات.
- **العمليات الكبيرة**: يمكن أن يولد إعادة التوجيه الثقيل أو الاستنساخ العديد من الكائنات الفضفاضة بسرعة، مما يؤدي إلى تشغيله.
- **خطافات ما بعد الأمر**: قد تستدعي بعض سير العمل أو الأدوات (مثل خطافات Git أو IDEs) `git gc` بعد التغييرات الكبيرة.

للتحكم فيه: اضبط الإعدادات مثل `git config --global gc.auto 0` لتعطيل الـ GC التلقائي إذا كنت تفضل التشغيل اليدوي، أو زد العتبة لتقليل المقاطعات. تشغيله يمنع المستودعات من التضخم — على سبيل المثال، يستخدم مستودع نواة Linux الـ GC للحفاظ على إدارة التاريخ رغم حجمه الهائل. إذا استمرت المشاكل، تحقق من `git count-objects -v` لإحصائيات الكائنات الفضفاضة.