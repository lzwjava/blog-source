---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: استدعاء الإجراءات المخزنة في DB2 باستخدام المعاملات
translated: true
type: note
---

### الافتراضات والسياق

يبدو أن استفسارك يشير إلى استدعاء *إجراء مخزن* (على الأرجح خطأ مطبعي لـ "store procedure") في نظام قاعدة بيانات IBM، مثل IBM DB2 (على Linux/Unix/Windows أو z/OS أو iSeries). الإجراءات المخزنة هي نصوص قابلة للتنفيذ مخزنة في قاعدة البيانات يمكنها قبول معاملات إدخال، وتنفيذ عمليات، وإرجاع مخرجات أو نتائج. الصيغة الدقيقة تعتمد على لغة البرمجة وبيئة IBM المستخدمة (مثل SQL أو COBOL أو RPG أو Java عبر JDBC). سأركز على الحالة الأكثر شيوعًا: عبارات CALL المعتمدة على SQL في DB2، لأن هذا هو المعيار لقواعد البيانات العلائقية.

إذا كنت تستخدم منصة IBM مختلفة (مثل أوامر CL في IBM i أو MQ أو Watson Query)، يرجى تقديم المزيد من التفاصيل للحصول على نصائح مخصصة.

### كيفية تمرير المعاملات في استدعاء إجراء مخزن في DB2

يتم استدعاء الإجراءات المخزنة في DB2 باستخدام عبارة `CALL` في SQL. يتم تمرير المعاملات في قائمة مفصولة بفواصل داخل الأقواس، لتتوافق مع تعريف الإجراء (مثال: IN للإدخال، OUT للإخراج، INOUT لكليهما).

#### دليل خطوة بخطوة
1. **تحديد أو معرفة توقيع الإجراء**: تأكد من معرفة اسم الإجراء ومعاملاته. على سبيل المثال، قد يتم تعريف الإجراء على النحو التالي:
   ```sql
   CREATE PROCEDURE update_employee (IN emp_id INT, IN new_salary DECIMAL(10,2), OUT status_msg VARCHAR(100))
   ```
   - هنا، `emp_id` هو معامل إدخال (IN)، `new_salary` هو معامل إدخال، و `status_msg` هو معامل إخراج (OUT).

2. **استخدام عبارة CALL**: في بيئة SQL (مثال: DB2 Command Line Processor، أو مضمنة في برامج مثل Java)، استدع الإجراء على النحو التالي:
   ```sql
   CALL update_employee(12345, 75000.00, ?);
   ```
   - الرمز `?` هو عنصر نائب لمعاملات OUT. في الاستدعاءات البرمجية، يتم التعامل مع المخرجات باستخدام مجموعات النتائج أو المتغيرات المضيفة.
   - يتم تمرير مدخلات كقيم حرفية أو متغيرات؛ يتم التقاط المخرجات عبر العناصر النائبة أو المتغيرات المقيدة.

3. **التعامل مع أنواع المعاملات**:
   - **معاملات IN**: تمرير القيم مباشرة (مثال: أرقام، سلاسل نصية بين علامتي اقتباس).
   - **معاملات OUT/INOUT**: استخدم `?` في عبارة CALL، ثم اربطها في الكود الخاص بك لاسترداد القيم بعد التنفيذ.
   - طابق الترتيب والأنواع بدقة؛ يؤدي عدم التطابق إلى أخطاء (مثال: SQLCODE -440 للمعاملات غير الصالحة).

4. **أمثلة في الكود**:
   - **عبر DB2 CLP (سطر الأوامر)**: تنفيذ SQL مباشر.
     ```sql
     CALL my_proc('input_value', ?);
     ```
     استرد معاملات OUT باستخدام `FETCH FIRST FROM` أو في النصوص البرمجية.
   - **عبر JDBC (Java)**:
     ```java
     CallableStatement stmt = conn.prepareCall("{CALL update_employee(?, ?, ?)}");
     stmt.setInt(1, 12345);          // معامل IN
     stmt.setBigDecimal(2, new java.math.BigDecimal("75000.00")); // معامل IN
     stmt.registerOutParameter(3, Types.VARCHAR); // معامل OUT
     stmt.execute();
     String status = stmt.getString(3); // استرداد معامل OUT
     ```
   - **عبر RPG على IBM i**: استخدم `CALLP` مع تعريف متغيرات تطابق أنواع المعاملات.
     ```rpg
     D PROC_PARAM    S                   LIKE(PARAM_TYPE)
     PROC_PARAM = 'value';
     CALLP MY_PROC(PROC_PARAM);
     ```
   - **معالجة الأخطاء**: تحقق من SQLSTATE أو SQLCODE بعد الاستدعاء؛ على سبيل المثال، '00000' تعني نجاح.

#### نصائح وأدلة رئيسية
- **أدلة من وثائق DB2**: وفقًا لمرجع SQL الرسمي لـ IBM's DB2 (مثال: لإصدار LUW v11.5 أو z/OS)، يتم تعريف عبارة `CALL` مع قوائم معاملات اختيارية. على سبيل المثال، الصيغة هي: `CALL procedure-name [(parameter [, parameter] ...)]`. هذا يتوافق مع المعايير الصناعية لقواعد البيانات العلائقية وهو مدعوم عبر متغيرات DB2 لضمان الاتساق (راجع IBM Knowledge Center).
- **الاختلافات**: في IBM i (AS400)، قد تستخدم الإجراءات استدعاءات CL (لغة الأوامر) مثل `CALL PGM(MYPROC) PARM('value')` لبرامج RPG. بالنسبة لـ COBOL على الأنظمة المركزية، قم بتضمين `EXEC SQL CALL...` مع المتغيرات المضيفة.
- **الاختبار**: استخدم `db2 describe routine procedure_name` لفحص المعاملات قبل الاستدعاء.
- **القيود**: قد تحتاج مجموعات المعاملات الكبيرة إلى مصفوفات أو مجموعات نتائج؛ تتطلب الأنواع المعقدة معالجة محددة.

إذا كان هذا لا يتطابق مع إعداداتك (مثال: إذا كان IBM Watson أو أداة أخرى)، شارك المزيد من السياق مثل المنصة أو لغة البرمجة للحصول على تعليمات دقيقة.