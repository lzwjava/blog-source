---
audio: false
generated: true
lang: ar
layout: post
title: إعداد خادم SMB لمشاركة الوسائط على أوبونتو
translated: true
type: note
---

إليك دليلًا خطوة بخطوة لإعداد خادم SMB (Server Message Block) على أوبونتو لتقديم ملفات الوسائط. SMB هو بروتوكول يسمح لك بمشاركة الملفات عبر الشبكة، مما يجعله مثاليًا لتقديم الوسائط لأجهزة مثل أجهزة الكمبيوتر، والتلفزيونات، أو الأجهزة المحمولة. سنستخدم Samba، البرنامج الذي يوفر وظيفة SMB على لينكس، وسنقوم بتكوينه لمشاركة دليل يحتوي على ملفات الوسائط الخاصة بك.

---

### الخطوة 1: تثبيت Samba
أولاً، تحتاج إلى تثبيت Samba على نظام أوبونتو الخاص بك. افتح طرفية وقم بتشغيل الأوامر التالية:

```bash
sudo apt update
sudo apt install samba
```

- `sudo apt update` يقوم بتحديث قائمة الحزم لضمان الحصول على أحدث إصدار.
- `sudo apt install samba` يقوم بتثبيت حزمة Samba، والتي تتضمن الأدوات والخدمات اللازمة.

---

### الخطوة 2: إنشاء نسخة احتياطية لملف تكوين Samba
قبل إجراء أي تغييرات، من الممارسات الجيدة إنشاء نسخة احتياطية لملف تكوين Samba الافتراضي. قم بتشغيل:

```bash
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
```

هذا ينشئ نسخة من الملف الأصلي (`smb.conf.backup`) في حال احتجت للتراجع عن التغييرات لاحقًا.

---

### الخطوة 3: تكوين مشاركة الوسائط
يوجد ملف تكوين Samba في المسار `/etc/samba/smb.conf`. ستقوم بتعديل هذا الملف لتحديد مشاركة لملفات الوسائط الخاصة بك. في هذا المثال، افترض أن ملفات الوسائط الخاصة بك مخزنة في `/home/user/media` (استبدل `user` باسم المستخدم الفعلي الخاص بك).

1. افتح ملف التكوين في محرر نصوص، مثل `nano`:
   ```bash
   sudo nano /etc/samba/smb.conf
   ```

2. انتقل إلى أسفل الملف وأضف القسم التالي:
   ```ini
   [media]
       path = /home/user/media
       browseable = yes
       read only = yes
       guest ok = yes
   ```

3. احفظ الملف واخرج:
   - في `nano`، اضغط `Ctrl+O`، ثم `Enter` للحفظ، و `Ctrl+X` للخروج.

#### شرح التكوين:
- `[media]`: اسم المشاركة، مرئي للمستخدمين الذين يتصفحون الشبكة.
- `path = /home/user/media`: الدليل الذي تريد مشاركته (اضبط هذا ليطابق موقع مجلد الوسائط الخاص بك).
- `browseable = yes`: يجعل المشاركة مرئية عند تصفح الشبكة.
- `read only = yes`: يمنع المستخدمين من تعديل أو حذف الملفات (مثالي لتقديم الوسائط).
- `guest ok = yes`: يسمح بالوصول بدون اسم مستخدم أو كلمة مرور، مما يبسط عملية الوصول للوسائط.

---

### الخطوة 4: التحقق من صحة التكوين
للتأكد من عدم وجود أخطاء في بناء الجملة في تكوينك، قم بتشغيل:

```bash
testparm
```

هذا الأمر يتحقق من ملف `smb.conf` ويعرض الخدمات المحملة. إذا لم تكن هناك أخطاء، فأنت جاهز للمتابعة.

---

### الخطوة 5: إعادة تشغيل خدمات Samba
يعمل Samba بخدمتين: `smbd` (تتعامل مع مشاركة الملفات) و `nmbd` (تتعامل مع اكتشاف الشبكة). أعد تشغيلهما لتطبيق التغييرات:

```bash
sudo systemctl restart smbd
sudo systemctl restart nmbd
```

للتأكد من أن هذه الخدمات تبدأ تلقائيًا عند الإقلاع (مفعلة افتراضيًا عادةً)، يمكنك تشغيل:

```bash
sudo systemctl enable smbd
sudo systemctl enable nmbd
```

---

### الخطوة 6: ضبط أذونات الملفات
لكي يعمل الوصول كضيف، يجب أن يكون دليل الوسائط وملفاته قابلة للقراءة من قبل الجميع. اضبط الأذونات المناسبة باستخدام:

```bash
sudo chmod -R 755 /home/user/media
```

- `755` تعني أن المالك لديه أذونات كاملة (قراءة، كتابة، تنفيذ)، بينما الآخرون لديهم أذونات قراءة وتنفيذ (ضرورية للوصول وإدراج الملفات).
- `-R` يطبق التغيير بشكل متكرر على جميع الملفات والمجلدات الفرعية.

---

### الخطوة 7: تكوين الجدار الناري
إذا كان جدار أوبونتو الناري (UFW) نشطًا، فأنت بحاجة إلى السماح لحركة مرور SMB. أولاً، تحقق من حالة الجدار الناري:

```bash
sudo ufw status
```

إذا كان نشطًا، افتح المنافذ اللازمة:

```bash
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
```

- المنافذ 139 و 445 (TCP) تُستخدم لمشاركة ملفات SMB.
- المنافذ 137 و 138 (UDP) تُستخدم من قبل `nmbd` لاكتشاف الشبكة.

أعد تحميل الجدار الناري لتطبيق التغييرات:

```bash
sudo ufw reload
```

إذا كان الجدار الناري غير نشط، يمكنك تخطي هذه الخطوة.

---

### الخطوة 8: اختبار مشاركة SMB
يجب أن يكون خادم SMB الخاص بك يعمل الآن. لاختباره:

1. ابحث عن عنوان IP لجهاز الأوبونتو الخاص بك:
   ```bash
   ip addr show
   ```
   ابحث عن عنوان IP (مثل `192.168.1.100`) تحت واجهة الشبكة الخاصة بك (مثل `eth0` أو `wlan0`).

2. من جهاز آخر على الشبكة (مثل جهاز كمبيوتر يعمل بنظام Windows):
   - افتح File Explorer وأدخل: `\\<ubuntu-ip-address>\media` (مثال: `\\192.168.1.100\media`).
   - يجب أن ترى ملفات الوسائط الخاصة بك. نظرًا لأن الوصول كضيف مفعل، لا يلزم تسجيل الدخول.

---

### نصائح لاستكشاف الأخطاء وإصلاحها
إذا واجهت مشاكل:
- **تحقق من سجلات Samba**: توجد السجلات في `/var/log/samba/` (مثال: `log.smbd` أو `log.nmbd`). استخدم `cat` أو `tail` لعرضها:
  ```bash
  sudo tail -f /var/log/samba/log.smbd
  ```
- **اختبر محليًا**: استخدم `smbclient` لسرد المشاركات على جهاز الأوبونتو الخاص بك:
  ```bash
  smbclient -L localhost
  ```
  أو اتصل بالمشاركة:
  ```bash
  smbclient //localhost/media -N
  ```
  (`-N` يتخطى مطالبة كلمة المرور للوصول كضيف.)

---

### ملخص الأوامر
إليك التسلسل الكامل:

```bash
sudo apt update
sudo apt install samba
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
sudo nano /etc/samba/smb.conf  # أضف قسم [media]
testparm
sudo systemctl restart smbd
sudo systemctl restart nmbd
sudo chmod -R 755 /home/user/media
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
sudo ufw reload
```

خادم SMB الخاص بك مُعد الآن لتقديم ملفات الوسائط من `/home/user/media`! يمكنك الوصول إليه من أي جهاز على شبكتك باستخدام عنوان IP واسم المشاركة (`\\<ip-address>\media`).