---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: إصلاحات أخطاء تثبيت إن بي إم
translated: true
type: note
---

### فهم الخطأ

هذا فشل في تثبيت npm أثناء تحديث عالمي (أو تثبيت) للحزمة `@anthropic-ai/claude-code`. المشكلة الرئيسية هي في مرحلة "reify"، حيث يحاول npm "إيقاف" (إنشاء نسخة احتياطية) لدليل الحزمة الحالي قبل تثبيت الإصدار الجديد. على وجه التحديد:

- يحاول npm إعادة تسمية `/usr/lib/node_modules/@anthropic-ai/claude-code` إلى نسخة احتياطية مؤقتة مثل `/usr/lib/node_modules/@anthropic-ai/.claude-code-ZjqcDZyQ`.
- هذا يفشل مع `ENOTEMPTY: directory not empty` (errno -39)، والذي يحدث عادةً عندما:
  - يحتوي الدليل المصدر على ملفات/أدلة فرعية مقفلة، قيد الاستخدام، أو بها مشاكل في الأذونات.
  - هناك روابط رمزية معطلة، مقابض ملفات مفتوحة (مثل عملية `claude` قيد التشغيل)، أو مشاكل في نظام الملفات على Linux.
  - نادرًا، تصادف المنطق الداخلي لـnpm لنقل الملفات حالة تسابق.

إعداداتك:
- Node: v22.18.0
- npm: v11.6.1
- نظام التشغيل: Linux 6.14.0-29-generic (على الأرجح Ubuntu/Debian)
- التشغيل كـ root (بناءً على مسار السجل `/root/.npm/_logs/`)، لذا فإن الأذونات ليست السبب الجذري.
- دليل العمل الحالي: `/home/lzwjava/projects/blog-source` (ولكن هذا تثبيت عالمي، لذا فهو غير ذي صلة).

يبدو أن الحزمة هي أداة Claude Code من Anthropic (واجهة سطر الأوامر للمساعدة في البرمجة بالذكاء الاصطناعي)، ويظهر السطر 73 تحذير عدم تطابق تبعية لـ `@img/sharp-libvips-linux-x64`، ولكن هذا غير مرتبط بحدوث التعطل.

### الإصلاحات السريعة (جرب بالترتيب)

1. **إيقاف أي عمليات قيد التشغيل**:
   - أوقف أي عمليات لواجهة سطر الأوامر `claude` أو العمليات المرتبطة بها: `pkill claude` (أو `ps aux | grep claude` للعثور على معرفات العملية، ثم `kill <PID>`).
   - أغلق أي طرفيات أو بيئات تطوير متكاملة تستخدم الحزمة.

2. **تنظيف الدليل يدويًا**:
   - احذف الحزمة والملف الثنائي الحاليين:
     ```
     sudo rm -rf /usr/lib/node_modules/@anthropic-ai/claude-code
     sudo rm -f /usr/bin/claude
     ```
   - يتخطى هذا خطوة النسخ الاحتياطي لـnpm. ثم أعد محاولة التثبيت:
     ```
     sudo npm install -g @anthropic-ai/claude-code
     ```

3. **مسح ذاكرة التخزين المؤقت لـnpm وإعادة المحاولة**:
   - شغّل:
     ```
     sudo npm cache clean --force
     sudo npm install -g @anthropic-ai/claude-code
     ```
   - إذا استمرت المشكلة، أضف `--no-optional` لتخطي التبعيات الاختيارية مثل مكتبة الصور Sharp.

4. **بديل: استخدام npx أو تجنب التثبيت العالمي**:
   - إذا لم تكن بحاجة إليه بشكل عام، قم بتثبيته محليًا في مشروعك: `npm install @anthropic-ai/claude-code` (ثم شغّله عبر `npx claude`).
   - أو استخدم Yarn: `sudo yarn global add @anthropic-ai/claude-code` (أحيانًا يتعامل Yarn مع عمليات النقل بشكل مختلف).

5. **إذا ما زلت عالقًا**:
   - تحقق من مشاكل نظام الملفات: `ls -la /usr/lib/node_modules/@anthropic-ai/` (ابحث عن روابط رمزية غريضة أو أقفال).
   - انزل بإصدار npm مؤقتًا: `sudo npm install -g npm@10` (الإصدار v11 به أخطاء reify عرضية؛ ارجع لاحقًا).
   - السجل الكامل: تحقق من `/root/.npm/_logs/2025-10-27T16_10_10_534Z-debug-0.log` للحصول على المزيد من الأدلة.

هذا يجب أن يحل المشكلة - يمكن أن تكون التثبيتات العالمية لـnpm على Linux متقلبة مع عمليات إعادة التسمية. إذا شاركت الأمر الدقيق الذي قمت بتشغيله أو المزيد من سياق السجل، يمكنني تحسين هذا.