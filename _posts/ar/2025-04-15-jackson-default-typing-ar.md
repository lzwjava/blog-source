---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: شرح الكتابة الافتراضية في جاكسون
translated: true
type: note
---

### ما هو Default Typing في ObjectMapper الخاص بجاكسون؟

`ObjectMapper` الخاص بجاكسون هو فئة أساسية في مكتبة Jackson JSON لجافا، مسؤولة عن تسلسل كائنات جافا إلى JSON وعكس التسلسل للكائنات مرة أخرى. "الكتابة الافتراضية" (Default Typing) هي ميزة تعزز التعامل مع الأنواع متعددة الأشكال (على سبيل المثال، عندما يمكن لحقل أن يحتوي على فئات فرعية مختلفة). تعمل عن طريق تضمين معلومات النوع في ناتج JSON أثناء التسلسل، والتي يستخدمها المعالج أثناء عكس التسلسل لإنشاء الفئة المحددة الصحيحة.

بدون الكتابة الافتراضية، تعتمد جاكسون على النوع المُعلن عنه (مثل فئة أساسية مجردة أو واجهة)، وقد تحتاج إلى تكوين مخصص مثل شرح `@JsonTypeInfo` لتحديد الأنواع الفرعية. تمكين الكتابة الافتراضية يوفر بديلاً عامًا أو شبه عام لتعدد الأشكال، وهو مفيد بشكل خاص للمجموعات أو الخرائط ذات الأنواع المختلطة.

### كيف تعمل؟

تمكين الكتابة الافتراضية يعدل عملية التسلسل:
1. **التسلسل**: عند تسلسل رسم بياني للكائنات، تضيف جاكسون حقل `@class` خاص أو بيانات وصفية مشابهة إلى JSON للإشارة إلى نوع وقت التشغيل للكائنات متعددة الأشكال. يحدث هذا فقط للأنواع التي لا يحدد فيها النوع المُعلن عنه الفئة المحددة بالكامل (مثل `List` تحتوي على كائنات `String` و `Integer`، أو حقول فئة مجردة).

2. **عكس التسلسل**: أثناء عكس التسلسل، يستخدم المعالج معلومات النوع المضمنة هذه للبحث عن الفئة الدقيقة وإنشائها. فهو يستفيد من `TypeFactory` الخاص بجاكسون لحل الأنواع بشكل ديناميكي.

لتمكينها، تقوم باستدعاء إحدى هذه الطرق على نسخة `ObjectMapper`:
- `mapper.enableDefaultTyping()`: طريقة قديمة (مهملة) تمكن تضمين الكتابة متعددة الأشكال الثابتة الزمن (عرضة لمشاكل أمنية).
- `mapper.activateDefaultTyping(ObjectMapper.DefaultTyping policy)`: بديل أكثر أمانًا ومُوصى به تم تقديمه في Jackson 2.10. يسمح بتحديد قيمة التعداد `DefaultTyping`، مثل:
  - `JAVA_LANG_OBJECT`: يتضمن الكتابة لجميع مراجع `Object`.
  - `NON_CONCRETE_AND_ARRAYS`: يتضمن الكتابة للأنواع المجردة/غير المحددة والمصفوفات.
  - `NON_FINAL`: يتضمن الكتابة للفئات غير النهائية.

مثال للاستخدام:
```java
import com.fasterxml.jackson.databind.ObjectMapper;
import static com.fasterxml.jackson.databind.ObjectMapper.DefaultTyping;

ObjectMapper mapper = new ObjectMapper();
mapper.activateDefaultTyping(DefaultTyping.NON_CONCRETE_AND_ARRAYS);
```

بدون التمكين، إذا قمت بتسلسل `List<Object>` بأنواع مختلطة، فقد يحذف JSON تفاصيل النوع، مما يؤدي إلى أخطاء في عكس التسلسل. عند تمكينه، يتضمن JSON تلميحات النوع، على سبيل المثال، `[{"@class": "java.lang.String", "value": "hello"}, {"@class": "java.lang.Integer", "value": 42}]`.

### الاعتبارات الأمنية والقيود

- **الثغرات الأمنية**: تمكين الكتابة الافتراضية بشكل أعمى (خاصة الطريقة القديمة `enableDefaultTyping()`) يمكن أن يعرض الأنظمة لهجمات مثل استخراج البيانات، لأنه يسمح بعكس تسلسل فئات تعسفية عبر JSON مُصمم. تقوم جاكسون بالحد من هذا افتراضيًا في الإصدارات الأحدث، حيث تسمح فقط بالأنواع الشائعة ما لم يتم تخصيصها.
- **ملاءمة حالة الاستخدام**: هي الأفضل للبيئات الموثوقة ذات البيانات متعددة الأشكال (مثل واجهات برمجة التطبيقات الداخلية). لواجهات برمجة التطبيقات العامة، يُفضل استخدام شروح الأنواع الصريحة أو مسلسلات/معكسات تسلسل مخصصة لأمان أفضل.
- **الأداء**: يضيف حملًا بسيطًا بسبب معلومات النوع المضمنة، مما يزيد حجم JSON.

إذا كان هذا يتعلق بـ "object mapper" مختلف (مثل Elasticsearch أو مكتبة أخرى)، قدم المزيد من السياق للحصول على شرح مخصص. للحصول على التفاصيل الكاملة، راجع الوثائق الرسمية لجاكسون.