---
audio: false
generated: true
lang: ar
layout: post
title: التعامل مع شهادات غير الموثوقة في IntelliJ IDEA
translated: true
type: note
---

يظهر مربع حوار "شهادة الخادم غير الموثوق بها" في IntelliJ IDEA غالبًا عندما تواجه البيئة التطويرية المتكاملة (IDE) شهادات SSL غير موثوق بها في مخزن المفاتيح الخاص بها، مثل الشهادات الموقعة ذاتيًا أو شهادات الشركات المخصصة. نظرًا لأنك قمت بالفعل باستيراد مخزن مفاتيح شركتك إلى `/lib/cacerts` ولكنك لا تزال ترى المطالبة، فقد يكون السبب في المشكلة هو أن IntelliJ لا يستخدم مخزن المفاتيح هذا أو أن هناك شهادات إضافية تسبب ظهور المربع الحواري. إليك كيفية معالجة المشكلة وإيقاف هذه المطالبات بشكل محتمل:

### الخيار 1: تكوين IntelliJ لقبول الشهادات غير الموثوق بها تلقائيًا
يتيح تمكين هذا الخيار لـ IntelliJ تخطي مربع الحوار للشهادات غير الموثوق بها، لكن كن حذرًا لأنه يقلل من الأمان من خلال قبول جميع الشهادات، مما قد يعرضك لهجمات الرجل في المنتصف (man-in-the-middle).

- **Windows/Linux**:
  1. انتقل إلى `File > Settings > Tools > Server Certificates`.
  2. حدد خانة الاختيار **"Accept non-trusted certificates automatically"**.
  3. انقر على **Apply** ثم **OK**.
- **macOS**:
  1. انتقل إلى `IntelliJ IDEA > Preferences > Tools > Server Certificates`.
  2. حدد **"Accept non-trusted certificates automatically"**.
  3. انقر على **Apply** ثم **OK**.

**ملاحظة**: لا يُوصى بهذا إلا إذا كنت في شبكة موثوقة ومعزولة (على سبيل المثال، بيئة شركات معزولة عن الشبكات الخارجية "air-gapped")، لأنه قد يجعل بيئة التطوير الخاصة بك عرضة لاتصالات غير موثوقة.

### الخيار 2: التحقق من تكوين مخزن المفاتيح وتصحيحه
نظرًا لأنك قمت باستيراد مخزن مفاتيح الشركة إلى `/lib/cacerts`، تأكد من أن IntelliJ يستخدمه بشكل صحيح. قد تكون المشكلة هي أن IntelliJ لا يزال يشير إلى مخزن الثقة الخاص به أو إلى ملف cacerts خاطئ.

1. **تحقق من مسار مخزن المفاتيح (Keystore Path)**:
   - غالبًا ما يستخدم IntelliJ مخزن الثقة الخاص به الموجود في `~/.IntelliJIdea<version>/system/tasks/cacerts` أو مخزن الثقة الخاص بـ JetBrains Runtime (JBR) الموجود في `<IntelliJ Installation>/jbr/lib/security/cacerts`.
   - إذا قمت بتعديل `/lib/cacerts` في دليل IntelliJ، فتأكد من أنه المسار الصحيح لإصدار البيئة التطويرية لديك. بالنسبة لتثبيتات JetBrains Toolbox، قد يختلف المسار (على سبيل المثال، `~/AppData/Local/JetBrains/Toolbox/apps/IDEA-U/ch-0/<version>/jbr/lib/security/cacerts` على Windows).
   - استخدم أمر `keytool` للتحقق من وجود الشهادة في ملف cacerts:
     ```bash
     keytool -list -keystore <path-to-cacerts> -storepass changeit
     ```
     تأكد من إدراج شهادة CA الخاصة بشركتك.

2. **توجيه IntelliJ إلى مخزن المفاتيح المخصص**:
   - إذا تم استيراد الشهادة بشكل صحيح ولكن IntelliJ لا يزال يظهر المطالبة، فقد لا يكون يستخدم ملف cacerts المعدل. أضف خيار VM مخصص لتحديد مخزن الثقة:
     1. انتقل إلى `Help > Edit Custom VM Options`.
     2. أضف:
        ```
        -Djavax.net.ssl.trustStore=<path-to-cacerts>
        -Djavax.net.ssl.trustStorePassword=changeit
        ```
        استبدل `<path-to-cacerts>` بالمسار الكامل لملف `cacerts` المعدل الخاص بك.
     3. أعد تشغيل IntelliJ IDEA.

3. **أعد استيراد الشهادة**:
   - إذا كان استيراد الشهادة غير مكتمل أو غير صحيح، أعد استيراده:
     ```bash
     keytool -import -trustcacerts -file <certificate-file>.cer -alias <alias> -keystore <path-to-cacerts> -storepass changeit
     ```
     استبدل `<certificate-file>.cer` بشهادة CA الخاصة بشركتك و `<path-to-cacerts>` بمسار ملف cacerts الصحيح.

### الخيار 3: إضافة الشهادات عبر إعدادات Server Certificates في IntelliJ
بدلاً من تعديل ملف cacerts يدويًا، يمكنك إضافة الشهادات من خلال واجهة المستخدم لـ IntelliJ، والتي تقوم بتخزينها في مخزن الثقة الداخلي الخاص بها:

1. انتقل إلى `File > Settings > Tools > Server Certificates` (أو `IntelliJ IDEA > Preferences` على macOS).
2. انقر على زر **"+"** لإضافة شهادة جديدة.
3. انتقل إلى ملف شهادة CA الخاصة بشركتك (بتنسيق `.cer` أو `.pem`) وقم باستيراده.
4. أعد تشغيل IntelliJ للتأكد من التعرف على الشهادة.

### الخيار 4: التحقق من تدخل الوكيل (Proxy) أو برنامج مكافحة الفيروسات
غالبًا ما تستخدم بيئات الشركات خوادم وكيلة أو برامج مكافحة فيروسات (مثل Zscaler, Forcepoint) تقوم بفحص SSL كوسيط (man-in-the-middle)، مما يولد شهادات جديدة ديناميكيًا. يمكن أن يتسبب هذا في ظهور مطالبات متكررة إذا كانت الشهادات تتغير بشكل متكرر (على سبيل المثال، يوميًا، كما في McAfee Endpoint Security).

- **استيراد شهادة CA للوكيل/برنامج مكافحة الفيروسات**:
  - احصل على شهادة الجذر CA من برنامج الوكيل أو مكافحة الفيروسات (اسأل فريق تكنولوجيا المعلومات الخاص بك).
  - قم باستيرادها إلى مخزن الثقة في IntelliJ عبر `Settings > Tools > Server Certificates` أو إلى ملف cacerts باستخدام أمر `keytool` المذكور أعلاه.
- **تعطيل فحص SSL (إذا كان ممكنًا)**:
  - إذا كان الوكيل الخاص بك يسمح بذلك، قم بتكوينه لتجاوز فحص SSL للنطاقات المرتبطة بـ IntelliJ (على سبيل المثال، `plugins.jetbrains.com`, `repo.maven.apache.org`).

### الخيار 5: تصحيح الأخطاء وتحديد الشهادات المسببة للمشكلة
إذا استمرت المشكلة، حدد الخادم أو الشهادة التي تسبب المطالبة:

1. تمكين تسجيل SSL المفصل (verbose SSL logging):
   - انتقل إلى `Help > Edit Custom VM Options` وأضف:
     ```
     -Djavax.net.debug=ssl:handshake:verbose
     ```
   - أعد تشغيل IntelliJ وتحقق من ملف `idea.log` (الموجود في `~/.IntelliJIdea<version>/system/log/`) للبحث عن أخطاء SSL، مثل `PKIX path building failed`. سيظهر هذا الخادم أو الشهادة المسببة للمشكلة.

2. التحقق من وجود إضافات أو تكاملات محددة:
   - قد تقوم الإضافات مثل Maven أو Gradle أو أنظمة التحكم في الإصدار (مثل Git, SVN) بالاتصال بخوادم تحتوي على شهادات مختلفة. قم بتعطيل الإضافات مؤقتًا لعزل المشكلة.
   - بالنسبة لـ Maven، تأكد من أن JDK المُكون في `File > Settings > Build, Execution, Deployment > Build Tools > Maven > Runner` يستخدم ملف cacerts المحدث.

### ملاحظات إضافية
- **تحذير أمني**: إن قبول الشهادات غير الموثوق بها تلقائيًا هو أمر مريح ولكنه محفوف بالمخاطر في الشبكات غير المعزولة. استخدم هذا فقط في البيئات الموثوقة.
- **مزامنة وقت النظام**: تأكد من تزامن ساعة نظامك، حيث أن عدم التطابق يمكن أن يسبب مشاكل في التحقق من صحة الشهادة.
- **JetBrains Runtime (JBR)**: يعمل IntelliJ على JBR الخاص به، والذي قد لا يستخدم مخزن الثقة Java الخاص بالنظام. لن تؤثر التغييرات على `$JAVA_HOME/lib/security/cacerts` الخاص بالنظام على IntelliJ إلا إذا تم تكوينه بشكل صريح.
- **المطالبات المستمرة**: إذا استمرت ظهور المطالبات بعد استيراد الشهادة، فقد يكون السبب هو إضافة أو خدمة (مثل JFrog, SonarQube) تستخدم مخزن ثقة مختلف. تحقق من إعدادات الإضافة أو اتصل بفريق تكنولوجيا المعلومات الخاص بك للحصول على سلسلة الشهادات الكاملة.

### النهج الموصى به
1. جرب **الخيار 3** (إضافة الشهادات عبر واجهة IntelliJ) أولاً، لأنه الأكثر أمانًا وبساطة.
2. إذا فشل ذلك، تحقق من مسار مخزن المفاتيح وتكوينه باستخدام **الخيار 2**.
3. استخدم **الخيار 1** (القبول التلقائي) فقط كحل أخير في بيئة موثوقة.
4. إذا كانت المشكلة تتعلق بوكيل أو برنامج مكافحة فيروسات، فتعاون مع فريق تكنولوجيا المعلومات الخاص بك للحصول على شهادات CA الصحيحة واستيرادها.

إذا كنت لا تزال تواجه مشاكل، شارك تفاصيل حول الشهادة (على سبيل المثال، المصدر، النطاق) أو أي رسائل خطأ من ملف `idea.log`، ويمكنني المساعدة في تضييق نطاق المشكلة further.