---
audio: false
generated: true
lang: ar
layout: post
title: برنامج بايثون لاتصالات TCP
translated: true
type: note
---

أمر PowerShell `Get-NetTCPConnection -LocalPort 80` يسترجع معلومات حول اتصالات TCP في نظام Windows التي تستخدم منفذ محلي محدد (في هذه الحالة، المنفذ 80). لتحقيق وظيفة مشابهة في Python، يمكنك استخدام مكتبة `psutil` التي توفر وصولاً متعدد المنصات إلى تفاصيل النظام، بما في ذلك الاتصالات الشبكية.

أدناه يوجد نص برمجي Python يسرد اتصالات TCP المُرشَّحة حسب منفذ محلي محدد (مثل المنفذ 80)، مشابهًا لأمر PowerShell:

```python
import psutil

def get_tcp_connections_by_port(local_port):
    # استرجاع جميع الاتصالات الشبكية
    connections = psutil.net_connections(kind='tcp')
    
    # تصفية الاتصالات حسب المنفذ المحلي
    matching_connections = [
        conn for conn in connections
        if conn.laddr.port == local_port and conn.status == 'LISTEN'
    ]
    
    # طباعة تفاصيل الاتصالات المطابقة
    if not matching_connections:
        print(f"No TCP connections found listening on port {local_port}")
        return
    
    print(f"TCP connections listening on port {local_port}:")
    print("PID\tLocal Address\tRemote Address\tStatus")
    print("-" * 50)
    
    for conn in matching_connections:
        local_addr = f"{conn.laddr.ip}:{conn.laddr.port}" if conn.laddr else "N/A"
        remote_addr = f"{conn.raddr.ip}:{conn.raddr.port}" if conn.raddr else "N/A"
        pid = conn.pid if conn.pid is not None else "N/A"
        status = conn.status if conn.status else "N/A"
        print(f"{pid}\t{local_addr}\t{remote_addr}\t{status}")

if __name__ == "__main__":
    target_port = 80  # تحديد المنفذ المراد تصفيته (مثل 80)
    get_tcp_connections_by_port(target_port)
```

### الشرح:
1. **تثبيت `psutil`**:
   - تحتاج إلى مكتبة `psutil` للوصول إلى تفاصيل الاتصال الشبكي. قم بتثبيتها باستخدام:
     ```bash
     pip install psutil
     ```

2. **تفاصيل النص البرمجي**:
   - `psutil.net_connections(kind='tcp')` يسترجع جميع اتصالات TCP.
   - يقوم النص البرمجي بتصفية الاتصالات حيث يطابق المنفذ المحلي `local_port` المحدد (مثل 80) وتكون الحالة `LISTEN` (لمحاكاة سلوك `Get-NetTCPConnection` للمنافذ المستمعة).
   - لكل اتصال مطابق، يطبع:
     - **PID**: معرّف العملية للتطبيق الذي يستخدم الاتصال.
     - **العنوان المحلي**: IP المحلي والمنفذ.
     - **العنوان البعيد**: IP البعيد والمنفذ (إذا كان مناسبًا؛ "N/A" إذا لم يكن متصلًا).
     - **الحالة**: حالة الاتصال (مثل "LISTEN").

3. **المخرجات**:
   - يتم تنسيق المخرجات لتشبه المخرجات الجدولية لـ `Get-NetTCPConnection`، مع عرض PID، والعنوان المحلي، والعنوان البعيد، والحالة.

### مثال على المخرجات:
إذا كان خادم ويب (مثل Apache أو Nginx) يستمع على المنفذ 80، فقد تبدو المخرجات كما يلي:
```
TCP connections listening on port 80:
PID     Local Address         Remote Address        Status
--------------------------------------------------
1234    0.0.0.0:80            N/A                   LISTEN
```

إذا لم تكن هناك أي عملية تستمع على المنفذ 80:
```
No TCP connections found listening on port 80
```

### ملاحظات:
- **متعدد المنصات**: مكتبة `psutil` تعمل على Windows، وLinux، وmacOS، على عكس `Get-NetTCPConnection` المخصصة لنظام Windows.
- **الأذونات**: في بعض الأنظمة (مثل Linux أو macOS)، قد تحتاج إلى صلاحيات root / admin للوصول إلى تفاصيل اتصال معينة.
- **التصفية**: يقوم النص البرمجي بالتصفية للاتصالات ذات الحالة `LISTEN` لمطابقة حالة الاستخدام النموذجية لـ `Get-NetTCPConnection -LocalPort 80`. يمكنك تعديل عامل التصفية (مثل إزالة شرط `conn.status == 'LISTEN'`) لتشمل حالات اتصال أخرى مثل `ESTABLISHED`.
- **معلومات إضافية**: يمكنك توسيع النص البرمجي لتشمل المزيد من التفاصيل (مثل اسم العملية) باستخدام `psutil.Process(conn.pid).name()` إذا كان PID متاحًا.

يوفر هذا النص البرمجي مكافئًا في Python لأمر PowerShell، بوظيفة ومخرجات متشابهة. إذا كنت بحاجة إلى ميزات إضافية أو لديك متطلبات محددة، دعني أعلم!