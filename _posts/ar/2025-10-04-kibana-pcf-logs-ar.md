---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: إعداد كيبانا لسجلات بي سي إف
translated: true
type: note
---

يبدو أن "kabana" تشير على الأرجح إلى **Kibana**، لوحة التحكم مفتوحة المصدر لتصور بيانات Elasticsearch. في سياق **Pivotal Cloud Foundry (PCF)** (التي أعيدت تسميتها الآن إلى VMware Tanzu Application Service)، يُستخدم Kibana بشكل شائع للبحث في السجلات وتصورها وتحليلها من خلال نظام التسجيل في المنصة (Loggregator). لا تشغل PCF Kibana بشكل مستقل بل تدمجه من خلال خدمة **Log Search**، التي تخزن السجلات في Elasticsearch وتوفر Kibana للاستعلام.

إذا لم يكن هذا هو ما تقصده، فلا تتردد في التوضيح! أدناه، سأشرح كيفية إعداد واستخدام Kibana مع سجلات PCF. يفترض هذا أنك مسؤول مع حق الوصول إلى PCF Ops Manager ولديك نشر PCF قيد التشغيل (الإصدار 2.0+). لاحظ أن تسجيل PCF قد تطور؛ تحقق من وثائق إصدارك للحصول على التفاصيل.

### المتطلبات الأساسية
- **إصدار PCF**: Log Search (مع Kibana) متوفر في PCF 2.2+. كانت الإصدارات السابقة تستخدم خدمة "ELK" منفصلة.
- **الخدمات**: تأكد من تثبيت خدمة **Elastic Runtime** (لـ Loggregator) وخدمة **Log Search** عبر Pivotal Network (الآن Broadcom Support Portal).
- **الوصول**: امتيازات المسؤول في Ops Manager وأداة سطر أوامر PCF.
- **الموارد**: خصص موارد كافية (على سبيل المثال، 4-8 جيجابايت من ذاكرة الوصول العشوائي لـ Log Search، اعتمادًا على حجم السجلات).

### الخطوة 1: تثبيت وتكوين خدمة Log Search في Ops Manager
تقوم خدمة Log Search بإعادة توجيه سجلات PCF (من التطبيقات والمنصات ومكونات النظام) إلى Elasticsearch، مما يجعلها قابلة للبحث عبر Kibana.

1. **تنزيل واستيراد الخدمة**:
   - سجل الدخول إلى Broadcom Support Portal (المعروف سابقًا باسم Pivotal Network).
   - قم بتنزيل خدمة **Log Search for PCF** (على سبيل المثال، الإصدار الذي يتطابق مع إصدار PCF الخاص بك).
   - في Ops Manager (واجهة الويب)، انتقل إلى **Catalog** > **Import a Product** وقم برفع الخدمة.

2. **تكوين الخدمة**:
   - في Ops Manager، انتقل إلى خدمة **Elastic Runtime** > علامة تبويب **Loggregator**:
     - قم بتمكين **Loggregator forwarding to external systems** (على سبيل المثال، إعداد إعادة توجيه syslog أو HTTP إذا لزم الأمر، ولكن بالنسبة إلى Log Search، يكون الأمر داخليًا).
     - عيّن **Loggregator log retention** إلى قيمة مثل 5-30 يومًا.
   - انتقل إلى خدمة **Log Search**:
     - **Assign Availability Zones**: حدد منطقة توفر واحدة على الأقل للحصول على موثوقية عالية.
     - **Elasticsearch Configuration**:
       - عيّن عدد الحالات (ابدأ بـ 3 للإنتاج).
       - قم بتكوين التخزين (على سبيل المثال، أقراص ثابتة سعة 100 جيجابايت).
       - قم بتمكين الأمان (على سبيل المثال، TLS لـ Elasticsearch).
     - **Kibana Configuration**:
       - قم بتمكين Kibana (يتم تضمينه).
       - عيّن بيانات اعتماد المسؤول (اسم المستخدم/كلمة المرور).
     - **Loggregator Integration**:
       - عيّن الحد الأقصى لعدد أسطر السجلات في الثانية (على سبيل المثال، 1000-5000 بناءً على الحمل الخاص بك).
       - حدد أنماط الفهرس (على سبيل المثال، احتفظ بالسجلات لمدة 7-30 يومًا).
     - **Networking**: اعرض Kibana عبر مسار (على سبيل المثال، `kibana.YOUR-PCF-DOMAIN.com`).
   - انقر فوق **Apply Changes** للنشر. قد يستغرق هذا 30-60 دقيقة.

3. **التحقق من النشر**:
   - قم بتشغيل `cf tiles` أو تحقق من Ops Manager للتحقق من النجاح.
   - قم بالوصول عبر SSH إلى جهاز ظاهري لـ Log Search (باستخدام BOSH CLI: `bosh ssh log-search/0`) وتأكد من أن Elasticsearch قيد التشغيل (`curl localhost:9200`).

### الخطوة 2: الوصول إلى Kibana
بعد النشر:

1. **من خلال PCF Apps Manager (واجهة المستخدم الرسومية)**:
   - سجل الدخول إلى Apps Manager (على سبيل المثال، `https://apps.YOUR-PCF-DOMAIN.com`).
   - ابحث عن instance خدمة "Log Search" (سيتم إنشاء واحد تلقائيًا).
   - انقر فوق instance الخدمة > علامة تبويب **Logs**. يفتح هذا عرض Kibana مدمجًا للبحث السريع في السجلات.

2. **الوصول المباشر إلى Kibana**:
   - انتقل إلى عنوان URL الخاص بـ Kibana الذي تم تكوينه في الخدمة (على سبيل المثال، `https://kibana.YOUR-PCF-DOMAIN.com`).
   - سجل الدخول باستخدام بيانات اعتماد المسؤول التي قمت بتعيينها.
   - إذا كنت تستخدم نطاقًا مخصصًا، فتأكد من أن DNS يشير بشكل صحيح وأن المسارات مسجلة (`cf routes` للتحقق).

3. **الوصول عبر سطر الأوامر (اختياري)**:
   - استخدم `cf logs APP-NAME` للحصول على السجلات الأساسية، ولكن للاستعلامات المتقدمة، استخدم واجهة مستخدم Kibana أو واجهة برمجة التطبيقات API.
   - اربط Log Search بتطبيقاتك: `cf create-service log-search standard my-log-search` ثم `cf bind-service APP-NAME my-log-search`.

### الخطوة 3: استخدام Kibana لسجلات PCF
توفر Kibana واجهة مستخدم تعتمد على الويب للاستعلام في السجلات وتصفيتها وتصورها من مكونات PCF (على سبيل المثال، سجلات التطبيقات، خلايا Diego، Gorouter، إلخ).

1. **التنقل الأساسي**:
   - **علامة تبويب Discover**: ابحث في السجلات باستخدام بناء جملة استعلام Lucene.
     - مثال: ابحث عن الأخطاء في تطبيق معين: `source_id:APP:your-app-name AND json.message:ERROR`.
     - الحقول المتاحة: `timestamp`, `source_id` (على سبيل المثال، `APP:your-app`, `RTR:router`), `message`, `deployment`, إلخ.
   - **علامة تبويب Visualize**: أنشئ لوحات تحكم للرسوم البيانية (على سبيل المثال، حجم السجلات بمرور الوقت، معدلات الخطأ).
     - مثال على التصور: مخطط شريطي للسجلات حسب source_id.
   - **علامة تبويب Dashboard**: احفظ لوحات التحكم المضمنة مسبقًا وشاركها (يتضمن Log Search إعدادات افتراضية لسجلات PCF).

2. **الاستعلامات والنصائح الشائعة**:
   - **تصفية حسب التطبيق**: `source_id:APP:your-app-name` (استبدل بمعرف التطبيق الفعلي أو اسمه).
   - **تصفية حسب الوقت**: استخدم منتقي الوقت (على سبيل المثال، آخر 24 ساعة).
   - **سجلات النظام**: `source_id:DEA` (لخلايا Diego) أو `source_id:LOGGREGATOR`.
   - **تصدير السجلات**: قم بالتنزيل كملف CSV أو JSON من علامة تبويب Discover.
   - **متقدم**: استخدم أدوات المطورين في Kibana (وحدة التحكم) للاستعلام مباشرة في Elasticsearch، على سبيل المثال:
     ```
     GET /logstash-*/_search
     {
       "query": { "match": { "message": "error" } },
       "sort": [ { "timestamp": { "order": "desc" } } ]
     }
     ```
   - **الاحتفاظ والفهرسة**: يتم فهرسة السجلات حسب اليوم (على سبيل المثال، `logstash-YYYY.MM.DD`). قم بتكوين التداول في الخدمة لإدارة التخزين.

3. **استكشاف أخطاء السجلات وإصلاحها**:
   - **لا تظهر السجلات؟** تحقق من قواعد إعادة التوجيه في Loggregator (Ops Manager > Elastic Runtime > Loggregator). تأكد من أن التطبيقات تصدر سجلات (على سبيل المثال، عبر `console.log` في Node.js).
   - **مشاكل في الأداء؟** قم بزيادة نطاق حالات Elasticsearch أو اضبط حدود معدل السجل.
   - **الأمان**: قم بتمكين تكامل UAA في Log Search لتسجيل الدخول الأحادي إلى Kibana.
   - **الأخطاء**: تحقق من سجلات PCF باستخدام `cf logs log-search` أو سجلات المهام في Ops Manager.

### موارد إضافية
- **الوثائق الرسمية**: وثائق VMware Tanzu حول [Log Search](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/10.0/tas/GUID-log-search-index.html) (ابحث عن إصدارك).
- **أدوات سطر الأوامر**: قم بتثبيت `uaac` للمصادقة UAA إذا لزم الأمر، أو استخدم `cf curl` للوصول إلى واجهة برمجة التطبيقات API.
- **البدائل**: للاحتياجات الأبسط، استخدم **Log Cache** المضمن في PCF (سطر أوامر cf: `cf tail APP-NAME`) أو قم بالدمج مع أدوات خارجية مثل Splunk عبر إعادة توجيه syslog.
- **التحديثات**: إذا كنت تستخدم إصدارًا قديمًا من PCF، فقم بالترحيل إلى خدمة ELK أو اتصل بدعم Broadcom.

إذا قدمت المزيد من التفاصيل (على سبيل المثال، إصدار PCF الخاص بك، رسائل الخطأ، أو حالة استخدام محددة)، يمكنني تحسين هذا الشرح further!