---
audio: false
generated: true
image: false
lang: ar
layout: post
title: المقاطعات لا تلغي الاستدلال السحابي
translated: true
type: note
---

عندما تقوم بمقاطعة (مثال: باستخدام Ctrl-C) سكريبت Python الخاص بك أثناء انتظاره لاستدعاء `generate_images()`، إليك ما يحدث تقريبًا:

1. **السلوك من جانب العميل**
   – بمجرد إنهاء عملية Python، يتم إسقاط اتصال HTTP/gRPC الأساسي.
   – ستقوم مكتبة عميل GenAI عادةً بالتقاط الأنبوب المكسور أو إعادة تعيين الاتصال ورفع استثناء (والذي ستراه في سكريبتك).

2. **ما يحدث على جانب Google**
   – بحلول وقت الإلغاء، يكون طلبك قد وصل بالفعل إلى خدمة الاستدلال الخاصة بـ Google وتم إدخاله في قائمة الانتظار (أو بدأ التشغيل بالفعل).
   – معظم نقاط نهاية الاستدلال السحابية **لا** تلغي العمل تلقائيًا لمجرد اختفاء العميل. ستستمر في تشغيل مهمة إنشاء الصورة حتى اكتمالها (مستهلكة لوحدة معالجة الرسومات/TPU ومستحقة للفوترة)، حتى لو لم يكن هناك اتصال حي لإعادة النتيجة.
   – بمجرد انتهاء المهمة، يتم التخلص من الصورة المُنشأة—لا توجد استدعاء ارتجاعي لك إلا إذا قمت بإعداد عملية طويلة المدى أو webhook.

3. **كيف يؤثر Nginx (أو أي وكيل آخر)**
   – إذا كان هناك وكيل عكسي Nginx أمام خدمة الاستدلال، فإن سلوكه الافتراضي هو مراقبة اتصال العميل. بمجرد أن يقطع العميل الاتصال، يُغلق Nginx اتصاله المنبع إلى عملية الاستدلال (مرسلًا FIN/RST).
   – ترى العملية المنبع مقبسًا مكسورًا عندما تحاول في النهاية كتابة الرد. في هذه المرحلة قد تسجل خطأ I/O، ولكن—والأهم من ذلك—**لا** تعود للخلف وتوقف الحساب الذي طلبته؛ هي ببساطة لا تستطيع توصيل البايتات.
   – يمكنك تعديل توجيه Nginx `proxy_ignore_client_abort`—إذا قمت بتعيينه إلى `on`، سيبقى Nginx على اتصال المنبع نشطًا حتى بعد انفصال العميل (مما قد يمكنك من إنهاء كتابة السجلات أو غيرها من عمليات التنظيف بالكامل).

4. **الاستنتاجات الرئيسية لسكريبتك**

   * **المقاطعات لا "تلغي النشر"** أو تلغي النموذج على خوادم Google—ستظل مُفوترًا بالكامل مقابل عملية الاستدلال.
   * إذا كنت تحتاج إلى استدلال قابل للإلغاء، يجب عليك استخدام نمط مختلف: على سبيل المثال،

     1. تقديم دُفعية غير عائقية أو عملية طويلة المدى،
     2. الاستفسار عن حالتها أو إلغاؤها صراحةً عبر استدعاء API منفصل.

باختصار: إنهاء سكريبتك عند 5 ثوانٍ يوقف انتظارك المحلي ويغلق المقبس، لكن استدلال Google لا يزال يعمل حتى اكتماله على أجهزتهم (وسيقوم Nginx أو ما شابه ببساطة بإسقاط الرد إلى لا مكان بمجرد أن يصبح جاهزًا).