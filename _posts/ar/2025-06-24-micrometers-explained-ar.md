---
audio: false
generated: true
lang: ar
layout: post
title: 'دليل الميكرومترات: الأدوات والمراقبة'
translated: true
type: note
---

يغطي هذا الدليل الشامل موضوعين متميزين: **الميكرومترات (أداة القياس)** و **الميكرومتر (واجهة قابلية المراقبة لتطبيقات جافا، خاصة سبرينغ بوت)، مع التركيز على حلول التتبع.**

دعونا نفصلهما:

-----

## الجزء 1: دليل شامل حول الميكرومترات (أداة القياس)

الميكرومتر، الذي يُطلق عليه غالبًا ميكرومتر مقياس البراغي، هو أداة قياس دقيقة تُستخدم للحصول على قياسات عالية الدقة للمسافات الصغيرة، عادةً في نطاق الألف من البوصة أو المئات من المليمتر. يُستخدم على نطاق واسع في مجالات الهندسة والخراطة والتصنيع والعلمية حيث تكون الأبعاد الدقيقة بالغة الأهمية.

### 1. ما هو الميكرومتر؟

في جوهره، يستخدم الميكرومتر آلية برغي مصنعة بدقة لتحويل الحركة الدورانية إلى حركة خطية. وهذا يسمح بإجراء تعديلات دقيقة وقراءات دقيقة لأبعاد الجسم عن طريق تثبيته بين سندان ثابت ومغزل متحرك.

### 2. المكونات الرئيسية للميكرومتر:

*   **الهيكل:** الجسم الرئيسي على شكل حرف C الذي يمسك بجميع المكونات الأخرى. يوفر الاستقرار ويجب التعامل معه بعناية لتجنب أخطاء التمدد الحراري.
*   **السندان:** وجه القياس الثابت الذي يوضع عليه الجسم.
*   **المغزل:** وجه القياس المتحرك الذي يتحرك نحو أو بعيدًا عن السندان عند تدوير الصديرة.
*   **الكم/الأنبوب:** الجزء الثابت من الميكرومتر الذي يضم مقياس الخطي الرئيسي، معروضًا عليه الأرقام الكاملة وأنصاف القيم (مثل البوصات أو المليمترات).
*   **الصديرة:** الجزء الدوار الذي يحرك المغزل وبه مقياس متدرج بدقة للحصول على قراءات أكثر دقة.
*   **وقف الراتchet:** يقع في نهاية الصديرة، ويضمن ضغط قياس متسق من خلال الانزلاق عند تطبيق القوة الصحيحة، مما يمنع الإحكام المفرط وتشويه قطعة العمل.
*   **صامولة القفل (أو ذراع القفل):** تُستخدم لقفل المغزل في مكانه بعد أخذ القياس، مما يمنع الحركة العرضية والحفاظ على القراءة.

### 3. أنواع الميكرومترات:

تأتي الميكرومترات بأنواع مختلفة، كل منها مصمم لمهام قياس محددة:

*   **ميكرومتر خارجي:** النوع الأكثر شيوعًا، يُستخدم لقياس الأبعاد الخارجية مثل قطر العمود أو سمك اللوحة.
*   **ميكرومتر داخلي:** يُستخدم لقياس الأبعاد الداخلية، مثل قطر التجويف أو الفتحة. غالبًا ما يكون لها تصاميم مختلفة، مثل الميكرومترات الأنبوبية أو ذات الفكين.
*   **ميكرومتر العمق:** يُستخدم لقياس عمق الثقوب أو الفتحات أو الدرجات.
*   **ميكرومتر الخيوط اللولبية:** مصمم لقياس قطر الخطوة لخيوط البراغي.
*   **ميكرومتر الكرة:** يتميز بسنادين/مغازل كروية الشكل لقياس سمك الأسطح المنحنية أو الميزات المحددة مثل جدران الأنابيب.
*   **ميكرومتر القرص:** له أوجه قياس مسطحة على شكل قرص لقياس المواد الرقيقة، الورق، أو أسنان التروس.
*   **ميكرومتر رقمي:** يتميز بشاشة إلكترونية لقراءات رقمية مباشرة، مما يلغي خطأ الإزاحة ويجعل القراءات أسهل.
*   **ميكرومتر تمثيلي:** يتطلب قراءة يدوية للمقاييس على الكم والصديرة.
*   **ميكرومتر الورنية:** يتضمن مقياس ورنية إضافي لدقة أعلى، مما يسمح بقراءات تتجاوز التدرجات الرئيسية للصديرة.

### 4. كيفية قراءة الميكرومتر (مثال تمثيلي/إمبراطوري):

بينما تختلف القراءات المحددة بين النظام الإمبراطوري (البوصات) والمتري (المليمترات) والتمثيلي/الرقمي، فإن المبدأ العام للميكرومترات التمثيلية هو:

1.  **اقرأ مقياس الكم (المقياس الرئيسي):**
    *   **البوصات الكاملة:** لاحظ علامة البوصة الكاملة الأكبر المرئية.
    *   **أعشار البوصة (0.100"):** يمثل كل خط مرقم على الكم 0.100 بوصة.
    *   **خمسة وعشرون جزء من الألف (0.025"):** يمثل كل خط غير مرقم بين علامات الأعشار 0.025 بوصة.
2.  **اقرأ مقياس الصديرة:**
    *   تحتوي الصديرة على 25 تدرجًا، يمثل كل علامة 0.001 بوصة.
    *   اقرأ الخط على الصديرة الذي يتماشى مع خط الفهرس على الكم.
3.  **اجمع القراءات:** أضف القيم من الكم (البوصات الكاملة، الأعشار، وخمسة وعشرون جزء من الألف) والصديرة (الأجزاء من الألف) للحصول على القياس النهائي.

**مثال (إمبراطوري):**

*   الكم:
    *   لنفترض أنك ترى "1" (لـ 1.000")
    *   ثم 3 خطوط بعد "1" (3 × 0.100" = 0.300")
    *   وخطين أسفل الخط الرئيسي (2 × 0.025" = 0.050")
    *   المجموع من الكم: 1.000 + 0.300 + 0.050 = 1.350"
*   الصديرة:
    *   العلامة الخامسة عشرة على الصديرة تتماشى مع خط الفهرس (0.015")
*   **القراءة الإجمالية:** 1.350" + 0.015" = **1.365"**

### 5. الاستخدام السليم وأفضل الممارسات:

*   **النظافة:** تأكد دائمًا من أن أوجه القياس (السندان والمغزل) نظيفة وخالية من الغبار أو الزيت أو الحطام.
*   **التصفير:** قبل الاستخدام، قم دائمًا "بتصفر" الميكرومتر. أغلاق أوجه القياس برفق باستخدام وقف الراتchet حتى تلمس. يجب أن تكون القراءة 0.000 (أو نطاق البداية، مثل 25-50 ملم). إذا لم يكن كذلك، اضبط الميكرومتر لخطأ الصفر. تحتوي الميكرومترات الرقمية عادةً على زر إعادة تعيين.
*   **درجة الحرارة:** تعامل مع الميكرومتر من خلال هيكله المعزول أو ارتدِ قفازات، لأن حرارة الجسم يمكن أن تسبب تمددًا حراريًا وتؤثر على الدقة، خاصة للميكرومترات الأكبر حجمًا. اسمح للأداة والجسم بالوصول إلى درجة حرارة الغرفة.
*   **ضغط متسق:** استخدم دائمًا وقف الراتchet لتطبيق ضغط قياس متسق ومناسب. الإحكام المفرط يمكن أن يشوه الجسم أو الميكرومتر.
*   **تحديد موقع الجسم:** ضع الجسم بشكل مربع بين السندان والمغزل لتجنب القراءات المنحرفة.
*   **قياسات متعددة:** للأبعاد الحرجة، خذ عدة قياسات في نقاط مختلفة على الجسم لمراعاة الاختلافات.
*   **التخزين:** قم بتخزين الميكرومترات في علبها الواقية لمنع تلفها.
*   **المعايرة:** تحقق من معايرة الميكرومترات بانتظام وقم بمعايرتها مقابل معايير معروفة (مثل كتل القياس) لضمان دقتها.

-----

## الجزء 2: الميكرومتر كحل تتبع لمشاريع جافا سبرينغ

في سياق مشاريع جافا سبرينغ، يشير "الميكرومتر" إلى **واجهة لقابلية مراقبة التطبيقات** توفر واجهة برمجة تطبيقات محايدة للبائعين لتجهيز التطبيقات القائمة على JVM. يسمح لك بجمع وتصدير بيانات telemetry المختلفة، بما في ذلك المقاييس، والتسجيل، و **التتبع الموزع**.

Micrometer Tracing هو الخليفة لـ Spring Cloud Sleuth ومصمم لتوفير نظرة ثاقبة على الأنظمة الموزعة المعقدة من خلال تتبع الطلبات عبر خدمات متعددة.

### 1. ما هو التتبع الموزع؟

في بنية الخدمات المصغرة، غالبًا ما يعبر طلب مستخدم واحد عبر خدمات متعددة. يسمح التتبع الموزع لك بما يلي:

*   **تتبع التدفق:** رؤية المسار الكامل الذي يسلكه الطلب عبر نظامك.
*   **تحديد الاختناقات:** تحديد الخدمة أو العملية التي تسبب التأخير.
*   **فهم التبعيات:** تصور التفاعلات بين الخدمات المختلفة.
*   **تبسيط التصحيح:** ربط السجلات بطلبات محددة، مما يجعل استكشاف الأخطاء وإصلاحها أسهل بكثير.

يتكون التتبع الموزع من **spans**. يمثل **الـ span** عملية واحدة أو وحدة عمل ضمن التتبع (على سبيل المثال، طلب HTTP إلى خدمة، استعلام قاعدة بيانات، تنفيذ طريقة). تحتوي الـ spans على معرف فريد، ووقت بداية ونهاية، ويمكن أن تتضمن علامات (أزواج مفتاح-قيمة) وأحداثًا للبيانات الوصفية الإضافية. يتم تنظيم الـ spans بشكل هرمي، مع علاقات أب-ابن، مشكلةً تتبعًا.

### 2. Micrometer Tracing في Spring Boot 3.x+

Spring Boot 3.x+ يتكامل بعمق مع Micrometer's Observation API و Micrometer Tracing، مما يجعله أسهل بكثير في تنفيذ التتبع الموزع.

#### 2.1. المفاهيم الأساسية:

*   **Observation API:** واجهة برمجة التطبيقات الموحدة لـ Micrometer لتجهيز الكود الخاص بك، القادرة على إنتاج مقاييس، وتتبع، وسجلات من نقطة تجهيز واحدة.
*   **Micrometer Tracing:** واجهة فوق مكتبات التتبع الشهيرة مثل OpenTelemetry و OpenZipkin Brave. يتعامل مع دورة حياة الـ spans، ونشر السياق، والإبلاغ إلى خلفيات التتبع.
*   **جسور التتبع:** يوفر Micrometer Tracing "جسور" لربط واجهة برمجة التطبيقات الخاصة به بتنفيذات تتبع محددة (مثل `micrometer-tracing-bridge-otel` لـ OpenTelemetry، `micrometer-tracing-bridge-brave` لـ OpenZipkin Brave).
*   **المراسلون/المصدرون:** ترسل هذه المكونات بيانات التتبع المجمعة إلى خلفية التتبع (مثل Zipkin، Jaeger، Grafana Tempo).

#### 2.2. إعداد Micrometer Tracing في مشروع جافا سبرينغ بوت:

إليك دليل خطوة بخطوة:

**الخطوة 1: إضافة التبعيات**

تحتاج إلى `spring-boot-starter-actuator` لميزات قابلية المراقبة، وجسر Micrometer Tracing، ومراسل/مصدر لخلفية التتبع التي اخترتها.

**مثال مع OpenTelemetry و Zipkin (خيار شائع):**

في ملف `pom.xml` الخاص بك (Maven):

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>

    <dependency>
        <groupId>io.micrometer</groupId>
        <artifactId>micrometer-observation</artifactId>
    </dependency>

    <dependency>
        <groupId>io.micrometer</groupId>
        <artifactId>micrometer-tracing-bridge-otel</artifactId>
    </dependency>

    <dependency>
        <groupId>io.opentelemetry</groupId>
        <artifactId>opentelemetry-exporter-zipkin</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
</dependencies>
```

**الخطوة 2: تكوين خصائص التتبع**

في `application.properties` أو `application.yml`، يمكنك تكوين سلوك التتبع.

```properties
# تمكين التتبع (عادة يكون صحيحًا افتراضيًا مع تبعيات actuator والتتبع)
management.tracing.enabled=true

# تكوين احتمالية أخذ العينات (1.0 = 100% من الطلبات يتم تتبعها)
# الافتراضي غالبًا هو 0.1 (10%)، اضبطه على 1.0 للتطوير/الاختبار
management.tracing.sampling.probability=1.0

# تكوين عنوان URL الأساسي لـ Zipkin (إذا كنت تستخدم Zipkin)
spring.zipkin.base-url=http://localhost:9411
```

**الخطوة 3: تشغيل خلفية التتبع (مثل Zipkin)**

تحتاج إلى خادم تتبع لجمع وتصور التتبع الخاص بك. Zipkin هو خيار شائع للتطوير المحلي.

يمكنك تشغيل Zipkin عبر Docker:

```bash
docker run -d -p 9411:9411 openzipkin/zipkin
```

بمجرد التشغيل، يمكنك الوصول إلى واجهة مستخدم Zipkin على `http://localhost:9411`.

**الخطوة 4: التجهيز التلقائي (سحر سبرينغ بوت!)**

بالنسبة للعديد من المكونات الشائعة في Spring Boot (مثل نقاط نهاية `RestController`، `RestTemplate`، `WebClient`، `JdbcTemplate`، مستمعي/منتجي Kafka، إلخ)، يوفر Micrometer Tracing **تجهيزًا تلقائيًا**. هذا يعني أنك غالبًا لا تحتاج إلى كتابة أي كود تتبع صريح ليعمل تتبع الطلبات الأساسي.

تضمن Spring Boot ما يلي:

*   تبدأ طلبات HTTP الواردة تتبعًا جديدًا تلقائيًا أو تستمر في تتبع موجود إذا كانت رؤوس التتبع موجودة.
*   تنشر الطلبات الصادرة التي تتم باستخدام `RestTemplateBuilder`، `RestClient.Builder`، أو `WebClient.Builder` المُهيأة تلقائيًا سياق التتبع إلى الخدمات اللاحقة.
*   تتضمن عبارات التسجيل تلقائيًا `traceId` و `spanId` (إذا قمت بتكوين نمط التسجيل الخاص بك).

**مثال لنمط التسجيل (في `application.properties`):**

```properties
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}] %c{1.}:%M:%L - %m%n
```

سيؤدي هذا النمط إلى حقن `traceId` و `spanId` في أسطر السجل الخاصة بك، مما يسهل ربط السجلات بتتبع محدد.

**الخطوة 5: التجهيز اليدوي (للمنطق المخصص)**

بينما يغطي التجهيز التلقائي الكثير، سترغب غالبًا في تتبع منطق أعمال محدد أو عمليات حرجة داخل تطبيقك. يمكنك القيام بذلك باستخدام:

*   **شرح `@Observed` (موصى به لـ Spring Boot 3.x+):**
    هذا الشرح هو جزء من Micrometer Observation API وهو الطريقة المفضلة لإنشاء ملاحظات (والتي يمكن أن تنتج كل من المقاييس والتتبع).

    ```java
    import io.micrometer.observation.annotation.Observed;
    import org.springframework.stereotype.Service;

    @Service
    public class MyService {

        @Observed(name = "myService.processData", contextualName = "processing-data")
        public String processData(String input) {
            // ... منطق عملك ...
            System.out.println("Processing data: " + input);
            return "Processed: " + input;
        }
    }
    ```

    يحدد سمة `name` اسم الملاحظة (الذي يصبح اسم المقياس واسم الـ span في التتبع). يوفر `contextualName` اسمًا أكثر قابلية للقراءة للإنسان للـ span في أدوات التتبع.

*   **واجهة برمجة التطبيقات البرمجية (لمزيد من التحكم):**
    يمكنك استخدام `ObservationRegistry` و `Tracer` beans المقدمة من Spring Boot مباشرة.

    ```java
    import io.micrometer.observation.Observation;
    import io.micrometer.observation.ObservationRegistry;
    import org.springframework.stereotype.Service;

    @Service
    public class AnotherService {

        private final ObservationRegistry observationRegistry;

        public AnotherService(ObservationRegistry observationRegistry) {
            this.observationRegistry = observationRegistry;
        }

        public String performComplexOperation(String id) {
            return Observation.createNotStarted("complex.operation", observationRegistry)
                    .lowCardinalityKeyValue("operation.id", id) // أضف علامة
                    .observe(() -> {
                        // ... المنطق المعقد هنا ...
                        try {
                            Thread.sleep(100); // محاكاة العمل
                        } catch (InterruptedException e) {
                            Thread.currentThread().interrupt();
                        }
                        return "Completed complex operation for " + id;
                    });
        }
    }
    ```

    هنا، `observe()` تغلف كتلة الكود، و `lowCardinalityKeyValue` تضيف علامة إلى الـ span.

### 3. التتبع الموزع في الخدمات المصغرة:

عندما يكون لديك خدمات Spring Boot متعددة، يسهل Micrometer Tracing نشر السياق تلقائيًا لـ `RestTemplate`، `WebClient`، وعملاء آخرين مجهزين. هذا يعني أنه يتم تمرير `traceId` و `spanId` في رؤوس HTTP بين الخدمات (على سبيل المثال، رأس `traceparent` لـ W3C Trace Context).

عندما يصل طلب إلى خدمة لاحقة، يكتشف Micrometer Tracing هذه الرؤوس ويستمر في التتبع الحالي، مما يخلق spans جديدة تكون تابعة للـ span الأصلي من الخدمة المتصل بها. هذا يشكل التتبع الكامل من البداية إلى النهاية.

### 4. تصور التتبع:

بمجرد تجهيز تطبيقك وإرسال التتبع إلى خلفية مثل Zipkin (أو Jaeger، Lightstep، إلخ)، يمكنك:

1.  **الوصول إلى واجهة المستخدم:** انتقل إلى واجهة المستخدم لخلفية التتبع (على سبيل المثال، `http://localhost:9411` لـ Zipkin).
2.  **العثور على التتبع:** استخدم المرشحات (اسم الخدمة، اسم الـ span، معرف التتبع) للعثور على تتبع محدد.
3.  **تحليل تفاصيل التتبع:** انقر على تتبع لرؤية الجدول الزمني الخاص به، والـ spans الفردية، ومدة كل منها، والعلامات، والأحداث.
4.  **رسم بياني للتبعيات:** يمكن لمعظم خلفيات التتبع تصور تبعيات الخدمة بناءً على التتبع المجمع.

### 5. أفضل الممارسات لـ Micrometer Tracing:

*   **اسمي الـ spans بشكل ذي معنى:** استخدم أسماء واضحة وموجزة ومنخفضة التدرج لـ spans الخاصة بك (على سبيل المثال، "userService.getUser"، "productService.updateStock"). تجنب تضمين بيانات ديناميكية للغاية في أسماء الـ spans.
*   **استخدم العلامات للتفاصيل (بيانات عالية التدرج):** بدلاً من وضع البيانات الديناميكية في أسماء الـ spans، استخدم العلامات (أزواج مفتاح-قيمة) للحصول على سياق إضافي. على سبيل المثال، `userId`، `orderId`، `customerType`. كن حذرًا بشأن العلامات **عالية التدرج**، لأنها يمكن أن تزيد بشكل كبير من تكاليف التخزين وأوقات الاستعلام في خلفية التتبع الخاصة بك. استخدمها بحكمة.
*   **احتفظ بالـ spans مفصلة ولكن ليست مفرطة:** أنشئ spans للعمليات المهمة، ولكن تجنب إنشاء العديد من الـ spans الصغيرة جدًا، لأن هذا يمكن أن يضيف عبئًا. استهدف تحقيق توازن يوفر رؤية كافية دون إرباك النظام.
*   **انشر السياق:** تأكد من نشر سياق التتبع بشكل صحيح عبر حدود الخدمة. يتعامل التهيئة التلقائية لـ Spring Boot مع هذا في السيناريوهات الشائعة، ولكن كن على علم عند استخدام عملاء مخصصين أو عمليات غير متزامنة.
*   **أخذ العينات:** لبيئات الإنتاج عالية الحركة، فكر في استخدام استراتيجيات أخذ العينات لتقليل حجم بيانات التتبع المرسلة إلى خلفيتك. يسمح Spring Boot بتكوين `management.tracing.sampling.probability`.
*   **ربط السجلات:** استفد من `traceId` و `spanId` المحقونة في السجلات لتسهيل التصحيح وربط سلوك التطبيق بطلبات محددة.
*   **راقب خلفية التتبع الخاصة بك:** تأكد من أن خلفية التتبع الخاصة بك (على سبيل المثال، خادم Zipkin) لديها موارد كافية للتعامل مع حجم التتبع الوارد.
*   **دمج مع أدوات قابلية المراقبة الأخرى:** التتبع هو جزء واحد من قابلية المراقبة. اجمعها مع المقاييس (أيضًا عبر Micrometer) والتسجيل المنظم للحصول على نظرة شاملة لصحة وأداء تطبيقك.

باتباع هذه الإرشادات، يمكنك الاستفادة بشكل فعال من Micrometer Tracing للحصول على رؤى عميقة في تطبيقات Spring Boot الخاصة بك، خاصة في البيئات الموزعة.