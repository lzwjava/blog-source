---
audio: true
generated: true
lang: ar
layout: post
title: استخدام SAX (الواجهة البسيطة لXML)
translated: true
---

لتستخدم حزمة `org.xml.sax` في Java لتحليل مستندات XML، يمكنك اتباع عملية بسيطة باستخدام طريقة تحليل SAX (Simple API for XML). SAX هو محلل مدفوع بالأحداث يقرأ مستند XML تسلسليًا ويحدث طرق استدعاء عندما يواجه أجزاء مختلفة من المستند مثل العناصر أو محتوى النص. وهذا يجعله فعالًا من حيث الذاكرة، خاصة للمستندات XML الكبيرة، لأنه لا يحمل المستند بأكمله في الذاكرة مثل DOM. أدناه دليل خطوة بخطوة لاستخدام `org.xml.sax`.

---

### الخطوة 1: إعداد محلل SAX
لتحليل XML باستخدام SAX، تحتاج إلى إنشاء مثيل `SAXParser` باستخدام فئة `SAXParserFactory`. تسمح هذه المصنع لك بتكوين سلوك المحلل قبل إنشائه.

هكذا يمكنك إنشاء `SAXParser`:

```java
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

public class SAXExample {
    public static void main(String[] args) {
        try {
            // إنشاء مثيل SAXParserFactory
            SAXParserFactory factory = SAXParserFactory.newInstance();

            // اختياري: تكوين المصنع (مثل: تمكين الوعي بالفضاء الاسمي)
            factory.setNamespaceAware(true); // قم بتحديده على `true` إذا كان XML الخاص بك يستخدم فضاءات أسماء

            // إنشاء SAXParser
            SAXParser parser = factory.newSAXParser();

            // الخطوات التالية ستذهب هنا
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

- **`SAXParserFactory.newInstance()`**: يخلق مثيل مصنع جديد.
- **`factory.setNamespaceAware(true)`**: اختياري. تمكين معالجة الفضاء الاسمي إذا كان XML الخاص بك يستخدم فضاءات أسماء. بافتراضه `false`.
- **`factory.newSAXParser()`**: يخلق `SAXParser`. يمكن أن يثير `ParserConfigurationException` أو `SAXException` إذا لم يتمكن المحلل من التكوين أو التهيئة.

---

### الخطوة 2: إنشاء معالج للأحداث XML
يستند تحليل SAX على معالج لمعالجة الأحداث XML التي يواجهها، مثل بداية عنصر، نهاية عنصر، أو محتوى نصي. الواجهة الرئيسية لهذا هي `ContentHandler`، ولكن من أجل السهولة، يمكنك توسيع فئة `DefaultHandler` التي توفر تنفيذات فارغة لـ `ContentHandler` وواجهات معالج أخرى (`ErrorHandler`, `DTDHandler`، إلخ.). تحتاج فقط إلى إعادة تعريف الطرق التي تهمك.

هنا مثال على معالج مخصص:

```java
import org.xml.sax.Attributes;
import org.xml.sax.helpers.DefaultHandler;

public class MyHandler extends DefaultHandler {
    // متغير لتجميع محتوى النص
    private StringBuilder content = new StringBuilder();

    @Override
    public void startElement(String uri, String localName, String qName, Attributes attributes) {
        // مسح حاوية المحتوى للمعالج الجديد
        content.setLength(0);
        System.out.println("بداية العنصر: " + qName);

        // إذا كان العنصر يحتوي على صفات، قم بمعالجتها
        for (int i = 0; i < attributes.getLength(); i++) {
            System.out.println("الصفات: " + attributes.getQName(i) + " = " + attributes.getValue(i));
        }
    }

    @Override
    public void characters(char[] ch, int start, int length) {
        // تجميع محتوى النص (قد يتم استدعاؤه عدة مرات لكل عنصر)
        content.append(ch, start, length);
    }

    @Override
    public void endElement(String uri, String localName, String qName) {
        // معالجة محتوى النص المتجمع
        String text = content.toString().trim();
        if (!text.isEmpty()) {
            System.out.println("المحتوى: " + text);
        }
        System.out.println("نهاية العنصر: " + qName);
        content.setLength(0); // إعادة تعيينه للمعالج التالي
    }

    @Override
    public void startDocument() {
        System.out.println("بدأ تحليل المستند");
    }

    @Override
    public void endDocument() {
        System.out.println("انتهى تحليل المستند");
    }
}
```

- **`startElement`**: يتم استدعاؤه عندما يواجه المحلل بداية عنصر. تشمل المتغيرات:
  - `uri`: URI الفضاء الاسمي (إذا كان الوعي بالفضاء الاسمي).
  - `localName`: اسم العنصر المحلي (بدون التسمية، إذا كان الوعي بالفضاء الاسمي).
  - `qName`: الاسم المؤهل (يضم التسمية، إذا كانت موجودة).
  - `attributes`: قائمة صفات العنصر.
- **`characters`**: يتم استدعاؤه لمحتوى النص داخل عنصر. لاحظ أن هذا قد يتم استدعاؤه عدة مرات لمحتوى عنصر واحد، لذا استخدم `StringBuilder` لتجميعه.
- **`endElement`**: يتم استدعاؤه عند انتهاء عنصر.
- **`startDocument` و `endDocument`**: يتم استدعاؤهما في بداية ونهاية مستند XML.

---

### الخطوة 3: تحليل XML
مع المحلل والمعالج جاهزين، يمكنك تحليل مصدر XML (مثل ملف، `InputStream`، أو سلسلة) عن طريق استدعاء طريقة `parse` على `SAXParser` وعبور المعالج الخاص بك.

هكذا يمكنك تحليل ملف XML:

```java
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import java.io.File;

public class SAXExample {
    public static void main(String[] args) {
        try {
            // إنشاء المحلل
            SAXParserFactory factory = SAXParserFactory.newInstance();
            SAXParser parser = factory.newSAXParser();

            // إنشاء المعالج
            MyHandler handler = new MyHandler();

            // تحليل ملف XML
            File xmlFile = new File("example.xml");
            parser.parse(xmlFile, handler);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

- **`parser.parse`**: يأخذ مصدر XML (مثل `File`) و `DefaultHandler`. يمكن أن يثير `IOException` (للخطأ في الإدخال) أو `SAXException` (للخطأ في التحليل).

لسلسلة XML بدلاً من ملف، استخدم `InputSource`:

```java
import org.xml.sax.InputSource;
import java.io.StringReader;

// داخل طريقة main
String xml = "<book><title>XML Parsing</title></book>";
InputSource inputSource = new InputSource(new StringReader(xml));
parser.parse(inputSource, handler);
```

---

### الخطوة 4: معالجة الاستثناءات
يشمل تحليل SAX عدة استثناءات يجب أن تتعامل معها:

- **`ParserConfigurationException`**: يثيره `newSAXParser()` إذا لم يتمكن المحلل من التكوين.
- **`SAXException`**: يثيره `newSAXParser()` أو `parse()` للخطأ العام في التحليل.
- **`IOException`**: يثيره `parse()` إذا كان هناك مشكلة في قراءة المصدر الإدخال.

أغلف كودك في كتلة `try-catch`:

```java
try {
    SAXParserFactory factory = SAXParserFactory.newInstance();
    SAXParser parser = factory.newSAXParser();
    MyHandler handler = new MyHandler();
    parser.parse(new File("example.xml"), handler);
} catch (ParserConfigurationException e) {
    System.err.println("خطأ في تكوين المحلل: " + e.getMessage());
} catch (SAXException e) {
    System.err.println("خطأ SAX: " + e.getMessage());
} catch (IOException e) {
    System.err.println("خطأ IO: " + e.getMessage());
}
```

---

### الخطوة 5: الميزات الاختيارية
#### معالجة الأخطاء
يستند `DefaultHandler` أيضًا على `ErrorHandler`. قم بإعادة تعريف طرقه لمعالجة أخطاء التحليل:

```java
public class MyHandler extends DefaultHandler {
    @Override
    public void error(SAXParseException e) {
        System.err.println("خطأ في التحليل: " + e.getMessage());
    }

    @Override
    public void fatalError(SAXParseException e) throws SAXException {
        System.err.println("خطأ قاتل: " + e.getMessage());
        throw e; // إيقاف التحليل
    }

    @Override
    public void warning(SAXParseException e) {
        System.out.println("تحذير: " + e.getMessage());
    }
    // طرق أخرى كما أعلاه
}
```

#### معالجة الفضاء الاسمي
إذا كان XML الخاص بك يستخدم فضاءات أسماء، قم بتحديد `factory.setNamespaceAware(true)` واستخدم `uri` و `localName` في طرق المعالج الخاص بك بدلاً من `qName` لتحديد العناصر بشكل صحيح.

#### التحقق من صحة
لتحقق من صحة XML ضد DTD أو مخطط، قم بتحديد `factory.setValidating(true)`. قد تحتاج أيضًا إلى `ErrorHandler` لإدارة أخطاء التحقق من صحة.

---

### مثال XML والنتيجة
لملف XML `example.xml`:
```xml
<book id="123">
    <title>XML Parsing</title>
    <author>John Doe</author>
</book>
```

عند تشغيل الكود أعلاه قد يكون الناتج:
```
بدأ تحليل المستند
بداية العنصر: book
الصفات: id = 123
بداية العنصر: title
المحتوى: XML Parsing
نهاية العنصر: title
بداية العنصر: author
المحتوى: John Doe
نهاية العنصر: author
نهاية العنصر: book
انتهى تحليل المستند
```

---

### الملخص
لتستخدم `org.xml.sax`:
1. إنشاء `SAXParser` باستخدام `SAXParserFactory`.
2. تنفيذ معالج عن طريق توسيع `DefaultHandler` وإعادة تعريف الطرق مثل `startElement`, `endElement`, و `characters`.
3. تحليل XML عن طريق استدعاء `parser.parse()` مع المعالج الخاص بك ومصدر XML.
4. معالجة الاستثناءات (`SAXException`, `IOException`, `ParserConfigurationException`).
5. اختياريًا، قم بتكوين الوعي بالفضاء الاسمي، التحقق من صحة، أو معالجة الأخطاء.

هذه الطريقة مثالية لتحليل مستندات XML الكبيرة بشكل فعال عندما تحتاج فقط إلى استخراج بيانات محددة دون بناء شجرة في الذاكرة.