---
audio: false
generated: true
lang: ar
layout: post
title: استخدام ساكس (واجهة برمجة تطبيقات بسيطة لـ إكس إم إل)
translated: true
type: note
---

لاستخدام حزمة `org.xml.sax` في جافا لتحليل مستندات XML، يمكنك اتباع عملية مباشرة باستخدام نهج التحليل SAX (واجهة برمجة تطبيقات بسيطة لـ XML). SAX هو محلل يعتمد على الأحداث يقرأ مستند XML بشكل تسلسلي ويشغل طرق رد الاتصال عند مواجهته لأجزاء مختلفة من المستند، مثل العناصر أو محتوى النص. هذا يجعله فعالاً من حيث الذاكرة، خاصةً لملفات XML الكبيرة، لأنه لا يقوم بتحميل المستند بالكامل في الذاكرة كما يفعل DOM. فيما يلي دليل خطوة بخطوة لاستخدام `org.xml.sax`.

---

### الخطوة 1: إعداد محلل SAX
للبدء في تحليل XML باستخدام SAX، تحتاج إلى إنشاء نسخة من `SAXParser` باستخدام فئة `SAXParserFactory`. تتيح لك هذه المصنع ضبط سلوك المحلل قبل إنشائه.

إليك كيفية إنشاء `SAXParser`:

```java
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

public class SAXExample {
    public static void main(String[] args) {
        try {
            // إنشاء نسخة من SAXParserFactory
            SAXParserFactory factory = SAXParserFactory.newInstance();

            // اختياري: ضبط المصنع (مثال: تمكين الوعي بمساحات الأسماء)
            factory.setNamespaceAware(true); // اضبطه على true إذا كان XML الخاص بك يستخدم مساحات الأسماء

            // إنشاء SAXParser
            SAXParser parser = factory.newSAXParser();

            // الخطوات التالية ستكون هنا
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

- **`SAXParserFactory.newInstance()`**: ينشئ نسخة مصنع جديدة.
- **`factory.setNamespaceAware(true)`**: اختياري. يمكّن معالجة مساحات الأسماء إذا كان XML الخاص بك يستخدمها. بشكل افتراضي، تكون القيمة `false`.
- **`factory.newSAXParser()`**: ينشئ `SAXParser`. هذا يمكن أن يطرح `ParserConfigurationException` أو `SAXException` إذا تعذر ضبط المحلل أو تهيئته.

---

### الخطوة 2: إنشاء معالج لأحداث XML
يعتمد تحليل SAX على معالج لمعالجة أحداث XML التي يواجهها، مثل بداية العنصر، أو نهاية العنصر، أو محتوى النص. الواجهة الأساسية لهذا هي `ContentHandler`، ولكن للتبسيط، يمكنك تمديد فئة `DefaultHandler`، التي توفر تنفيذات فارغة لـ `ContentHandler` وواجهات المعالج الأخرى (`ErrorHandler`, `DTDHandler`, إلخ). تحتاج فقط إلى تجاوز الطرق التي تهتم بها.

إليك مثالاً على معالج مخصص:

```java
import org.xml.sax.Attributes;
import org.xml.sax.helpers.DefaultHandler;

public class MyHandler extends DefaultHandler {
    // متغير لتجميع محتوى النص
    private StringBuilder content = new StringBuilder();

    @Override
    public void startElement(String uri, String localName, String qName, Attributes attributes) {
        // مسح مخزن المحتوى للعنصر الجديد
        content.setLength(0);
        System.out.println("بداية العنصر: " + qName);

        // إذا كان للعنصر سمات، قم بمعالجتها
        for (int i = 0; i < attributes.getLength(); i++) {
            System.out.println("السمة: " + attributes.getQName(i) + " = " + attributes.getValue(i));
        }
    }

    @Override
    public void characters(char[] ch, int start, int length) {
        // تجميع محتوى النص (قد يتم استدعاؤه عدة مرات لكل عنصر)
        content.append(ch, start, length);
    }

    @Override
    public void endElement(String uri, String localName, String qName) {
        // معالجة محتوى النص المتراكم
        String text = content.toString().trim();
        if (!text.isEmpty()) {
            System.out.println("المحتوى: " + text);
        }
        System.out.println("نهاية العنصر: " + qName);
        content.setLength(0); // إعادة الضبط للعنصر التالي
    }

    @Override
    public void startDocument() {
        System.out.println("بدأ تحليل المستند");
    }

    @Override
    public void endDocument() {
        System.out.println("اكتمل تحليل المستند");
    }
}
```

- **`startElement`**: يتم استدعاؤه عندما يواجه المحلل بداية عنصر. تشمل المعاملات:
  - `uri`: URI مساحة الاسم (إذا كان واعيًا بمساحات الأسماء).
  - `localName`: الاسم المحلي للعنصر (بدون البادئة، إذا كان واعيًا بمساحات الأسماء).
  - `qName`: الاسم المؤهل (يتضمن البادئة، إن وجدت).
  - `attributes`: قائمة سمات العنصر.
- **`characters`**: يتم استدعاؤه لمحتوى النص داخل عنصر. لاحظ أنه قد يتم استدعاؤه عدة مرات لمحتوى عنصر واحد، لذا استخدم `StringBuilder` لتجميعه.
- **`endElement`**: يتم استدعاؤه عندما ينتهي العنصر.
- **`startDocument` و `endDocument`**: يتم استدعاؤهما في بداية ونهاية مستند XML.

---

### الخطوة 3: تحليل XML
مع جاهزية المحلل والمعالج، يمكنك تحليل مصدر XML (مثل ملف، `InputStream`، أو سلسلة نصية) عن طريق استدعاء طريقة `parse` على `SAXParser` وتمرير المعالج الخاص بك.

إليك كيفية تحليل ملف XML:

```java
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import java.io.File;

public class SAXExample {
    public static void main(String[] args) {
        try {
            // إنشاء المحلل
            SAXParserFactory factory = SAXParserFactory.newInstance();
            SAXParser parser = factory.newSAXParser();

            // إنشاء المعالج
            MyHandler handler = new MyHandler();

            // تحليل ملف XML
            File xmlFile = new File("example.xml");
            parser.parse(xmlFile, handler);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

- **`parser.parse`**: يأخذ مصدر XML (مثل `File`) و `DefaultHandler`. يمكن أن يطرح `IOException` (لأخطاء الإدخال) أو `SAXException` (لأخطاء التحليل).

لتحليل سلسلة XML بدلاً من ملف، استخدم `InputSource`:

```java
import org.xml.sax.InputSource;
import java.io.StringReader;

// داخل طريقة main
String xml = "<book><title>XML Parsing</title></book>";
InputSource inputSource = new InputSource(new StringReader(xml));
parser.parse(inputSource, handler);
```

---

### الخطوة 4: معالجة الاستثناءات
يتضمن تحليل SAX عدة استثناءات يجب أن تعالجها:

- **`ParserConfigurationException`**: يطرحه `newSAXParser()` إذا تعذر ضبط المحلل.
- **`SAXException`**: يطرحه `newSAXParser()` أو `parse()` لأخطاء التحليل العامة.
- **`IOException`**: يطرحه `parse()` إذا كانت هناك مشكلة في قراءة مصدر الإدخال.

اقفل الكود الخاص بك داخل كتلة `try-catch`:

```java
try {
    SAXParserFactory factory = SAXParserFactory.newInstance();
    SAXParser parser = factory.newSAXParser();
    MyHandler handler = new MyHandler();
    parser.parse(new File("example.xml"), handler);
} catch (ParserConfigurationException e) {
    System.err.println("خطأ في ضبط المحلل: " + e.getMessage());
} catch (SAXException e) {
    System.err.println("خطأ SAX: " + e.getMessage());
} catch (IOException e) {
    System.err.println("خطأ IO: " + e.getMessage());
}
```

---

### الخطوة 5: ميزات اختيارية
#### معالجة الأخطاء
`DefaultHandler` ينفذ أيضًا `ErrorHandler`. قم بتجاوز طرقه لمعالجة أخطاء التحليل:

```java
public class MyHandler extends DefaultHandler {
    @Override
    public void error(SAXParseException e) {
        System.err.println("خطأ في التحليل: " + e.getMessage());
    }

    @Override
    public void fatalError(SAXParseException e) throws SAXException {
        System.err.println("خطأ جسيم: " + e.getMessage());
        throw e; // إيقاف التحليل
    }

    @Override
    public void warning(SAXParseException e) {
        System.out.println("تحذير: " + e.getMessage());
    }
    // الطرق الأخرى كما ورد أعلاه
}
```

#### معالجة مساحات الأسماء
إذا كان XML الخاص بك يستخدم مساحات الأسماء، اضبط `factory.setNamespaceAware(true)` واستخدم `uri` و `localName` في طرق المعالج الخاصة بك بدلاً من `qName` لتحديد العناصر بشكل صحيح.

#### التحقق من الصحة
للتحقق من صحة XML مقابل DTD أو مخطط، اضبط `factory.setValidating(true)`. قد تحتاج أيضًا إلى `ErrorHandler` لإدارة أخطاء التحقق من الصحة.

---

### مثال XML والإخراج
لملف XML `example.xml`:
```xml
<book id="123">
    <title>XML Parsing</title>
    <author>John Doe</author>
</book>
```

تشغيل الكود أعلاه قد ينتج:
```
بدأ تحليل المستند
بداية العنصر: book
السمة: id = 123
بداية العنصر: title
المحتوى: XML Parsing
نهاية العنصر: title
بداية العنصر: author
المحتوى: John Doe
نهاية العنصر: author
نهاية العنصر: book
اكتمل تحليل المستند
```

---

### الملخص
لاستخدام `org.xml.sax`:
1. أنشئ `SAXParser` باستخدام `SAXParserFactory`.
2. نفذ معالجًا عن طريق تمديد `DefaultHandler` وتجاوز طرق مثل `startElement`، `endElement`، و `characters`.
3. احلل XML عن طريق استدعاء `parser.parse()` مع المعالج الخاص بك ومصدر XML.
4. عالج الاستثناءات (`SAXException`, `IOException`, `ParserConfigurationException`).
5. اضبط بشكل اختياري الوعي بمساحات الأسماء، أو التحقق من الصحة، أو معالجة الأخطاء.

هذا النهج مثالي لتحليل مستندات XML الكبيرة بكفاءة عندما تحتاج فقط لاستخراج بيانات محددة دون بناء شجرة في الذاكرة.