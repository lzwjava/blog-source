---
audio: false
generated: true
lang: ar
layout: post
title: تحسين جودة الصوت في واي تي دي إل بي
translated: true
type: note
---

لمعالجة مخاوفك بشأن جودة الصوت غير المرضية عند تنزيل مقاطع فيديو YouTube باستخدام السكريبت الخاص بك مع `yt-dlp`، سأرشدك حول كيفية تعديل السكريبت لضمان تنزيل **أفضل جودة صوت ممكنة** دائمًا، بغض النظر عن دقة الفيديو المختارة (720p أو 480p). دعنا نفصل ذلك خطوة بخطوة ونقدم حلاً واضحًا.

### فهم السكريبت الحالي
يستخدم السكريبت الخاص بك `yt-dlp` لتنزيل مقاطع فيديو YouTube، مما يسمح لك بتحديد الدقة (720p أو 480p). يتم التحكم في اختيار التنسيق بواسطة المتغير `format_str`، الذي يتم تمريره إلى الخيار `-f` في `yt-dlp`. إليك ما يفعله حاليًا:

- **للدقة 720p**: `format_str = 'bestvideo[height<=720]+bestaudio/best[height<=720]'`
- **للدقة 480p**: `format_str = 'bestvideo[height<=480]+bestaudio/best[height<=720]'`

في `yt-dlp`:
- `bestvideo[height<=720]` تختار أفضل دفق فيديو بارتفاع لا يزيد عن 720 بكسل.
- `bestaudio` تختار أفضل دفق صوتي منفصل متاح، عادةً ذو أعلى معدل بت.
- المشغل `+` يخبر `yt-dlp` بتنزيل دفقَي الفيديو والصوت بشكل منفصل ودمجهما في ملف واحد.
- المشغل `/` يوفر خيارًا بديلاً: إذا لم يكن المزيج المحدد قبله (مثل `bestvideo[height<=720]+bestaudio`) متاحًا، فإنه يستخدم التنسيق المحدد بعده (مثل `best[height<=720]`)، وهو أفضل تنسيق فردي يحتوي على كل من الفيديو والصوت بدقة تصل إلى 720p.

نظرًا لأن `bestaudio` مُضمنة، كان ينبغي على السكريبت بالفعل اختيار أفضل جودة صوت متاحة. ومع ذلك، لاحظت أن جودة الصوت تبدو "أقل جودة"، لذا دعنا نتحقق من السبب وكيفية إصلاحه.

### لماذا قد تكون جودة الصوت دون المستوى المطلوب
على الرغم من استخدام `bestaudio`، هناك مشكلة محتملة:
- قد يتم تشغيل الخيار البديل (`best[height<=720]`) في حالات نادرة حيث لا يمكن دمج دفقَي الفيديو والصوت المنفصلين كما هو محدد. هذا الخيار البديل يختار تنسيقًا مجتمعًا للفيديو+الصوت، والذي قد تكون له جودة صوت أقل (مثل 128kbps بدلاً من دفق صوتي منفصل بمعدل 256kbps).
- بالنسبة لحالة 480p، فإن الخيار البديل هو `best[height<=720]`، وهو غير متناسق — فقد يقوم بتنزيل فيديو بدقة 720p عندما طلبت 480p، وقد لا تكون جودة الصوت في ذلك التنسيق المجمع هي الأفضل.

نظرًا لأن YouTube عادةً ما يوفر دفقَي فيديو وصوت منفصلين، فإن مزيج `bestvideo + bestaudio` يجب أن يعمل دائمًا تقريبًا. ومع ذلك، لضمان أفضل جودة صوت وتجنب أي اعتماد على تنسيق مجتمع قد تكون جودة صوته أقل، يمكننا تحسين السكريبت.

### الحل: ضمان أفضل جودة صوت
لضمان أن `yt-dlp` يقوم دائمًا بتنزيل أفضل جودة صوت متاحة:
1. **استخدم `bestaudio` بدون خيار بديل**: هذا يُجبر `yt-dlp` على تنزيل أفضل دفق صوتي متاح، إلى جانب أفضل دفق فيديو ضمن الدقة المختارة. إذا لم يكن هذا المزيج ممكنًا، فسيفشل التنزيل بدلاً من المساومة على جودة الصوت، وهو أمر مقبول نظرًا لأن مقاطع فيديو YouTube تحتوي دائمًا تقريبًا على دفق منفصلة.
2. **إصلاح عدم تناسق الخيار البديل لـ 480p**: محاذاة الخيار البديل (إذا تم الاحتفاظ به) مع الدقة المطلوبة، على الرغم من أن إزالته هو الأبسط ويتوافق مع هدفك.

إليك كيفية تعديل السكريبت:

#### الكود المعدل
قم بتحديث تعريفات `format_str` في السكريبت الخاص بك على النحو التالي:

```python
import argparse
import subprocess
import os

def main():
    parser = argparse.ArgumentParser(description="Download YouTube videos at specified resolution.")
    parser.add_argument("url", help="YouTube video URL")
    parser.add_argument(
        "--resolution",
        choices=["720p", "480p"],
        default="720p",
        help="Video resolution to download (default: 720p)"
    )
    args = parser.parse_args()

    output_dir = "test"
    os.makedirs(output_dir, exist_ok=True)

    # سلاسل التنسيق المحدثة لضمان أفضل جودة صوت
    if args.resolution == "720p":
        format_str = 'bestvideo[height<=720]+bestaudio'
    else:  # 480p
        format_str = 'bestvideo[height<=480]+bestaudio'

    command = [
        "yt-dlp",
        "--cookies-from-browser", "firefox",
        "-f", format_str,
        "-P", output_dir,
        args.url
    ]

    subprocess.run(command)

if __name__ == "__main__":
    main()
```

#### شرح التغييرات
- **720p**: تغيرت من `'bestvideo[height<=720]+bestaudio/best[height<=720]'` إلى `'bestvideo[height<=720]+bestaudio'`.
- **480p**: تغيرت من `'bestvideo[height<=480]+bestaudio/best[height<=720]'` إلى `'bestvideo[height<=480]+bestaudio'`.
- **تمت إزالة الخيار البديل (`/best[height<=...]`)**: هذا يضمن أن `yt-dlp` يستخدم دائمًا أفضل دفق صوتي (`bestaudio`) بدلاً من الاعتماد possibly على تنسيق مجتمع ذي جودة صوت أقل.

### لماذا يعمل هذا الحل
- **`bestaudio`**: تختار دفق الصوت بأعلى معدل بت متاح (مثل Opus عند 160kbps أو AAC عند 256kbps، اعتمادًا على الفيديو)، مما يضمن أفضل جودة صوت.
- **لا يوجد خيار بديل**: من خلال إزالة `/best[height<=720]`، تمنع `yt-dlp` من تنزيل تنسيق مجتمع قد يكون ذا جودة صوت أدنى. نظرًا لأن مقاطع فيديو YouTube تحتوي عادةً على دفق منفصلة، فإن `bestvideo + bestaudio` يجب أن تنجح دائمًا.
- **تم احترام الدقة**: تظل دقة الفيديو ضمن اختيارك (720p أو 480p)، بينما يتم تعظيم جودة الصوت.

### التحقق من النتيجة
لتأكيد أنك تحصل على أفضل صوت:
1. **تحقق من التنسيقات المتاحة**: قم بتشغيل `yt-dlp --list-formats <youtube_url>` لرؤية دفق الفيديو والصوت المتاحة لفيديو معين. ابحث عن تنسيقات الصوت المنفردة (مثل `m4a`، `webm`) ومعدلات البت الخاصة بها.
2. **راقب عملية التنزيل**: عند تشغيل السكريبت، سيخرج `yt-dlp` التنسيقات التي يقوم بتنزيلها (مثل "Downloading video stream (code)" و "Downloading audio stream (code)"). تأكد من أنه يختار دفق صوتي منفصل بمعدل بت عالٍ.
3. **اختبر التشغيل**: شغل الملف الذي تم تنزيله وتحقق من جودة الصوت. إذا كانت لا تزال ضعيفة، فقد تكون أفضل جودة صوت متاحة للفيديو محدودة من قبل المُحمّل، وليس بسبب السكريبت.

### ماذا لو فشل؟
إذا فشل `yt-dlp` لأن `bestvideo[height<=720]+bestaudio` غير متاحة (وهو أمر مستبعد جدًا على YouTube)، يمكنك:
- إضافة خيار بديل مثل `/best[height<=720]'` مرة أخرى، ولكن هذا قد يقلل من جودة الصوت، وهو ما تريد تجنبه.
- التحقق من الفيديو المحدد باستخدام `--list-formats` وتعديل السكريبت لتلك الحالة، على الرغم من ندرة الحاجة إلى ذلك.

### الخلاصة
تم الآن ضبط السكريبت الخاص بك ليقوم دائمًا بتنزيل أفضل جودة صوت متاحة باستخدام `bestaudio` بدون خيار بديل، إلى جانب دقة الفيديو المختارة. قيم `format_str` المعدلة هي:

- للدقة 720p: `'bestvideo[height<=720]+bestaudio'`
- للدقة 480p: `'bestvideo[height<=480]+bestaudio'`

يجب أن يحل هذا التغيير المشكلة لديك، مما يضمن أعلى جودة صوت ممكنة ضمن تفضيلات الدقة الخاصة بك. إذا كان الصوت لا يزال يبدو غير كافٍ، فقد يكون ذلك بسبب جودة التحميل الأصلية للفيديو، وهو ما لا يمكن للسكريبت التحكم فيه. جربه وأخبرني كيف يعمل!