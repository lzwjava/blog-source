---
audio: false
generated: true
image: false
lang: ar
layout: post
title: دليل مُنسِّق كود بايثون بلاك
translated: true
type: note
---

بلاك (Black) هو أداة تنسيق شفرات بايثون صارمة الرأي طورتها مؤسسة برمجيات بايثون (PSF). يقوم تلقائيًا بإعادة تنسيق شفرات بايثون لتتوافق مع نمط موحد، مستند بشكل أساسي إلى مجموعة فرعية صارمة من PEP 8، مع التركيز على سهولة القراءة، والاتساق، وتقليل الفروقات (diffs) في أنظمة التحكم بالإصدار. باستخدام بلاك، يوافق المطورون على التخلي عن التحكم بالتفاصيل الصغيرة للتنسيق مقابل السرعة، الحتمية، وتقليل النقاشات حول النمط أثناء مراجعة الشفرات. يضمن بلاك أن الشفرة المنسقة ("المسودة") تبدو موحدة عبر المشاريع، مما يوفر الوقت والجهد الذهني للجوانب الأكثر أهمية في التطوير. يدعم بايثون 3.8 والإصدارات الأحدث، مع أحدث إصدار مستقر هو الإصدار 25.1.0 (صدر في 29 يناير 2025)، والذي يقدم النمط المستقر لعام 2025 مع تحسينات مثل توحيد حالة أحرف الهروب في يونيكود (Unicode) وتحسين التعامل مع الفواصل الزائدة.

فلسفة بلاك تُعطي الأولوية للآتي:
- **الاتساق**: يتم تنسيق التركيبات المتشابهة بشكل مماثل.
- **العمومية**: تنطبق القواعد على نطاق واسع دون حالات خاصة.
- **سهولة القراءة**: تركز على الشفرة سهلة القراءة.
- **تقليل الفروقات (Diffs)**: يقلل التغييرات في فروقات Git لتسريع عمليات المراجعة.

يُستخدم على نطاق واسع في المشاريع مفتوحة المصدر والمهنية نظرًا لموثوقيته وإمكانيات التكامل.

## التثبيت

بلاك متوفر على PyPI ويمكن تثبيته باستخدام pip. يُنصح بتثبيته في بيئة افتراضية لعزل المشروع.

- التثبيت الأساسي:
  ```
  pip install black
  ```

- للميزات الإضافية مثل دعم Jupyter Notebook أو فروقات ملونة:
  ```
  pip install 'black[jupyter,colorama]'
  ```
  (الخاصية الإضافية `d` مخصصة لـ blackd، وهو خادم لتكاملات المحرر.)

على أرش لينكس (Arch Linux)، يمكن التثبيت عبر مدير الحزم: `pacman -S python-black`.

يمكن أيضًا تثبيت بلاك عبر conda أو مديري حزم آخرين. بعد التثبيت، تحقق باستخدام `black --version`.

للتطوير أو الاختبار، يمكنك استنساخ مستودع GitHub والتثبيت في وضع قابل للتعديل:
```
git clone https://github.com/psf/black.git
cd black
pip install -e .
```

## الاستخدام

بلاك هو في الأساس أداة سطر أوامر. الأمر الأساسي يقوم بتنسيق الملفات أو المجلدات في مكانها:

```
black {source_file_or_directory}
```

إذا لم يعمل تشغيل بلاك كنص برمجي (مثلاً، بسبب مشاكل في البيئة)، استخدم:
```
python -m black {source_file_or_directory}
```

### خيارات سطر الأوامر الرئيسية

يقدم بلاك أعلامًا متنوعة للتخصيص والتحكم. فيما يلي ملخص لأهمها:

- `-h, --help`: عرض المساعدة والخروج.
- `-c, --code <code>`: تنسيق سلسلة من الشفرة (مثلاً، `black --code "print ( 'hello, world' )"` يُخرج النسخة المنسقة).
- `-l, --line-length <int>`: تعيين طول السطر (الافتراضي: 88).
- `-t, --target-version <version>`: تحديد إصدارات بايثون للتتوافق معها (مثلاً، `py38`، يمكن تحديد عدة إصدارات مثل `-t py311 -t py312`).
- `--pyi`: معاملة الملفات كملفات تعريف الأنماط (نمط `.pyi`).
- `--ipynb`: معاملة الملفات كدفاتر Jupyter Notebook.
- `--python-cell-magics <magic>`: التعرف على أوامر Jupyter السحرية المخصصة.
- `-x, --skip-source-first-line`: تخطي تنسيق السطر الأول (مفيد لـ shebangs).
- `-S, --skip-string-normalization`: عدم توحيد السلاسل إلى علامات اقتباس مزدوجة أو بادئات.
- `-C, --skip-magic-trailing-comma`: تجاهل الفواصل الزائدة لكسر الأسطر.
- `--preview`: تمكين تغييرات النمط التجريبية للإصدار التالي.
- `--unstable`: تمكين جميع تغييرات المعاينة بالإضافة إلى الميزات غير المستقرة (يتطلب `--preview`).
- `--enable-unstable-feature <feature>`: تمكين ميزات غير مستقرة محددة.
- `--check`: التحقق مما إذا كانت الملفات تحتاج إلى إعادة تنسيق دون تغييرها (رمز الخروج 1 إذا كانت هناك حاجة لتغييرات).
- `--diff`: عرض فرق التغييرات دون كتابة الملفات.
- `--color / --no-color`: تلوين ناتج الفروقات.
- `--line-ranges <ranges>`: تنسيق نطاقات أسطر محددة (مثلاً، `--line-ranges=1-10`).
- `--fast / --safe`: تخطي (`--fast`) أو فرض (`--safe`) فحوصات سلامة AST (الافتراضي: safe).
- `--required-version <version>`: اشتراط إصدار محدد من بلاك.
- `--exclude <regex>`: استبعاد الملفات/المجلدات عبر regex.
- `--extend-exclude <regex>`: الإضافة إلى الاستبعادات الافتراضية.
- `--force-exclude <regex>`: الاستبعاد حتى لو تم تمريره صراحةً.
- `--include <regex>`: تضمين الملفات/المجلدات عبر regex.
- `-W, --workers <int>`: تعيين عدد العاملين المتوازيين (الافتراضي: عدد وحدات المعالجة المركزية).
- `-q, --quiet`: كتم الرسائل غير المتعلقة بالأخطاء.
- `-v, --verbose`: إظهار الناتج المفصل.
- `--version`: عرض إصدار بلاك.
- `--config <file>`: تحميل التكوين من ملف.

### أمثلة

- تنسيق ملف واحد: `black example.py`
- التحقق دون تنسيق: `black --check .`
- عرض الفروقات: `black --diff example.py`
- تنسيق stdin: `echo "print('hello')" | black -`
- التنسيق بطول سطر مخصص: `black -l 79 example.py`
- تنسيق Jupyter Notebook: `black notebook.ipynb`

### نصائح وملاحظات

- بلاك ينسق الملفات بالكامل؛ استخدم `# fmt: off` / `# fmt: on` لتخطي الكتل أو `# fmt: skip` للأسطر.
- بالنسبة لـ stdin، استخدم `--stdin-filename` لاحترام الاستبعادات.
- بلاك حتمي: نفس المدخلات تعطي دائمًا نفس المخرجات.
- استخدم `--preview` لاختبار الأنماط القادمة، لكن لاحظ أنها قد تتغير.

## التكوين

يمكن تكوين بلاك عبر أعلام سطر الأوامر أو ملف `pyproject.toml` (مفضل للمشاريع). يتم وضع التكوين في `pyproject.toml` تحت قسم `[tool.black]`.

### استخدام pyproject.toml

مثال:
```
[tool.black]
line-length = 79
target-version = ['py311']
include = '\.pyi?$'
exclude = '''
/(
    \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
)/
'''
skip-string-normalization = true
```

الخيارات المدعومة تطابق أعلام CLI (مثلاً، `line-length`, `skip-string-normalization`). الخيارات متعددة القيم مثل `target-version` تستخدم المصفوفات.

### الأولوية

- أعلام سطر الأوامر تتجاوز إعدادات ملف التكوين.
- إذا لم يتم العثور على `pyproject.toml`، يستخدم بلاك الإعدادات الافتراضية ويبحث في المجلدات الأصل.
- استخدم `--config` لتحديد ملف تكوين مخصص.

### اكتشاف الملفات وتجاهلها

يكتشف بلاك تلقائيًا ملفات بايثون في المجلدات، محترمًا `.gitignore` افتراضيًا. استخدم `--include`/`--exclude` للتخصيص. يتجاهل المجلدات الشائعة مثل `.git`, `.venv`، إلخ، ما لم يتم تجاوز ذلك.

للتحكم بالإصدار، قم بالتكامل مع أدوات مثل pre-commit لفرض التنسيق.

## نمط شفرة بلاك

يفرض بلاك نمطًا محددًا مع إمكانية تكوين محدودة. القواعد الرئيسية:

### طول السطر
- الافتراضي: 88 حرفًا. قد يتجاوز ذلك إذا كان غير قابل للكسر (مثلاً، سلاسل طويلة).

### السلاسل
- يفضل علامات الاقتباس المزدوجة؛ يوحد البادئات إلى أحرف صغيرة (مثلاً، `r` قبل `f`).
- يخفض تسلسلات الهروب (باستثناء أسماء `\N`).
- يعالج docstrings: يصلح المسافات البادئة، يزيل المسافات البيضاء/الأسطر الجديدة الإضافية، يحافظ على علامات الجدولة في النص.

### الثوابت الرقمية
- أحرف صغيرة للأجزاء النحوية (مثلاً، `0xAB`)، أحرف كبيرة للأرقام.

### فواصل الأسطر والعوامل
- يكسر قبل العوامل الثنائية.
- مسافات مفردة حول معظم العوامل؛ لا توجد مسافات للعوامل الأحادية/الأس مع المعاملات البسيطة.

### الفواصل الزائدة
- يضيفها إلى المجموعات متعددة الأسطر/وسائط الدالة (إذا كانت بايثون 3.6+).
- الفاصلة الزائدة "السحرية" تفتح القوائم إذا كانت موجودة.

### التعليقات
- مسافتان قبل التعليقات المضمنة؛ مسافة واحدة قبل النص.
- يحافظ على التباعد الخاص لـ shebangs، تعليقات المستندات، إلخ.

### المسافة البادئة
- 4 مسافات؛ يطابق الأقواس مع أقواس الإغلاق المقلوبة المسافة البادئة.

### الأسطر الفارغة
- مساحة بيضاء دنيا: سطر واحد في الدوال، سطران على مستوى الوحدة النمطية.
- قواعد محددة لـ docstrings، والفئات، والدوال.

### الاستيرادات
- يقسم الاستيرادات الطويلة؛ متوافق مع ملف تعريف `black` الخاص بـ isort.

### قواعد أخرى
- يفضل الأقواس على الشرطات المائلة العكسية.
- يوحد نهايات الأسطر بناءً على الملف.
- نمط موجز لملفات `.pyi` (مثلاً، لا توجد أسطر إضافية بين الدوال).
- يطوي الأسطر الفارغة بعد الاستيرادات في وضع المعاينة.

يهدف بلاك إلى تقليل الفروقات وتحسين سهولة القراءة، مع تغييرات غالبًا لإصلاح الأخطاء أو دعم بناء جملة جديد.

## التكاملات

يتكامل بلاك بسلاسة مع المحررات وأنظمة التحكم بالإصدار للتنسيق الآلي.

### المحررات

- **VS Code**: استخدم امتداد Python مع بلاك كأداة تنسيق. عيّن `"python.formatting.provider": "black"` في settings.json. لـ LSP، قم بتثبيت python-lsp-server و python-lsp-black.
- **PyCharm/IntelliJ**:
  - مدمج (2023.2+): الإعدادات > الأدوات > Black، قم بتكوين المسار.
  - أداة خارجية: الإعدادات > الأدوات > أدوات خارجية، أضف Black مع وسيط `$FilePath$`.
  - مراقب الملفات: للتنسيق التلقائي عند الحفظ.
  - إضافة BlackConnect للتنسيق القائم على الخادم.
- **Vim**: استخدم الإضافة الرسمية (عبر vim-plug: `Plug 'psf/black', { 'branch': 'stable' }`). الأوامر: `:Black` للتنسيق. الحفظ التلقائي: أضف autocmd إلى vimrc. متغيرات التكوين مثل `g:black_linelength`.
- **Emacs**: استخدم reformatter.el أو حزمة python-black للتنسيق عند الحفظ.
- **أخرى**: يدعم Sublime Text، JupyterLab، Spyder، إلخ، عبر إضافات أو امتدادات.

### التحكم بالإصدار

- **خطافات Pre-commit**: أضف إلى `.pre-commit-config.yaml`:
  ```
  repos:
    - repo: https://github.com/psf/black-pre-commit-mirror
      rev: 25.1.0
      hooks:
        - id: black
          language_version: python3.11
  ```
  لـ Jupyter: استخدم `id: black-jupyter`.
- **إجراءات GitHub (GitHub Actions)**: استخدم إجراءات مثل `psf/black-action` في سير العمل للتحقق من CI.
- **Git**: شغّل بلاك في نصوص pre-commit أو husky للفرض.

## مواضيع متقدمة

- **أنماط المعاينة وغير المستقرة**: استخدم `--preview` للتغييرات المستقبلية (مثلاً، تحسين الأقواس المحيطة). `--unstable` للميزات التجريبية.
- **Blackd**: خادم HTTP للتكاملات (`blackd --bind-host 127.0.0.1 --bind-port 45484`).
- **دعم Jupyter**: ينسق الدفاتر، محافظًا على الأوامر السحرية.
- **تعريفات الأنماط (Typing Stubs)**: تنسيق موجز خاص لملفات `.pyi`.
- **التوافق**: يستهدف بايثون 3.8+؛ استخدم `--target-version` للشفرات الأقدم.
- **البدائل**: مقارنة بـ autopep8 (أكثر مرونة لكن أقل صرامة في الرأي) أو Ruff (أسرع، يتضمن فحص الأخطاء).

لاستكشاف الأخطاء وإصلاحها، تحقق من الأسئلة الشائعة في الوثائق الرسمية أو قضايا GitHub.

## المراجع

- [Black 25.1.0 Documentation](https://black.readthedocs.io/en/stable/)
- [psf/black GitHub Repository](https://github.com/psf/black)
- [The Black Code Style](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html)
- [Usage and Configuration](https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html)
- [Editor Integrations](https://black.readthedocs.io/en/stable/integrations/editors.html)
- [Version Control Integration](https://black.readthedocs.io/en/stable/integrations/source_version_control.html)
- [Python Code Formatting Using Black - GeeksforGeeks](https://www.geeksforgeeks.org/python/python-code-formatting-using-black/)
- [How to Auto-Format Your Python Code with Black - freeCodeCamp](https://www.freecodecamp.org/news/auto-format-your-python-code-with-black/)
- [Black - PyPI](https://pypi.org/project/black/)
- [Introduction to Python Black Module - GeeksforGeeks](https://www.geeksforgeeks.org/introduction-to-python-black-module/)
- [Python Auto Formatter: Autopep8 vs. Black - Built In](https://builtin.com/data-science/autopep8-vs-black)