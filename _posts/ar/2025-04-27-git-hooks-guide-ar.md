---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: 'دليل هووكس جيت: قبل الكوميت وقبل البوش'
translated: true
type: note
---

### نظرة عامة على خطافات Git

خطافات Git هي نصوص برمجية قابلة للتخصيص تؤتمت المهام في نقاط محددة في سير عمل Git. يمكن أن تكون من جانب العميل (تعمل على جهازك المحلي) أو من جانب الخادم (تعمل على المستودع البعيد). يتم تخزين الخطافات في دليل `.git/hooks/` للمستودع. أدناه، سأشرح خطافات ما قبل الالتزام (pre-commit)، وما قبل الدفع (pre-push)، وخطافات جانب الخادم المتعلقة بالدفع، موضحًا كيفية تنفيذها.

### خطافات جانب العميل: Pre-Commit و Pre-Push

تعمل هذه الخطافات محليًا على جهازك قبل أن يتم إنجاز الإجراءات، مما يسمح لك بفرض القواعد أو تشغيل الفحوصات.

- **خطاف Pre-Commit**:
  - **وقت التنفيذ**: يتم تشغيله تلقائيًا مباشرة قبل قيامك بإجراء التزام (commit) للتغييرات (على سبيل المثال، عبر `git commit`).
  - **الغرض**: مفيد لفحوصات جودة الكود، مثل تشغيل أدوات الفحص (linters)، أو الاختبارات، أو أدوات التنسيق. إذا فشل الخطاف (ينتهي بحالة خروج غير صفرية)، يتم إحباط الالتزام.
  - **مثال**: قد يقوم خطاف pre-commit نموذجي بتشغيل `eslint` على ملفات JavaScript. إذا كانت هناك أخطاء، يتوقف الالتزام.
  - **كيفية العمل**: النص البرمجي موجود في `.git/hooks/pre-commit`. اجعله قابلاً للتنفيذ باستخدام `chmod +x .git/hooks/pre-commit`. إذا كنت تستخدم أدوات مثل Husky (مكتبة شائعة لإدارة خطافات Git)، فإنها تبسط الإعداد.

- **خطاف Pre-Push**:
  - **وقت التنفيذ**: يتم تشغيله تلقائيًا مباشرة قبل قيامك بالدفع (push) إلى مستودع بعيد (على سبيل المثال، عبر `git push`).
  - **الغرض**: يتحقق من أشياء مثل تشغيل الاختبارات، أو التحقق من تغطية الكود، أو ضمان التوافق قبل إرسال التغييرات إلى المستودع البعيد. إذا فشل، يتم حظر الدفع.
  - **ملاحظة على "some prepush"**: لا يوجد خطاف قياسي يسمى "prepush" في Git — أفترض أنك تقصد خطاف "pre-push" (بشرطة). يمكنك إنشاء نصوص برمجية pre-push مخصصة، غالبًا عبر أدوات مثل Husky، لفرض قواعد مثل "الدفع فقط إذا نجحت جميع الاختبارات."
  - **مثال**: يمكن لخطاف pre-push تشغيل `npm test` وإحباط الدفع إذا فشلت الاختبارات. إذا تم تخطيه (على سبيل المثال، باستخدام `git push --no-verify`)، فلن يعمل الخطاف.
  - **كيفية العمل**: موجود في `.git/hooks/pre-push`. يلزم وجود أذونات تنفيذ. يستقبل وسيطات مثل اسم المستودع البعيد والمرجع (ref) الذي يتم دفعه.

تضمن خطافات جانب العميل اكتشاف المشكلات مبكرًا، مما يمنع الالتزامات أو عمليات الدفع السيئة من مغادرة جهازك.

### خطافات جانب الخادم أثناء الدفع

عند تشغيل `git push`، يتم إرسال الدفع إلى المستودع البعيد (مثل GitHub أو GitLab أو خادم مخصص). يمكن أن يكون للمستودع البعيد خطافات خاصة به يتم تنفيذها أثناء أو بعد عملية الدفع. يتم تخزين هذه الخطافات في دليل `.git/hooks/` للمستودع البعيد لـ Git ويتم إدارتها بواسطة مسؤول الخادم.

- **العملية أثناء الدفع**:
  1. **الفحوصات المحلية**: يعمل خطاف pre-push أولاً (إذا كان موجودًا).
  2. **نقل البيانات**: يتم إرسال التغييرات إلى المستودع البعيد.
  3. **التنفيذ البعيد**: تعمل خطافات جانب الخادم على الخادم البعيد، وليس على جهازك.

- **خطاف Pre-Receive**:
  - **وقت التنفيذ**: على الخادم البعيد، مباشرة upon استلام الدفع ولكن قبل تحديث أي مراجع (فروع أو علامات tags).
  - **الغرض**: يتحقق من صحة التغييرات الواردة. يمكنه رفض الدفع بالكامل إذا فشلت الفحوصات، مثل فرض تنسيق رسائل الالتزام، أو مراجعات الكود، أو فحوصات الأمان.
  - **كيفية العمل**: إذا انتهى الخطاف بحالة خروج غير صفرية، يتم رفض الدفع، وسترى رسالة خطأ. مثال: رفض عمليات الدفع التي تقدم ملفات بحجم يتجاوز حدًا معينًا.

- **خطاف Update** (شبيه بـ Pre-Receive ولكنه لكل مرجع):
  - **وقت التنفيذ**: لكل فرع أو علامة يتم تحديثها، بعد pre-receive.
  - **الغرض**: يسمح بالتحكم الدقيق، مثل التحقق مما إذا كان الدفع من مستخدم مصرح له أو إذا كان الفرع يتبع اصطلاحات تسمية معينة.
  - **كيفية العمل**: يستقبل تفاصيل حول المرجع الذي يتم تحديثه.

- **خطاف Post-Receive**:
  - **وقت التنفيذ**: على الخادم البعيد، بعد قبول الدفع بالكامل وتحديث المراجع.
  - **الغرض**: يشغل إجراءات لاحقة، مثل نشر الكود (deploy)، أو إرسال إشعارات (مثل تنبيهات Slack)، أو تشغيل نصوص برمجية ما بعد النشر مثل "إعادة بناء التطبيق".
  - **كيفية العمل**: يعمل بشكل موثوق بعد دفع ناجح. مثال: تشغيل خط أنابيب CI/CD تلقائيًا أو تحديث خادم ويب.

توفر خطافات جانب الخادم فرضًا مركزيًا، لذا حتى إذا تم تجاوز خطافاتك المحلية، يمكن للمستودع البعيد依然 التحقق من صحة الدفع أو الرد عليه. تستخدم منصات مثل GitHub الخطافات الويبية (webhooks) (المكافئة القائمة على API) لأغراض مماثلة، ولكن لخوادم Git العارية أو المستودعات ذاتية الاستضافة، فإن الخطافات المذكورة أعلاه هي الأساس.

### الاختلافات الرئيسية وأفضل الممارسات

- **العميل مقابل الخادم**: خطافات العميل (مثل pre-commit/pre-push) تمنحك ملاحظات سريعة محليًا. خطافات الخادم تفرض قواعد على مستوى المستودع بأكمله.
- **التخصيص**: الخطافات هي نصوص برمجية shell (مثل Bash) ولكن يمكنها استدعاء Python أو Node.js، إلخ. استخدم أدوات مثل pre-commit (إطار عمل) لإدارتها.
- **التجاوز**: الالتزام باستخدام `--no-verify`، الدفع باستخدام `--no-verify`، ولكن لا يمكن تجاوز خطافات الخادم إلا إذا كان لديك حق الوصول كمسؤول.
- **نصائح الإعداد**: لا يتم نسخ الخطافات بين المستودعات، لذا أضفها إلى قالب مستودع أو استخدم أداة لتثبيتها.

إذا كنت تقوم بإعداد هذا، تحقق من وثائق Git أو أدوات مثل Husky لمشاريع Node. إذا كان لديك سيناريو محدد (مثال على الكود)، قدم المزيد من التفاصيل للحصول على نصيحة مخصصة!