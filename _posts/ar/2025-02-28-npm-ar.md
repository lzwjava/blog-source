---
audio: false
generated: true
lang: ar
layout: post
title: تهيئة إن بي إم
translated: true
type: note
---

### النقاط الرئيسية
- يبدو من المحتمل أن تكوين NPM يتضمن تحرير ملف `.npmrc` لتعيين إعدادات الوكيل والسجل، وهو ما يمكن القيام به يدويًا أو عبر الأوامر.
- تشير الأبحاث إلى أن إعدادات الوكيل تتطلب التنسيق `proxy = http://user:password@proxy_server:port`، مع ترميز الأحرف الخاصة في عنوان URL.
- تميل الأدلة نحو تعيين السجل كـ `registry = https://registry.npmjs.org/` افتراضيًا، مع خيارات لتعطيل التحقق من SSL إذا لزم الأمر.

### تكوين NPM والعمل مع `.npmrc`
NPM، أو Node Package Manager، هو أداة لإدارة تبعيات JavaScript، وغالبًا ما يتضمن تكوينه ملف `.npmrc` لإعدادات مثل السجل والوكيل.

#### ما هو ملف `.npmrc` وأين يوجد؟
ملف `.npmrc` هو ملف تكوين لـ NPM، يسمح بتخصيص طريقة عمله. يمكن أن يكون:
- **عالميًا**: يوجد في `~./.npmrc` على أنظمة Unix-like أو `%APPDATA%\npm\npmrc` على Windows (عادة `C:\Users\<username>\AppData\Roaming\npm\npmrc`).
- **محليًا لمشروع**: موجود في `./package/.npmrc` في دليل جذر المشروع. الإعدادات المحلية تتجاوز الإعدادات العالمية.

#### تعيين الوكيل و HTTPS Proxy
للعمل خلف وكيل، أضف هذه الأسطر إلى `.npmrc`:
- `proxy = http://user:password@proxy_server:port`
- `https_proxy = http://user:password@proxy_server:port`

لاحظ أنه حتى لـ `https_proxy`، استخدم `http://` كبروتوكول. إذا كان اسم المستخدم أو كلمة المرور يحتوي على أحرف خاصة (مثل `\`، `@`)، قم بترميزها في عنوان URL (مثال: `domain\user` تصبح `domain%5Cuser`). يمكنك أيضًا تعيين هذه الإعدادات عبر الأوامر:
- `npm config set proxy http://user:password@proxy_server:port`
- `npm config set https_proxy http://user:password@proxy_server:port`

#### تعيين السجل
السجل هو عنوان URL الذي يستخدمه NPM لجلب الحزم، يُعيّن عادةً كـ:
- `registry = https://registry.npmjs.org/`

للحصول على سجلات مخصصة، استبدل العنوان بـ URL الخاص بك (مثل السجل الخاص للشركة). عيّنه عبر:
- `npm config set registry https://your_custom_registry.com/`

#### التعامل مع SSL والتحقق
إذا واجهت مشاكل في SSL، ففكر في:
- `strict-ssl = false` في `.npmrc` لتجاهل أخطاء SSL، على الرغم من أن هذا أقل أمانًا. عيّنه عبر:
- `npm config set strict-ssl false`

#### استخدام والتحقق من التكوينات
قم بتحرير `.npmrc` مباشرة باستخدام محرر نصوص، أو استخدم أوامر `npm config set`. للتحقق:
- ادرج جميع الإعدادات باستخدام `npm config list`.
- تحقق من إعداد محدد باستخدام `npm config get proxy`.
- حل المشكلات باستخدام `npm install --verbose` للحصول على مخرجات مفصلة.

قد يبدو ملف `.npmrc` النموذجي كما يلي:
```
proxy = http://user:password@proxy_server:8080
https_proxy = http://user:password@proxy_server:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

### ملاحظة المسح: دليل شامل لتكوين NPM باستخدام `.npmrc`
يقدم هذا القسم استكشافًا مفصلًا لتكوين NPM، مع التركيز على ملف `.npmrc` لإعدادات السجل والوكيل، مع توسيع الإجابة المباشرة بسياق إضافي وتفاصيل تقنية.

#### مقدمة عن `.npmrc` ودوره
ملف `.npmrc` هو ملف تكوين حاسم لـ NPM، مما يتيح تخصيص سلوكيات إدارة الحزم. وهو يدعم تنسيق INI بأزواج مفتاح-قيمة، حيث تبدأ التعليقات بفاصلة منقوطة (`;`). يمكن أن يكون موقعه عالميًا أو محليًا:
- **الموقع العالمي**: على أنظمة Unix-like، يكون في `~./.npmrc`؛ على Windows، في `%APPDATA%\npm\npmrc`، عادة `C:\Users\<username>\AppData\Roaming\npm\npmrc`.
- **الموقع المحلي**: داخل دليل جذر المشروع كـ `./package/.npmrc`. الإعدادات المحلية تتجاوز الإعدادات العالمية، مما يوفر تكوينات خاصة بالمشروع.

يضمن هذا التسلسل الهرمي المرونة، مما يسمح للمطورين بإدارة الإعدادات على مستوى المستخدم والمشروع، وهو أمر مفيد بشكل خاص في البيئات ذات المشاريع المتعددة أو الأنظمة المشتركة.

#### تكوين الوكيل التفصيلي
يتطلب العمل خلف وكيل تعيين كل من `proxy` و `https_proxy` في `.npmrc`. التنسيق هو:
- `proxy = http://user:password@proxy_server:port`
- `https_proxy = http://user:password@proxy_server:port`

من الجدير بالملاحظة أن `https_proxy` يستخدم `http://` كبروتوكول، وليس `https://`، لأن خادم الوكيل يتعامل مع الاتصال، ولا يقوم بتشفيره إلى الوكيل نفسه. هذه نقطة خلط شائعة، لأن الحمولة المرسلة إلى الوجهة تبقى مشفرة بـ SSL.

للمصادقة، قم بتضمين اسم المستخدم وكلمة المرور، ولكن إذا كانت تحتوي على أحرف خاصة، فإن الترميز في عنوان URL ضروري:
- الشرطة المائلة للخلف (`\`) تصبح `%5C`.
- رمز at (`@`) يصبح `%40`.
- النقطتان (`:`) تصبح `%3A`.

على سبيل المثال، إذا كان اسم المستخدم هو `domain\user` وكلمة المرور هي `pass@word`، فسيكون `proxy = http://domain%5Cuser:pass%40word@proxy_server:8080`. يضمن هذا الترميز التحليل الصحيح من قبل NPM.

قد يواجه مستخدمو Windows، خاصة في البيئات المؤسسية مع Active Directory، مشاكل مع الشرطات المائلة للخلف. تشير بعض التقارير إلى أن `domain\username` في `.npmrc` قد تتحول إلى `domain/username` عند القراءة، مما قد يتسبب في فشل المصادقة. في مثل هذه الحالات، يمكن أن تساعد أدوات مثل NTLM Authorization Proxy Server أو Cntlm، على الرغم من أنها خارج نطاق التكوين المباشر لـ `.npmrc`.

#### تكوين السجل واعتبارات SSL
يحدد إعداد السجل المكان الذي يجلب منه NPM الحزم، ويُضبط افتراضيًا على `https://registry.npmjs.org/`. للسجلات المخصصة أو الخاصة، عيّن:
- `registry = https://your_custom_registry.com/`

إذا فشل التحقق من SSL، غالبًا بسبب وكلاء الشركات الذين يستخدمون شهادات موقعة ذاتيًا، يمكنك تعطيل strict SSL:
- `strict-ssl = false`

ومع ذلك، يقلل هذا من الأمان، لأنه يتجاوز التحقق من صحة الشهادة. بدلاً من ذلك، قم بتكوين سلطة الشهادة:
- استخدم `npm config -g set cafile [YOUR_CERTIFICATE_DIR]/[CERTIFICATE_NAME].crt` لتحديد ملف CA موثوق به.

يختار بعض المطورين `registry = http://registry.npmjs.org/` لتجنب SSL تمامًا، ولكن هذا غير موصى به لأسباب أمنية، خاصة في بيئة الإنتاج.

#### استخدام `.npmrc`: التحرير اليدوي مقابل سطر الأوامر
يمكنك تحرير `.npmrc` مباشرة بأي محرر نصوص، مع التأكد من أن كل إعداد في سطر جديد بالتنسيق `key = value`. تبدأ التعليقات بـ `;`، مثال:
```
; إعدادات الوكيل للشبكة المؤسسية
proxy = http://user:password@proxy_server:8080
https_proxy = http://user:password@proxy_server:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

بدلاً من ذلك، استخدم أوامر NPM للراحة:
- تعيين الوكيل: `npm config set proxy http://user:password@proxy_server:port`
- تعيين السجل: `npm config set registry https://registry.npmjs.org/`
- تعيين strict-ssl: `npm config set strict-ssl false`

تقوم هذه الأوامر بتحديث ملف `.npmrc` المناسب بناءً على السياق (عالمي أو محلي). للتبديل بين العالمي والمحلي، استخدم `-g` للإعدادات العالمية، مثال: `npm config set -g proxy ...`.

#### التحقق من التكوينات واستكشاف الأخطاء وإصلاحها
للتحقق من التكوينات، استخدم:
- `npm config list` لسرد جميع الإعدادات، مع إظهار القيم الفعالة والافتراضية.
- `npm config get proxy` لاسترداد إعداد محدد.

لاستكشاف الأخطاء وإصلاحها، خاصة خلف الوكلاء، قم بتشغيل:
- `npm install --verbose` لرؤية السجلات التفصيلية، والتي يمكن أن تساعد في تحديد مشكلات الاتصال، مثل `ECONNREFUSED` أو `socket hang up`.

إذا لم تُفعّل الإعدادات، تحقق من متغيرات البيئة (`HTTP_PROXY`, `HTTPS_PROXY`) التي قد تتجاوز `.npmrc`. يمكن تعيين هذه على مستوى النظام ولها الأسبقية، لذا تأكد من الاتساق.

#### أفضل الممارسات والاعتبارات الإضافية
- **الأمان**: تجنب `strict-ssl = false` في بيئة الإنتاج؛ بدلاً من ذلك، قم بتكوين الشهادات الموثوقة.
- **متغيرات البيئة**: كن على علم بأن `NODE_ENV` و `HTTPS_PROXY` يمكن أن تتجاوز إعدادات `.npmrc`، وهي مفيدة لأنابيب CI/CD ولكنها قد تسبب ارتباكًا محليًا.
- **مستويات التسجيل**: اضبط `loglevel` في `.npmrc` (مثال: `loglevel = http`) للحصول على مخرجات أكثر تفصيلاً أثناء التصحيح، مع خيارات تتراوح من `silent` إلى `silly` (7 مستويات إجمالاً).
- **وكلاء الشركات**: لوكلاء NTLM، فكر في استخدام أدوات مثل Cntlm، وإعداد خادم وكيل محلي، وتكوين `.npmrc` للإشارة إلى `localhost:3128`، مما يبسط المصادقة.

#### أمثلة على التكوينات
فيما يلي جدول يلخص إعدادات `.npmrc` الشائعة للوكيل والسجل، مع أمثلة:

| **الإعداد**    | **الوصف**                              | **مثال**                                      |
|----------------|----------------------------------------------|--------------------------------------------------|
| proxy          | عنوان URL لخادم الوكيل HTTP                        | `proxy = http://user:password@proxy:8080`        |
| https_proxy    | عنوان URL لخادم الوكيل HTTPS                       | `https_proxy = http://user:password@proxy:8080`  |
| registry       | عنوان URL لسجل الحزم                         | `registry = https://registry.npmjs.org/`         |
| strict-ssl     | تمكين/تعطيل التحقق من SSL              | `strict-ssl = false`                             |
| loglevel       | مستوى مخرجات وحدة التحكم (من silent إلى silly، 7 مستويات) | `loglevel = http`                                |

يساعد هذا الجدول في المرجع السريع، خاصة للمطورين الجدد في `.npmrc`.

#### تفصيل غير متوقع: التأثير على الإعدادات العالمية مقابل المحلية
جانب غير متوقع هو كيف تؤثر إعدادات `.npmrc` العالمية على جميع المشاريع، بينما يمكن للإعدادات المحلية أن تتجاوزها لمشاريع محددة. يمكن أن يؤدي هذا التقسيم الطبقي إلى ارتباك إذا، على سبيل المثال، تم تعيين وكيل عالمي ولكن مشروع محلي يستخدم سجلًا مختلفًا، مما قد يتسبب في مشاكل مصادقة. فهم هذا التسلسل الهرمي أمر بالغ الأهمية للبيئات متعددة المشاريع.

#### الخلاصة
يعد تكوين NPM عبر `.npmrc` لإعدادات الوكيل والسجل أمرًا واضحًا مع التنسيق الصحيح والاعتبارات الخاصة بالترميز و SSL. من خلال التحرير المباشر أو استخدام الأوامر، والتحقق باستخدام `npm config list`، فإنك تضمن إدارة سلسة للحزم، خاصة في شبكات الشركات التي تستخدم الوكلاء. لمزيد من القراءة، استشر الوثائق الرسمية على [NPM CLI Config](https://docs.npmjs.com/cli-config) أو استكشف أفضل الممارسات على [Configuring Your .nmprc](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment).

### الاقتباسات الرئيسية
- [NPM CLI Config Documentation](https://docs.npmjs.com/cli-config)
- [Configuring Your .nmprc for an Optimal Node.js Environment](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment)
- [How to setup npm proxy settings behind proxy on Windows](https://gist.github.com/zillingen/5c4b8da657025c83ead59e1e547c7436)