---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: تجنب حلقات البروكسي في دوكر ديمون
translated: true
type: note
---

### لماذا `"no-proxy": "localhost,127.0.0.1,.local"` حاسمة في `daemon.json` الخاص بـ Docker

عندما تقوم بتكوين Daemon الخاص بـ Docker بإعدادات الوكيل مثل `"http-proxy": "http://localhost:7890"` (شائع للأدوات مثل Clash التي تعمل محليًا)، يطبق الـ Daemon هذه القواعد على **جميع** حركة مرور الشبكة الصادرة افتراضيًا. وهذا يشمل الاتصالات بالسجلات الخارجية (مثل `registry-1.docker.io` لسحب صور مثل `hello-world`).

ومع ذلك، بدون توجيه `no-proxy`، يحاول الـ Daemon أيضًا توجيه **الاتصالات المحلية** — مثل مصافحة TCP الأولية لخادم الوكيل نفسه على `localhost:7890` — من خلال نفس الوكيل. هذا يخلق **حلقة وكيل** كلاسيكية:

1. يحتاج Docker لجلب صورة من `registry-1.docker.io`.
2. يحاول الاتصال عبر الوكيل على `localhost:7890`.
3. ولكن للوصول إلى `localhost:7890`، تعود إعدادات الوكيل للتطبيق مجددًا، مما يجبر Docker على... الاتصال عبر الوكيل على `localhost:7890`.
4. يفشل هذا التكرار اللانهائي على مستوى TCP لأن الوكيل لا يمكنه وكالة اتصال إلى نفسه (يؤدي هذا إلى حلقة自我ية المرجعية دون حل).
5. ينقطع الاتصال بشكل غير متوقع، مما يؤدي إلى خطأ `proxyconnect tcp: EOF` (EOF تعني "نهاية الملف"، مما يشير إلى إغلاق مبكر أثناء التفاوض على الوكيل/مصافحة).

إضافة `"no-proxy": "localhost,127.0.0.1,.local"` تخبر الـ Daemon صراحةً **بتجاوز الوكيل** لحركة المرور الموجهة إلى:
- `localhost` (اسم المضاف المحلي لجهازك)،
- `127.0.0.1` (عنوان IPv4 المحلي)،
- النطاقات `.local` (شائع لحل شبكة mDNS/المحلية).

هذا يسمح لـ Docker بالاتصال **مباشرة** بخادم الوكيل على localhost دون المرور عبر نفسه. بمجرد الاتصال، يمكن للوكيل بعد ذلك معالجة الطلب الخارجي إلى سجل Docker بشكل صحيح (على سبيل المثال، عبر HTTP CONNECT لحركة مرور HTTPS).

باختصار: يمنع الـ Daemon من "استخدام الوكيل للوصول إلى الوكيل نفسه"، مما يضمن عمل الوصول إلى الوكيل المحلي مع استمرار توجيه حركة المرور الموجهة للإنترنت (مثل سحب الصور) من خلاله.

إذا كانت إعداداتك تتضمن خدمات محلية أخرى (مثل السجلات الداخلية أو الحاويات التي تتواصل محليًا)، فإن توسيع `no-proxy` لتشمل تلك النطاقات/عناوين IP يمكن أن يمنع مشاكل مماثلة.

[تكوين وكيل Docker Daemon](https://docs.docker.com/engine/daemon/proxy/)  
[مناقشة منتدى إعدادات وكيل Docker](https://forums.docker.com/t/proxy-settings-for-the-docker-daemon/132089)  
[دليل وكيل Docker للجدران النارية للشركات](https://www.datacamp.com/tutorial/docker-proxy)