---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-code-fast-1
title: نظرة عامة على فئة المحمل في كود إيجنتر
translated: true
type: note
---

فيما يلي شرح واضح ومنظم لمقتطف كود PHP المقدم. يبدو أن هذا هو فئة `CI_Loader` من إطار عمل CodeIgniter لـ PHP (إطار عمل ويب مفتوح المصدر). تم تصميم CodeIgniter لتبسيط مهام تطوير الويب الشائعة، وفئة Loader هي مكون أساسي مسؤول عن تحميل وإدارة موارد الإطار المختلفة (مثل النماذج، والعروض، والمكتبات). سأقوم بتفصيلها خطوة بخطوة، بما في ذلك الغرض منها، والمكونات الرئيسية، والطرق، وكيفية عملها. سأتجنب استخدام المصطلحات التقنية حيثما أمكن وسأحافظ على الإيجاز، ولكن نظرًا لأن هذه فئة كبيرة (أكثر من 1000 سطر)، سألخص بدلاً من تحليل كل سطر.

إذا كنت جديدًا في CodeIgniter أو أطر عمل PHP، فاعتبر هذا هو "المُرسل" أو "المستورد" لتطبيقك—فهو يقوم بتحميل الملفات ديناميكيًا (مثل الفئات أو العروض) عند الطلب دون الحاجة إلى استدعائها يدويًا في الكود الخاص بك.

### 1. **الغرض العام والسياق**
   - **ماذا يفعل**: فئة `CI_Loader` هي قلب تحميل الموارد في CodeIgniter. تتيح لك تحميل وتجهيز المكتبات، والنماذج، والعروض، والمساعدات، والسواقات، والمزيد ديناميكيًا. على سبيل المثال، في وحدة التحكم، يمكنك القيام بـ `$this->load->model('User_model')` لتحميل نموذج، مما يجعله متاحًا كـ `$this->User_model`.
   - **سبب وجودها**: تعمل `require_once` في PHP، لكن أطر العمل مثل CodeIgniter تؤتمت تحميل الملفات، وتتعامل مع اصطلاحات التسمية (مثل كتابة أسماء الفئات بأحرف كبيرة)، وتدير المسارات (مثل مجلدات التطبيق مقابل النظام)، وتمنع أخطاء مثل التحميل المكرر. هذا يعزز كتابة كود أنظف وأكثر نمطية.
   - **أين تتناسب**: يتم تجهيزها مبكرًا في دورة حياة الإطار (عبر `CI_Controller::__construct()`). تتفاعل مع نسخة وحدة التحكم الرئيسية (`$CI =& get_instance()`) لإرفاق الموارد المحملة.
   - **الترخيص والبيانات الوصفية**: يظهر الرأس أنه مرخص بترخيص MIT، حقوق النشر محفوظة لـ EllisLab Inc. وآخرين، وتم إصداره تحت CodeIgniter (الإصدار 3.x استنادًا إلى الكود).
   - **مُعرَّف في**: `system/core/Loader.php` (في تثبيت CodeIgniter قياسي).

### 2. **هيكل الفئة والخصائص**
   - **اسم الفئة**: `CI_Loader`.
   - **يمتد / يرث**: لا شيء صراحةً—إنها قائمة بذاتها ولكنها تندمج بشكل وثيق مع الإطار.
   - **الرؤية**: معظم الطرق `public` (لوصول المستخدم)، وبعضها `protected` (للاستخدام الداخلي).
   - **الخصائص الرئيسية** (جميعها محمية، تخزن المسارات والعناصر المحملة):
     - `$_ci_ob_level`: يتتبع مستوى تخزين الإخراج ( `ob_start()` في PHP لمعالجة العروض).
     - `$_ci_view_paths`, `$_ci_library_paths`, `$_ci_model_paths`, `$_ci_helper_paths`: مصفوفات من المسارات للبحث عن الملفات (مثل `APPPATH` لمجلد التطبيق، `BASEPATH` لمجلد النظام).
     - `$_ci_classes`, `$_ci_models`, `$_ci_helpers`: يتتبع ما تم تحميله بالفعل لتجنب التكرار.
     - `$_ci_cached_vars`: يخزن المتغيرات للعروض (يتم تمريرها عبر `vars()`).
     - `$_ci_varmap`: يعين أسماء الفئات (مثل `'unit_test' => 'unit'`) لتوافق الإصدارات القديمة.
   - **المنشئ**: يقوم بإعداد المسارات الأولية ويحصل على مستوى تخزين الإخراج. يستدعي مُهيئ التحميل التلقائي الداخلي.
   - **نمط الوراثة**: يستخدم التجهيز الديناميكي في PHP (مثل `new $class_name()`) بدلاً من فئة أساسية ثابتة لمعظم أدوات التحميل.

### 3. **الطرق الرئيسية والوظائف**
تحتوي الفئة على العديد من الطرق، مجمعة حسب الموضوع. فيما يلي تفصيل للطرق الرئيسية:

#### **تحميل الموارد (طرق عامة)**
هذه هي واجهات برمجة التطبيقات الرئيسية التي تستدعيها (كمطور):
   - **`library($library, $params, $object_name)`**: يحمل فئة مكتبة (مثل البريد الإلكتروني، الجلسة). إذا كان `$library` مصفوفة، فإنه يحمل عدة مكتبات. يتعامل مع المجلدات الفرعية ويجهز الفئة على وحدة التحكم (`$CI->some_library`).
   - **`model($model, $name, $db_conn)`**: يحمل فئة نموذج (للتفاعل مع قاعدة البيانات). يضمن أن النموذج يمتد `CI_Model`. يمكنه التحميل التلقائي لقاعدة البيانات إذا لزم الأمر.
   - **`view($view, $vars, $return)`**: يحمل ملف عرض (قالب PHP) ويخرجه. يمرر المتغيرات، ويستخدم تخزين الإخراج للأداء. يبحث في مسارات مثل `APPPATH/views/`.
   - **`helper($helpers)`**: يحمل دوال مساعدة (دوال مساعدة عامة، مثل مساعدات النماذج). يتضمن كل من الأساسية (النظام) وتجاوزات مستوى التطبيق.
   - **`database($params, $return, $query_builder)`**: يحمل اتصال قاعدة البيانات. يمكنه إرجاع كائن أو إرفاقه بـ `$CI->db`.
   - **`driver($library, $params, $object_name)`**: مشابه لـ `library()`، ولكن لـ "السواقات" (مكتبات تحتوي على سواقات فرعية، مثل cache_db).
   - **`config($file, $use_sections)`**: يحمل ملفات التكوين (يتعامل مع مكون التكوين).
   - **`language($files, $lang)`**: يحمل ملفات اللغة للتدويل (يتعامل مع مكون اللغة).
   - **`file($path, $return)`**: يحمل ملفات عشوائية (مشابه للعرض، لملفات PHP غير العروض).

#### **إدارة المتغيرات والذاكرة المؤقتة**
   - **`vars($vars, $val)`**: يحدد المتغيرات للعروض (مثل البيانات لتمريرها إلى القوالب).
   - **`get_var($key)`, `get_vars()`, `clear_vars()`**: يسترجع أو يمسح متغيرات العرض المخزنة مؤقتًا.

#### **إدارة الحزم والمسارات**
   - **`add_package_path($path, $view_cascade)`**: يسمح لك بإضافة مسارات مخصصة (مثل الحزم من طرف ثالث) إلى مسارات البحث الخاصة بأداة التحميل.
   - **`remove_package_path($path)`**: يزيل المسارات، ويعيد التعيين إلى المسارات الافتراضية (مسارات التطبيق والأساس).
   - **`get_package_paths($include_base)`**: إرجاع المسارات الحالية.

#### **الطرق الداخلية / المحمية**
هذه تتولى العمل "خلف الكواليس":
   - **`_ci_load($_ci_data)`**: أداة التحميل الأساسية للعروض/الملفات. يستخدم تخزين الإخراج، يستخرج المتغيرات، يتضمن الملفات، ويسجل. يتعامل مع إعادة كتابة الوسم المختصر لإصدارات PHP القديمة.
   - **`_ci_load_library($class, $params, $object_name)` و `_ci_load_stock_library(...)`**: يجد ويحمل ملفات المكتبة، يتحقق من التكرار، ويستدعي `_ci_init_library()`.
   - **`_ci_init_library($class, $prefix, $config)`**: يجهز الفئات، يحمل التكوينات (مثل `libraries/config/somelib.php`)، ويرفقها بوحدة التحكم. يتعامل مع تعيينات أسماء الفئات.
   - **`_ci_autoloader()`**: يعمل عند البدء، يحمل تلقائيًا العناصر من `config/autoload.php` (مثل الحزم، المساعدات).
   - **طرق الأداء**: `_ci_prep_filename()` يوحد أسماء الملفات (مثل إضافة `.php`)، `_ci_object_to_array()` يحول الكائنات إلى مصفوفات لمتغيرات العرض.

#### **روابط الأحداث / التسجيل**
   - يستخدم `log_message()` للرسائل المعلوماتية / التصحيحية / الخطأ (مثل "تم تحميل المساعد").
   - يستدعي `show_error()` للمشاكل الحرجة (مثل الملفات المفقودة).

### 4. **كيف يعمل: مثال على التدفق عالي المستوى**
1. **التهيئة**: المنشئ يحدد المسارات (مثل مجلدات التطبيق والأساس). `initialize()` يستدعي `_ci_autoloader()` لتحميل العناصر المهيأة تلقائيًا (من `autoload.php`).
2. **تحميل مورد** (مثل نموذج):
   - تستدعي `$this->load->model('user_model')`.
   - يحلل الاسم، يتحقق من المسارات (`APPPATH/models/` ثم `BASEPATH/models/`)، يجد الملف.
   - يتضمن الملف، يضمن أنه يمتد `CI_Model`، يجهزه كـ `$CI->user_model`.
   - يمنع التكرار ويتعامل مع المجلدات الفرعية (مثل `models/admin/user_model.php`).
3. **العروض والإخراج**: `view()` يخزن الإخراج مؤقتًا للسماح بالمعالجة اللاحقة (مثل إضافة أوقات تحميل الصفحة). يتم استخراج المتغيرات وجعلها متاحة بشكل عام في العرض.
4. **معالجة الأخطاء**: يطلق `RuntimeException` أو يستدعي `show_error()` لمشاكل مثل الملفات المفقودة أو الفئات غير الصالحة.
5. **المسارات والمرونة**: يدعم التتابع (البحث في التطبيق أولاً، ثم النظام) والحزم (مثل وحدات HMVC).

### 5. **الميزات والفوائد الرئيسية**
   - **الأداء**: يخزن العناصر المحملة مؤقتًا، يستخدم التخزين المؤقت للعروض.
   - **المرونة**: يتعامل مع المسارات المخصصة، والتجاوزات (مثل مكتبات مستوى التطبيق تتغلب على مكتبات النظام)، وتكوينات بيئة محددة (عبر ثابت `ENVIRONMENT`).
   - **الاتفاقية بدلاً من التكوين**: يكتب تلقائيًا أسماء الفئات بأحرف كبيرة، يفترض هياكل مجلدات قياسية (`libraries/`, `models/`).
   - **الأمان**: يقتصر على المسارات المحددة، يتجنب التضمينات العشوائية.
   - **القدرة على التوسع**: يمكنه تحميل السواقات (مكتبات تحتوي على سواقات فرعية) والمساعدات.
   - **توافق PHP**: يتعامل مع ميزات PHP مثل الوسوم المختصرة أو تحويل الكائن إلى مصفوفة.

### 6. **أمثلة استخدام شائعة**
```php
// في وحدة تحكم
$this->load->library('email');       // يحمل CI_Email، يمكن استخدامه كـ $this->email
$this->load->model('User_model');    // يحمل User_model، يمكن استخدامه كـ $this->User_model
$this->load->view('welcome', array('title' => 'Hello'));  // يعرض views/welcome.php
$this->load->helper('url');          // يجعل url_title() إلخ متاحة globally
$this->load->add_package_path(APPPATH.'third_party/some_package/');  // إضافة مسار مخصص
```

### 7. **المشكلات أو المفاجآت المحتملة**
   - **المسارات**: إذا كانت المسارات خاطئة (مثل أذونات)، فشل التحميل. استخدم `$this->add_package_path()` للوحدات النمطية المخصصة.
   - **التكرارات**: لن يعيد تحميل نفس العنصر—بدلاً من ذلك يسجل رسالة تصحيح.
   - **تسمية الفئة**: تأكد من أن الفئات المحملة تطابق أسماء الملفات (مثل `User_model.php` تعلن `class User_model`).
   - **إصدار PHP**: يستخدم ميزات مثل `ob_get_level()`؛ قد يحتاج إلى تعديلات لإصدارات PHP قديمة جدًا (<5.4).
   - **التصحيح**: تحقق من السجلات لـ "تم تحميل الملف" أو الأخطاء. مكّن الإبلاغ عن الأخطاء.

إذا كان هذا الكود من إصدار محدد من CodeIgniter (مثل 3.x)، فقد تختلف السلوكيات في الإصدار 4.x. إذا كان لديك جزء محدد من الكود (مثل طريقة) تريد مني شرحه بمزيد من التفصيل، أو إذا كان هذا من أجل التصحيح/التعديل، فأخبرني! للوثائق الرسمية، راجع دليل مستخدم CodeIgniter حول تحميل الموارد.