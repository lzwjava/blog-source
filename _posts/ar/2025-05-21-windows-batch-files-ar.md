---
audio: false
generated: true
lang: ar
layout: post
title: كتابة ملفات دفعية لنظام ويندوز
translated: true
type: note
---

ملف الدُفعة في Windows (بامتداد `.bat` أو `.cmd`) هو ملف نصي يحتوي على سلسلة من الأوامر تنفذ بواسطة موجه أوامر Windows (cmd.exe). تعمل ملفات الدُفعة على أتمتة المهام المتكررة، وإدارة عمليات النظام، أو تنفيذ البرامج. فيما يلي مقدمة شاملة لكتابة ملفات الدُفعة في Windows، تغطي الغرض منها، وبنية الأوامر، والأوامر الشائعة، وأفضل الممارسات.

### ما هو ملف الدُفعة؟
ملف الدُفعة هو ملف نصي عادي بامتداد `.bat` أو `.cmd` يحتوي على أوامر يفسرها موجه أوامر Windows. عند التنفيذ، تعمل الأوامر بشكل تسلسلي، مما يسمح بأتمتة مهام مثل إدارة الملفات، أو تكوين النظام، أو تثبيت البرامج.

### لماذا نستخدم ملفات الدُفعة؟
- **الأتمتة**: تنفيذ أوامر متعددة من خلال سكريبت واحد.
- **البساطة**: لا تتطلب معرفة متقدمة بالبرمجة.
- **إدارة النظام**: تنفيذ مهام مثل النسخ الاحتياطي، أو إدارة المستخدمين، أو إعداد البيئة.
- **التوافق**: يعمل على جميع إصدارات Windows التي تحتوي على موجه الأوامر.

### إنشاء ملف دُفعة
1. **كتابة السكريبت**: استخدم محرر نصوص (مثل Notepad أو VS Code) لكتابة الأوامر.
2. **الحفظ بالامتداد الصحيح**: احفظ الملف بامتداد `.bat` أو `.cmd` (مثال: `script.bat`).
3. **التنفيذ**: انقر نقرًا مزدوجًا فوق الملف أو شغله عبر موجه الأوامر.

### البنية الأساسية وبناء الجملة
- **الأوامر**: تستخدم ملفات الدُفعة أوامر موجه الأوامر (مثل `dir`، `copy`، `del`) وأوامر خاصة بالدُفعة (مثل `echo`، `set`، `goto`).
- **التعليقات**: استخدم `REM` أو `::` لإضافة تعليقات للتوضيح.
- **عدم حساسية الحالة**: الأوامر والمتغيرات لا تفرق بين الأحرف الكبيرة والصغيرة.
- **تنفيذ الأسطر**: يتم تنفيذ الأوامر سطرًا بسطر ما لم يتم التحكم فيها بأوامر التدفق مثل `if`، أو `for`، أو `goto`.

### الأوامر والميزات الشائعة
#### 1. **الأوامر الأساسية**
- `ECHO`: يتحكم في عرض الأوامر أو يعرض نصًا.
  - مثال: `ECHO Hello, World!` يعرض "Hello, World!".
  - `ECHO OFF`: يمنع عرض الأوامر أثناء التنفيذ.
- `CLS`: يمسح شاشة موجه الأوامر.
- `PAUSE**: يوقف التنفيذ، في انتظار إدخال المستخدم.
- `EXIT`: ينهي السكريبت أو جلسة موجه الأوامر.

#### 2. **المتغيرات**
- **تعيين المتغيرات**: استخدم `SET` لإنشاء أو تعديل المتغيرات.
  - مثال: `SET MY_VAR=Hello` ينشئ متغير `MY_VAR`.
- **استخدام المتغيرات**: الرجوع إليها باستخدام `%اسم_المتغير%`.
  - مثال: `ECHO %MY_VAR%` يعرض "Hello".
- **متغيرات البيئة**: متغيرات مضمنة مثل `%PATH%`، أو `%USERNAME%`، أو `%DATE%`.

#### 3. **الإدخال والإخراج**
- **إدخال المستخدم**: استخدم `SET /P` لطلب الإدخال.
  - مثال: `SET /P NAME=Enter your name: ` يخزن إدخال المستخدم في `NAME`.
- **توجيه الإخراج**: استخدم `>` لكتابة الإخراج إلى ملف أو `>>` للإلحاق.
  - مثال: `DIR > filelist.txt` يحفظ قائمة الدليل في `filelist.txt`.

#### 4. **العبارات الشرطية**
- استخدم `IF` لتنفيذ الأوامر بناءً على الشروط.
  - بناء الجملة: `IF condition command [ELSE command]`
  - مثال: `IF "%NAME%"=="Admin" ECHO Welcome, Admin! ELSE ECHO Access denied.`

#### 5. **الحلقات**
- **حلقة FOR**: تتكرر عبر الملفات، أو المجلدات، أو القيم.
  - مثال: `FOR %i IN (*.txt) DO ECHO %i` يسرد جميع ملفات `.txt`.
  - ملاحظة: في ملفات الدُفعة، استخدم `%%i` بدلاً من `%i` للمتغيرات.
- **حلقات شبيهة بـ WHILE**: يمكن محاكاتها باستخدام `GOTO` و `IF`.

#### 6. **الإجراءات الفرعية والتسميات**
- **التسميات**: استخدم `:label` لوضع علامة على قسم من الكود.
- `GOTO`: يقفز إلى قسم موسوم.
  - مثال: `GOTO :EOF` يقفز إلى نهاية الملف.
- `CALL`: يستدعي ملف دُفعة آخر أو إجراءًا فرعيًا.
  - مثال: `CALL :mySubroutine` يشغل إجراءًا فرعيًا موسومًا.

#### 7. **معالجة الأخطاء**
- تحقق من نجاح الأمر باستخدام `%ERRORLEVEL%`.
  - مثال: `IF %ERRORLEVEL% NEQ 0 ECHO Command failed.`

### أفضل الممارسات
- **استخدم `ECHO OFF`**: يقلل الفوضى بإخفاء إخراج الأوامر.
- **أضف تعليقات**: استخدم `REM` أو `::` لتوثيق الكود.
- **اختبر تدريجيًا**: شغل أقسامًا صغيرة لتصحيح الأخطاء.
- **تعامل مع الأخطاء**: تحقق من `%ERRORLEVEL%` للفشل.
- **استخدم علامات الاقتباس للمسارات**: ضع مسارات الملفات بين علامتي اقتباس للتعامل مع المسافات (مثال: `"C:\Program Files\"`).
- **تجنب الأسماء المحجوزة**: لا تستخدم أسماء مثل `CON`، أو `NUL`، أو `PRN` للملفات أو المتغيرات.
- **استخدم `@` للإسكات**: بادئ الأوامر بـ `@` لمنع عرض الأمر الفردي (مثال: `@ECHO OFF`).

### مثال على ملف دُفعة
فيما يلي ملف دُفعة نموذجي يوضح الميزات الشائعة: طلب إدخال المستخدم، وإنشاء مجلد، وتسجيل الإخراج.

```batch
@echo off
REM نموذج لملف دُفعة لإنشاء مجلد وتسجيل الإجراءات
ECHO Starting script...

:: طلب اسم المجلد
SET /P DIRNAME=Enter directory name:

:: التحقق مما إذا كان الإدخال فارغًا
IF "%DIRNAME%"=="" (
    ECHO Error: No directory name provided.
    PAUSE
    EXIT /B 1
)

:: إنشاء المجلد وتسجيل النتيجة
MKDIR "%DIRNAME%"
IF %ERRORLEVEL%==0 (
    ECHO Directory "%DIRNAME%" created successfully.
    ECHO %DATE% %TIME%: Created directory "%DIRNAME%" >> log.txt
) ELSE (
    ECHO Failed to create directory "%DIRNAME%".
    ECHO %DATE% %TIME%: Failed to create directory "%DIRNAME%" >> log.txt
)

PAUSE
ECHO Done.
EXIT /B
```

### تشغيل ملف الدُفعة
- احفظ الكود أعلاه كـ `sample.bat`.
- انقر نقرًا مزدوجًا أو شغله عبر موجه الأوامر (`cmd.exe /c sample.bat`).

### نصائح متقدمة
- **التوسيع المؤجل**: استخدم `SETLOCAL EnableDelayedExpansion` للمتغيرات التي يتم تحديثها في الحلقات (مثال: `!VAR!` بدلاً من `%VAR%`).
- **مستويات الخطأ**: اختبر الأوامر باستخدام `IF ERRORLEVEL n` لرموز الخروج المحددة.
- **الأدوات الخارجية**: ادمج أدوات مثل `PowerShell` أو `curl` لوظائف متقدمة.
- **الأمان**: تجنب تشغيل ملفات الدُفعة من مصادر غير موثوقة لمنع تنفيذ كود ضار.

### القيود
- **التعقيد**: ملفات الدُفعة أقل قوة من PowerShell أو Python للمهام المعقدة.
- **معالجة الأخطاء**: محدودة مقارنة بلغات البرمجة النصية الحديثة.
- **Cross-Platform**: ملفات الدُفعة خاصة بـ Windows.

### الموارد
- **التوثيق الرسمي**: مرجع موجه أوامر Microsoft (أمر `help` في cmd.exe).
- **الدروس**: مواقع ويب مثل SS64.com توفر مراجع أوامر مفصلة.
- **المجتمع**: ابحث عن أمثلة لملفات الدُفعة على X أو منتديات مثل Stack Overflow.

توفر هذه المقدمة أساسًا لكتابة ملفات الدُفعة. تدرب على سكريبتات بسيطة واستكشف الأوامر عبر `help` في موجه الأوامر لتطوير مهاراتك.