---
audio: false
generated: true
lang: ar
layout: post
title: رفع الملفات عبر بروتوكول HTTP
translated: true
type: note
---

### النقاط الرئيسية
- تشير الأبحاث إلى أن عمليات رفع الملفات عبر HTTP تستخدم عادةً طريقة POST مع ترميز multipart/form-data لنماذب الويب، مما يسمح برفع ملفات متعددة وبيانات إضافية.
- يبدو من المرجح أن طريقة PUT يمكنها أيضًا رفع الملفات، حيث ترسل المحتوى الخام مباشرة، وغالبًا ما تُستخدم في واجهات برمجة التطبيقات (RESTful APIs) للبساطة.
- تميل الأدلة إلى صحة كلتا الطريقتين، حيث يحدد تكوين الخادم وحالة الاستخدام الاختيار المناسب.

### نظرة عامة
يعد رفع الملفات عبر HTTP مهمة شائعة لمشاركة البيانات عبر الإنترنت، مثل إرسال الصور أو المستندات إلى موقع ويب. يمكن القيام بذلك بطريقتين رئيسيتين: استخدام طريقة POST مع تنسيق خاص يسمى multipart/form-data، وهو رائع لنماذب الويب، أو استخدام طريقة PUT، وهي أبسط وغالبًا ما تُستخدم في واجهات برمجة التطبيقات (APIs) الحديثة. لكل طريقة إعدادها الخاص، ويعتمد الاختيار الصحيح على كيفية إعداد الخادم وما تحاول تحقيقه.

### آلية العمل
- **POST مع Multipart/Form-Data**: يشبه هذا تغليف ملفك وأي معلومات إضافية (مثل الوصف) في أجزاء منفصلة، يتم تمييزها بسلسلة حدود فريدة. وهو شائع لنماذب الويب حيث تختار الملفات لرفعها.
- **طريقة PUT**: ترسل محتوى الملف مباشرة إلى عنوان URL محدد، مثل تحديث ملف على الخادم. إنها أبسط ولكنها تتطلب دعم الخادم لها.

### تفصيل غير متوقع
قد لا تتوقع أن طريقة PUT، المُستخدمة عادةً لتحديث البيانات، يمكنها أيضًا التعامل مع رفع الملفات، خاصة في واجهات برمجة التطبيقات (APIs)، مما يجعلها خيارًا متعدد الاستخدامات beyond النماذب التقليدية.

---

### ملاحظة استقصائية: شرح مفصل لرفع الملفات عبر HTTP

يُعد رفع الملفات عبر HTTP عملية أساسية في تطوير الويب، تمكن المستخدمين من مشاركة بيانات مثل الصور أو المستندات أو الوسائط مع الخوادم. يمكن إنجاز هذه العملية من خلال طريقتين أساسيتين: طريقة POST مع ترميز multipart/form-data، شائعة الاستخدام لنماذب الويب، وطريقة PUT، التي غالبًا ما تُستخدم في واجهات برمجة التطبيقات (RESTful APIs) لإرسال محتوى الملف مباشرة. أدناه، نستكشف هذه الطرق بعمق، بما في ذلك هيكلها وتنفيذها والاعتبارات المتعلقة بها، لتوفير فهم شامل لكل من الجماهير التقنية وغير التقنية.

#### Multipart/Form-Data: المعيار لنماذب الويب

نوع المحتوى multipart/form-data هو الخيار الافتراضي لرفع الملفات عبر HTTP، خاصة عند التعامل مع نماذب HTML. تتيح هذه الطريقة نقل ملفات متعددة وبيانات نموذج إضافية، مثل حقول النص، في وقت واحد ضمن طلب واحد. تتضمن العملية بناء جسم طلب مقسم إلى أجزاء، يفصل بين كل جزء سلسلة حدود فريدة، مما يضمن قدرة الخادم على التمييز بين قطع البيانات المختلفة.

##### الهيكل والمثال
يبدأ الطلب بتعيين رأس `Content-Type` إلى `multipart/form-data; boundary=boundary_string`، حيث `boundary_string` هي سلسلة يتم اختيارها عشوائيًا لتجنب التعارض مع محتوى الملف. يتضمن كل جزء من جسم الطلب رؤوسًا مثل `Content-Disposition`، الذي يحدد اسم حقل النموذج، وبالنسبة للملفات، اسم الملف، و `Content-Type`، الذي يشير إلى نوع البيانات (مثل `text/plain` للملفات النصية، `image/jpeg` لصور JPEG). ينتهي الجزء بسلسلة الحدود، ويتم تمييز الجزء الأخير بالحدود متبوعًا بشرطتين.

فكر في رفع ملف باسم `example.txt` يحتوي على "Hello, world!" إلى [هذا النقطة النهائية](https://example.com/upload)، مع اسم حقل النموذج "file". سيبدو طلب HTTP كما يلي:

```
POST /upload HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=abc123
Content-Length: 101

--abc123
Content-Disposition: form-data; name="file"; filename="example.txt"
Content-Type: text/plain

Hello, world!
--abc123--
```

هنا، يتم حساب `Content-Length` على أنه 101 بايت، مع الأخذ في الاعتبار الحدود والرؤوس ومحتوى الملف، مع استخدام نهايات الأسطر عادةً CRLF (`\r\n`) للتنسيق الصحيح لـ HTTP.

##### التعامل مع ملفات متعددة وحقول النموذج
تتفوق هذه الطريقة في السيناريوهات التي تتطلب بيانات وصفية إضافية. على سبيل المثال، إذا كنت ترفع ملفًا مع وصف، يمكن أن يتضمن جسم الطلب أجزاء متعددة:

```
--abc123
Content-Disposition: form-data; name="description"

هذا هو ملفي
--abc123
Content-Disposition: form-data; name="file"; filename="example.txt"
Content-Type: text/plain

Hello, world!
--abc123--
```

يتم الحفاظ على محتوى كل جزء، بما في ذلك أي أسطر جديدة، وتضمن الحدود الفصل. هذه المرونة تجعلها مثالية لنماذب الويب مع عناصر `<input type="file">`.

#### طريقة PUT: رفع الملف المباشر لواجهات برمجة التطبيقات (RESTful APIs)

تقدم طريقة PUT بديلاً أبسط، خاصة في سياقات واجهات برمجة التطبيقات (RESTful API)، حيث الهدف هو تحديث أو إنشاء مورد بمحتوى الملف. على عكس multipart/form-data، ترسل PUT بيانات الملف الخام مباشرة في جسم الطلب، مما يقلل من الحمل ويبسط المعالجة على جانب الخادم.

##### الهيكل والمثال
لرفع `example.txt` إلى [هذا الرابط](https://example.com/files/123)، سيكون الطلب كما يلي:

```
PUT /files/123 HTTP/1.1
Host: example.com
Content-Type: text/plain
Content-Length: 13

Hello, world!
```

هنا، يحدد `Content-Type` نوع MIME للملف (مثل `text/plain`)، و `Content-Length` هو حجم الملف بالبايت. هذه الطريقة فعالة للملفات الكبيرة، لأنها تتجنب حمل الترميز الخاص بـ multipart/form-data، لكنها تتطلب تكوين الخادم للتعامل مع طلبات PUT لرفع الملفات.

##### حالات الاستخدام والاعتبارات
غالبًا ما تُستخدم PUT في سيناريوهات مثل تحديث الصور الرمزية للمستخدمين أو رفع الملفات إلى مورد محدد في واجهة برمجة تطبيقات. ومع ذلك، لا تدعم جميع الخوادم PUT لرفع الملفات افتراضيًا، خاصة في بيئات الاستضافة المشتركة، حيث يكون POST مع multipart/form-data مقبولاً بشكل أكثر عالمية. قد يكون من الضروري تكوين الخادم، مثل تمكين فعل PUT في Apache، كما هو مذكور في [دليل PHP حول دعم طريقة PUT](https://www.php.net/manual/en/features.file-upload.put-method.php).

#### تحليل مقارن

لتوضيح الاختلافات، ضع في اعتبارك الجدول التالي الذي يقارن بين الطريقتين:

| الجانب                  | POST مع Multipart/Form-Data          | PUT مع المحتوى الخام                  |
|-------------------------|----------------------------------------|---------------------------------------|
| **حالة الاستخدام**      | نماذب الويب، ملفات متعددة، بيانات وصفية | واجهات برمجة التطبيقات (RESTful APIs)، تحديث ملف مفرد     |
| **التعقيد**             | أعلى (معالجة الحدود، أجزاء متعددة) | أقل (محتوى مباشر)               |
| **الكفاءة**             | متوسطة (حمل ترميز)           | أعلى (لا يوجد ترميز)                 |
| **دعم الخادم**          | مدعوم على نطاق واسع                      | قد يتطلب تكوين            |
| **رؤوس مثال**     | `Content-Type: multipart/form-data; boundary=abc123` | `Content-Type: text/plain`           |
| **جسم الطلب**        | أجزاء مفصولة بحدود          | محتوى الملف الخام                     |

يسلط هذا الجدول الضوء على أنه بينما تكون multipart/form-data أكثر تنوعًا لتفاعلات الويب، فإن PUT أكثر كفاءة للرفع الموجه بواجهات برمجة التطبيقات، اعتمادًا على قدرات الخادم.

#### تفاصيل التنفيذ والمزالق

##### اختيار الحدود ومحتوى الملف
في multipart/form-data، يعد اختيار سلسلة الحدود أمرًا بالغ الأهمية لتجنب التعارض مع محتوى الملف. إذا ظهرت الحدود داخل الملف، فقد تسبب أخطاء في التحليل. تتولى المكتبات الحديثة هذا عن طريق إنشاء حدود عشوائية، لكن التنفيذ اليدوي يتطلب عناية. بالنسبة للملفات الثنائية، يتم نقل المحتوى كما هو، مع الحفاظ على جميع البايتات، وهو أمر ضروري للحفاظ على سلامة الملف.

##### حجم الملف والأداء
يجب على كلتا الطريقتين مراعاة حدود حجم الملف التي يفرضها الخوادم. يمكن أن تصبح طلبات Multipart/form-data كبيرة مع ملفات متعددة، مما قد يتجاوز حدود الخادم أو يسبب مشاكل في الذاكرة. بينما تكون PUT أبسط، فإنها تتطلب أيضًا التدفق للملفات الكبيرة لتجنب تحميل المحتوى بالكامل في الذاكرة، كما هو موضح في [توثيق HTTPie حول نماذب رفع الملفات](https://httpie.io/docs/cli/file-upload-forms).

##### معالجة الأخطاء والأمان
بعد إرسال الطلب، يجب على العملاء التحقق من رمز حالة HTTP. يُشار إلى النجاح عادةً بـ 200 (OK) أو 201 (Created)، بينما تشير الأخطاء مثل 400 (Bad Request) أو 403 (Forbidden) إلى وجود مشكلات. الأمان أمر بالغ الأهمية، حيث يمكن استغلال رفع الملفات لهجمات مثل رفع ملفات تنفيذية ضارة. يجب على الخوادم التحقق من أنواع الملفات وفحصها بحثًا عن البرامج الضارة وتقييد مجلدات التحميل، كما هو موضح في [مناقشات Stack Overflow حول أمان رفع الملفات عبر HTTP](https://stackoverflow.com/questions/8659808/how-does-http-file-upload-work).

#### أمثلة عملية عبر اللغات

توفر لغات البرمجة المختلفة مكتبات لتبسيط رفع الملفات عبر HTTP. على سبيل المثال، تعالج مكتبة `requests` في Python multipart/form-data باستخدام:

```python
import requests
files = {'file': open('example.txt', 'rb')}
response = requests.post('https://example.com/upload', files=files)
```

بالنسبة لـ PUT، يمكن استخدام curl كما هو موضح في [Stack Overflow حول اختبار رفع PUT](https://stackoverflow.com/questions/5143915/test-file-upload-using-http-put-method):

```bash
curl -X PUT "https://example.com/files/123" --upload-file example.txt
```

توضح هذه الأمثلة التجريد، لكن فهم بنية HTTP الأساسية أمر بالغ الأهمية لاستكشاف الأخطاء وإصلاحها والتنفيذ المخصص.

#### خاتمة

باختصار، يمكن تحقيق رفع الملفات عبر HTTP من خلال POST مع multipart/form-data لتفاعلات نماذب الويب متعددة الاستخدامات أو PUT لتحديثات واجهات برمجة التطبيقات الفعالة، لكل منها مزايا ومتطلبات مميزة. يعد تكوين الخادم وحجم الملف والاعتبارات الأمنية أمرًا بالغ الأهمية لضمان تنفيذ قوي. لمزيد من القراءة، استكشف [دليل Medium حول رفع الملفات باستخدام POST](https://medium.com/@API4AI/post-a-file-via-http-request-the-ultimate-guide-b23fb70a3f73) للحصول على أمثلة عملية عبر اللغات.

### الاقتباسات الرئيسية
- [How do you upload your files to a web server Learn web development MDN](https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Tools_and_setup/Upload_files_to_a_web_server)
- [How does HTTP file upload work Stack Overflow](https://stackoverflow.com/questions/8659808/how-does-http-file-upload-work)
- [POST a File via HTTP Request The Ultimate Guide by API4AI Medium](https://medium.com/@API4AI/post-a-file-via-http-request-the-ultimate-guide-b23fb70a3f73)
- [HTTP REST API File Uploads Phil Sturgeon](https://philsturgeon.com/http-rest-api-file-uploads/)
- [PHP PUT method support Manual](https://www.php.net/manual/en/features.file-upload.put-method.php)
- [curl Test file upload using HTTP PUT method Stack Overflow](https://stackoverflow.com/questions/5143915/test-file-upload-using-http-put-method)
- [File upload forms HTTPie 3.2.4 latest docs](https://httpie.io/docs/cli/file-upload-forms)