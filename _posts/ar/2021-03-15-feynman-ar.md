---
audio: false
generated: false
lang: ar
layout: post
title: 'mathjax2mobi: ุชุญููู MathJax HTML ุฅูู ูุชุจ ุฅููุชุฑูููุฉ'
translated: true
---

### ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

ุฏุนููุง ุฃููุงู ูููู ูุธุฑุฉ ุนุงูุฉ ุนูู ุญุงูุฉ ุงููุดุฑูุน.

![ูุงูููุงู_ุฃูููุงูู](assets/images/feynman/feynman_online.jpg)

<img src="/assets/images/feynman/change.JPG" alt="ุงูุชุบููุฑ" style="zoom:50%;" />

![ููุงุชูููุณ](assets/images/feynman/latex.JPG)

![epub_black](assets/images/feynman/epub_black.JPG)

![epub_beautiful](assets/images/feynman/epub_beautiful.JPG)

ุจุนุฏ ุงูุงูุชูุงุก ูู ุงููุดุฑูุนุ ุดุนุฑุช ุจุจุนุถ ุงูุณุนุงุฏุฉ. ูุชุจุช ูุฐู ุงูุฌููุฉ.

ูุชุจุช ุงูููุฏ ุทูุงู ุงููููุ ูุฃุฎูุฑูุง ุญุตูุช ุนูู ูุชุงุจ ุฅููุชุฑููู ุฌููู ููุญุงุถุฑุงุช ููุฒูุงุก ูุงูููุงู! ูุญุงุถุฑุงุช ููุฒูุงุก ูุงูููุงู ูุชุงุญุฉ ุนูู ุงูุฅูุชุฑูุชุ ููู ููุชูุจุฉ ุจุงุณุชุฎุฏุงู `latex` ุงูุฐู ูุชููุฒ ุจุนุฑุถ ุฑุงุฆุน ูููุนุงุฏูุงุช ุงูุฑูุงุถูุฉ. ูุนูุฏูุง ูุชู ูุดุฑูุง ุนูู ุงูุฅูุชุฑูุชุ ูุชู ุงุณุชุฎุฏุงู ููุชุจุฉ `mathjax` ูุชุญููู ููุฏ `latex` ุฅูู ููุฏ `html`ุ ููุง ููุชุฌ ุนูู ุงููุซูุฑ ูู ุนูุงูุงุช `div` ู `span`. ููู ุงููุชุจ ุงูุฅููุชุฑูููุฉ ูุง ุชุฏุนู ูุฐู ุงูุทุฑููุฉ. ูุฐุงุ ูุงูุช ุงูููุฑุฉ ูู ุงุณุชุฎุฑุงุฌ ุตูุญุงุช ุงูููุจุ ูุนูุณ ุนูููุฉ ุนุฑุถ `mathjax`ุ ุซู ุงุณุชุจุฏุงููุง ุจุตูุฑ `svg`. ูุงุฌูุช ุงูุนุฏูุฏ ูู ุงููุดุงููุ ุฃูููุง ุฃู ุงูููุฏ ูุญุชูู ุนูู ุงููุซูุฑ ูู ูุญุฏุงุช `latex` ุงููุฎุตุตุฉ ุงูุชู ูุฌุจ ุฅุถุงูุชูุงุ ูุซุงูููุงุ ุฃู ุชุถููู ุงููุซูุฑ ูู ุตูุฑ `svg` ูุณุจุจ ูุดุงูู. ุฅุฐุง ูุงูุช ุงูุตูุฑุฉ ูุงุญุฏุฉ ููุง ูุดููุฉุ ูููู ุนูุฏ ูุฌูุฏ ุงููุซูุฑ ูููุง ุชุธูุฑ ูุดุงูู. ุฑุจูุง ูููู ูุฐุง ุจุณุจุจ ุจุนุถ ุงูุฃุฎุทุงุก ุงูุบุฑูุจุฉ ูู ุงููุชุตูุญุงุช ู `svg`. ุงูุญู ูุงู ุจุจุณุงุทุฉ ุญูุธ `svg` ููููุงุช ูุงุณุชุฎุฏุงู ุนูุงูุฉ `img` ูุฅุฏุฑุงุฌูุง. ุงููุนุงุฏูุงุช ุฃูุถูุง ุชููุณู ุฅูู ููุนูู: ูุนุงุฏูุงุช ุฏุงุฎู ุงููุต ููุนุงุฏูุงุช ูููุฑุฏุฉ ูู ุณุทุฑ ุฎุงุต. ูููุฐุงุ ุญุตูุช ุฃุฎูุฑูุง ุนูู ูุชุงุจ ุฅููุชุฑููู ุฌููู!

### ุงูุจูุงูุงุช ุงูุชู ุชู ุงูุจุญุซ ุนููุง

ููุง ูุชู ุชุณุฌูู ุงูููุงุฏ ุงูุชู ุชู ุงููุตูู ุฅูููุง ุฃุซูุงุก ุญู ุงููุดุฑูุน. ูุธุฑูุง ูุฃู ูุฐุง ุจุฑูุงูุฌ ุชุนููููุ ูุณุฃุนุฑุถ ููุทูุงุจ ุชุฌุฑุจุฉ ููููุฉ ุชูููุฐ ูุดุฑูุน ุจุดูู ุนุงู.

![](assets/images/feynman/s1.PNG)

![](assets/images/feynman/s2.PNG)

![](assets/images/feynman/s3.PNG)

![](assets/images/feynman/s4.PNG)

![](assets/images/feynman/s5.PNG)

![](assets/images/feynman/s6.PNG)

![](assets/images/feynman/s7.PNG)

![](assets/images/feynman/s8.PNG)

### ุจุฏุก ุงููุดุฑูุน

ูุญุงุถุฑุงุช ููููุงู ูู ุงูููุฒูุงุก ุฃุตุจุญุช ูุชุงุญุฉ ูููุฑุงุกุฉ ุนูู ุงูุฅูุชุฑูุช. ุฃุฑุบุจ ูู ูุฑุงุกุชูุง ุนูู ุฌูุงุฒ `Kindle`. ููุน ุฐููุ ูุธุฑูุง ูุงุญุชูุงุฆูุง ุนูู ุงูุนุฏูุฏ ูู ุงูุตูุบ ุงูุฑูุงุถูุฉุ ูุฅู ุงููุณูุฏุฉ ุงูุฃุตููุฉ ุฑุจูุง ุชู ุฅุนุฏุงุฏูุง ุจุงุณุชุฎุฏุงู `latex`. ูุชู ุงุณุชุฎุฏุงู ููุชุจุฉ `mathjax` ูุนุฑุถ ูุญุชูู ุจุชูุณูู `latex` ุนูู ุตูุญุงุช ุงูููุจ.

ููุฃุฎุฐ ูุซุงููุง.

```html
<span class="MathJax_Preview" style="color: inherit; display: none;">
</span>
<div class="MathJax_Display">
    <span class="MathJax MathJax_FullWidth" id="MathJax-Element-10-Frame" tabindex="0" style="">
              <span class="mi" id="MathJax-Span-159" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;">
                </span>  
    </span>
</div>
<script type="math/tex; mode=display" id="MathJax-Element-10">\begin{equation}
\label{Eq:I:13:3}
dT/dt = Fv.
\end{equation}
</script>
```

ูู ุงูุฃุนูู ููุชุทู ูู ููุฏ `html`. ูู ูุฐุง ุงูุฌุฒุก ูู ููุฏ `html`ุ ููุฌุฏ ูุต `latex` ููุง ูู ุชุญุช ุนูุงูุฉ `script`. ูููู `mathjax` ุจุชุญูููู ุฅูู ุงูุนุฏูุฏ ูู ุนูุงูุงุช `span` ูุนุฑุถู.

ูุฏููุง ุงูุขู ููุฑุฉ. ููู ุชุบููุฑ ุทุฑููุฉ ุนุฑุถ `mathjax` ุฅูู ุตูุฑ `svg`.

ูุฌุฏุช ูุดุฑูุนูุง ุนูู GitHub ุจุงุณู `tuxu/latex2svg`.

```python
from latex2svg import latex2svg
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])
```

ุญุงููุช ุงูุชุดุบููุ ููู ุญุฏุซ ุฎุทุฃ.

```shell
    raise RuntimeError('latex not found')
RuntimeError: latex not found
```

ุงูุธุฑ ุฅูู ุงูููุฏ.

```python
    # ุชุดุบูู LaTeX ูุฅูุดุงุก ููู DVI
    try:
        ret = subprocess.run(shlex.split(params['latex_cmd']+' code.tex'),
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                             cwd=working_directory)
        ret.check_returncode()
    except FileNotFoundError:
        raise RuntimeError('latex ุบูุฑ ููุฌูุฏ')
```

ูุจุฏู ุฃู ูุฐุง ูุนุชูุฏ ุฃูุถูุง ุนูู ุฃูุฑ `latex`.

ูู ุจุงูุชุซุจูุช.

```shell
brew install --cask mactex
==> ููุงุญุธุงุช
ูุฌุจ ุนููู ุฅุนุงุฏุฉ ุชุดุบูู ูุงูุฐุฉ ุงูุทุฑููุฉ ุงูุฎุงุตุฉ ุจู ุญุชู ูุชู ุชูุนูู ุชุซุจูุช ุฃุฏูุงุช MacTex CLI.
ุจุฏูุงู ูู ุฐููุ ูููู ููุณุชุฎุฏูู Bash ู Zsh ุชุดุบูู ุงูุฃูุฑ:
  eval "$(/usr/libexec/path_helper)"
==> ุฌุงุฑู ุงูุชุญููู http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
==> ุฌุงุฑู ุงูุชุญููู ูู https://mirrors.aliyun.com/CTAN/systems/mac/mactex/mactex-20200407.pkg
######################################################################## 100.0%
ุชู ุชูุจูุฉ ุฌููุน ุชุจุนูุงุช ุงูุตูุบุฉ.
==> ุฌุงุฑู ุชุซุจูุช Cask mactex
==> ุฌุงุฑู ุชุดุบูู ุงููุซุจุช ูู mactexุ ูุฏ ููุฒู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู.
installer: ุงุณู ุงูุญุฒูุฉ ูู MacTeX
installer: ุชู ุชุทุจูู ููู ุชุบููุฑุงุช ุงูุงุฎุชูุงุฑุงุช '/private/tmp/choices20210315-4643-5884ro.xml'
installer: ุฌุงุฑู ุงูุชุซุจูุช ูู ุงููุณุงุฑ ุงูุฃุณุงุณู /
installer: ุชู ุงูุชุซุจูุช ุจูุฌุงุญ.
๐บ  ุชู ุชุซุจูุช mactex ุจูุฌุงุญ!
```

ุชู ุงูุชุซุจูุช ุจูุฌุงุญ.

```shell
% latex
ูุฐุง ูู pdfTeXุ ุงูุฅุตุฏุงุฑ 3.14159265-2.6-1.40.21 (TeX Live 2020) (ุชูุณูู ูุณุจู ุงูุชุญููู=latex)
 ุชู ุชูููู \write18 ุงููููุฏ.
**
```

```python
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])
```

ูู ุงูููุฏ ุฃุนูุงูุ ูุชู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ `latex2svg` ูุชุญููู ุงูุชุนุจูุฑ ุงูุฑูุงุถู \( e^{i \pi} + 1 = 0 \) ุฅูู ุตูุบุฉ SVG. ุจุนุฏ ุฐููุ ูุชู ุทุจุงุนุฉ ุนูู ุงูุตูุฑุฉ (`depth`) ูุฑูุฒ SVG ุงููุงุชุฌ (`svg`).

```python
svg = open('1.svg', 'w')
svg.write(out['svg'])
svg.close()
```

ูููู ุงูุขู ุฅูุดุงุก ูููุงุช `svg`.

ูุฐุงุ ุฌุฑุจ ุฅูุดุงุก ูุต `latex` ุงูุฐู ุชุญุตู ุนููู ูู `mathjax`.

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg
```

```python
file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
content = file.read()
```

```python
soup = BeautifulSoup(content)
```

```python
mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    out = latex2svg(mathjax.string)
    print(out['svg'])
```

ููุฃุณู ุญุฏุซ ุฎุทุฃ.

```python
    raise CalledProcessError(self.returncode, self.args, self.stdout,
subprocess.CalledProcessError: ุงูุฃูุฑ '['latex', '-interaction', 'nonstopmode', '-halt-on-error', 'code.tex']' ุฃุนุงุฏ ุญุงูุฉ ุฎุฑูุฌ ุบูุฑ ุตูุฑูุฉ 1.
```

ุฃู ุตูุบุฉ ูุญุฏุฏุฉ ูุงูุช ุฎุงุทุฆุฉุ

```latex
\tfrac{1}{2}mv^2
```

## ูุงุชููุณ

ูุงุชููุณ (LaTeX) ูู ูุธุงู ูุฅุนุฏุงุฏ ุงููุณุชูุฏุงุช ุนุงููุฉ ุงูุฌูุฏุฉุ ูุณุชุฎุฏู ุจุดูู ุดุงุฆุน ูู ุงูุฃูุณุงุท ุงูุฃูุงุฏูููุฉ ูุงูุนูููุฉ ูุฅูุชุงุฌ ุฃูุฑุงู ุจุญุซูุฉ ููุชุจ ูุนุฑูุถ ุชูุฏูููุฉ. ูุชููุฒ ูุงุชููุณ ุจูุฏุฑุชู ุนูู ุงูุชุนุงูู ูุน ุงููุนุงุฏูุงุช ุงูุฑูุงุถูุฉ ุงููุนูุฏุฉ ูุงูุฑููุฒ ุงูุนูููุฉ ุจุณูููุฉุ ููุง ูุฌุนูู ุงูุฎูุงุฑ ุงูููุถู ููุนุฏูุฏ ูู ุงูุจุงุญุซูู ูุงูุทูุงุจ.

### ูุซุงู ุจุณูุท ูู ูุงุชููุณ

```latex
\documentclass{article}
\usepackage[utf8]{inputenc}

\title{ุนููุงู ุงููุณุชูุฏ}
\author{ุงุณู ุงููุคูู}
\date{\today}

\begin{document}

\maketitle

\section{ููุฏูุฉ}
ูุฐุง ูุซุงู ุจุณูุท ููุณุชูุฏ ูุงุชููุณ. ููููู ูุชุงุจุฉ ุงููุตูุต ูุฅุถุงูุฉ ุงููุนุงุฏูุงุช ุงูุฑูุงุถูุฉ ุจุณูููุฉ.

\section{ูุนุงุฏูุฉ ุฑูุงุถูุฉ}
ููุง ูุนุงุฏูุฉ ุฑูุงุถูุฉ ุจุณูุทุฉ:

\[
E = mc^2
\]

\end{document}
```

ูู ูุฐุง ุงููุซุงูุ ูุชู ุฅูุดุงุก ูุณุชูุฏ ุจุณูุท ูุญุชูู ุนูู ุนููุงู ูููุฏูุฉ ููุนุงุฏูุฉ ุฑูุงุถูุฉ. ููููู ุชุนุฏูู ุงููุตูุต ูุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฃูุณุงู ุญุณุจ ุงูุญุงุฌุฉ.

ููุชุนูู `latex`.

```latex
\documentclass[12pt]{article}
\usepackage{lingmacros}
\usepackage{tree-dvips}
\begin{document}
```

\section*{ููุงุญุธุงุช ุญูู ูุฑูุฉ ุงูุจุญุซ ุงูุฎุงุตุฉ ุจู}

ูุง ุชูุณู ุชุถููู ุฃูุซูุฉ ุนูู ุงูุชุฎุตูุต ุงูููุถุนู.  
ุชุจุฏู ููุฐุง:

{\small
\enumsentence{ุงูุชุฑููุฒ ูู ุฎูุงู ุงูููุถูุน ุงูุฌููุฉ:\\
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
{ & {\bf R-}clear & {\sc comp} & 
  {\bf IR}.{\sc 3s}-love   & P & him & }
{ุฌููุ (ูู) ุงููุงุถุญ ุฃู ูุงุฑู ุชุญุจู.}}
}

\subsection*{ููููุฉ ุงูุชุนุงูู ูุน ุงูุชูุจููุงูุงูุฒูุดู (ุงูุชุฑููุฒ ุนูู ููุถูุน ุงูุฌููุฉ)}

ุณุฃูุชุฑุถ ุจุจุณุงุทุฉ ุจููุฉ ุดุฌุฑุฉ ูุซู (\ex{1}).

{\small
\enumsentence{ูููู ุฅุณูุงุทุงุช A$'$:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
}

\subsection*{ุงููุฒุงุฌ}

ูุชุบูุฑ ุงููุฒุงุฌ ุนูุฏูุง ูููู ููุงู ููุถูุนุ ููุฐูู ุนูุฏูุง ูููู ููุงู ุญุฑูุฉ WH. \emph{Irrealis} ูู ุงููุฒุงุฌ ุนูุฏูุง ูููู ููุงู ููุถูุน ุบูุฑ ูุงุนู ุฃู ุนุจุงุฑุฉ WH ูู Comp. \emph{Realis} ูู ุงููุฒุงุฌ ุนูุฏูุง ูููู ููุงู ููุถูุน ูุงุนู ุฃู ุนุจุงุฑุฉ WH.

```latex
\end{document}
```

ุนุซุฑุช ุนูู ูููุฐุฌ ูุดูุฑุฉ `latex` ุนูู ุงูุฅูุชุฑูุช.

```shell
% latex code.tex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=latex)
 restricted \write18 enabled.
entering extended mode
(./code.tex
LaTeX2e <2020-02-02> patch level 5
L3 programming layer <2020-03-06>
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/size12.clo))
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/lingmacros.sty)
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/tree-dvips.sty
tree-dvips version .91 of May 16, 1995
) (/usr/local/texlive/2020/texmf-dist/tex/latex/l3backend/l3backend-dvips.def)
(./code.aux) [1] (./code.aux) )
Output written on code.dvi (1 page, 3416 bytes).
Transcript written on code.log.
```

![latex](assets/images/feynman/latex.png)

ููููู ูุธุฑุฉ ุนูู ุงูููุฏ ุงููุตุฏุฑู ูุงููุชูุฌุฉ ุงูููุฏูุฉ ุจุนุฏ ุงูุชุตููุฑุ ููุฑู ูุง ูููููุง ุชุนููู.

```latex
\begin{document}
\end{document}
```

ููุฐุง ูุชู ุชุบููู ุงููุณุชูุฏ.

```latex
\section*{ููุงุญุธุงุช ููุฑูุชู ุงูุจุญุซูุฉ}
```

ูุฐุง ูุดูุฑ ุฅูู ุจุฏุงูุฉ ุนููุงู `section`.

```latex
\subsection*{ููููุฉ ุงูุชุนุงูู ูุน ุงูุชูุจููุงููุฒูุดู (ุงูุชุฑููุฒ ุนูู ุงูููุถูุน)}
```

ูุฐุง ูุดูุฑ ุฅูู ุงูุนููุงู ุงููุฑุนู.

```latex
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
```

![shortex](assets/images/feynman/shortex.png)

ูููู ุงุณุชุฎุฏุงู `$_i$` ูุชูุซูู ุงูุญุฑูู ุงูุณูููุฉ. ูุงุณุชุฎุฏุงู `{\bf l-}` ูุชูุซูู ุงููุต ุงูุบุงูู.

```latex
\enumsentence{ูููู ุฅุณูุงุทุงุช A$'$:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
```

<img src="/assets/images/feynman/node.png" alt="node" style="zoom:50%;" />

ูุงุญุธ ุงุณุชุฎุฏุงู `nodeconnect` ููุฅุดุงุฑุฉ ุฅูู ุงูุงุชุตุงู ุจูู ุงูุนูุฏ.

### ุชุญููู LaTeX ุฅูู SVG

ูุชุญููู ูุนุงุฏูุงุช LaTeX ุฅูู ุตูุฑ ุจุชูุณูู SVGุ ููููู ุงุณุชุฎุฏุงู ุฃุฏูุงุช ูุฎุชููุฉ. ูููุง ููู ุจุนุถ ุงูุทุฑู ุงูุดุงุฆุนุฉ:

#### 1. ุงุณุชุฎุฏุงู `MathJax` ูุน `svg` ูุชูุณูู ุฅุฎุฑุงุฌ
ููููู ุงุณุชุฎุฏุงู `MathJax` ูุชุญููู ูุนุงุฏูุงุช LaTeX ุฅูู SVG ูุจุงุดุฑุฉ ูู ุงููุชุตูุญ. ุฅููู ูุซุงู ุจุณูุท:

```html
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
```

ุซู ููููู ูุชุงุจุฉ ูุนุงุฏูุงุช LaTeX ุฏุงุฎู ุนูุงุตุฑ `script` ูู ููุน `math/tex`:

```html
<script type="math/tex">E = mc^2</script>
```

#### 2. ุงุณุชุฎุฏุงู `LaTeX` ูุน `dvisvgm`
ุฅุฐุง ููุช ุชุฑูุฏ ุชุญููู ูููุงุช LaTeX ุฅูู SVG ูุญูููุงุ ููููู ุงุณุชุฎุฏุงู `dvisvgm`. ุฃููุงูุ ูู ุจุชุญููู ููู LaTeX ุฅูู DVI ุจุงุณุชุฎุฏุงู `latex`:

```bash
latex input.tex
```

ุซู ูู ุจุชุญููู ููู DVI ุฅูู SVG ุจุงุณุชุฎุฏุงู `dvisvgm`:

```bash
dvisvgm input.dvi
```

#### 3. ุงุณุชุฎุฏุงู `pandoc` ูุน `MathJax`
ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู `pandoc` ูุชุญููู ูุณุชูุฏุงุช LaTeX ุฅูู HTML ูุน ูุนุงุฏูุงุช SVG:

```bash
pandoc input.tex -o output.html --mathjax
```

#### 4. ุงุณุชุฎุฏุงู `MathJax-Node`
ุฅุฐุง ููุช ุชุฑูุฏ ุชุญููู ูุนุงุฏูุงุช LaTeX ุฅูู SVG ุจุฑูุฌููุง ุจุงุณุชุฎุฏุงู Node.jsุ ููููู ุงุณุชุฎุฏุงู `mathjax-node`:

```bash
npm install mathjax-node
```

ุซู ููููู ุงุณุชุฎุฏุงู ุงูููุฏ ุงูุชุงูู ูุชุญููู ูุนุงุฏูุฉ LaTeX ุฅูู SVG:

```javascript
const mjAPI = require("mathjax-node");
mjAPI.config({
  MathJax: {
    svg: {
      fontCache: 'global'
    }
  }
});
mjAPI.start();

mjAPI.typeset({
  math: 'E = mc^2',
  format: 'TeX',
  svg: true,
}, function (data) {
  if (!data.errors) {
    console.log(data.svg);
  }
});
```

ูุฐู ุจุนุถ ุงูุทุฑู ุงูุดุงุฆุนุฉ ูุชุญููู ูุนุงุฏูุงุช LaTeX ุฅูู SVG. ููููู ุงุฎุชูุงุฑ ุงูุทุฑููุฉ ุงูุชู ุชูุงุณุจ ุงุญุชูุงุฌุงุชู ุจูุงุกู ุนูู ุงูุจูุฆุฉ ุงูุชู ุชุนูู ูููุง.

ุงุณุชูุฑุงุฑ ุงููุดุฑูุน.

```latex
\documentclass[16pt]{article}
\usepackage{amsmath}
\begin{document}
```

\[\tfrac{1}{2}mv^2\]

```latex
\end{document}
```

<img src="/assets/images/feynman/frac.png" alt="frac" style="zoom:50%;" />

ูุฐุง ูููู ุฃู ูุชู ุนุฑุถู ุจุดูู ุตุญูุญ. ูู ุงูููุฏุ ูุฏ ูุง ูุชู ุนุฑุถู ุจุดูู ุตุญูุญุ ุฑุจูุง ูุฃูู ูู ูุชู ุฅุถุงูุฉ `\usepackage{amsmath}`.

```latex
\documentclass[12pt,preview]{standalone}
```

```latex
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}
```

```latex
\begin{document}
\begin{preview}
\tfrac{1}{2}mv^2
\end{preview}
\end{document}
```

```shell
! ุชู ุฅุฏุฎุงู ุนูุงูุฉ $ ููููุฏุฉ.
<ุงููุต ุงูููุฏุฎู>
                $
l.12 \tfrac{1}{2}
                 mv^2
```

ูุฐุง ุฎุทุฃ. ูุจุนุฏ ุงูุชุนุฏูู ุฅูู ูุง ูููุ ุณูุนูู ุจุดูู ุตุญูุญ.

```latex
\[\tfrac{1}{2}mv^2\]
```

ูุฐุง ุงูุชุนุจูุฑ ุงูุฑูุงุถู ููุซู ุงูุทุงูุฉ ุงูุญุฑููุฉ ูุฌุณู ูุงุ ุญูุซ:
- \( m \) ูู ูุชูุฉ ุงูุฌุณู.
- \( v \) ูู ุณุฑุนุฉ ุงูุฌุณู.
- \(\tfrac{1}{2}mv^2\) ูู ุงูุทุงูุฉ ุงูุญุฑููุฉ ููุฌุณู.

ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ูุฎุชููุฉ.

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg
```

```python
file = open('The Feynman Lectures on Physics Vol. I Ch. 13: Work and Potential Energy (A).html')
content = file.read()
```

```python
soup = BeautifulSoup(content, features="lxml")
```

```python
mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    wrap = '$' + mathjax.string + '$'
    # ุฅุฐุง ูุงูุช 'frac' ููุฌูุฏุฉ ูู ุงููุต ุงูุฑูุงุถู
    # wrap = '$' + mathjax.string + '$'
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
    out = latex2svg(wrap)
    # ุทุจุงุนุฉ ุงููุงุชุฌ
    node = BeautifulSoup(out['svg'], features="lxml")
    svg = node.find('svg')
    mathjax.insert_after(svg)
    # ุทุจุงุนุฉ SVG ุงููุงุชุฌ
    # break
    # mathjax.replaceWith(out['svg'])    
    
    # ุทุจุงุนุฉ ุฎุตุงุฆุต mathjax
    # break
    
    # out = latex2svg(wrap)    
    # ุทุจุงุนุฉ SVG ุงููุงุชุฌ
```

```python
# ุทุจุงุนุฉ ุนุฏุฏ ุงูุนูุงุตุฑ ุฏุงุฎู soup
print(len(soup.contents))

# ูุชุญ ููู ุงูุฅุฎุฑุงุฌ ูููุชุงุจุฉ
output_file = open('out.html', 'w')
# ูุชุงุจุฉ ุงููุญุชูู ุงูููุณู ูู soup ูู ุงูููู
output_file.write(soup.prettify())
# ุฅุบูุงู ุงูููู ุจุนุฏ ุงูุงูุชูุงุก ูู ุงููุชุงุจุฉ
output_file.close()

# ุทุจุงุนุฉ ูุญุชููุงุช soup (ูุนููู)
# print(soup.contents)
```

```python
# out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])
```

ูู ุงูููุฏ ุฃุนูุงูุ ูุชู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ `latex2svg` ูุชุญููู ูุนุงุฏูุฉ ูุงุชููุณ ุฅูู ุตูุบุฉ SVG. ูุชู ุชูุฑูุฑ ุงููุนุงุฏูุฉ \( e^{i \pi} + 1 = 0 \) ูุณูุณูุฉ ูุตูุฉ ุฅูู ุงูุฏุงูุฉ. ุงููุงุชุฌ `out` ูู ูุงููุณ ูุญุชูู ุนูู ูุนูููุงุช ุญูู ุงูุตูุฑุฉ ุงููุงุชุฌุฉุ ุจูุง ูู ุฐูู ุงูุนูู (`depth`) ูุงูุตูุบุฉ SVG (`svg`). ูุชู ุทุจุงุนุฉ ูุฐู ุงูููู ุจุงุณุชุฎุฏุงู `print`.

```python
# svg = open('1.svg', 'w')
# svg.write(out['svg'])
# svg.close()
```

```

ุฃูุง ุฃุฎุชุจุฑ ูู ูุฐู ุงูุฃุดูุงุก ูุฃู ุณุจุจุ

```python
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
```

ุชู ุงูุงุญุชูุงุธ ุจุงูููุฏ ููุง ูู ูุฃูู ูุญุชูู ุนูู ุฃุณูุงุก ูุชุบูุฑุงุช ูุดุฑูุท ููุทููุฉ ูุง ุชุญุชุงุฌ ุฅูู ุชุฑุฌูุฉ.

ููุง ุนูุฏ ุงูุชุญููู ุฅูู ูุฌูุฏ `FLP` ู`Fig` ู`eps` ูู ูุตุฏุฑ `latex`ุ ุญุฏุซ ุฎุทุฃ ูู ุนูููุฉ ุงูุชุญููู.

ุนูู ุณุจูู ุงููุซุงูุ ูู `HTML`ุ ูุฏ ุชุฌุฏ ูุตูุง ุจุฑูุฌููุง ูุซู ูุฐุง:

```html
<script type="math/tex" id="MathJax-Element-11">\FLPF\cdot\FLPv</script>
```

ุชุญููู ุงูุญุตูู ุนูู:

```latex
\FLPF\cdot\FLPv
```

**ููุงุญุธุฉ:** ุงููุต ุงูููุฌูุฏ ูู ุงูููุฏ ูู ุฑูุฒ ุฑูุงุถู ูุณุชุฎุฏู ูู ูุบุฉ LaTeX ูุชูุซูู ุงูุถุฑุจ ุงูููุทู ุจูู ูุชุฌู ุงูููุฉ \(\FLPF\) ููุชุฌู ุงูุณุฑุนุฉ \(\FLPv\). ูุง ูุชู ุชุฑุฌูุฉ ุงูุฑููุฒ ุงูุฑูุงุถูุฉ ุฃู ุงูุฃููุงุฏ ุงูุจุฑูุฌูุฉ.

ุนูุฏูุง ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุญููู ูู ุงูููุฏ. ุฃู ุฃู `latex2svg.py` ูุฏ ูุดู. ููุง ูุชู ุงุณุชุฎุฏุงู ุจุฑูุงูุฌ `latex` ูุฅุฌุฑุงุก ุงูุชุญููู.

```tex
\documentclass{article}
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}

\begin{document}

\begin{lstlisting}[language=Python]
def hello_world():
    print("Hello, world!")
\end{lstlisting}

\end{document}
```

```latex
\documentclass[12pt,preview]{standalone}
```

```latex
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}
```

```latex
\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}
```

```shell
$latex code.tex
! ุชุณูุณู ุชุญูู ุบูุฑ ูุนุฑูู.
l.13     \FLPF
              \cdot\FLPv
ุ
```

ูุง ูู ูุฐู ุงููุดููุฉ ุจุงูุชุญุฏูุฏ. ูุงุญุธุช ูุงุญููุง ูุฐุง ุงูุฌุฒุก ูู ุงูููุฏ ูู `html`.

```html
<script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
        TeX: {
          Macros: {
            FLPvec: ["\\boldsymbol{#1}", 1], 
            Figvec: ["\\mathbf{#1}", 1], 
            FLPC: ["\\FLPvec{C}", 0], 
            FLPF: ["\\FLPvec{F}", 0], 
            FLPa: ["\\FLPvec{a}", 0], 
            FLPb: ["\\FLPvec{b}", 0], 
            FLPr: ["\\FLPvec{r}", 0], 
            FLPs: ["\\FLPvec{s}", 0], 
            FLPv: ["\\FLPvec{v}", 0], 
            ddt: ["\\frac{d#1}{d#2}", 2], 
            epsO: ["\\epsilon_0", 0], 
            FigC: ["\\Figvec{C}", 0]
          }
        }
      });
</script>
```

ูุฐุง ูุนูู ุฃูู ุนูุฏ ุนุฑุถ ุงูุตูุญุฉุ ุชู ุชุนููู ูุญุฏุงุช ุงููุงูุฑู ูู `MathJax`. ูุฐูู ูุฌุจ ุนูููุง ุฃูุถูุง ุฅุถุงูุชูุง ูู ููุฏ ุชุญููู `latex`. ุฏุนูุง ูุถูููุง.

```latex
\documentclass[12pt,preview]{standalone}
```

```latex
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}
```

\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}
```

ูุฐุง ุตุญูุญ.

![fv1](assets/images/feynman/fv1.png)

### ุชุญููู ุงูููุฏ

ููููู ูุธุฑุฉ ุนูู ุงูููุฏ ุงูููุงุฆู.

```python
import subprocess
from bs4 import BeautifulSoup
from latex2svg import latex2svg
```

```python
def clean_mathjax(soup, name, cls):
    previews = soup.findAll(name, {'class': cls})
    for preview in previews:
        preview.decompose()
        
def clean_script(soup):
    scripts = soup.findAll('script')
    for s in scripts:
        s.decompose()    
```

```python
def wrap_latex(mathjax, equation = False):
    wrap = ''
    if equation:
        wrap = mathjax.string
    else:
        wrap = '$' + mathjax.string + '$'
    wrap = wrap.replace('label', 'tag')
    return wrap
 
def wrap_svg(svg, equation):
    if equation:
        p = BeautifulSoup(f'<div style="text-align:center;"></div>', features="lxml")
        p.div.append(svg)
        return p.div
    else:
        return svg
```

```python
def to_svg(mathjaxs, equation=False):
    if equation:
        svg_prefix = 'eq_'
    else:
        svg_prefix = 'in_'
    i = 0
    for mathjax in mathjaxs:     
        print(mathjax.string)
        wrap = wrap_latex(mathjax, equation=equation)   
        out = {}
        try:
            out = latex2svg(wrap)   
        except subprocess.CalledProcessError as err:
            raise err      
            
        f = open(f'svgs/{svg_prefix}{i}.svg', 'w')
        f.write(out['svg'])
        f.close()
        
        node = BeautifulSoup('<img>', features="lxml")
        img = node.find('img')
        img.attrs['src'] = f'./svgs/{svg_prefix}{i}.svg'
        img.attrs['style'] = 'vertical-align: middle; margin: 0.5em 0;'
        
        p = wrap_svg(img, equation)
        mathjax.insert_after(p)
        i +=1
```

ุชุฑุฌูุฉ ุงูููุฏ ุฃุนูุงู:

```python
def to_svg(mathjaxs, equation=False):
    if equation:
        svg_prefix = 'eq_'
    else:
        svg_prefix = 'in_'
    i = 0
    for mathjax in mathjaxs:     
        print(mathjax.string)
        wrap = wrap_latex(mathjax, equation=equation)   
        out = {}
        try:
            out = latex2svg(wrap)   
        except subprocess.CalledProcessError as err:
            raise err      
            
        f = open(f'svgs/{svg_prefix}{i}.svg', 'w')
        f.write(out['svg'])
        f.close()
        
        node = BeautifulSoup('<img>', features="lxml")
        img = node.find('img')
        img.attrs['src'] = f'./svgs/{svg_prefix}{i}.svg'
        img.attrs['style'] = 'vertical-align: middle; margin: 0.5em 0;'
        
        p = wrap_svg(img, equation)
        mathjax.insert_after(p)
        i +=1
```

ููุงุญุธุฉ: ุงูููุฏ ูุจุฏู ุฃูู ูููู ุจุชุญููู ูุนุงุฏูุงุช LaTeX ุฅูู ุตูุฑ SVG ูุญูุธูุง ูู ูููุงุชุ ุซู ุฅุฏุฑุงุฌูุง ูู ูุณุชูุฏ HTML ุจุงุณุชุฎุฏุงู BeautifulSoup. ุงูุชุฑุฌูุฉ ุงูุญุฑููุฉ ููููุฏ ูุง ุชุบูุฑ ูู ูุธููุชูุ ูุฐุง ุชู ุชุฑู ุงูููุฏ ููุง ูู ูุน ุดุฑุญ ุจุณูุท ูููุธููุฉ.

```python
def main():    
    file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
    content = file.read()
    
    soup = BeautifulSoup(content, features="lxml")
    clean_mathjax(soup, 'span', 'MathJax')
    clean_mathjax(soup, 'div', 'MathJax_Display')
    clean_mathjax(soup, 'span', 'MathJax_Preview')
    
    mathjaxs = soup.findAll('script', {'type': 'math/tex'})
    to_svg(mathjaxs, equation=False)
    
    mathjaxs = soup.findAll('script', {'type': 'math/tex; mode=display'})   
    to_svg(mathjaxs, equation=True)
    
    clean_script(soup)
    
    output_file = open('out.html', 'w')
    output_file.write(soup.prettify())
    output_file.close()    
```

```main()
```

ุนูุฏูุง ูุฑุบุจ ูู ุชุญููู ูุชุงุจ ุฅููุชุฑููู ุจุงููุงููุ ูููููุง ุฃููุงู ุชุฌุฑุจุฉ ุตูุญุฉ ูุงุญุฏุฉ.

```python
    file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
    content = file.read()
```

ููุง ุชู ุชูุฒูู ุตูุญุฉ ูุงุญุฏุฉ.

`MathJax` ูููุดุฆ ุงููุซูุฑ ูู ุนูุงุตุฑ `div` ู `span`. ุนูู ุณุจูู ุงููุซุงูุ ุงููุนุงุฏูุฉ `T+U=const` ูุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ MathJax ุจูุฐู ุงูุทุฑููุฉ.

```html
<span class="MathJax">T</span>
<span class="MathJax">+</span>
<span class="MathJax">U</span>
<span class="MathJax">=</span>
<span class="MathJax">ุซุงุจุช</span>
```

ูุฐู ุงูุฃุดูุงุก ูุฒุนุฌุฉ ููุฏ ุชุคุซุฑ ุนูู ูุตูุง. ูุธุฑูุง ูุฃู ูุฏููุง ุจุงููุนู `svg`ุ ููุง ูุญุชุงุฌ ุฅูู ูุฐู ุงูุฃุดูุงุก.

```python
def clean_mathjax(soup, name, cls):
    previews = soup.findAll(name, {'class': cls})
    for preview in previews:
        preview.decompose()
```

ุชูุช ุชุฑุฌูุฉ ุงูููุฏ ุฅูู:

```python
def clean_mathjax(soup, name, cls):
    previews = soup.findAll(name, {'class': cls})
    for preview in previews:
        preview.decompose()
```

ููุงุญุธุฉ: ุงูููุฏ ุจูู ููุง ูู ูุฃูู ููุชูุจ ุจูุบุฉ ุจุฑูุฌุฉ (Python) ููุง ูุชู ุชุฑุฌูุชู.

```python
clean_mathjax(soup, 'span', 'MathJax')
clean_mathjax(soup, 'div', 'MathJax_Display')
clean_mathjax(soup, 'span', 'MathJax_Preview')
```

ูู ุจุฅุฒุงูุชูุง ุฌููุนูุง.

```python
    mathjaxs = soup.findAll('script', {'type': 'math/tex'})
    to_svg(mathjaxs, equation=False)
    
    mathjaxs = soup.findAll('script', {'type': 'math/tex; mode=display'})   
    to_svg(mathjaxs, equation=True)
```

**ููุงุญุธุฉ:** ุงูููุฏ ุฃุนูุงู ููุชูุจ ุจูุบุฉ Python ููุณุชุฎุฏู ููุชุจุฉ BeautifulSoup ูุงุณุชุฎุฑุงุฌ ุนูุงุตุฑ ุงููุตูุต ุงูุฑูุงุถูุฉ ูู ุตูุญุฉ ููุจ ูุชุญููููุง ุฅูู ุตูุบุฉ SVG. ูุง ูุญุชุงุฌ ุงูููุฏ ุฅูู ุชุฑุฌูุฉ ุญูุซ ุฃู ุงูุฃูุงูุฑ ูุงููุชุบูุฑุงุช ููุชูุจุฉ ุจุงูุฅูุฌููุฒูุฉ ููู ุฌุฒุก ูู ุจูุงุก ุงูุฌููุฉ ุงูุจุฑูุฌูุฉ.

ูุงุญุธ ุฃู ููุงู ููุนูู ูู `script` ููุง.

```latex
m(dv/dt)=F
```

**ุชุฑุฌูุฉ ุงููุนุงุฏูุฉ:**

ุชูุนุจุฑ ุงููุนุงุฏูุฉ ุนู ุงููุงููู ุงูุซุงูู ููููุชู ููุญุฑูุฉุ ุญูุซ:
- \( m \) ูู ูุชูุฉ ุงูุฌุณู.
- \( \frac{dv}{dt} \) ูู ูุนุฏู ุชุบูุฑ ุงูุณุฑุนุฉ ุจุงููุณุจุฉ ููุฒูู (ุงูุชุณุงุฑุน).
- \( F \) ูู ุงูููุฉ ุงููุคุซุฑุฉ ุนูู ุงูุฌุณู.

**ุงูุตูุบุฉ ุงูุฑูุงุถูุฉ:**
\[ m \frac{dv}{dt} = F \]

**ุงูุชูุณูุฑ:**
ุงูููุฉ ุงููุคุซุฑุฉ ุนูู ุฌุณู ูุง ุชุณุงูู ูุชูุฉ ุงูุฌุณู ูุถุฑูุจุฉ ูู ุชุณุงุฑุนู.

ูุฐุง ูู ุงููููุฐุฌ ุงููุถูู.

```latex
\begin{equation}
\underset{\text{ุงูุทุงูุฉ ุงูุญุฑููุฉ}}{\tfrac{1}{2}mv^2}+
\underset{\text{ุงูุทุงูุฉ ุงููุงููุฉ}}{\vphantom{\tfrac{1}{2}}mgh}=\text{ุซุงุจุช},\notag
```

ูุฐุง ูู ุงููุต ุจุดูู ููุฑุงุช.

ุนูุฏ ุงุณุชุฎุฏุงู ุงูุตูุบุฉ ุงููุถููุฉุ ูุฌุจ ุฅุถุงูุฉ `$` ุฃู `[]` ุญูู ุงูุชุนุจูุฑ. ูุฅูุง ููุฏ ูุญุฏุซ ุฎุทุฃ.

```latex
\begin{document}
\begin{preview}
\tfrac{1}{2}mv^2
\end{preview}
\end{document}
```

```shell
! ุชู ุฅุฏุฎุงู ุนูุงูุฉ $ ููููุฏุฉ.
<ุงููุต ุงูููุฏุฎู>
                $
l.26 \tfrac{1}{2}
                 mv^2
```

ูุฌุจ ุฃู ูุชู ุชุบููุฑู ุฅูู ูุฐุง:

```latex
\begin{document}
\begin{preview}
$\tfrac{1}{2}mv^2$
\end{preview}
\end{document}
```

ููุฑู ุงูุขู ููููุฉ ุชุญููู `latex` ุฅูู `svg`.

```python
    if equation:
        svg_prefix = 'eq_'
    else:
        svg_prefix = 'in_'
```

```shell
% tree svgs
svgs
โโโ eq_0.svg
โโโ eq_1.svg
โโโ in_0.svg
```

ููุฐุง ูุชู ุญูุธ `svg`.

```python
def wrap_latex(mathjax, equation = False):
    wrap = ''
    if equation:
        wrap = mathjax.string
    else:
        wrap = '$' + mathjax.string + '$'
    wrap = wrap.replace('label', 'tag')
    return wrap
```

ููุง ุณูููู ุจุฅุฌุฑุงุก ุจุนุถ ุงูุชุนุฏููุงุช ุนูู ููุฏ `latex`. ูุงุญุธ ุฃู `label` ูุฏ ุชุญููุช ุฅูู `tag`.

![ุนูุงูุฉ](assets/images/feynman/tag.png)

ูุงุญุธ `(Eq:I:13:14)` ุนูู ุงูุฌุงูุจ ุงูุฃููู. ุฅุฐุง ูุงู `label`ุ ูุฅูู ูู ูุชู ุชุญูููู ุจูุฌุงุญ. ุณูุธูุฑ ูุฐุง ูู `(1)`. ููุง ูุณุชุฎุฏู `tag` ููุฅุดุงุฑุฉ ุฅููู ูุคูุชูุงุ ููู ูุชุนูู ูู ุงูุจุญุซ ุจุนุฏ.

ุซู ูุชู ุงุณุชุฏุนุงุก `latex2svg.py`.

```python
        out = {}
        try:
            out = latex2svg(wrap)   
        except subprocess.CalledProcessError as err:
            raise err    
```

**ููุงุญุธุฉ:** ุงูููุฏ ุงูููุฌูุฏ ูู ุงูููู ุงูุฃุตูู ููุชูุจ ุจูุบุฉ Python ููุง ูุญุชุงุฌ ุฅูู ุชุฑุฌูุฉุ ุญูุซ ุฃู ุงูุฃููุงุฏ ุงูุจุฑูุฌูุฉ ุชุจูู ููุง ูู ุจุบุถ ุงููุธุฑ ุนู ุงููุบุฉ ุงููุณุชุฎุฏูุฉ ูู ุงููุซููุฉ.

ุงุทูุน ุนูู `latex2svg.py`.

```python
    # ุชุดุบูู LaTeX ูุฅูุดุงุก ููู DVI
    try:
        ret = subprocess.run(shlex.split(params['latex_cmd']+' code.tex'),
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                             cwd=working_directory)
        ret.check_returncode()
    except FileNotFoundError:
        raise RuntimeError('latex ุบูุฑ ููุฌูุฏ')
```

ููุง ูุชู ุงุณุชุฏุนุงุก ุฃูุฑ `latex`.

```shell
 % latex --help
ุงูุงุณุชุฎุฏุงู: pdftex [ุฎูุงุฑ]... [ุงุณู ุงูููู[.tex]] [ุฃูุงูุฑ]
   ุฃู: pdftex [ุฎูุงุฑ]... \ุงูุณุทุฑ ุงูุฃูู
   ุฃู: pdftex [ุฎูุงุฑ]... &ุชูุณูู ARGS
  ุชุดุบูู pdfTeX ุนูู ุงุณู ุงููููุ ุนุงุฏุฉู ูุง ูุชู ุฅูุดุงุก ุงุณู ุงูููู.pdf.
```

```python
    try:
        ret = subprocess.run(shlex.split(params['dvisvgm_cmd']+' code.dvi'),
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                             cwd=working_directory, env=env)
        ret.check_returncode()
    except FileNotFoundError:
        raise RuntimeError('ูู ูุชู ุงูุนุซูุฑ ุนูู dvisvgm')
```

ููุง ูุชู ุงุณุชุฏุนุงุก ุฃูุฑ `dvisvgm`.

```shell
% dvisvgm
dvisvgm 2.9.1
```

ูุฐุง ุงูุจุฑูุงูุฌ ูุญูู ูููุงุช DVIุ ุงูุชู ูุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ TeX/LaTeXุ ุจุงูุฅุถุงูุฉ ุฅูู ูููุงุช EPS ูPDFุ ุฅูู ุชูุณูู SVG ุงููุงุฆู ุนูู XML ูุงูุฐู ูุนุชุจุฑ ุชูุณูููุง ูุชุฌูููุง ูุงุจููุง ููุชุญุฌูู.

ุงูุงุณุชุฎุฏุงู: dvisvgm [ุฎูุงุฑุงุช] ููู_dvi
       dvisvgm --eps [ุฎูุงุฑุงุช] ููู_eps
       dvisvgm --pdf [ุฎูุงุฑุงุช] ููู_pdf
```

ุฃูู ุชูุชุจ ูุญุฏุงุช ุงููุงูุฑู ุงููุฎุตุตุฉ ูู `latex` ุงูุชู ุชู ุฐูุฑูุง ุฃุนูุงูุ ููุง ูุฌุจ ุชุนุฏูู `latex2svg.py`. ูู ุจุชุนุฏูู `default_preamble`.

```python
default_preamble = r"""
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}
```

\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
"""
```

ุจุนุฏ ุงูุชุญููู ุจูุฌุงุญุ ูุชู ุงููุชุงุจุฉ ุฅูู ุงูููู.

```python
        f = open(f'svgs/{svg_prefix}{i}.svg', 'w')
        f.write(out['svg'])
        f.close()
```

ุงุณุชูุฑ.

```python
        node = BeautifulSoup('<img>', features="lxml")
        img = node.find('img')
        img.attrs['src'] = f'./svgs/{svg_prefix}{i}.svg'
        img.attrs['style'] = 'vertical-align: middle; margin: 0.5em 0;'
```

**ุชุฑุฌูุฉ ุงูููุฏ ุฅูู ุงูุนุฑุจูุฉ:**

```python
        node = BeautifulSoup('<img>', features="lxml")  # ุฅูุดุงุก ูุงุฆู BeautifulSoup ูู ูุณู <img>
        img = node.find('img')  # ุงูุจุญุซ ุนู ูุณู <img> ุฏุงุฎู ุงููุงุฆู
        img.attrs['src'] = f'./svgs/{svg_prefix}{i}.svg'  # ุชุนููู ุงูุณูุฉ 'src' ููุณุงุฑ ููู SVG
        img.attrs['style'] = 'vertical-align: middle; margin: 0.5em 0;'  # ุชุนููู ุงูุณูุฉ 'style' ูุชูุณูู ุงูุตูุฑุฉ
```

**ููุงุญุธุฉ:** ุชู ุงูุญูุงุธ ุนูู ุงูููุฏ ุงูุฃุตูู ููุง ูู ูุฃูู ูุชุถูู ุฃุณูุงุก ููุชุจุงุช ููุธุงุฆู ูุญุฏุฏุฉ (ูุซู `BeautifulSoup`) ูุงูุชู ูุง ูุชู ุชุฑุฌูุชูุง ุนุงุฏุฉู. ุชูุช ุฅุถุงูุฉ ุงูุชุนูููุงุช ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุดุฑุญ ุงูููุฏ.

ููุง ูููู ุจุฅูุดุงุก ูุณู `img`.

```python
def wrap_svg(svg, equation):
    if equation:
        p = BeautifulSoup(f'<div style="text-align:center;"></div>', features="lxml")
        p.div.append(svg)
        return p.div
    else:
        return svg
      
p = wrap_svg(img, equation)
```

ุชูุช ุชุฑุฌูุฉ ุงูููุฏ ุฃุนูุงู ุฅูู:

```python
def wrap_svg(svg, equation):
    if equation:
        p = BeautifulSoup(f'<div style="text-align:center;"></div>', features="lxml")
        p.div.append(svg)
        return p.div
    else:
        return svg
      
p = wrap_svg(img, equation)
```

ููุงุญุธุฉ: ุงูููุฏ ูู ูุชุบูุฑ ูุฃูู ูุญุชูู ุนูู ุฃุณูุงุก ูุชุบูุฑุงุช ูุฏูุงู ุจุงูุฅูุฌููุฒูุฉุ ููู ูุชู ุชุบููุฑูุง ููููุง ููุชุนูููุงุช.

ุฅุฐุง ูุงูุช `latex` ุนุจุงุฑุฉ ุนู ููุฑุฉ ูุงุญุฏุฉุ ููู ุจุชุบููููุง ุจุงุณุชุฎุฏุงู `div` ูุชูุณูุทูุง.

```python
mathjax.insert_after(p)
```

ููุง ูุชู ุฅุถุงูุฉ ูุณู `div` ุฃู ูุณู `img` ุจุนุฏ ูุณู `script` ุงูุฃุตูู.

```python
def clean_script(soup):
    scripts = soup.findAll('script')
    for s in scripts:
        s.decompose()    
        
clean_script(soup)
```

**ุชุฑุฌูุฉ ุงูููุฏ ุฅูู ุงูุนุฑุจูุฉ:**

```python
def ุชูุธูู_ุงููุตู(soup):
    ุงููุตูุต = soup.findAll('script')
    for ูุต in ุงููุตูุต:
        ูุต.decompose()    
        
ุชูุธูู_ุงููุตู(soup)
```

ูู ูุฐุง ุงูููุฏุ ูุชู ุชุนุฑูู ุฏุงูุฉ `ุชูุธูู_ุงููุตู` ุงูุชู ุชููู ุจุฅุฒุงูุฉ ุฌููุน ุนูุงุตุฑ ุงููุตูุต ุงูุจุฑูุฌูุฉ (`script`) ูู ูุงุฆู `soup` ุงูุฐู ููุซู ูุซููุฉ HTML. ูุชู ุงุณุชุฎุฏุงู `findAll` ููุนุซูุฑ ุนูู ุฌููุน ุงูุนูุงุตุฑ ูู ููุน `script`ุ ุซู ูุชู ุงุณุชุฎุฏุงู `decompose` ูุฅุฒุงูุฉ ูู ุนูุตุฑ ูุตู ูู ุงููุซููุฉ.

ุจุนุฏ ุงุณุชุจุฏุงู ุฌููุน ุนูุงุตุฑ `latex` ุจู `svg`ุ ูู ุชููู ููุงู ุญุงุฌุฉ ุฅูู `script`. ูู ุจุญุฐููุง ูุฌุนู ุงูููุฏ ุฃูุซุฑ ูุธุงูุฉ.

ุฃุฎูุฑูุงุ ูุชู ูุชุงุจุฉ `html` ุงููุนุฏู ุจุงููุงูู ูู ููู.

```python
    output_file = open('out.html', 'w')
    output_file.write(soup.prettify())
    output_file.close()    
```

ุซู ุงุณุชุฎุฏู ุฃุฏุงุฉ `pandoc` ูุชุญููููุง ุฅูู ุตูุบุฉ `epub`.

```shell
pandoc -s -r html out.html -o feynman.epub
```

ุณูุชู ูุชุญ ูุชุงุจ ุฅููุชุฑููู ุฌููู.

ููุงุฐุง ูุง ูุชู ุชุถููู ุนูุงูุฉ `svg` ูุจุงุดุฑุฉุ ุจุฏูุงู ูู ุงุณุชุฎุฏุงู `img` ูุฅุฏุฑุงุฌูุงุ ุฃู ุจูุชุงุจุฉ ูุซู ูุฐุง:

```html
<p></p>
<svg></svg>
<p></p>
```

ููุงู `bug` ุบุฑูุจ ุฌุฏูุง. ุนูุฏูุง ูููู ููุงู ุงููุซูุฑ ูู ูููุงุช `svg`ุ ูุญุฏุซ ุดูุก ูุซู ูุฐุง.

<img src="/assets/images/feynman/svg_p1.png" alt="svg_p1" style="zoom:40%;" />

ูุงุญููุง ุงูุชุดูุช ุฃูู ูููู ุงุณุชุฎุฏุงู `img` ูุฅุฏุฑุงุฌ ุงูุตูุฑ. ุฃูุง ุนู ุณุจุจ ุฐููุ ูู ุฃูููู ุชูุงููุง. ุนูุฏูุง ุฃุฎุฐุช ูุฐุง ุงูู `svg` ุงููุฑุฏู ูุนุฑุถุชู ูู ุงููุชุตูุญุ ูู ุชูู ููุงู ูุดููุฉ. ูุจุฏู ุฃู ุงููุดููุฉ ุชุญุฏุซ ุนูุฏูุง ูููู ุงููุชุตูุญ ุจุนุฑุถ ุนุฏุฏ ูุจูุฑ ุฌุฏูุง ูู ูููุงุช `svg` ูู ููุณ ุงูููุช.

### ุงูุฎุชุงู

ุฃูุง ุจุงููุณุจุฉ ูููููุฉ ุชุญููู `epub` ุฅูู `mobi`ุ ููููู ุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ุงูุฑุณููุฉ ูู `Kindle` ููู `Kindle Previewer 3`. ูุงุญุธ ุฃู ูุฐุง ูุฌุฑุฏ ูุตู ูุงุญุฏ.

ููุฏ ุงููุดุฑูุน ููุฌูุฏ ูู [feynman-lectures-mobi@lzwjava](https://github.com/lzwjava/feynman-lectures-mobi).

ููู ูููู ุงุณุชุฎุฑุงุฌ ุฌููุน ุงูุตูุญุงุช ูุชูุธูููุง ูู ูุชุงุจ ุฅููุชุฑูููุ ุณูุชุญุฏุซ ุนู ุฐูู ูุงุญููุง. ูููู ูุฐุง ุงููุตู ูู ูุญุงุถุฑุงุช ููููุงู ูู ุงูููุฒูุงุก ูุงูู ูููุฑุงุกุฉ. ุญุณููุงุ ููุจุฏุฃ ุงููุฑุงุกุฉ ุนูู ุฌูุงุฒ Kindle.