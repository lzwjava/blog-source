---
audio: false
generated: true
lang: ar
layout: post
title: لماذا قد يفتقد إخراج Logback للألوان في طرفية جنوم
translated: true
type: note
---

أنت تطرح سؤالاً رائعاً يتعمق في كيفية تفاعل الطرفيات، ومكتبات التسجيل، وأنظمة التشغيل مع المخرجات الملونة!

السبب وراء عدم ظهور مخرجات Logback ملونة في Gnome Terminal لديك، حتى مع استخدام `%highlight`، بينما تظهر المخرجات الافتراضية لـ Spring Boot ملونة، يعود لعدة عوامل:

1.  **رموز التحكم ANSI:** تعمل المخرجات الملونة في الطرفية من خلال طباعة تسلسلات أحرف خاصة تسمى **رموز تحكم ANSI**. تخبر هذه الرموز محاكي الطرفية (مثل Gnome Terminal) بتغيير لون النص الأمامي، أو لون الخلفية، أو إعادة تعيين الألوان، إلخ.
    * على سبيل المثال، `\u001B[31m` قد يغير لون النص إلى الأحمر، و `\u001B[0m` يعيد تعيينه.
2.  **محول `%highlight` في Logback:** محول `%highlight` في Logback (وغيره مثل `%red`، `%green`، إلخ) يولد داخلياً رموز تحكم ANSI هذه. لذا، فإن ملف `logback.xml` الخاص بك مُهيأ بالفعل لإنتاج مخرجات ملونة.
3.  **محاكيات الطرفية ودعم ANSI:** معظم طرفيات Linux الحديثة، بما في ذلك Gnome Terminal، تدعم رموز تحكم ANSي افتراضياً. هذا ليس عادة المشكلة على Linux.
4.  **التكوين الافتراضي لـ Spring Boot:** يوفر Spring Boot تكوين Logback مُوجهًا ومُحسّنًا جدًا بشكل افتراضي. يقوم هذا التكوين الافتراضي بعدة أشياء:
    * يستخدم `PatternLayout` مع `%highlight` ومحولات ألوان أخرى.
    * **والأهم، لمستخدمي Windows، فإنه غالباً ما يتضمن مكتبة `jansi`.** لدى Logback نفسه خاصية `withJansi` يمكنك تعيينها على `ConsoleAppender`. في Windows، موجه الأوامر (CMD.exe) لا يفسر رموز تحكم ANSي بشكل أصلي. تعمل مكتبة `jansi` (دعم ANSI لجافا) كأداة تكيف، تعترض رموز ANSI وتترجمها إلى أوامر خاصة بالطرفية يستطيع Windows فهمها. بينما طرفيات Linux عادة لا *تحتاج* إلى Jansi لدعم ANSI الأساسي، إلا أن وجودها أو غيابها يمكن أحياناً أن يؤثر على كيفية كشف Logback "لقدرة الطرفية" أو كيفية إخراج البيانات، رغم أن هذا أقل شيوعاً على Linux.
    * قد يتضمن الإعداد الافتراضي لـ Spring Boot أيضاً منطقاً إضافياً أو خصائص تضمن تقديم الألوان بشكل متسق.

**لماذا قد لا يظهر ملف `logback.xml` المخصص لديك الألوان في Gnome Terminal:**

بما أنك تستخدم `%highlight`، فإن رموز ANSي *يجب* أن تكون موجودة. إذا لم تظهر، ففكر في هذه الاحتمالات:

1.  **هل يتم تحميل ملف `logback.xml` الخاص بك فعلياً؟**
    * راجع موقعه مرة أخرى: يجب أن يكون في `src/main/resources/logback.xml` (أو `logback-spring.xml` إذا أردت أن يطبق Spring Boot إعداداته الافتراضية *ثم* تخصيصاتك).
    * اطلع على سجلات بدء تشغيل تطبيقك. غالباً ما تطبع Logback رسائل تشير إلى ملف التكوين الذي يتم تحميله. إذا رأيت رسائل عن `BasicConfigurator` أو ملف مختلف، فهذا يعني أن ملف `logback.xml` الخاص بك لا يُستخدم.
2.  **إعادة توجيه المخرجات:** هل تقوم بإعادة توجيه مخرجات تطبيقك؟
    * إذا قمت بتوجيه مخرجات تطبيقك إلى ملف (`java -jar your-app.jar > log.txt`) أو أمر آخر، فل يفسر محاكي الطرفية رموز ANSي، وسترى فقط تسلسلات الهروب الخام في الملف.
    * قد تقوم بعض الأدوات أو البيئات بإزالة رموز ANSي، بافتراض أن المخرجات لا تذهب إلى طرفية "حقيقية".
3.  **كشف نوع الطرفية:** غالباً ما تحاول `ConsoleAppender` في Logback والمنطق الخاص بالتلوين الكشف عما إذا كان الهدف الناتج طرفية "حقيقية" (TTY). إذا لم يتم اكتشافه كطرفية حقيقية (على سبيل المثال، إذا كان التشغيل في وحدات تحكم بيئة التطوير المتكاملة IDE التي لا تحاكي طرفية حقيقية بالكامل، أو إذا تم توجيه المخرجات)، فقد تقوم Logback تلقائياً بكبت رموز ANSي لتجنب تشويش المخرجات غير المدعومة للألوان.
    * عادة ما يتم اكتشاف Gnome Terminal كطرفية حقيقية TTY، لذا فإن هذا الاحتمال ضعيف أن يكون السبب الرئيسي، لكنه جدير بالملاحظة.
4.  **`withJansi` لتحقيق الاتساق عبر المنصات (أقل أهمية لـ Linux، لكن من الجيد معرفته):** بينما Jansi مخصصة primarily لنظام Windows، إلا أن تعيين `<withJansi>true</withJansi>` صراحةً داخل `ConsoleAppender` في ملف `logback.xml` يمكن أن يساعد أحياناً في ضمان سلوك متسق عبر المنصات، حتى على Linux حيث قد لا يكون ضرورياً بشدة. غالباً لا يضر.
5.  **متغيرات البيئة:** في حالات نادرة جداً، يمكن لمتغيرات بيئة معينة (مثل `TERM` أو `CLICOLOR_FORCE`) أن تؤثر على كيفية تعامل الطرفيات أو التطبيقات مع المخرجات الملونة. ومع ذلك، بالنسبة لـ Gnome Terminal القياسي، من غير المرجح أن يكون هذا هو سبب *عدم* ظهور الألوان مطلقاً.

**للاستكشاف والأخطاء وضمان ظهور الألوان:**

1.  **تحقق من تحميل `logback.xml`:** ابدأ تشغيل تطبيقك وابحث عن رسائل التهيئة الذاتية لـ Logback. ستخبرك بأي ملف تكوين يتم استخدامه.
    * يمكنك أيضاً إضافة `debug="true"` إلى وسم `<configuration>` في `logback.xml` للحصول على رسائل حالة داخلية أكثر تفصيلاً من Logback عند بدء التشغيل:
        ```xml
        <configuration debug="true">
            </configuration>
        ```
2.  **اختبر تطبيق جافا بسيط برموز ANSI خام:**
    ```java
    public class AnsiTest {
        public static void main(String[] args) {
            System.out.println("\u001B[31mThis text is red.\u001B[0m");
            System.out.println("\u001B[32mThis text is green.\u001B[0m");
            System.out.println("This text is default.");
        }
    }
    ```
    قم بتجميع وتشغيل هذا من خلال Gnome Terminal لديك (`javac AnsiTest.java && java AnsiTest`). إذا أظهر هذا الألوان، فهذا يعني أن طرفيتك قادرة على ذلك، والمشكلة على الأرجح في تكوين Logback الخاص بك أو كيفية تشغيله. إذا *لم* يظهر هذا الألوان، فهناك شيء أكثر جوهرية في إعداد Gnome Terminal لديك (رغم أن هذا غير مرجح بشدة).
3.  **قارن ملف `logback.xml` الخاص بك بالإعداد الافتراضي لـ Spring Boot:**
    * إذا كنت تستخدم Spring Boot، يمكنك غالباً العثور على ملف `logback-spring.xml` الافتراضي (أو ما شابه) داخل ملفات JAR الخاصة بـ Spring Boot أو الوثائق. قد تكشف مقارنة أقسام `ConsoleAppender` عن اختلافات طفيفة.
    * عادة ما يستخدم Spring Boot نمطاً مشابهاً لـ:
        `%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} %highlight(${LOG_LEVEL_PATTERN:-%-5p}) ${PID:- } --- [%thread] %logger{40}.%M{1.}: %msg%n%throwable`
        لاحظ استخدام خصائص النظام (`LOG_DATEFORMAT_PATTERN`, `LOG_LEVEL_PATTERN`, `PID`) والتي يقوم Spring Boot بإعدادها لك.

باتباع هذه الخطوات، يجب أن تكون قادراً على تحديد السبب الدقيق وراء عدم إنتاج تكوين Logback المخصص لديك لمخرجات ملونة في Gnome Terminal. السبب الأكثر شيوعاً هو أن ملف `logback.xml` لا يتم تحميله أو أن هناك مشكلة في إعادة توجيه المخرجات.