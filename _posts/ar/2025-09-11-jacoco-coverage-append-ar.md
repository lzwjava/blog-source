---
audio: false
date: 2025-09-11
generated: true
image: false
lang: ar
layout: post
model: openai/gpt-5
title: ملف تغطية جاكوكو ووضع الإلحاق
translated: true
type: note
---

هذه تفصيلة دقيقة لكنها مهمة في طريقة عمل JaCoCo.

### سلوك `jacoco:prepare-agent`

* عندما يشغّل Maven هدف **`prepare-agent`**، فإنه لا يولد ملف التغطية فوراً.
* بدلاً من ذلك، يقوم **بتكوين JVM** (عادة عبر وسيط `-javaagent:jacocoagent.jar`) بحيث يتم جمع بيانات التغطية أثناء تشغيل اختباراتك أو تطبيقك.
* يتم التحكم في موقع ملف `.exec` عبر الخاصية `jacoco.destFile` (القيمة الافتراضية هي `target/jacoco.exec`، ولكن غالباً ما يتم تخصيصها، مثلاً `target/jacoco-it.exec`).

### ماذا يحدث إذا كان الملف موجوداً بالفعل؟

* افتراضياً، **سيقوم JaCoCo بالكتابة فوق الملف** عندما يبدأ JVM مع الوكيل.
* هذا يعني أن كل تشغيل لـ `prepare-agent` → تنفيذ الاختبار سينتج ملف `.exec` *جديد*.
* لا يقوم بالدمج تلقائياً — يتم فقدان البيانات القديمة ما لم تقم بتكوينه بشكل مختلف.

### كيفية الدمج بدلاً من الاستبدال

إذا كنت تريد أن تتراكم عمليات التشغيل المتعددة في ملف exec نفسه، يجب عليك تمكين وضع الدمج صراحةً:

```xml
<plugin>
  <groupId>org.jacoco</groupId>
  <artifactId>jacoco-maven-plugin</artifactId>
  <version>0.8.12</version>
  <configuration>
    <destFile>${project.build.directory}/jacoco-it.exec</destFile>
    <append>true</append>   <!-- ✅ دمج بيانات التغطية -->
  </configuration>
</plugin>
```

مع `<append>true>`، إذا كان الملف موجوداً، سيتم دمج بيانات التغطية الجديدة فيه.

### باختصار

* **الافتراضي:** كل تشغيل يستبدل ملف `.exec` القديم.
* **مع `append=true`:** يتم دمج التغطية من عمليات تشغيل JVM متعددة (أو وحدات/اختبارات متعددة) في الملف نفسه.

---

هل تريد مني أيضاً أن أشرح كيف يتفاعل هذا مع **بناءات Maven متعددة الوحدات** (حيث قد تحاول كل وحدة كتابة ملف exec JaCoCo الخاص بها)، نظراً لأن هذا هو السبب الشائع وراء مواجهة المستخدمين لمشاكل الاستبدال مقابل الدمج؟