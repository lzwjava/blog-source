---
audio: false
generated: true
image: false
lang: ar
layout: post
model: x-ai/grok-4-fast
title: هيكل فهارس آي بي إم دي بي ٢ مُوضَّح
translated: true
type: note
---

### كيف تعمل فهارس IBM DB2

تستخدم IBM DB2 **أشجار B+** كبنية البيانات الأساسية لفهارسها. هذا هو نوع متوازن من الأشجار مُحسَّن للتخزين القائم على الأقراص والاستعلامات النطاقية، الشائعة في قواعد البيانات العلائقية. تضمن أشجار B+ عمليات بحث وإدراج وحذف فعالة بتعقيد زمني لوغاريتمي (O(log n))، مما يجعلها مثالية لمجموعات البيانات الكبيرة. أدناه، سأفصل البنية والعمليات الرئيسية والملاحظات الخاصة بـ DB2.

#### بنية شجرة B+ في DB2
تنظم شجرة B+ في DB2 في تسلسل هرمي من **الصفحات** (تُسمى أيضًا العقد)، يبلغ حجم كل منها عادةً 4 كيلوبايت على القرص. الشجرة ذاتية التوازن، مما يعني أن جميع العقد الورقية على نفس العمق، وهي تنمو أو تتقلص ديناميكيًا مع تغير البيانات. إليك التفصيل:

- **الصفحة الجذرية**: نقطة الدخول في أعلى الشجرة. تحتوي على قيم مفاتيح مرتبة ومؤشرات إلى الصفحات الفرعية أسفلها. بالنسبة للفهارس الصغيرة، قد يشير الجذر مباشرة إلى الصفحات الورقية.

- **الصفحات الداخلية (غير الورقية)**: هذه المستويات المتوسطة تعمل كدلائل. تحتوي كل صفحة على:
  - قائمة مرتبة من **مفاتيح الفهرس** (القيم من العمود المفهرس، مثل معرفات الموظفين).
  - مؤشرات إلى الصفحات الفرعية (مؤشر واحد إضافي أكثر من المفاتيح، لفصل النطاقات).
  - على وجه التحديد، كل إدخال هو **أعلى قيمة مفتاح** في الشجرة الفرعية أسفله، مقترنًا **بمعرف السجل (RID)** — وهو مؤشر فريد إلى الصفحة والفتحة حيث تعيش صف البيانات الفعلي في الجدول.

  لا تخزن الصفحات غير الورقية مؤشرات البيانات الفعلية؛ إنها توجه عملية الاجتياز.

- **الصفحات الورقية**: المستوى السفلي، مرتبط باتجاهين (أمامي وخلفي) لعمليات المسح النطاقي الفعالة. تحتوي كل صفحة ورقية على:
  - قيم **المفاتيح** الكاملة المرتبة من العمود المفهرس.
  - **معرفات السجل (RIDs)** المرتبطة التي تشير مباشرة إلى صفوف الجدول.
  - مؤشرات إلى الصفحات الورقية المجاورة، مما يتيح الوصول التسلسلي (مثل `WHERE column BETWEEN x AND y`).

تبدأ الشجرة بمستويين على الأقل (جذر + أوراق) ويمكن أن تنمو إلى 3-5+ مستويات للجداول الضخمة (ملايين الصفوف). عدد المستويات (NLEVELS) يمكن الاستعلام عنه عبر `SYSCAT.INDEXES` ويؤثر على الأداء — فالمستويات الأقل تعني اجتيازًا أسرع، لكن DB2 تدير هذا تلقائيًا.

يتم تخزين الفهارس بشكل منفصل عن الجداول في tablespace خاص بها، مستهلكة مساحة قرص متناسبة مع البيانات المفهرسة (على سبيل المثال، قد يأخذ الفهرس الفريد على جدول بحجم 1 مليون صف حوالي 10-20% من حجم الجدول).

#### كيف تعمل عملية البحث
1. ابدأ من **الصفحة الجذرية** وقم بتحميلها إلى الذاكرة.
2. قارن مفتاح البحث (مثل `WHERE id = 123`) بالمفاتيح المرتبة في الصفحة الحالية.
3. اختر المؤشر الفرعي المناسب (مثل إذا كان مفتاح البحث > المفتاح الحالي، فاذهب لليمين).
4. كرر العملية نزولاً في الشجرة (عادةً من 1 إلى 5 عمليات إدخال/إخراج) حتى الوصول إلى **صفحة ورقية**.
5. في الصفحة الورقية، امسح المفاتيح المرتبة للعثور على التطابقات، ثم استخدم RID لجلب الصف الدقيق من الجدول (عملية إدخال/إخراج إضافية واحدة).

يحافظ ضغط المسار هذا على عمليات الاجتياز ضحلة. بالنسبة للاستعلامات النطاقية، بمجرد الوصول إلى الصفحة الورقية البداية، اتبع الروابط الشقيقة للمسح التسلسلي دون القفز مرة أخرى لأعلى الشجرة.

#### الإدراج والحذف
- **الإدراج**:
  1. اجتاز إلى الصفحة الورقية الصحيحة (كما في البحث).
  2. أدخل المفتاح الجديد + RID في الصفحة الورقية المرتبة.
  3. إذا تجاوزت الصفحة السعة (تجاوزت الحد الأقصى للإدخالات، ~200-500 اعتمادًا على حجم المفتاح)، قسّمها إلى صفحتين وأدخل مفتاح فاصل في الصفحة الأصل (الداخلية).
  4. إذا تجاوزت الصفحة الأصل السعة، قسّم للأعلى (قد ينشئ هذا جذرًا جديدًا). تقوم DB2 بقفل الصفحات لفترة وجيزة للتزامن.

- **الحذف**:
  1. اجتاز إلى الصفحة الورقية واحذف المفتاح + RID.
  2. إذا قلّت إدخالات الصفحة عن الحد الأدنى، استعير من صفحة شقيقة أو ادمج معها، مع إزالة مفتاح الفاصل من الصفحة الأصل.
  3. انشر عمليات الدمج للأعلى إذا لزم الأمر. قد تؤجل DB2 إعادة التنظيم لمعالجة التغييرات على دفعات من أجل الكفاءة.

تحافظ هذه العمليات على التوازن تلقائيًا، مع حد أدنى من انقسام/دمج الصفحات (~1% من العمليات).

#### ميزات خاصة بـ DB2
- **أشجار B+ المُحسَّنة** (في DB2 for z/OS): مُحسَّنة للتزامن في أنظمة mainframe، مع جلب استباقي كسري للتنبؤ بتحميل الصفحات مسبقًا، مما يقلل عمليات الإدخال/الإخراج.
- **التجميع**: يمكن أن تكون الفهارس "مجمعة" (بيانات مرتبة فعليًا حسب ترتيب الفهرس) لأداء نطاقي أفضل.
- **الأنواع**: تدعم فهارس فريدة ومركبة (متعددة الأعمدة) وبيتية، جميعها قائمة على B+. لا توجد فهارس تجزئة أصلية.
- **الصيانة**: قم بتشغيل `RUNSTATS` بعد التغييرات المجمعة لتحديث الإحصائيات للمحسن. أدوات مثل `INSPECT` تتحقق من وجود مشاكل.

تتفوق أشجار B+ في DB2 لأنها تقلل من الإدخال/الإخراج العشوائي (مهم للأنظمة المقيدة بالقرص) وتدعم الوصول المرتب دون مسح كامل للجدول.

[Index structure - IBM](https://www.ibm.com/docs/en/db2/11.1.0?topic=indexes-index-structure)  
[DB2 LUW Indexes: B-Tree Details](https://datageek.blog/2013/09/19/db2-luw-basics-indexes/)  
[Inside Db2 for z/OS: How Optimized B+ Trees Power High-Speed Indexing](https://planetmainframe.com/2025/06/inside-db2-for-z-os-how-optimized-b-trees-power-high-speed-indexing/)  
[How to Understand DB2 B-Tree Index Quickly](https://srinimf.com/2021/07/26/db2-how-to-understand-b-tree-structure-of-index/)  
[Db2 Index Overview](https://www.idug.org/news/db2-index-overview)