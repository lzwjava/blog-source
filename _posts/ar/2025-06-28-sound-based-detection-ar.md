---
audio: false
generated: true
lang: ar
layout: post
title: الكشف الصوتي لغسالة مايتاج
translated: true
type: note
---

استخدام الصوت للكشف عن توقف غسالة Maytag MHW8630HW الخاص بك يمثل بديلاً عملياً للنهج القائم على الكاميرا. من خلال وضع مستشعر صوت بالقرب من الغسالة، يمكنك مراقبة الضوضاء الناتجة أثناء التشغيل (مثل طنين المحرك، تدفق الماء، أو دوران الحوض) والكشف عن توقفها، مما يشير إلى نهاية دورة الغسيل. أدناه، سأشرح كيفية تعديل المشروع السابق لاستخدام مستشعر صوت بدلاً من الكاميرا، مع التركيز على الأجهزة، الخوارزمية، وتغييرات الكود مع الحفاظ على نظام إشعارات Telegram.

---

### البنية التقنية
#### الأجهزة
1.  **لوحة Arduino**:
    *   **ESP32-CAM** (لا يزال قابلاً للاستخدام) – يحتفظ باتصال Wi-Fi للتكامل مع Telegram، على الرغم من أن الكاميرا ليست مطلوبة.
    *   بديل: **ESP8266 NodeMCU** أو **Arduino Uno** مع وحدة ESP8266 لـ Wi-Fi (أبسط إذا كنت لا تحتاج الكاميرا).
2.  **مستشعر الصوت**:
    *   **KY-038 Microphone Sound Sensor** أو ما شابه – اقتصادي، يكتشف مستويات الصوت عبر إخراج تماثلي.
    *   بديل: **MAX9814 Electret Microphone Amplifier** – أكثر حساسية، مع قابلية ضبط الربح لاكتشاف أفضل.
3.  **مزود الطاقة**:
    *   محول طاقة USB 5V أو حزمة بطارية للوحة ESP32 أو غيرها.
4.  **التثبيت**:
    *   ضع مستشعر الصوت بالقرب من الغسالة (مثل لصقها على الجانب أو الأعلى) حيث يمكنه اكتشاف الأصوات التشغيلية ولكن تجنب التعرض المباشر للماء.
    *   استخدم علبة صغيرة لحماية المستشعر واللوحة.
5.  **موجه Wi-Fi**:
    *   لتوصيلية الإنترنت لإرسال إشعارات Telegram.

#### البرمجيات
*   **Arduino IDE**: لبرمجة لوحة ESP32 أو غيرها.
*   **المكتبات**:
    *   **Universal Arduino Telegram Bot Library** بواسطة Brian Lough – للتكامل مع Telegram.
    *   **ArduinoJson** – للتعامل مع بيانات JSON في اتصال Telegram API.
*   **Telegram Bot**: نفس السابق، استخدام BotFather للحصول على رمز البوت ومعرف الدردشة.
*   **لغة البرمجة**: C++ (Arduino sketch).

---

### خوارزمية للكشف عن حالة الغسالة باستخدام الصوت
سيكتشف مستشعر الصوت مستوى الضوضاء الناتجة عن الغسالة. عندما تكون الآلة قيد التشغيل، تولد أصواتًا متسقة (مثل المحرك، الماء، أو الحوض). عندما تتوقف، ينخفض مستوى الصوت بشكل كبير. تعالج الخوارزمية مستويات الصوت هذه لتحديد حالة الآلة.

#### خوارزمية الكشف
1.  **أخذ عينات الصوت**:
    *   اقرأ باستمرار الإخراج التماثلي من مستشعر الصوت لقياس مستويات الضوضاء.
2.  **معالجة الإشارة**:
    *   **المتوسط**: احسب متوسط مستوى الصوت خلال نافذة زمنية قصيرة (مثلاً 1-2 ثانية) لتخفيف الضوضاء العابرة (مثل إغلاق الباب بعنف).
    *   **العتبة**: قارن متوسط مستوى الصوت بعتبة محددة مسبقًا. يشير المستوى المرتفع إلى أن الآلة تعمل، بينما يشير المستوى المنخفض إلى أنها متوقفة.
3.  **آلة الحالة**:
    *   تتبع حالة الآلة (تشغيل أو إيقاف) بناءً على مستويات الصوت.
    *   إذا تجاوز مستوى الصوت العتبة لعدة دورات، افترض أن الآلة تعمل.
    *   إذا انخفض مستوى الصوت below العتبة وبقي منخفضًا لفترة محددة (مثلاً 5 دقائق)، افترض أن دورة الغسيل اكتملت.
4.  **إزالة الارتداد**:
    *   نفذ تأخيرًا (مثلاً 5 دقائق) لتأكيد توقف الآلة، وتجنب الإشعارات الخاطئة أثناء المراحل الهادئة (مثل النقع أو التوقفات في الدورة).
5.  **الإشعار**:
    *   عندما يتم تأكيد توقف الآلة، أرسل رسالة على Telegram (مثلاً "توقفت الغسالة! حان الوقت لتعليق الملابس.").

#### لماذا الكشف الصوتي؟
*   الكشف الصوتي أبسط من معالجة الصور، لأنه لا يتطلب خوارزميات معقدة أو موارد حاسوبية عالية.
*   أقل حساسية لتغيرات الإضاءة المحيطة مقارنة بالكشف القائم على الكاميرا.
*   ومع ذلك، قد يتأثر بالضوضاء الخلفية (مثل التلفاز الصاخب)، لذا فإن الموضع وضبط العتبة أمران بالغان الأهمية.

---

### دليل التنفيذ
#### الخطوة 1: إعداد بوت Telegram
*   اتبع نفس الخطوات كما في الدليل الأصلي:
    *   أنشئ بوتًا باستخدام **@BotFather** للحصول على **Bot Token**.
    *   احصل على **Chat ID** الخاص بك باستخدام **@GetIDsBot** أو عن طريق فحص الرسائل الواردة.
    *   تأكد من إعداد Telegram على هاتفك لتلقي الإشعارات.

#### الخطوة 2: إعداد الأجهزة
1.  **اختر مستشعر صوت**:
    *   **KY-038**: يوفر إخراجًا تماثليًا (0-1023 لمحول ESP32 التناظري 10-bit) يتناسب مع شدة الصوت. لديه أيضًا إخراج رقمي، ولكن التماثلي أفضل للكشف الدقيق.
    *   **MAX9814**: أكثر حساسية، مع ربح قابل للتعديل عبر مقياس الجهد. وصله بطرف تماثلي.
2.  **وصل مستشعر الصوت**:
    *   لـ KY-038:
        *   **VCC** إلى 5V (أو 3.3V، اعتمادًا على اللوحة).
        *   **GND** إلى GND.
        *   **Analog Out (A0)** إلى طرف تماثلي على ESP32 (مثل GPIO 4).
    *   لـ MAX9814:
        *   وصلات مماثلة، ولكن اضبط الربح using مقياس الجهد الموجود على اللوحة للحصول على الحساسية المثلى.
3.  **ضع المستشعر**:
    *   ضع المستشعر بالقرب من الغسالة (مثل على الجانب أو الأعلى) حيث يمكنه اكتشاف ضوضاء المحرك أو الحوض. تجنب المناطق المعرضة للماء.
    *   اختبر الموضع عن طريق مراقبة مستويات الصوت أثناء دورة غسيل (استخدم Serial Monitor لتسجيل القيم).
4.  **شغل اللوحة بالطاقة**:
    *   وصل محول طاقة USB 5V أو حزمة بطارية بلوحة ESP32 أو غيرها.
    *   تأكد من استقرار الطاقة، لأن اتصال Wi-Fi يتطلب جهدًا ثابتًا.
5.  **التثبيت**:
    *   استخدم علبة أو شريط لاصق لتأمين المستشعر واللوحة، مع ضمان تعريض الميكروفون لالتقاط الصوت.

#### الخطوة 3: إعداد البرمجيات
*   **Arduino IDE**: ثبته كما هو موضح في الدليل الأصلي.
*   **دعم لوحة ESP32**: أضف حزمة لوحة ESP32 عبر Boards Manager (نفس الرابط كما قبل).
*   **المكتبات**:
    *   ثبت **Universal Arduino Telegram Bot Library** و **ArduinoJson** كما هو موضح.
*   **Wi-Fi**: تأكد من أن اللوحة يمكنها الاتصال بشبكة Wi-Fi بتردد 2.4GHz الخاصة بك.

#### الخطوة 4: اكتب كود Arduino
أدناه نموذج لـ Arduino sketch لـ ESP32 (أو ESP8266) للكشف عن مستويات الصوت وإرسال إشعارات Telegram. هذا يفترض أن مستشعر الصوت KY-038 موصول بـ GPIO 4.

```cpp
#include <WiFi.h>
#include <UniversalTelegramBot.h>
#include <ArduinoJson.h>

// بيانات اعتماد Wi-Fi
#define WIFI_SSID "your_wifi_ssid"
#define WIFI_PASSWORD "your_wifi_password"

// بيانات اعتماد Telegram Bot
#define BOT_TOKEN "your_bot_token"
#define CHAT_ID "your_chat_id"

// طرف مستشعر الصوت
#define SOUND_PIN 4 // GPIO 4 للإدخال التماثلي

// معلمات كشف الصوت
#define SOUND_THRESHOLD 300 // اضبط بناءً على الاختبار (0-1023)
#define SAMPLE_WINDOW 2000 // 2 ثانية لأخذ المتوسط
#define STOP_DELAY 300000 // 5 دقائق بالمللي ثانية

WiFiClientSecure client;
UniversalTelegramBot bot(BOT_TOKEN, client);

bool machineRunning = false;
unsigned long lastOnTime = 0;

void setup() {
  Serial.begin(115200);

  // الاتصال بـ Wi-Fi
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("WiFi connected");

  // تهيئة عميل Telegram
  client.setInsecure(); // للتبسيط؛ فكر في SSL مناسب للإنتاج

  // إعداد طرف مستشعر الصوت
  pinMode(SOUND_PIN, INPUT);
}

void loop() {
  // أخذ عينة من مستوى الصوت خلال نافذة زمنية
  unsigned long startMillis = millis();
  uint32_t totalSound = 0;
  uint16_t sampleCount = 0;

  while (millis() - startMillis < SAMPLE_WINDOW) {
    totalSound += analogRead(SOUND_PIN);
    sampleCount++;
    delay(10); // تأخير بسيط بين العينات
  }

  float avgSound = sampleCount > 0 ? (float)totalSound / sampleCount : 0;
  Serial.print("Average sound level: ");
  Serial.println(avgSound);

  // آلة الحالة
  if (avgSound > SOUND_THRESHOLD) {
    if (!machineRunning) {
      machineRunning = true;
      Serial.println("Machine is ON");
    }
    lastOnTime = millis();
  } else {
    if (machineRunning && (millis() - lastOnTime > STOP_DELAY)) {
      machineRunning = false;
      Serial.println("Machine stopped");
      bot.sendMessage(CHAT_ID, "Washing machine stopped! Time to hang up clothes.", "");
    }
  }

  delay(10000); // التحقق كل 10 ثوانٍ
}
```

#### الخطوة 5: تخصيص الكود
1.  **حدّث بيانات الاعتماد**:
    *   استبدل `your_wifi_ssid`, `your_wifi_password`, `your_bot_token`, و `your_chat_id` بقيمك الفعلية.
2.  **اضبط `SOUND_THRESHOLD`**:
    *   شغّل الغسالة وراقب مستويات الصوت عبر Serial Monitor (`Serial.println(analogRead(SOUND_PIN));`).
    *   عيّن `SOUND_THRESHOLD` إلى قيمة أعلى من الضوضاء المحيطة ولكن below ضوضاء تشغيل الآلة (مثلاً 200-500، اعتمادًا على إعداداتك).
3.  **اضبط `SAMPLE_WINDOW`**:
    *   نافذة 2 ثانية (`2000` مللي ثانية) تخفف الضوضاء العابرة. زدها إذا كانت الضوضاء الخلفية تسبب قراءات خاطئة.
4.  **اضبط `STOP_DELAY`**:
    *   عيّنها على `300000` (5 دقائق) لتجنب الإشعارات الخاطئة أثناء المراحل الهادئة مثل النقع.

#### الخطوة 6: اختبر ونفّذ
1.  **حمّل الكود**:
    *   وصّل ESP32 بجهاز الكمبيوتر عبر محول USB-to-serial.
    *   اختر **ESP32 Wrover Module** (أو **NodeMCU** لـ ESP8266) في Arduino IDE وحمّل الـ sketch.
2.  **اختبر النظام**:
    *   ابدأ تشغيل الغسالة وراقب Serial Monitor لتغيرات مستويات الصوت والحالة.
    *   تحقق من إشعارات Telegram عندما تتوقف الآلة.
3.  **اضبط بدقة**:
    *   اضبط `SOUND_THRESHOLD` أو `STOP_DELAY` إذا حدثت إيجابيات/سلبيات كاذبة.
    *   اختبر في ظروف مختلفة (مثل وجود ضوضاء خلفية) لضمان الموثوقية.
4.  **التثبيت الدائم**:
    *   ثبت المستشعر واللوحة في علبة بالقرب من الآلة، مع ضمان تعريض الميكروفون ولكن مع حمايته من الماء.

---

### مزايا الكشف الصوتي
*   **معالجة أبسط**: لا توجد معالجة للصور، مما يقلل الحمل الحسابي على ESP32.
*   **فعال من حيث التكلفة**: مستشعرات الصوت مثل KY-038 غير مكلفة (غالبًا أقل من 5 دولارات).
*   **غير تدخلي**: لا حاجة لربط أي شيء مباشرة بمصباح لوحة الآلة.

### التحديات والتخفيف منها
*   **الضوضاء الخلفية**: قد تتداخل ضوضاء المنزل (مثل التلفاز، التحدث). خفف من ذلك عن طريق:
    *   وضع المستشعر بالقرب من محرك الآلة أو حوضها.
    *   ضبط `SOUND_THRESHOLD` لتجاهل الضوضاء المحيطة.
    *   استخدام ميكروفون اتجاهي أو ضبط الربح على MAX9814.
*   **المراحل الهادئة**: بعض دورات الغسيل بها توقفات (مثل النقع). يضمن `STOP_DELAY` إرسال الإشعارات فقط بعد صمت مطول.
*   **التعرض للماء**: تأكد من أن المستشعر في علبة مقاومة للماء، حيث قد تكون الغسالات معرضة للرذاذ أو الرطوبة.

### تحسينات اختيارية
*   **تحليل التردد**: إذا كانت الضوضاء الخلفية مشكلة مستمرة، حلل ترددات الصوت (مثل طنين المحرك عند 50-200 هرتز) باستخدام مكتبة مثل `arduinoFFT`. هذا يتطلب المزيد من قوة المعالجة وقد لا يكون مجديًا على ESP32 أساسي دون تحسين.
*   **مستشعرات مزدوجة**: اجمع بين مستشعرات الصوت والاهتزاز (مثل SW-420) للتكرار. إذا أشار كلاهما إلى توقف الآلة، تزداد الثقة في الكشف.
*   **طاقة البطارية**: للح portability، استخدم بطارية LiPo قابلة لإعادة الشحن مع وحدة شحن (مثل TP4056) بدلاً من محول USB.

---

### استكشاف الأخطاء وإصلاحها
*   **لا يوجد كشف للصوت**: تحقق من توصيلات المستشعر، اختبر باستخدام Serial Monitor، وتأكد من أن المستشعر قريب من مصدر ضوضاء الآلة.
*   **إشعارات خاطئة**: زد `STOP_DELAY` أو اضبط `SOUND_THRESHOLD` لتصفية الضوضاء الخلفية أو توقفات الدورة.
*   **مشاكل Wi-Fi**: تحقق من بيانات اعتماد Wi-Fi بتردد 2.4GHz وقوة الإشارة بالقرب من الآلة.
*   **لا توجد رسائل على Telegram**: أكد من رمز البوت ومعرف الدردشة، تحقق من Serial Monitor للبحث عن أخطاء.

نهج الكشف الصوتي هذا أبسط وأكثر متانة في ظروف الإضاءة المختلفة مقارنة بطريقة الكاميرا، مما يجعله مثاليًا لمراقب الغسالة. دعني أعرف إذا كنت بحاجة إلى مساعدة في خطوات محددة، معايرة المستشعر، أو دمج ميزات إضافية!