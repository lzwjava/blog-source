---
audio: false
generated: true
lang: de
layout: post
title: Einrichten eines SFTP-Servers unter Ubuntu
translated: true
type: note
---

Die Einrichtung eines SFTP (SSH File Transfer Protocol) Servers unter Ubuntu ist ein unkomplizierter Prozess, der es Ihnen ermöglicht, Dateien über ein Netzwerk unter Verwendung von SSH-Verschlüsselung sicher zu übertragen. Nachfolgend finden Sie eine vollständige, schrittweise Anleitung, die Ihnen bei der Einrichtung hilft.

---

### Schritt 1: OpenSSH Server installieren
SFTP basiert auf dem OpenSSH Server, den Sie auf Ihrem Ubuntu-System installieren müssen.

1. Öffnen Sie ein Terminal und aktualisieren Sie Ihre Paketliste:
   ```bash
   sudo apt update
   ```

2. Installieren Sie den OpenSSH Server:
   ```bash
   sudo apt install openssh-server
   ```

3. Prüfen Sie, ob der SSH-Dienst läuft:
   ```bash
   sudo systemctl status ssh
   ```
   - Falls er nicht läuft, starten Sie ihn:
     ```bash
     sudo systemctl start ssh
     ```
   - Stellen Sie sicher, dass er beim Booten startet:
     ```bash
     sudo systemctl enable ssh
     ```

---

### Schritt 2: Einen dedizierten SFTP-Benutzer erstellen
Für mehr Sicherheit sollten Sie einen spezifischen Benutzer für den SFTP-Zugriff erstellen.

1. Fügen Sie einen neuen Benutzer hinzu (z. B. `sftpuser`):
   ```bash
   sudo adduser sftpuser
   ```
   - Folgen Sie den Aufforderungen, um ein Passwort zu setzen und optionale Details einzugeben.

2. (Optional) Verhindern Sie, dass dieser Benutzer über SSH auf eine Shell zugreifen kann:
   ```bash
   sudo usermod -s /bin/false sftpuser
   ```

---

### Schritt 3: SSH für SFTP konfigurieren
Sie können entweder allen Benutzern erlauben, SFTP mit ihren Home-Verzeichnissen zu nutzen, oder bestimmte Benutzer auf bestimmte Ordner beschränken.

#### Option 1: SFTP für alle Benutzer erlauben
Wenn Sie möchten, dass alle Benutzer über SFTP auf ihre Home-Verzeichnisse zugreifen können, ist nach der Installation von OpenSSH keine zusätzliche Konfiguration nötig. Fahren Sie mit Schritt 5 fort.

#### Option 2: Einen Benutzer auf ein bestimmtes Verzeichnis beschränken
Um einen Benutzer (z. B. `sftpuser`) auf ein bestimmtes Verzeichnis zu beschränken:

1. Bearbeiten Sie die SSH-Konfigurationsdatei:
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

2. Fügen Sie die folgenden Zeilen am Ende der Datei hinzu:
   ```ini
   Match User sftpuser
       ChrootDirectory /home/sftpuser
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   - Speichern Sie die Datei (`Strg+O`, dann `Eingabe`) und beenden Sie den Editor (`Strg+X`).

3. Diese Konfiguration:
   - Beschränkt `sftpuser` auf `/home/sftpuser`.
   - Erzwingt die ausschließliche Nutzung von SFTP.
   - Deaktiviert zusätzliche Funktionen wie TCP-Forwarding.

---

### Schritt 4: Verzeichnisberechtigungen einrichten
Damit die eingeschränkte Einrichtung (Chroot) funktioniert, passen Sie die Berechtigungen an:

1. Lassen Sie das Chroot-Verzeichnis root gehören:
   ```bash
   sudo chown root:root /home/sftpuser
   ```

2. Erstellen Sie ein beschreibbares Unterverzeichnis für den Benutzer (z. B. `uploads`):
   ```bash
   sudo mkdir /home/sftpuser/uploads
   sudo chown sftpuser:sftpuser /home/sftpuser/uploads
   ```
   - Der Benutzer kann nun Dateien in `/home/sftpuser/uploads` hochladen.

---

### Schritt 5: SSH-Dienst neu starten
Wenden Sie Ihre Änderungen an, indem Sie SSH neu starten:
```bash
sudo systemctl restart ssh
```

---

### Schritt 6: Ihren SFTP-Server testen
Überprüfen Sie, ob der Server funktioniert, indem Sie sich von einem anderen Gerät aus verbinden.

1. Finden Sie die IP-Adresse Ihres Ubuntu-Rechners:
   ```bash
   ip addr show
   ```
   - Suchen Sie nach einer IP wie `192.168.1.100`.

2. Testen Sie die Verbindung:
   - **Von einem Terminal (Linux/macOS):**
     ```bash
     sftp sftpuser@<ubuntu-ip-adresse>
     ```
     - Geben Sie das Passwort ein, wenn dazu aufgefordert.
   - **Mit FileZilla (beliebiges Betriebssystem):**
     - Host: `sftp://<ubuntu-ip-adresse>`
     - Benutzername: `sftpuser`
     - Passwort: (Ihr Passwort)
     - Port: 22

3. Versuchen Sie, eine Datei in den `uploads`-Ordner hochzuladen oder Verzeichnisinhalte aufzulisten.

---

### Schritt 7: Die Firewall konfigurieren
Falls Sie die Ubuntu-Firewall (UFW) verwenden, erlauben Sie SFTP-Datenverkehr:

1. Prüfen Sie den Status der Firewall:
   ```bash
   sudo ufw status
   ```

2. Erlauben Sie SSH/SFTP (Port 22):
   ```bash
   sudo ufw allow 22/tcp
   sudo ufw reload
   ```

---

### Alles erledigt!
Ihr SFTP-Server ist jetzt betriebsbereit! Benutzer können sich sicher verbinden und Dateien in ihre zugewiesenen Verzeichnisse übertragen, indem sie einen SFTP-Client verwenden. Wenn Sie `sftpuser` beschränkt haben, kann dieser nur auf `/home/sftpuser/uploads` (oder wo auch immer Sie es eingerichtet haben) zugreifen. Viel Spaß beim sicheren Dateitransfer!