---
lang: de
layout: post
title: '## Redis入门


  Redis (Remote Dictionary Server) 是一个开源的内存数据结构存储系统，广泛用于缓存、消息队列、实时分析等场景。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合等，并且提供了丰富的操作命令。本文将带你快速入门Redis，了解其基本概念和使用方法。


  ### 1. 安装Redis


  在开始使用Redis之前，首先需要在你的系统上安装Redis。以下是在不同操作系统上安装Redis的步骤：


  #### 在Linux上安装Redis


  ```bash

  sudo apt-get update

  sudo apt-get install redis-server

  ```


  #### 在macOS上安装Redis


  ```bash

  brew install redis

  ```


  #### 在Windows上安装Redis


  Windows上可以通过WSL（Windows Subsystem for Linux）来安装Redis，或者使用Redis的Windows版本。


  ### 2. 启动Redis服务器


  安装完成后，可以通过以下命令启动Redis服务器：


  ```bash

  redis-server

  ```


  默认情况下，Redis会在`127.0.0.1:6379`上运行。


  ### 3. 使用Redis CLI


  Redis提供了一个命令行工具`redis-cli`，用于与Redis服务器进行交互。你可以通过以下命令启动Redis CLI：


  ```bash

  redis-cli

  ```


  启动后，你可以直接在命令行中输入Redis命令。


  ### 4. 基本命令


  以下是一些常用的Redis命令：


  #### 设置和获取键值对


  ```bash

  SET mykey "Hello Redis"

  GET mykey

  ```


  #### 删除键


  ```bash

  DEL mykey

  ```


  #### 检查键是否存在


  ```bash

  EXISTS mykey

  ```


  #### 设置过期时间


  ```bash

  SET mykey "Hello Redis"

  EXPIRE mykey 10  # 10秒后过期

  ```


  #### 查看剩余过期时间


  ```bash

  TTL mykey

  ```


  ### 5. 数据结构


  Redis支持多种数据结构，以下是几种常见的数据结构及其操作：


  #### 字符串（String）


  ```bash

  SET name "Alice"

  GET name

  ```


  #### 哈希（Hash）


  ```bash

  HSET user:1 name "Alice" age 30

  HGET user:1 name

  HGETALL user:1

  ```


  #### 列表（List）


  ```bash

  LPUSH mylist "world"

  LPUSH mylist "hello"

  LRANGE mylist 0 -1

  ```


  #### 集合（Set）


  ```bash

  SADD myset "apple"

  SADD myset "banana"

  SMEMBERS myset

  ```


  #### 有序集合（Sorted Set）


  ```bash

  ZADD myzset 1 "one"

  ZADD myzset 2 "two"

  ZRANGE myzset 0 -1 WITHSCORES

  ```


  ### 6. 持久化


  Redis提供了两种持久化方式：RDB（Redis Database）和AOF（Append-Only File）。RDB是通过快照的方式将数据保存到磁盘，而AOF则是通过记录所有写操作来保证数据的持久化。


  #### RDB配置


  在`redis.conf`中，可以通过以下配置来启用RDB：


  ```bash

  save 900 1

  save 300 10

  save 60 10000

  ```


  #### AOF配置


  在`redis.conf`中，可以通过以下配置来启用AOF：


  ```bash

  appendonly yes

  appendfilename "appendonly.aof"

  ```


  ### 7. 集群


  Redis支持集群模式，可以通过多个Redis实例组成一个集群，以提高系统的可用性和扩展性。Redis集群使用分片（sharding）来将数据分布到多个节点上。


  #### 创建集群


  ```bash

  redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 \

  127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \

  --cluster-replicas 1

  ```


  ### 8. 总结


  本文介绍了Redis的基本概念、安装方法、常用命令以及数据结构。Redis作为一个高性能的内存数据库，广泛应用于各种场景中。通过本文的学习，你应该能够快速上手Redis，并在实际项目中应用它。


  如果你想深入了解Redis的更多高级特性，可以参考Redis的官方文档或相关书籍。'
---

Öffnet man die offizielle Website von Redis, steht dort als erster Satz, dass Redis ein Open-Source-In-Memory-Datenstrukturspeicher ist, der häufig als Datenbank und Cache verwendet wird. `Redis` ist sehr verbreitet.

## Redis installieren

Sie können `Redis` von der offiziellen Website installieren. Genau wie bei `SQLite`. Nach der Installation stellt sich die Frage, wie man `Redis` in `Python` verwendet.

```shell
pip install redis
```

```shell
>>> import redis
>>> r = redis.Redis(host='localhost', port=6379, db=0)
>>> r.set('foo', 'bar')
True
>>> r.get('foo')
b'bar'
```

Die Python-Dokumentation bietet einige Beispiele. Hier taucht etwas wie `pip` auf. `pip` ist ein Paketverwaltungstool. Was ein Paketverwaltungstool ist, können Sie im Kapitel „Programmierumgebung kennenlernen“ nachlesen. `pip` ist für `Python` das, was `Homebrew` für das `macOS`-System ist.

`pip` wird normalerweise bereits mit der Installation von `Python` mitgeliefert. Wenn Ihr Computer mehrere Versionen von `Python` und `Pip` hat, können Sie die folgenden beiden Zeilen in Ihre `~/.bash_profile`-Datei einfügen:

```shell
alias python=/usr/local/Cellar/python@3.9/3.9.1_6/bin/python3
alias pip=/usr/local/Cellar/python@3.9/3.9.1_6/bin/pip3
```

Die Bedeutung besteht darin, eine bestimmte Version von `python` und `pip` festzulegen. Eine Möglichkeit besteht darin, sie über `Homebrew` zu installieren. Es ist auch möglich, sie aus dem Quellcode zu erstellen und zu installieren.

```shell
make
make test
make install
```

```shell
$ redis-server
87684:C 10 Mar 2021 14:46:06.056 # oO0OoO0OoO0Oo Redis startet oO0OoO0OoO0Oo
87684:C 10 Mar 2021 14:46:06.056 # Redis Version=6.2.1, Bits=64, Commit=00000000, modifiziert=0, PID=87684, gerade gestartet
87684:C 10 Mar 2021 14:46:06.056 # Warnung: Keine Konfigurationsdatei angegeben, die Standardkonfiguration wird verwendet. Um eine Konfigurationsdatei anzugeben, verwenden Sie redis-server /pfad/zur/redis.conf
87684:M 10 Mar 2021 14:46:06.057 * Maximale Anzahl offener Dateien auf 10032 erhöht (ursprünglich auf 4864 gesetzt).
87684:M 10 Mar 2021 14:46:06.057 * Monotone Uhr: POSIX clock_gettime
...
Redis 6.2.1 (00000000/0) 64 Bit
...
87684:M 10 Mar 2021 14:46:06.058 # Server initialisiert
87684:M 10 Mar 2021 14:46:06.058 * Bereit, Verbindungen zu akzeptieren
```

Hier ist ein Auszug aus dem Inhalt. Wie man sieht, haben wir es bereits installiert. Die Versionsnummer `6.2.1` ist die neueste auf der offiziellen Website. Öffnen Sie ein weiteres Terminalfenster. Sie können versuchen, damit herumzuspielen:
```shell
$ redis-cli
127.0.0.1:6379> set a 2
OK
127.0.0.1:6379> get a
"2"
```

Führen Sie den folgenden Code aus.

```python
import redis
```

```python
r = redis.Redis(host='localhost', port=6379, db=0)
r.set('foo', 'bar')
print(r.get('foo'))
```

Ausgabe:

```shell
$ python fib_redis.py
b'bar'
```

## Redis Cache Beispiel

来实现斐波那契数列的`Redis`版本。

```python
import redis
```

r = redis.Redis(host='localhost', port=6379, db=0)

```python
def f(n):
    nr = r.get(n)
    if nr is not None:
        return int(nr)
    res_n = 0
    if n < 2:
        res_n = n
    else:
        res_n = f(n-1) + f(n-2)
    
    r.set(n, res_n)
    return res_n
```

```python
print(f(10))
```

Das war's schon!