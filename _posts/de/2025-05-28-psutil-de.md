---
audio: false
generated: true
lang: de
layout: post
title: Python-Skript für TCP-Verbindungen
translated: true
type: note
---

Der PowerShell-Befehl `Get-NetTCPConnection -LocalPort 80` ruft Informationen über TCP-Verbindungen auf einem Windows-System ab, die den angegebenen lokalen Port verwenden (in diesem Fall Port 80). Um eine ähnliche Funktionalität in Python zu erreichen, können Sie die `psutil`-Bibliothek verwenden, die plattformübergreifenden Zugriff auf Systemdetails, einschließlich Netzwerkverbindungen, bietet.

Nachfolgend finden Sie ein Python-Skript, das TCP-Verbindungen auflistet, die nach einem bestimmten lokalen Port (z. B. Port 80) gefiltert sind, ähnlich dem PowerShell-Befehl:

```python
import psutil

def get_tcp_connections_by_port(local_port):
    # Alle Netzwerkverbindungen abrufen
    connections = psutil.net_connections(kind='tcp')
    
    # Verbindungen nach lokalem Port filtern
    matching_connections = [
        conn for conn in connections
        if conn.laddr.port == local_port and conn.status == 'LISTEN'
    ]
    
    # Details der passenden Verbindungen ausgeben
    if not matching_connections:
        print(f"Keine TCP-Verbindungen gefunden, die auf Port {local_port} lauschen")
        return
    
    print(f"TCP-Verbindungen, die auf Port {local_port} lauschen:")
    print("PID\tLokale Adresse\t\tEntfernte Adresse\tStatus")
    print("-" * 60)
    
    for conn in matching_connections:
        local_addr = f"{conn.laddr.ip}:{conn.laddr.port}" if conn.laddr else "N/A"
        remote_addr = f"{conn.raddr.ip}:{conn.raddr.port}" if conn.raddr else "N/A"
        pid = conn.pid if conn.pid is not None else "N/A"
        status = conn.status if conn.status else "N/A"
        print(f"{pid}\t{local_addr}\t{remote_addr}\t{status}")

if __name__ == "__main__":
    target_port = 80  # Port zum Filtern angeben (z. B. 80)
    get_tcp_connections_by_port(target_port)
```

### Erklärung:
1. **`psutil` installieren**:
   - Sie benötigen die `psutil`-Bibliothek, um auf Netzwerkverbindungsdetails zuzugreifen. Installieren Sie sie mit:
     ```bash
     pip install psutil
     ```

2. **Skriptdetails**:
   - `psutil.net_connections(kind='tcp')` ruft alle TCP-Verbindungen ab.
   - Das Skript filtert Verbindungen, bei denen der lokale Port mit dem angegebenen `local_port` (z. B. 80) übereinstimmt und der Status `LISTEN` ist (um das Verhalten von `Get-NetTCPConnection` für lauschende Ports nachzuahmen).
   - Für jede passende Verbindung gibt es aus:
     - **PID**: Prozess-ID der Anwendung, die die Verbindung verwendet.
     - **Lokale Adresse**: Lokale IP und Port.
     - **Entfernte Adresse**: Entfernte IP und Port (falls zutreffend; "N/A" wenn nicht verbunden).
     - **Status**: Verbindungsstatus (z. B. "LISTEN").

3. **Ausgabe**:
   - Die Ausgabe ist so formatiert, dass sie der tabellarischen Ausgabe von `Get-NetTCPConnection` ähnelt und die PID, lokale Adresse, entfernte Adresse und den Status anzeigt.

### Beispielausgabe:
Wenn ein Webserver (z. B. Apache oder Nginx) auf Port 80 lauscht, könnte die Ausgabe wie folgt aussehen:
```
TCP-Verbindungen, die auf Port 80 lauschen:
PID     Lokale Adresse          Entfernte Adresse       Status
------------------------------------------------------------
1234    0.0.0.0:80              N/A                     LISTEN
```

Wenn kein Prozess auf Port 80 lauscht:
```
Keine TCP-Verbindungen gefunden, die auf Port 80 lauschen
```

### Hinweise:
- **Plattformübergreifend**: Die `psutil`-Bibliothek funktioniert unter Windows, Linux und macOS, im Gegensatz zu `Get-NetTCPConnection`, das Windows-spezifisch ist.
- **Berechtigungen**: Auf einigen Systemen (z. B. Linux oder macOS) benötigen Sie möglicherweise Root-/Admin-Rechte, um auf bestimmte Verbindungsdetails zuzugreifen.
- **Filterung**: Das Skript filtert nach `LISTEN`-Verbindungen, um den typischen Anwendungsfall von `Get-NetTCPConnection -LocalPort 80` abzudecken. Sie können den Filter ändern (z. B. die Bedingung `conn.status == 'LISTEN'` entfernen), um andere Verbindungszustände wie `ESTABLISHED` einzuschließen.
- **Zusätzliche Informationen**: Sie können das Skript erweitern, um weitere Details (z. B. Prozessnamen) einzubeziehen, indem Sie `psutil.Process(conn.pid).name()` verwenden, falls eine PID verfügbar ist.

Dieses Skript bietet ein Python-Äquivalent zum PowerShell-Befehl mit ähnlicher Funktionalität und Ausgabe. Wenn Sie zusätzliche Funktionen benötigen oder spezifische Anforderungen haben, lassen Sie es mich wissen!