---
audio: false
generated: true
lang: de
layout: post
title: Einrichten eines SMB-Servers für Medienfreigabe unter Ubuntu
translated: true
type: note
---

Hier ist eine Schritt-für-Schritt-Anleitung zur Einrichtung eines SMB (Server Message Block)-Servers auf Ubuntu, um Mediendateien bereitzustellen. SMB ist ein Protokoll, das die Freigabe von Dateien über ein Netzwerk ermöglicht und somit ideal für die Bereitstellung von Medien für Geräte wie Computer, Fernseher oder Mobilgeräte ist. Wir verwenden Samba, die Software, die SMB-Funktionalität unter Linux bereitstellt, und konfigurieren sie so, dass ein Verzeichnis mit Ihren Mediendateien freigegeben wird.

---

### Schritt 1: Samba installieren
Zuerst müssen Sie Samba auf Ihrem Ubuntu-System installieren. Öffnen Sie ein Terminal und führen Sie die folgenden Befehle aus:

```bash
sudo apt update
sudo apt install samba
```

- `sudo apt update` aktualisiert die Paketliste, um sicherzustellen, dass Sie die neueste Version erhalten.
- `sudo apt install samba` installiert das Samba-Paket, das die notwendigen Tools und Dienste enthält.

---

### Schritt 2: Die Samba-Konfigurationsdatei sichern
Bevor Sie Änderungen vornehmen, ist es eine gute Praxis, die standardmäßige Samba-Konfigurationsdatei zu sichern. Führen Sie aus:

```bash
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
```

Dies erstellt eine Kopie der Originaldatei (`smb.conf.backup`), falls Sie später Änderungen rückgängig machen müssen.

---

### Schritt 3: Die Medienfreigabe konfigurieren
Die Samba-Konfigurationsdatei befindet sich unter `/etc/samba/smb.conf`. Sie bearbeiten diese Datei, um eine Freigabe für Ihre Mediendateien zu definieren. Nehmen wir für dieses Beispiel an, dass Ihre Mediendateien in `/home/user/media` gespeichert sind (ersetzen Sie `user` durch Ihren tatsächlichen Benutzernamen).

1. Öffnen Sie die Konfigurationsdatei in einem Texteditor, z. B. `nano`:
   ```bash
   sudo nano /etc/samba/smb.conf
   ```

2. Scrollen Sie zum Ende der Datei und fügen Sie den folgenden Abschnitt hinzu:
   ```ini
   [media]
       path = /home/user/media
       browseable = yes
       read only = yes
       guest ok = yes
   ```

3. Speichern Sie und beenden Sie den Editor:
   - In `nano` drücken Sie `Strg+O`, dann `Eingabe` zum Speichern und `Strg+X` zum Beenden.

#### Erklärung der Konfiguration:
- `[media]`: Der Name der Freigabe, der für Benutzer sichtbar ist, die das Netzwerk durchsuchen.
- `path = /home/user/media`: Das Verzeichnis, das Sie freigeben möchten (passen Sie dies an den Speicherort Ihres Medienordners an).
- `browseable = yes`: Macht die Freigabe sichtbar, wenn das Netzwerk durchsucht wird.
- `read only = yes`: Verhindert, dass Benutzer Dateien ändern oder löschen (ideal für die Medienbereitstellung).
- `guest ok = yes`: Ermöglicht den Zugriff ohne Benutzernamen oder Passwort, um den Medienzugriff einfach zu halten.

---

### Schritt 4: Die Konfiguration überprüfen
Um sicherzustellen, dass keine Syntaxfehler in Ihrer Konfiguration vorliegen, führen Sie aus:

```bash
testparm
```

Dieser Befehl überprüft die `smb.conf`-Datei und zeigt die geladenen Dienste an. Wenn keine Fehler angezeigt werden, können Sie fortfahren.

---

### Schritt 5: Samba-Dienste neu starten
Samba führt zwei Dienste aus: `smbd` (verarbeitet die Dateifreigabe) und `nmbd` (verarbeitet die Netzwerkerkennung). Starten Sie sie neu, um Ihre Änderungen zu übernehmen:

```bash
sudo systemctl restart smbd
sudo systemctl restart nmbd
```

Um sicherzustellen, dass diese Dienste automatisch beim Systemstart beginnen (standardmäßig normalerweise aktiviert), können Sie ausführen:

```bash
sudo systemctl enable smbd
sudo systemctl enable nmbd
```

---

### Schritt 6: Dateiberechtigungen anpassen
Damit der Gastzugriff funktioniert, müssen das Medienverzeichnis und seine Dateien für alle lesbar sein. Setzen Sie die entsprechenden Berechtigungen mit:

```bash
sudo chmod -R 755 /home/user/media
```

- `755` bedeutet, dass der Eigentümer volle Berechtigungen (Lesen, Schreiben, Ausführen) hat, während andere Lese- und Ausführungsberechtigungen haben (benötigt, um auf Dateien zuzugreifen und sie aufzulisten).
- `-R` wendet die Änderung rekursiv auf alle Dateien und Unterverzeichnisse an.

---

### Schritt 7: Die Firewall konfigurieren
Wenn die Ubuntu-Firewall (UFW) aktiv ist, müssen Sie SMB-Datenverkehr erlauben. Überprüfen Sie zuerst den Status der Firewall:

```bash
sudo ufw status
```

Wenn sie aktiv ist, öffnen Sie die notwendigen Ports:

```bash
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
```

- Die Ports 139 und 445 (TCP) werden für die SMB-Dateifreigabe verwendet.
- Die Ports 137 und 138 (UDP) werden von `nmbd` für die Netzwerkerkennung verwendet.

Laden Sie die Firewall neu, um die Änderungen zu übernehmen:

```bash
sudo ufw reload
```

Wenn die Firewall inaktiv ist, können Sie diesen Schritt überspringen.

---

### Schritt 8: Die SMB-Freigabe testen
Ihr SMB-Server sollte jetzt laufen. So testen Sie ihn:

1. Ermitteln Sie die IP-Adresse Ihres Ubuntu-Rechners:
   ```bash
   ip addr show
   ```
   Suchen Sie nach der IP-Adresse (z. B. `192.168.1.100`) unter Ihrer Netzwerkschnittstelle (wie `eth0` oder `wlan0`).

2. Von einem anderen Gerät im Netzwerk (z. B. einem Windows-PC):
   - Öffnen Sie den Datei-Explorer und geben Sie ein: `\\<ubuntu-ip-adresse>\media` (z. B. `\\192.168.1.100\media`).
   - Sie sollten Ihre Mediendateien sehen. Da der Gastzugriff aktiviert ist, ist keine Anmeldung erforderlich.

---

### Tipps zur Fehlerbehebung
Wenn Sie auf Probleme stoßen:
- **Samba-Protokolle prüfen**: Die Protokolle befinden sich in `/var/log/samba/` (z. B. `log.smbd` oder `log.nmbd`). Verwenden Sie `cat` oder `tail`, um sie anzuzeigen:
  ```bash
  sudo tail -f /var/log/samba/log.smbd
  ```
- **Lokal testen**: Verwenden Sie `smbclient`, um die Freigaben auf Ihrem Ubuntu-Rechner aufzulisten:
  ```bash
  smbclient -L localhost
  ```
  Oder verbinden Sie sich mit der Freigabe:
  ```bash
  smbclient //localhost/media -N
  ```
  (`-N` überspringt die Passwortabfrage für den Gastzugriff.)

---

### Befehlszusammenfassung
Hier die vollständige Befehlssequenz:

```bash
sudo apt update
sudo apt install samba
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
sudo nano /etc/samba/smb.conf  # Fügen Sie den Abschnitt [media] hinzu
testparm
sudo systemctl restart smbd
sudo systemctl restart nmbd
sudo chmod -R 755 /home/user/media
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
sudo ufw allow 137/udp
sudo ufw allow 138/udp
sudo ufw reload
```

Ihr SMB-Server ist jetzt eingerichtet, um Mediendateien aus `/home/user/media` bereitzustellen! Greifen Sie von jedem Gerät in Ihrem Netzwerk über die IP-Adresse und den Freigabenamen (`\\<ip-adresse>\media`) darauf zu.