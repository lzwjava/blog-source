---
audio: false
generated: true
image: false
lang: zh
layout: post
model: x-ai/grok-code-fast-1
title: Git钩子指南：预提交与预推送
translated: true
type: note
---

### Git 钩子概述
Git 钩子是在 Git 工作流特定节点自动执行的可定制脚本，可分为客户端钩子（在本地机器运行）和服务端钩子（在远程仓库运行）。这些钩子存储在仓库的 `.git/hooks/` 目录中。下面我将分别解析与推送操作相关的 pre-commit、pre-push 及服务端钩子的执行机制。

### 客户端钩子：Pre-Commit 与 Pre-Push
这类钩子在操作完成前于本地运行，可用于实施规范或执行检查。

- **Pre-Commit 钩子**：
  - **触发时机**：在执行提交操作时自动触发（如通过 `git commit` 命令）
  - **作用**：适用于代码质量检查，例如运行代码检查工具、测试用例或格式化工具。若钩子执行失败（返回非零状态码），则提交操作会被中止
  - **示例**：典型的 pre-commit 钩子可运行 JavaScript 文件的 `eslint` 检查，若存在错误则阻止提交
  - **运作方式**：脚本位于 `.git/hooks/pre-commit`，需通过 `chmod +x .git/hooks/pre-commit` 赋予可执行权限。使用 Husky 等钩子管理工具可简化配置流程

- **Pre-Push 钩子**：
  - **触发时机**：在执行推送操作前自动触发（如通过 `git push` 命令）
  - **作用**：用于在代码发送到远程仓库前进行最终验证，例如运行测试套件、检查代码覆盖率或确保兼容性。若验证失败则阻断推送
  - **关于“prepush”的说明**：Git 标准钩子中不存在 "prepush"（无连字符）钩子，此处特指带连字符的 "pre-push" 钩子。可通过 Husky 等工具创建自定义 pre-push 脚本实施诸如“测试全部通过才允许推送”的规则
  - **示例**：pre-push 钩子可执行 `npm test` 命令，若测试失败则中止推送。使用 `git push --no-verify` 可跳过该钩子
  - **运作方式**：脚本位于 `.git/hooks/pre-push`，需设置可执行权限。该钩子会接收远程名称和引用等参数

客户端钩子能有效在早期发现问题，避免有问题的提交或推送传播到远程仓库。

### 推送过程中的服务端钩子
当执行 `git push` 时，推送内容会发送至远程仓库（如 GitHub、GitLab 或自建服务器）。远程仓库可配置在推送过程中或完成后执行的服务端钩子，这些钩子存储在远程 Git 仓库的 `.git/hooks/` 目录，由服务器管理员管理。

- **推送执行流程**：
  1. **本地检查**：优先运行 pre-push 钩子（若存在）
  2. **数据传输**：将变更内容发送至远程仓库
  3. **远程执行**：服务端钩子在远程服务器执行（非本地机器）

- **Pre-Receive 钩子**：
  - **触发时机**：在远程服务器接收推送后、更新任何引用（分支或标签）前立即执行
  - **作用**：验证传入的变更内容，可执行提交信息规范检查、代码审查状态验证或安全扫描等。若检查不通过则拒绝整个推送
  - **运作方式**：若钩子返回非零状态码，推送将被拒绝并显示错误信息。例如：可配置该钩子阻止推送超过特定尺寸的文件

- **Update 钩子**（功能类似 Pre-Receive 但按引用执行）：
  - **触发时机**：在每个待更新的分支/标签上执行，位于 pre-receive 钩子之后
  - **作用**：提供更精细的控制，例如验证推送者权限或检查分支命名规范
  - **运作方式**：接收待更新引用的详细信息

- **Post-Receive 钩子**：
  - **触发时机**：在远程服务器完全接收推送且引用更新完成后执行
  - **作用**：触发后续自动化流程，例如代码部署、发送通知（如 Slack 提醒）或执行“重建应用”等部署后脚本
  - **运作方式**：在推送成功后稳定执行。典型应用场景：自动触发 CI/CD 流水线或更新网页服务器

服务端钩子提供集中式管控机制，即使本地钩子被绕过，远程仓库仍可对推送进行验证或响应。虽然 GitHub 等平台使用 Webhook（基于 API 的等效方案）实现类似功能，但在原生 Git 服务器或自托管仓库中，上述钩子仍是核心管控手段。

### 核心差异与最佳实践
- **本地与服务端**：客户端钩子（如 pre-commit/pre-push）提供快速本地反馈，服务端钩子实施仓库级统一规范
- **定制能力**：钩子本质是 Shell 脚本（如 Bash），但可调用 Python、Node.js 等程序。建议使用 pre-commit 等框架进行统一管理
- **绕过机制**：可通过 `git commit --no-verify` 跳过提交钩子，`git push --no-verify` 跳过推送钩子，但服务端钩子仅管理员可绕过
- **配置建议**：钩子不会在仓库间自动复制，可将其添加到仓库模板或使用专用工具进行安装

如需具体配置，请参考 Git 官方文档或 Husky（适用于 Node 项目）等工具。若您有特定使用场景（例如需要代码示例），提供更多细节可获取针对性建议！