---
audio: false
generated: true
lang: zh
layout: post
title: Control-M 中的 ctmfw 命令
translated: true
type: note
---

Control-M 中的 `ctmfw` 命令是文件监控工具的一部分，用于监视文件的创建、删除或传输完成等事件。根据 Control-M 文档定义的参数，命令 `ctmfw %%FILENAME CREATE 0 60 10 3 1410` 可解析如下：

- **`ctmfw`**：Control-M 文件监控工具，用于检测文件相关事件并根据条件触发操作，例如启动作业或执行命令。

- **`%%FILENAME`**：表示要监视的文件名或路径的变量（例如 `datafile.txt` 或模式如 `*.csv`）。实际文件名在运行时解析，通常在 Control-M 作业或环境中定义。

- **`CREATE`**：操作模式，表示工具正在监视指定文件的**创建**。其他可能的模式包括 `DELETE`（用于监视文件删除）。

- **`0`**：文件被视为有效所需的最小文件大小（以字节为单位）。值为 `0` 表示接受任何文件大小，因此无论文件大小如何，工具都会检测到该文件。

- **`60`**：连续尝试检查文件存在的时间间隔（以秒为单位）。工具每 60 秒检查一次文件是否已创建。

- **`10`**：检测到文件后，监视文件大小的尝试间隔（以秒为单位）。这确保文件大小稳定（不再被写入）。工具每 10 秒检查一次文件大小。

- **`3`**：文件大小必须保持静态（未更改）的迭代次数，以确认文件已完全创建。工具检查文件大小 3 次（每次间隔 10 秒，总计 30 秒）以确保其稳定。

- **`1410`**：工具在等待文件创建并满足大小条件时运行的最长时间（以分钟为单位）。1410 分钟约等于 23.5 小时。如果在此时间内未检测到文件或文件未稳定，工具将超时并可能执行 `DO_NOTOK` 操作（例如报告“文件未创建”）。

### 工作原理
此命令监视由 `%%FILENAME` 指定的文件的创建。它每 60 秒检查一次文件是否存在。一旦检测到文件，它会验证文件大小在 3 次迭代（每次间隔 10 秒，总计 30 秒）中保持不变。该过程将持续最多 1410 分钟（23.5 小时）或直到文件被检测到并稳定。如果文件创建并满足条件，则执行 `DO_OK` 操作（例如触发作业或命令）。否则，执行 `DO_NOTOK` 操作。

### 示例场景
如果 `%%FILENAME` 设置为 `/home/controlm/datafile.txt`，工具将：
- 每 60 秒检查一次 `datafile.txt`。
- 一旦找到，确保其大小在 30 秒内稳定（3 次检查，每次间隔 10 秒）。
- 运行最多 23.5 小时或直到文件稳定。
- 如果成功，可能触发作业（例如将文件移动到另一个目录）。如果超时，可能记录“文件未创建”。

### 注意事项
- `%%FILENAME` 变量必须在 Control-M 作业或环境中定义，否则命令将失败。
- 工具会忽略修改时间超过 50 年的文件。
- 如果在 `%%FILENAME` 中使用通配符（例如 `*.csv`），可能需要其他参数（如 `MONITOR_FILE_SIZE`）来处理多个文件。
- 对于循环监视（检测后重复检查），需要 `CYCLIC_INTERVAL` 参数，但此处未指定。

此解释基于 Control-M 文件监控文档，来源包括 BMC 官方文档和社区讨论。[](https://documents.bmc.com/supportu/controlm-saas/en-US/Documentation/ctmfw.htm)[](https://documents.bmc.com/supportu/9.0.21/en-US/Documentation/ctmfw.htm)[](https://pdfslide.net/documents/file-watcher-for-control-m.html)