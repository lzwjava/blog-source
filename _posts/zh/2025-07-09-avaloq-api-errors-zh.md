---
audio: false
generated: true
lang: zh
layout: post
title: Avaloq API错误排查指南
translated: true
type: note
---

## Avaloq API错误全面指南

### 常见系统级错误

**1. Avaloq代理执行错误**
在Avaloq系统或Oracle上执行Avaloq代理代码时出现的错误。如果在Avaloq系统上执行的作业以错误结束，则可能发生这些错误。

**故障排除：**
- 检查Oracle数据库连接性
- 验证Avaloq代理配置
- 查看系统日志中与数据库相关的问题
- 确保执行用户具有适当权限

**2. 作业取消错误**
日志中的以下行表示由于Avaloq系统上的内部错误，作业已被取消。该作业的最终状态对Avaloq代理有效：YYYY-MM-DD hh:mm:ss 作业642执行：作业已完成但存在故障。

**故障排除：**
- 查看作业日志以了解具体失败原因
- 检查系统资源可用性
- 验证作业参数和依赖关系
- 监控执行期间的系统性能

### 银行环境中的标准HTTP API错误

**1. 400错误请求**
Avaloq环境中的常见原因：
- 无效的账号或客户ID
- 交易金额格式错误
- 交易订单中缺少必填字段
- 无效的日期格式或范围

**故障排除：**
- 检查URL确保发送有效的数据参数并使用正确的请求头
- 根据Avaloq的模式要求验证所有输入参数
- 检查货币代码和格式
- 验证账户状态和权限

**2. 401未授权**
银行特定原因：
- 无效的API凭据
- 过期的认证令牌
- 用户对特定操作权限不足
- 客户关系限制

**故障排除：**
- 验证API密钥和密钥的有效性
- 检查令牌过期时间
- 确认用户具有适当的银行权限
- 审查客户-顾问关系映射

**3. 403禁止访问**
财富管理上下文：
- 对特定客户账户的访问被拒绝
- 操作受到监管限制
- 合规规则违规
- 基于管辖区的限制

**故障排除：**
- 审查用户访问权限和角色
- 检查合规规则和限制
- 验证监管权限
- 确认跨境交易许可

**4. 404未找到**
银行特定场景：
- 不存在的账号
- 无效的投资组合ID
- 缺失的交易参考号
- 已删除或归档的客户记录

**故障排除：**
- 仔细检查端点确保拼写正确
- 验证账户存在性和状态
- 检查已归档或非活动账户
- 确认正确的URL构造

**5. 500内部服务器错误**
系统级问题：
- 数据库连接问题
- 核心银行系统故障
- 集成服务中断
- 内存或性能问题

**故障排除：**
- 检查系统健康仪表板
- 审查数据库连接池
- 监控系统资源利用率
- 验证依赖服务可用性

### Avaloq特定错误类别

**1. 业务单元错误**
引用Avaloq系统上不存在的业务单元的RA Avaloq作业可能被执行

**常见问题：**
- 无效的业务单元引用
- 非活动或已删除的业务单元
- 不正确的组织层次结构映射

**2. 集成错误**
基于Avaloq的集成能力：
- API版本不匹配
- 模式验证失败
- 消息格式不兼容
- 与外部系统的超时问题

**3. 合规和监管错误**
- 交易前检查失败
- 反洗钱/了解你的客户验证错误
- 监管报告问题
- 跨境交易限制

### 错误处理最佳实践

**1. 日志记录和监控**
- 为所有API调用实施全面的日志记录
- 为关键错误模式设置警报
- 监控API响应时间和成功率
- 跟踪业务特定的错误模式

**2. 错误响应结构**
典型的Avaloq错误响应应包括：
- 错误代码和类别
- 人类可读的错误消息
- 时间戳和请求ID
- 建议的修复步骤

**3. 重试逻辑**
- 对瞬时错误实施指数退避
- 避免在认证失败时重试
- 设置最大重试限制
- 对系统故障使用断路器模式

**4. 测试和验证**
Avaloq通过利用由AWS支持的Avaloq沙盒解决方案管理各个阶段的复杂性，为企业测试和集成新解决方案奠定了良好基础。

**推荐测试方法：**
- 使用Avaloq沙盒环境进行测试
- 系统地测试错误场景
- 验证不同用户角色的错误处理
- 测试与外部系统的集成点

### 错误预防策略

**1. 输入验证**
- 在API调用前验证所有输入参数
- 使用正确的数据类型和格式
- 在适当的地方实施客户端验证
- 在提交前检查业务规则

**2. 连接管理**
- 实施适当的连接池
- 优雅处理超时
- 对依赖服务使用健康检查
- 监控API速率限制

**3. 安全考虑**
- 实施适当的认证处理
- 使用安全通信渠道
- 适当记录安全相关错误
- 谨慎处理错误消息中的敏感数据

如需具体的错误代码和详细的故障排除流程，请查阅您的Avaloq系统文档或直接联系Avaloq支持，因为许多错误细节特定于您的实施和配置。