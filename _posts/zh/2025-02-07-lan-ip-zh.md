---
audio: true
lang: zh
layout: post
title: 局域网IP扫描器
translated: true
---

## 局域网IP扫描器

这个Python脚本扫描局域网以查找活动的IP地址。它使用`ping`命令检查主机是否可达，并使用多线程来加快扫描过程。信号量限制并发线程的数量，以避免压垮系统。脚本接受网络地址（例如，“192.168.1.0/24”）作为输入，并打印网络中每个IP地址的运行状态（正常或异常）。

此脚本通过扫描活动IP地址来帮助识别网络上的设备，例如以有线桥接模式运行的TP-LINK网状路由器。


```python
import subprocess
import ipaddress
import threading
import os

MAX_THREADS = 50  # 最大线程数

def is_host_up(host):
    """
    使用ping检查主机是否正常运行。
    如果主机正常运行，则返回True，否则返回False。
    """
    try:
        # -c 1: 只发送1个数据包
        # -W 1: 等待1秒钟响应
        subprocess.check_output(["ping", "-c", "1", "-W", "1", host], timeout=1)
        return True
    except subprocess.CalledProcessError:
        return False
    except subprocess.TimeoutExpired:
        return False

def scan_ip(ip_str):
    """
    扫描单个IP地址并打印其状态。
    """
    if is_host_up(ip_str):
        print(f"{ip_str} is up")
    else:
        print(f"{ip_str} is down")

def scan_network(network):
    """
    使用线程扫描网络中的活动主机，限制并发线程数。
    """
    print(f"Scanning network: {network}")
    threads = []
    semaphore = threading.Semaphore(MAX_THREADS)  # 限制并发线程数

    def scan_ip_with_semaphore(ip_str):
        semaphore.acquire()
        try:
            scan_ip(ip_str)
        finally:
            semaphore.release()

    for ip in ipaddress.IPv4Network(network):
        ip_str = str(ip)
        thread = threading.Thread(target=scan_ip_with_semaphore, args=(ip_str,))
        threads.append(thread)
        thread.start()

    for thread in threads:
        thread.join()

if __name__ == "__main__":
    network_to_scan = "192.168.1.0/24"  # 将此更改为您的网络
    scan_network(network_to_scan)

```

## 跳过本地IP

该脚本识别活动的IP地址。为确保正确的网络通信，请验证是否已将代理设置配置为跳过这些本地IP。

```bash
192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,127.0.0.1,localhost,*.local,timestamp.apple.com,sequoia.apple.com,seed-sequoia.siri.apple.com, 192.168.1.0/16
```
