---
audio: false
generated: true
lang: zh
layout: post
title: DNS全面解析
translated: true
type: note
---

### 核心要点
- DNS（域名系统）将诸如 google.com 之类的域名转换为诸如 142.251.46.238 之类的 IP 地址，使互联网更易于使用。
- 它通过根域名服务器、顶级域名服务器和权威域名服务器的分层结构运行，确保高效查询。
- DNS 查询过程通常需要 20-120 毫秒，并按顺序查询这些服务器。
- 常见的 DNS 记录包括 A、AAAA、CNAME、MX、NS 和 PTR，每种记录都有特定的功能，如邮件路由或 IP 映射。

### 什么是 DNS？
DNS，即域名系统，就像是互联网的电话簿。它将易于记忆的域名（例如 google.com）转换为计算机用于定位服务器的数字 IP 地址（例如 142.251.46.238）。该系统对于无需记忆复杂数字即可浏览网页至关重要。

### DNS 如何工作？
DNS 通过分层结构运行：
- **根域名服务器**：全球有 13 个逻辑根服务器，每个都由多个物理服务器支持，存储有关顶级域名服务器的信息。
- **顶级域名服务器**：这些服务器管理诸如 .com 或 .org 之类的域名扩展，保存有关权威域名服务器的数据。
- **权威域名服务器**：这些服务器提供特定域名的实际 IP 地址，由 GoDaddy 或 Namecheap 等注册商维护。

当您输入域名时，您的浏览器会向 DNS 解析器发送请求。如果解析器没有缓存的 IP，它会查询根服务器，然后是 TLD 服务器，最后是权威服务器以获取 IP 地址，此过程通常需要 20-120 毫秒。

### DNS 记录类型
DNS 使用各种记录来实现不同目的：
- **A 记录**：将域名映射到 IPv4 地址。
- **AAAA 记录**：映射到 IPv6 地址。
- **CNAME 记录**：将一个域名别名指向另一个域名，对于子域名很有用。
- **MX 记录**：将电子邮件定向到邮件服务器。
- **NS 记录**：指定权威域名服务器。
- **PTR 记录**：将 IP 地址映射回域名以进行反向查询。

---

### 调研笔记：DNS 综合分析

本节详细探讨域名系统，扩展了上述要点和过程。旨在为对互联网导航技术基础感兴趣的读者提供透彻的理解，内容源自权威资料并力求清晰。

#### DNS 简介
域名系统是互联网的关键组成部分，作为一个分布式的分层数据库，它将人类可读的域名（例如 google.com）转换为机器可读的 IP 地址（例如 142.251.46.238）。这种转换对于使用户无需记忆数字地址即可访问网站至关重要，考虑到互联网的规模，记忆数字地址是不切实际的。DNS 作为应用层服务在网络边缘运行，确保无缝连接和可扩展性。

#### 历史背景与重要性
DNS 的开发是为了解决早期系统（需要手动更新主机文件）的局限性，随着互联网的发展，这种局限性变得不可持续。如今，它不仅支持网页浏览，还支持邮件路由、负载均衡等，使其成为现代数字基础设施不可或缺的一部分。其设计侧重于分布和层次结构，确保其能够处理每日数十亿的查询，这证明了其稳健性。

#### DNS 层次结构与结构
DNS 系统采用分层结构来有效管理海量域名：

| **层级**                   | **描述**                                                                                                   | **示例**                                   |
|----------------------------|-----------------------------------------------------------------------------------------------------------|-------------------------------------------|
| 根域名服务器               | 存储 TLD 域名服务器的 IP 地址；全球有 13 个逻辑服务器，每个都有多个物理实例以实现冗余。                       | 由 ICANN 等组织管理。                       |
| 顶级域名服务器             | 管理诸如 .com、.edu、.net、.org 等域名扩展；存储有关权威域名服务器的信息。                                   | .com, .org, .us, .test.                  |
| 权威域名服务器             | 保存特定域名的实际 DNS 记录，提供 IP 地址以响应查询。                                                         | 由 Cloudflare、Namecheap、GoDaddy 等提供商维护。 |
| 递归 DNS 服务器（解析器）   | 充当中介，根据需要与更高级别的服务器通信来处理查询。                                                           | 通常由 ISP 或公共服务（如 Google Public DNS）提供。 |

这种层次结构确保查询被有效路由，每个层级通过委派责任来减少更高层级的负载。

#### DNS 查询过程：逐步解析
DNS 解析过程是一系列查询和响应，最终将 IP 地址传递给客户端。以下是详细分解：

1.  **初始请求**：当用户输入域名（例如 google.com）时，浏览器会将其发送到配置的 DNS 解析器。
2.  **缓存检查**：解析器首先检查其缓存中是否有该 IP 地址。如果找到，则立即返回，从而加速过程。
3.  **根服务器查询**：如果未缓存，解析器会查询根域名服务器，根服务器识别 TLD（例如 .com）并返回相应 TLD 服务器的 IP 地址。
4.  **TLD 服务器查询**：解析器然后查询 TLD 服务器，TLD 服务器提供 google.com 的权威域名服务器的 IP 地址。
5.  **权威服务器查询**：解析器查询权威域名服务器，权威服务器返回 IP 地址，例如 142.251.46.238。
6.  **响应客户端**：解析器缓存此信息以备将来使用，并将 IP 地址发送回浏览器，浏览器随后连接到 Web 服务器。

这个过程，称为迭代查询解析，通常需要 20-120 毫秒，正如 Web 性能工具 YSlow 所指出的。另一种方式是递归解析，涉及解析器处理所有步骤，但迭代方式更常见，效率更高。

#### DNS 记录类型及其功能
DNS 记录是 DNS 数据库中的条目，定义了域名如何被解析。下表详细介绍了最常用的类型，基于近期的见解：

| **记录类型** | **功能**                                                                                                   | **示例用例**                               |
|--------------|-----------------------------------------------------------------------------------------------------------|------------------------------------------|
| A (地址)     | 将域名映射到 IPv4 地址，对于基本的 Web 访问至关重要。                                                          | www.example.com → 192.0.2.1              |
| AAAA         | 将域名映射到 IPv6 地址，支持现代互联网协议。                                                                  | www.example.com → 2001:db8::1            |
| CNAME (规范名称) | 将一个域名别名指向另一个域名，隐藏子域名的实际域名。                                                           | web.example.com → example.com            |
| MX (邮件交换器) | 将电子邮件流量定向到正确的邮件服务器，对于电子邮件投递至关重要。                                                   | @sales.example.com → mail.example.com    |
| NS (名称服务器) | 指定域名的权威域名服务器，有助于查询路由。                                                                     | ns1.example.com, ns2.example.com         |
| PTR (指针)   | 提供反向 DNS 查询，将 IP 地址映射回域名以进行验证。                                                              | 192.0.2.1 → www.example.com             |

这些记录实现了从 Web 托管到电子邮件管理的各种功能，对于系统管理员和开发人员至关重要。

#### 性能与可扩展性
DNS 为可扩展性而设计，各个层级的缓存减少了查询时间。递归服务器缓存响应，浏览器可能会在一段时间内缓存 DNS 结果，从而提高频繁访问的速度。其分布式特性，加上全球数千台服务器，确保了高可用性和容错性，这是近期系统设计讨论中强调的一个特性。

#### 实际影响与用例
理解 DNS 对于 Web 开发人员、网络管理员甚至普通用户都至关重要。例如，配置 MX 记录对于设置电子邮件服务至关重要，而 CNAME 记录简化了子域名管理。诸如 DNS 劫持或解析缓慢等问题可能会中断服务，这凸显了稳健 DNS 配置的重要性，正如近期 ByteByteGo 帖子中所讨论的。

#### 结论
DNS 是互联网的支柱，通过其分层结构和高效的解析过程实现无缝导航。它能够处理多种记录类型并扩展以满足全球需求，使其成为现代数字基础设施的基石。如需进一步阅读，请参阅 [域名系统查询如何工作？](https://blog.bytebytego.com/p/how-does-the-domain-name-system-dns) 和 [DNS 速成课程](https://blog.bytebytego.com/p/a-crash-course-in-dns-domain-name) 的详细分析。

本笔记基于 ByteByteGo YouTube 视频"关于 DNS 您需要了解的一切：系统设计速成课程 #4"及其相关博客文章的内容，确保为读者提供全面的概述。

### 主要引用
- [域名系统查询如何工作？博客文章](https://blog.bytebytego.com/p/how-does-the-domain-name-system-dns)
- [DNS 域名系统速成课程博客文章](https://blog.bytebytego.com/p/a-crash-course-in-dns-domain-name)
- [EP143 您应该了解的 DNS 记录类型博客文章](https://blog.bytebytego.com/p/ep143-dns-record-types-you-should)