---
audio: false
generated: true
image: false
lang: zh
layout: post
title: Git垃圾回收机制详解
translated: true
type: note
---

`git gc` 代表 **Git 垃圾回收**。这是一个用于清理和优化本地仓库的日常维护命令。

### 功能说明

* **压缩文件历史**：Git 将对象（提交记录、目录树、文件内容）存储在数据库中。随着时间的推移，会积累大量松散对象。`git gc` 会将这些对象打包成紧凑的二进制文件以节省磁盘空间。
* **清理不可达对象**：如果您删除分支或进行变基操作，某些提交可能不再被任何引用关联。Git 会暂时保留这些对象，但 `git gc` 最终会将其清除。
* **优化引用文件**：重新整理并打包引用文件（如标签和分支），加速查找过程。
* **修剪 reflog 记录**：自动删除超过保存期限的旧 reflog 条目（HEAD 变更记录）。

### 自动触发机制

* 当松散对象或打包文件数量超过阈值时，Git 会自动在后台执行 **`gc` 操作**。例如进行大量提交、变基或合并操作后可能触发。
* 许多 Git 命令（如 `git fetch`、`git merge` 或 `git rebase`）会检测是否需要执行垃圾回收，并在必要时自动运行。
* 这种机制可确保代码库保持良好性能，无需人工干预。

### 手动执行场景

* 当代码库出现**运行缓慢**或**体积膨胀**时（如 `.git` 文件夹过大）。
* 完成**大规模清理**后（例如删除分支或从历史记录中移除大文件）。
* 需要立即执行清理时：

  ```bash
  git gc --prune=now --aggressive
  ```

  *（注意：`--aggressive` 参数在大型仓库上可能耗时较长）*

---

需要继续了解如何**查看 Git 最近自动执行 `gc` 的时间**以及触发自动回收的阈值条件吗？