---
audio: false
generated: true
image: false
lang: zh
layout: post
model: x-ai/grok-4-fast
title: DNS 简明解析
translated: true
type: note
---

### DNS 的含义是什么？

DNS 代表 **域名系统**。它本质上是互联网（和本地网络）的"电话簿"。它将人类可读的域名（如 `www.example.com` 或 `google.com`）转换为机器可读的 IP 地址（如 `192.0.2.1` 或 `8.8.8.8`）。如果没有 DNS，您就必须记住并输入原始 IP 地址才能访问网站，这很不现实。

DNS 是分层工作的：您的设备会查询 DNS 服务器（一种专门处理此类查询的服务器），该服务器要么知道答案，要么将查询向上转发给权威服务器，直到将名称解析为 IP 地址。

### 在 macOS 或 Windows 上配置 DNS

当您在 macOS（在"系统设置" > "网络"中）或 Windows（在"设置" > "网络和 Internet" > "以太网/Wi-Fi" > "属性"中）配置网络设置时，**DNS** 部分允许您手动指定 DNS 服务器或使用网络提供的默认服务器。常见的默认服务器包括：
-   您 ISP 的 DNS 服务器。
-   公共 DNS 服务器，例如 Google 的 `8.8.8.8` 和 `8.8.4.4`，或 Cloudflare 的 `1.1.1.1`。

如果您将其设置为"自动"（通常通过 DHCP，如您所述），则由您的路由器或网络为您提供这些 DNS 服务器。

您列出的其他详细信息：
-   **192.168.1.1**：这通常是您路由器的本地 IP 地址（"默认网关"）。它是您家庭网络通往外部互联网的大门。
-   **IPv4 使用 DHCP**：DHCP（动态主机配置协议）是一种服务，可自动为网络上的设备分配 IP 地址和其他网络信息。"使用 DHCP"意味着您的计算机不选择静态 IP，而是动态地向 DHCP 服务器（通常是您的路由器）请求一个。

### 您的计算机如何连接到网络并处理 IP/主机查询

让我们逐步分析当您的计算机"访问网络"（即连接到 Wi-Fi 或以太网）时的过程：

1.  **初始连接和 DHCP 握手**：
    -   当您连接时，您的计算机会广播一个 DHCP"发现"请求："嘿，有人能给我一个可用的 IP 地址吗？"
    -   您的**路由器**（充当 DHCP 服务器）会响应一个"提供"："当然，这是给您的 IP（例如 192.168.1.100），还有您的子网掩码（例如 255.255.255.0）、默认网关（192.168.1.1）和 DNS 服务器 IP（例如 8.8.8.8）。"
    -   您的计算机接受（"请求"）并确认（"确认"）。现在它拥有了在本地网络上通信所需的一切。
    -   这还不涉及 DNS——这只是为了您设备自身的 IP 和基本路由。您的"主机"（主机名，例如您计算机的名称）可能在您的设备本地设置或在路由器处注册用于本地名称解析，但那是分开的。

2.  **解析主机（DNS 介入的地方）**：
    -   一旦连接，如果您尝试访问 `www.google.com`，您的计算机还不知道其 IP 地址。它会向 DHCP 提供的 DNS 服务器（可能是路由器的 IP 或外部 DNS 服务器）发送 **DNS 查询**。
    -   **它会先到达路由器吗？** 通常是，间接地：
        -   如果您的路由器配置为 DNS 代理/转发器（在家庭路由器中很常见，例如 TP-Link、Netgear 或 Apple Airport），您的计算机会首先查询路由器（例如，通过 192.168.1.1 作为 DNS 服务器）。
        -   路由器检查其本地缓存（为了速度）。如果它有答案（来自先前的查询），它会直接响应。如果没有，它会将查询转发给上游 DNS 服务器（例如您 ISP 的或您设置的公共 DNS 服务器）。
    -   上游 DNS 服务器解析它（例如，`www.google.com` → `142.250.190.14`）并将 IP 地址通过链路发送回您的计算机。
    -   您的计算机然后使用该 IP 地址连接到网站。

3.  **路由器如何处理这些查询**：
    -   **DHCP 查询**：路由器维护一个可用 IP 地址池（例如 192.168.1.50 到 192.168.1.150）。当您请求一个时，它会将其租用给您一段时间（例如 24 小时），在其表中进行跟踪，并在需要时续订。如果您设置了主机名（例如用于本地访问，如 `ping mylaptop.local`），它也会处理您的主机名。
    -   **DNS 查询**：路由器并不"拥有" DNS 记录——它是一个中间人。它：
        -   缓存响应以避免重复的上游查询（提高速度并减少带宽使用）。
        -   将未解析的查询转发给配置的上游服务器。
        -   可能会应用家长控制、广告拦截（通过像 Pi-hole 这样的自定义 DNS）或日志记录。
        -   如果查询是针对本地设备的（例如，您网络上的另一台计算机），它可能会通过其本地 hosts 文件或 mDNS（组播 DNS，被 macOS/Apple 设备上的 Bonjour 使用）来解析它。
    -   错误？如果 DNS 失败（例如，错误的服务器 IP），您将无法解析名称——网站将无法加载，但直接 ping IP 地址可能有效。

简而言之：DHCP 从路由器获取您计算机的"地址和方向"。然后 DNS 使用这些方向来询问"这个网站在哪里？"——通常通过路由器路由到外部解析器。

如果您正在对特定设置进行故障排除，请分享更多详细信息，例如您的路由器型号或确切错误！