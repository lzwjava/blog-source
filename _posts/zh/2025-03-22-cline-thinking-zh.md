---
audio: false
generated: true
lang: zh
layout: post
title: Clineæ€ç»´â€”â€”è°ƒè¯•Hetzneräº‘æœåŠ¡å™¨å¿«ç…§è„šæœ¬
translated: true
type: note
---

$0.8984

## åˆå§‹è°ƒè¯•è¿‡ç¨‹

æ£€æŸ¥ç‚¹
æ¯”è¾ƒ
æ¢å¤

**æ€è€ƒè¿‡ç¨‹**
æˆ‘éœ€è¦ä¿®å¤ `hetzner.py` æ–‡ä»¶ä¸­çš„ä¸€ä¸ªé”™è¯¯ã€‚é”™è¯¯æ˜¾ç¤º 'Server' å¯¹è±¡æ²¡æœ‰ 'create_snapshot' å±æ€§ã€‚é¦–å…ˆè®©æˆ‘æ£€æŸ¥è¯¥æ–‡ä»¶çš„å†…å®¹ä»¥äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ ¹æ®ç¯å¢ƒè¯¦æƒ…ï¼Œè¯¥æ–‡ä»¶ä½äº `scripts/auto-ss-config/hetzner.py`ï¼Œå› æ­¤æˆ‘éœ€è¦è¯»å–æ­¤æ–‡ä»¶æ¥ç†è§£é—®é¢˜ã€‚

è®©æˆ‘æ£€æŸ¥ hetzner.py æ–‡ä»¶æ¥ç†è§£å¹¶ä¿®å¤ 'Server' å¯¹è±¡æ²¡æœ‰ 'create_snapshot' å±æ€§çš„é”™è¯¯ã€‚

**æ€è€ƒï¼š**
æˆ‘éœ€è¦ä¿®å¤ 'Server' å¯¹è±¡æ²¡æœ‰ 'create_snapshot' å±æ€§çš„é”™è¯¯ã€‚æŸ¥çœ‹ä»£ç ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªå‡½æ•° `create_snapshot(server)` è¯•å›¾è°ƒç”¨ `server.create_snapshot()`ï¼Œä½†æ ¹æ®é”™è¯¯ä¿¡æ¯ï¼ŒServer å¯¹è±¡ä¸Šä¸å­˜åœ¨æ­¤å±æ€§/æ–¹æ³•ã€‚è¿™è¡¨æ˜åœ¨ hcloud Python åº“ä¸­ï¼ŒServer ç±»æ²¡æœ‰åä¸º create_snapshot çš„æ–¹æ³•ã€‚æˆ‘åº”è¯¥ä½¿ç”¨ client å¯¹è±¡æ¥åˆ›å»ºå¿«ç…§ã€‚è®©æˆ‘ä¿®æ”¹ä»£ç ï¼Œé€šè¿‡ä½¿ç”¨ client.servers API è€Œä¸æ˜¯ç›´æ¥åœ¨ server å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•æ¥ä¿®å¤æ­¤é—®é¢˜ã€‚

æˆ‘å‘ç°äº†é—®é¢˜ - é”™è¯¯å‘ç”Ÿæ˜¯å› ä¸º hcloud åº“ä¸­çš„ Server å¯¹è±¡æ²¡æœ‰ create_snapshot æ–¹æ³•ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ client çš„ servers API æ¥åˆ›å»ºå¿«ç…§ã€‚è®©æˆ‘ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š

**æ€è€ƒï¼š**
æˆ‘å·²ç»æˆåŠŸä¿®å¤äº† hetzner.py æ–‡ä»¶ä¸­çš„é—®é¢˜ã€‚é—®é¢˜æ˜¯ä»£ç è¯•å›¾ç›´æ¥åœ¨ server å¯¹è±¡ä¸Šè°ƒç”¨ `create_snapshot()`ï¼Œä½† hcloud åº“ä¸­çš„ server å®ä¾‹ä¸Šä¸å­˜åœ¨æ­¤æ–¹æ³•ã€‚æˆ‘ä¿®æ”¹äº†ä»£ç ä»¥ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•ï¼šè°ƒç”¨ `client.servers.create_snapshot()` å¹¶å°† server å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ã€‚æˆ‘è¿˜å°†å‚æ•°ä» `name` æ›´æ–°ä¸º `description`ï¼Œè¿™æ˜¯ API æ ¹æ®é”™è¯¯æ‰€æœŸæœ›çš„ã€‚ä¿®å¤å·²æˆåŠŸåº”ç”¨ã€‚

**ä»»åŠ¡å®Œæˆ**
æˆ‘å·²ç»ä¿®å¤äº† hetzner.py è„šæœ¬ä¸­çš„é—®é¢˜ã€‚é”™è¯¯å‘ç”Ÿæ˜¯å› ä¸ºä»£ç è¯•å›¾ç›´æ¥åœ¨ server å¯¹è±¡ä¸Šè°ƒç”¨ create_snapshot()ï¼Œä½† hcloud åº“çš„ Server ç±»ä¸­ä¸å­˜åœ¨æ­¤æ–¹æ³•ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ client çš„ servers APIï¼š

```python
# ä»ï¼š
snapshot = server.create_snapshot(name=f"{server.name}-snapshot")

# æ”¹ä¸ºï¼š
snapshot = client.servers.create_snapshot(server, description=f"{server.name}-snapshot")
```
æ­¤æ›´æ”¹åœ¨ client.servers å¯¹è±¡ä¸Šè°ƒç”¨ create_snapshot æ–¹æ³•ï¼Œå¹¶å°† server ä½œä¸ºå‚æ•°ä¼ é€’ï¼ŒåŒæ—¶ä½¿ç”¨æ­£ç¡®çš„å‚æ•°åç§° 'description' è€Œä¸æ˜¯ 'name'ã€‚

## ä¿®å¤å…¶ä»–é—®é¢˜

æŸ¥çœ‹æ–°æ›´æ”¹

```
lzwjava@anonymous lzwjava.github.io % python scripts/auto-ss-config/hetzner.py
ğŸš€ **æ£€æµ‹åˆ°ä»£ç†è®¾ç½®ï¼š**
- HTTP_PROXY: http://127.0.0.1:7890
- HTTPS_PROXY: http://127.0.0.1:7890

æœåŠ¡å™¨ ID: 61589357
æœåŠ¡å™¨åç§°: sg5
æœåŠ¡å™¨çŠ¶æ€: running
æœåŠ¡å™¨ IPv4: 5.223.56.128
æœåŠ¡å™¨ IPv6: 2a01:4ff:2f0:3b22::/64
æœåŠ¡å™¨ç±»å‹: cpx11
æœåŠ¡å™¨ä½ç½®: sin
----------------------------------
ä¸ºæœåŠ¡å™¨ sg5 åˆ›å»ºå¿«ç…§æ—¶å‡ºé”™: 'ServersClient' å¯¹è±¡æ²¡æœ‰ 'create_snapshot' å±æ€§
```

å†æ¬¡ä¿®å¤

**æ€è€ƒï¼š**
ç°åœ¨æˆ‘éœ€è¦ä¿®å¤æ–°çš„é”™è¯¯ã€‚ä¼¼ä¹ `ServersClient` å¯¹è±¡ä¹Ÿæ²¡æœ‰ `create_snapshot` æ–¹æ³•ã€‚æˆ‘éœ€è¦æŸ¥çœ‹ hcloud Python åº“ä¸­åˆ›å»ºå¿«ç…§çš„æ­£ç¡®æ–¹æ³•ã€‚æŸ¥çœ‹ hcloud åº“æ–‡æ¡£æˆ–ç¤ºä¾‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ `client.server_actions` è€Œä¸æ˜¯ `client.servers` æ¥åˆ›å»ºå¿«ç…§ã€‚è®©æˆ‘ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚

è®©æˆ‘ä¿®å¤æ–°é”™è¯¯ã€‚é—®é¢˜æ˜¯æˆ‘ä½¿ç”¨äº† client.servers.create_snapshotï¼Œä½†æ­£ç¡®çš„ API æ˜¯ client.server_actions.create_imageï¼š

**æ€è€ƒï¼š**
è®©æˆ‘éªŒè¯æ›´æ”¹æ˜¯å¦æˆåŠŸã€‚ä¹‹å‰çš„é”™è¯¯æ˜¯ "'ServersClient' å¯¹è±¡æ²¡æœ‰ 'create_snapshot' å±æ€§"ã€‚æˆ‘çš„ä¿®å¤å°†å…¶æ›¿æ¢ä¸º `client.server_actions.create_image()`ï¼Œè¿™æ˜¯ hcloud åº“ä¸­åˆ›å»ºå¿«ç…§çš„æ­£ç¡® APIã€‚æˆ‘è¿˜æ›´æ–°äº†è®¿é—®å¿«ç…§ ID çš„æ–¹å¼ï¼Œå› ä¸ºå“åº”ç»“æ„ä¸åŒ - ç°åœ¨æ˜¯ `snapshot.image.id`ã€‚æˆ‘ç›¸ä¿¡è¿™åº”è¯¥èƒ½è§£å†³é—®é¢˜ï¼Œä½†è®©æˆ‘ç­‰å¾…ç”¨æˆ·ç¡®è®¤è¿™æ˜¯å¦æœ‰æ•ˆã€‚

**æ€è€ƒï¼š**
æˆ‘éœ€è¦æ£€æŸ¥ hcloud Python åº“ä¸­åˆ›å»ºå¿«ç…§çš„æ­£ç¡® API æ–¹æ³•ã€‚è®©æˆ‘å†æ¬¡ä¿®å¤ä»£ç ã€‚æ ¹æ®é”™è¯¯æ¶ˆæ¯ï¼Œæˆ‘éœ€è¦è°ƒæŸ¥åˆ›å»ºå¿«ç…§çš„æ­£ç¡® APIã€‚

è®©æˆ‘æŸ¥çœ‹ hcloud Python åº“æ–‡æ¡£ï¼Œäº†è§£åˆ›å»ºå¿«ç…§çš„æ­£ç¡®æ–¹æ³•ï¼š

**æ€è€ƒï¼š**
ç°åœ¨æˆ‘æ‰¾åˆ°äº†ï¼ä»è¾“å‡ºä¸­ï¼Œæˆ‘å¯ä»¥çœ‹åˆ° Client çš„ `servers` å¯¹è±¡æœ‰ä¸€ä¸ª `create_image` æ–¹æ³•ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦ç”¨æ¥åˆ›å»ºå¿«ç…§çš„æ–¹æ³•ã€‚

æˆ‘æ‰¾åˆ°äº†è¦ä½¿ç”¨çš„æ­£ç¡®æ–¹æ³• - create_image æ˜¯ servers client çš„ä¸€ä¸ªæ–¹æ³•ã€‚è®©æˆ‘æ›´æ–°ä»£ç ï¼š

**æ€è€ƒï¼š**
è®©æˆ‘ä»¬å†æ¬¡æ‰§è¡Œè„šæœ¬ä»¥ç¡®ä¿å®ƒç°åœ¨æ­£å¸¸å·¥ä½œã€‚

**æ€è€ƒï¼š**
å¤ªå¥½äº†ï¼è„šæœ¬ç°åœ¨æ­£å¸¸å·¥ä½œã€‚å¿«ç…§å·²æˆåŠŸåˆ›å»ºï¼ŒID ä¸º 225649148ã€‚ä¿®å¤æ–¹æ³•æ˜¯ä½¿ç”¨ client.servers.create_image() è€Œä¸æ˜¯å°è¯•ä½¿ç”¨ server.create_snapshot() æˆ– client.server_actions.create_image()ã€‚ç°åœ¨æˆ‘åº”è¯¥æ€»ç»“ä¸€ä¸‹æˆ‘ä¿®å¤é—®é¢˜çš„è¿‡ç¨‹ã€‚

**ä»»åŠ¡å®Œæˆ**
æˆ‘é€šè¿‡ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•åˆ›å»ºå¿«ç…§ä¿®å¤äº† Hetzner è„šæœ¬ä¸­çš„é—®é¢˜ã€‚é”™è¯¯å‘ç”Ÿæ˜¯å› ä¸ºåŸå§‹ä»£ç è¯•å›¾ç›´æ¥åœ¨ server å¯¹è±¡ä¸Šè°ƒç”¨ create_snapshot()ï¼Œä½†æ­¤æ–¹æ³•ä¸å­˜åœ¨ã€‚

åœ¨æ£€æŸ¥äº† hcloud Python åº“ API åï¼Œæˆ‘å‘ç°æ­£ç¡®çš„æ–¹æ³•æ˜¯åœ¨ servers client å¯¹è±¡ä¸Šä½¿ç”¨ create_image()ï¼š

```python
# ä»ï¼š
snapshot = server.create_snapshot(name=f"{server.name}-snapshot")

# æ”¹ä¸ºï¼š
response = client.servers.create_image(server, description=f"{server.name}-snapshot", type="snapshot")
```
ä¿®å¤æˆåŠŸï¼ŒæœåŠ¡å™¨ sg5 çš„å¿«ç…§å·²åˆ›å»ºï¼ŒID ä¸º 225649148ã€‚

æ‰€åšçš„ä¸»è¦æ›´æ”¹ï¼š

- ä½¿ç”¨ client.servers.create_image() æ–¹æ³•è€Œä¸æ˜¯å°è¯•åœ¨ server å¯¹è±¡ä¸Šè®¿é—®ä¸å­˜åœ¨çš„æ–¹æ³•
- å°†å‚æ•°åç§°ä» name æ”¹ä¸º description
- æ·»åŠ äº† type="snapshot" å‚æ•°