---
audio: false
generated: true
lang: zh
layout: post
title: 使用JDBC驱动程序
translated: true
type: note
---

要在 Java 中使用 JDBC（Java 数据库连接）驱动，你需要按照一系列步骤来建立数据库连接、执行查询并处理结果。下面我将以清晰实用的方式逐步引导你完成整个过程。

### 第一步：将 JDBC 驱动添加到项目
首先，你需要获取对应数据库（如 MySQL、PostgreSQL、Oracle 等）的 JDBC 驱动。每个数据库厂商都会提供自己的驱动。

- **Maven 项目**：
  在 `pom.xml` 中添加依赖。以 MySQL 为例：
  ```xml
  <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.33</version> <!-- 请检查最新版本 -->
  </dependency>
  ```
  PostgreSQL 示例：
  ```xml
  <dependency>
      <groupId>org.postgresql</groupId>
      <artifactId>postgresql</artifactId>
      <version>42.7.3</version> <!-- 请检查最新版本 -->
  </dependency>
  ```

- **非 Maven 项目**：
  从厂商网站（如 mysql.com）下载 JDBC 驱动 JAR 文件，并手动添加到项目的类路径中。

### 第二步：加载 JDBC 驱动
在旧版 Java（JDBC 4.0 之前）中，需要使用 `Class.forName()` 显式加载驱动。现代 JDBC 驱动（JDBC 4.0+）通过服务提供者机制自动注册，此步骤可省略。但为了清晰起见，以下展示具体用法：

```java
try {
    Class.forName("com.mysql.cj.jdbc.Driver"); // MySQL 示例
    // PostgreSQL 示例：Class.forName("org.postgresql.Driver");
} catch (ClassNotFoundException e) {
    e.printStackTrace();
}
```

### 第三步：建立连接
通过 `DriverManager` 类，提供连接 URL、用户名和密码来连接数据库。URL 格式因数据库而异。

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase"; // MySQL 示例
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            System.out.println("成功连接数据库！");
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

- **URL 示例**：
  - MySQL：`jdbc:mysql://localhost:3306/mydatabase?useSSL=false`
  - PostgreSQL：`jdbc:postgresql://localhost:5432/mydatabase`
  - Oracle：`jdbc:oracle:thin:@localhost:1521:xe`

### 第四步：创建语句并执行查询
连接成功后，可通过 `Statement`、`PreparedStatement`（推荐用于参数化查询）或 `CallableStatement`（用于存储过程）执行 SQL 查询。

#### 简单查询示例：
```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase";
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            Statement statement = connection.createStatement();
            ResultSet resultSet = statement.executeQuery("SELECT * FROM users");

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", 姓名: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

#### 使用 PreparedStatement 示例（更安全，适用于用户输入）：
```java
try (Connection connection = DriverManager.getConnection(url, username, password)) {
    String sql = "SELECT * FROM users WHERE id = ?";
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.setInt(1, 5); // 设置参数值
    ResultSet resultSet = preparedStatement.executeQuery();

    while (resultSet.next()) {
        System.out.println("ID: " + resultSet.getInt("id") + ", 姓名: " + resultSet.getString("name"));
    }
} catch (SQLException e) {
    e.printStackTrace();
}
```

### 第五步：关闭资源
务必关闭 `ResultSet`、`Statement` 和 `Connection` 对象以释放资源。使用 try-with-resources（如上所示）可自动处理资源关闭。

### 完整工作示例（MySQL）
假设存在包含 `id`（整型）和 `name`（字符串）字段的 `users` 表：

```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase?useSSL=false";
        String username = "root";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            String sql = "SELECT * FROM users WHERE id = ?";
            PreparedStatement preparedStatement = connection.prepareStatement(sql);
            preparedStatement.setInt(1, 1);
            ResultSet resultSet = preparedStatement.executeQuery();

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", 姓名: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

### 关键提示
- **错误处理**：始终捕获 `SQLException` 以处理数据库相关错误
- **依赖匹配**：确保 JDBC 驱动版本与数据库版本匹配
- **安全性**：对包含用户输入的查询使用 `PreparedStatement` 防止 SQL 注入
- **连接池**：生产环境建议使用连接池（如 HikariCP）替代 `DriverManager`

如果你需要针对特定数据库的帮助或更高级的用例，请随时告知！