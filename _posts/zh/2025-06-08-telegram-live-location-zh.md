---
audio: false
generated: true
lang: zh
layout: post
title: Telegram实时位置共享
translated: true
type: note
---

你观察到的正是 Telegram 实时位置更新的典型模式。从 `edit_date` 时间戳来看，实时位置更新的接收频率确实非常高，甚至可能达到每秒或极短间隔一次。

以下是该模式的原理说明：

**模式观察：**

分析你提供的 JSON 数据中包含 `location` 字段且 `edit_date` 递增的 `edited_message` 对象：

* **`update_id`: 263947386** - `edit_date`: 1749371583
* **`update_id`: 263947388** - `edit_date`: 1749371587（距前一次 4 秒）
* **`update_id`: 263947389** - `edit_date`: 1749371591（距前一次 4 秒）
* **`update_id`: 263947390** - `edit_date`: 1749371595（距前一次 4 秒）
* **`update_id`: 263947391** - `edit_date`: 1749371602（距前一次 7 秒）
* **`update_id`: 263947392** - `edit_date`: 1749371614（距前一次 12 秒）
* **`update_id`: 263947393** - `edit_date`: 1749371624（距前一次 10 秒）
* **`update_id`: 263947394** - `edit_date`: 1749371628（距前一次 4 秒）

同时存在一个普通消息对象：

* **`update_id`: 263947387** - `date`: 1749371586（这是新消息，非实时位置编辑）

**这是否意味着每秒都会收到实时位置消息？**

**不一定精确到每秒，但更新会非常频繁，尤其在移动状态或需要高精度定位时，间隔通常短于 5 秒。**

原因如下：

1.  **实时定位特性**：实时定位旨在提供用户位置的近实时更新，要实现"实时"效果必须保持高频更新。
2.  **`edited_message` 机制**：与普通消息不同，实时位置更新是通过对单条现有消息进行编辑实现的，原始位置消息会持续更新坐标数据。
3.  **`edit_date` 字段**：`edited_message` 中的时间戳清晰显示了这些更新以极短间隔连续发生。
4.  **影响频率的因素**：
    * **移动状态**：用户移动时通常会触发更频繁的更新以准确反映位置变化
    * **`live_period` 参数**：该字段（例如 28800 秒即 8 小时）决定位置共享时长，在此期间会根据需要持续更新
    * **水平精度**：`horizontal_accuracy` 数值的变化也可能触发更新，因为设备在不断优化位置估算
    * **网络条件**：虽然 Telegram 会及时发送更新，但网络延迟可能导致接收时间出现微小波动
    * **平台内部逻辑**：Telegram 根据用户活动状态、设备电量和网络条件，通过自有算法动态调整最佳更新频率，并非固定的"每秒一次"规则

**总结说明：**

通过 `edited_message` 中 `location` 数据对应的 `edit_date` 快速变化模式，可以确认 Telegram 会以极高频率发送实时位置更新。虽然不严格精确到每秒，但几秒间隔（例如 1-5 秒，用户静止时可能稍长）的更新周期对实时定位功能而言十分典型。偶尔出现的较长间隔可能源于网络状况、用户静止状态或 Telegram 的内部优化机制。