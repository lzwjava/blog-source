---
audio: false
generated: true
lang: zh
layout: post
title: 高级 Git 命令
translated: true
type: note
---

Git 就像开发者的瑞士军刀——功能多样、威力强大，但若不清楚该用什么工具，偶尔也会令人困惑。今天我们将深入探讨 Git 的一些实用功能和操作流程：精准拣选提交、多样化合并、重构提交历史以保持整洁、删除误提交的大文件，以及在发现偏离正轨时撤销提交。下面我们来逐一解析。

#### 拣选提交：精准获取所需内容
假设你的功能分支包含十几个提交，但其中某个闪亮的提交你想单独提取并应用到主分支，同时避免引入其他提交。这时就需要用到 `git cherry-pick`。

操作非常简单：找到提交哈希值（可通过 `git log` 获取），切换到目标分支后执行：
```
git cherry-pick <提交哈希值>
```
瞬间该提交就融入当前分支。若出现冲突，Git 会暂停操作让你解决，处理方式与合并冲突相同。确认无误后提交更改即可。

当紧急修复代码混杂在凌乱的功能分支中，需要快速同步到 `main` 分支时，我经常使用这个方法。但需注意——拣选操作会复制提交并生成新哈希值。如果后续要合并原始分支，可能需要额外清理才能保持提交历史整洁。

#### 合并选项：不止是「合并」
合并是 Git 的核心功能，但你知道它还有多种模式吗？默认的 `git merge` 在可能时会执行「快进合并」（直接拉直历史线），在分支出现分叉时则创建合并提交。其实你还有更多选择：

- **`--no-ff` (禁用快进)**：即使满足快进条件也强制生成合并提交。我常用此选项来清晰记录功能分支合并到 `main` 分支的时间点：
  ```
  git merge --no-ff 功能分支
  ```
- **`--squash`**：将分支所有变更压缩为当前分支的单个提交。不生成合并提交，只打包成整洁的提交单元。特别适合整理包含多次「临时提交」的分支：
  ```
  git merge --squash 功能分支
  ```
  执行后需手动提交完成最终操作。

每种方式各有适用场景。我对长期分支倾向使用 `--no-ff`，而对满是「临时提交」的分支则采用 `--squash` 整理。

#### 变基操作：专业级历史重构
如果觉得合并提交过于杂乱，`git rebase` 或许更适合你。它会将你的提交重新应用到目标分支，形成线性历史，就像从一开始就完美规划好所有操作。

切换到功能分支后执行：
```
git rebase main
```
Git 会暂存你的提交，将分支更新至与 `main` 同步，最后重新应用你的变更。若出现冲突，解决后执行 `git rebase --continue` 直至完成。

优势？整洁的时间线。劣势？若分支已推送且团队成员正在使用，变基会重写历史——小心收到队友的抗议邮件。我仅在本地分支或个人项目中使用变基，协作项目还是稳妥地用合并更安全。

#### 从历史记录删除大文件：糟了，那个 2GB 视频
我们都经历过：误提交了大文件并推送，现在仓库变得臃肿。Git 不会轻易遗忘，但你可以通过一些操作擦除历史记录中的文件。

经典工具是 `git filter-branch` 或更现代的 `git filter-repo`（推荐后者——更快更稳定）。假设需要删除误提交的 `bigfile.zip`：
1. 安装 `git-filter-repo`（请查阅官方文档配置）
2. 执行：
   ```
   git filter-repo --path bigfile.zip --invert-paths
   ```
   这将从所有历史提交中移除 `bigfile.zip`
3. 强制推送重构后的历史：
   ```
   git push --force
   ```

注意：此操作会重写历史，需与团队协调。若存在关联的拉取请求，可能还需要清理引用记录。完成清理后，执行垃圾回收（`git gc`）即可让仓库恢复苗条。

#### 撤销提交：让时光倒流
刚提交就后悔了？Git 为你提供补救方案。根据操作进度有两种撤销方式：

- **未推送的提交**：使用 `git reset`。撤销最新提交但保留工作区变更：
  ```
  git reset HEAD^ --soft
  ```
  需要彻底丢弃变更？
  ```
  git reset HEAD^ --hard
  ```
- **已推送的提交**：需要重写历史。本地执行 `git reset HEAD^` 后强制推送：
  ```
  git push --force
  ```
  注意这会影响共享历史，请谨慎操作。

我通过 `git reset --soft` 挽回局面的次数数不胜数——特别适合提交过早需要微调的情况。

#### 总结

Git 的灵活性正是其强大之处，但若不熟悉各种选项很容易陷入混乱。精准修改时使用拣选，根据工作流调整合并策略，通过变基打造整洁历史，遇到失误时不必惊慌——无论是巨型文件还是仓促提交。如果担心操作风险，可以在测试仓库中练习，很快你就能驾轻就熟。

你最喜欢的 Git 技巧是什么？欢迎分享——我一直乐于学习新技能！