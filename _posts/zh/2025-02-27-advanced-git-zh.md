---
audio: false
lang: zh
layout: post
title: 高级 Git 命令
translated: true
---

Git 就像开发者的瑞士军刀——多功能、强大，有时如果不知道要使用哪个工具，可能会感到困惑。今天，我们将深入探讨 Git 的一些最佳功能和工作流程：精选更改、优雅合并、重新基础以获得更清晰的历史、删除那些意外提交的大文件，以及在意识到自己偏离轨道时撤销提交。让我们来分解一下。

#### 精选更改：获取你需要的
想象一下，你有一个包含十几个提交的功能分支，但其中有一个闪亮的提交你想要提取出来并应用到主分支，而不带来其余的提交。这就是 `git cherry-pick` 的用武之地。

它非常简单：找到提交哈希（你可以从 `git log` 中获取），切换到你想要的分支，然后运行：
```
git cherry-pick <commit-hash>
```
完成，该提交现在是你当前分支的一部分。如果有冲突，Git 会暂停并让你解决它，就像合并一样。解决完后，提交更改，你就可以了。

我经常使用这个功能，当一个错误修复潜入一个混乱的功能分支，而我需要它在 `main` 上尽快使用。只是要小心——精选更改会复制提交，所以它会获得一个新的哈希。不要期望它在稍后合并原始分支时会很好地工作，除非进行一些清理。

#### 合并选项：不仅仅是“合并”
合并是 Git 的基本功能，但你知道它有不同的风味吗？默认的 `git merge` 如果可能会进行“快进”（直线化历史）或在分支分歧时创建一个合并提交。但你有选项：

- **`--no-ff`（无快进）**：即使可能快进，也强制合并提交。我喜欢这样做，以保持一个清晰的记录，当一个功能分支进入 `main` 时。运行它：
  ```
  git merge --no-ff feature-branch
  ```
- **`--squash`**：将分支的所有更改拉入当前分支的一个提交中。没有合并提交，只是一个整洁的包裹。完美地将一个混乱的分支压缩成一个可展示的：
  ```
  git merge --squash feature-branch
  ```
  完成后，你需要手动提交以完成。

每个都有其用途。我倾向于 `--no-ff` 用于长期分支，当我有一个充满“WIP”提交的分支时，我会使用 `--squash`。

#### 重新基础：像专业人士一样重写历史
如果合并看起来太混乱，`git rebase` 可能是你的风格。它会取你的提交并重新应用到另一个分支，给你一个线性的历史，看起来像你从一开始就计划好了。

切换到你的功能分支并运行：
```
git rebase main
```
Git 会提取你的提交，更新分支以匹配 `main`，然后将你的更改重新应用到顶部。如果出现冲突，解决它们，然后 `git rebase --continue` 直到完成。

优点？一个完美的时间线。缺点？如果你已经推送了那个分支并且其他人正在使用它，重新基础会重写历史——队友的愤怒邮件即将到来。我只在本地分支或个人项目中使用重新基础。对于共享的内容，合并更安全。

#### 从历史中删除大文件：哦，那2GB的视频
我们都经历过：你意外地提交了一个巨大的文件，推送它，现在你的仓库膨胀了。Git 不容易忘记，但你可以通过一些努力将该文件从历史中清除。

这里的首选工具是 `git filter-branch` 或更新的 `git filter-repo`（我推荐后者——它更快且更少出错）。假设你提交了 `bigfile.zip` 并且需要删除它：
1. 安装 `git-filter-repo`（查看其文档以进行设置）。
2. 运行：
   ```
   git filter-repo --path bigfile.zip --invert-paths
   ```
   这将从历史中的每个提交中删除 `bigfile.zip`。
3. 强制推送重写的历史：
   ```
   git push --force
   ```

注意：这会重写历史，所以要与你的团队协调。如果它在某个拉取请求中，你可能需要清理引用。删除后，你的仓库会在垃圾收集后变得更小（`git gc`）。

#### 撤销提交：回撤时钟
提交后立即后悔了吗？Git 会帮你。有几种方法可以撤销它，具体取决于你走得有多远：

- **如果你还没有推送**：使用 `git reset`。要撤销最后一个提交但保留工作目录中的更改：
  ```
  git reset HEAD^ --soft
  ```
  如果你想完全丢弃更改：
  ```
  git reset HEAD^ --hard
  ```
- **如果你已经推送**：你需要重写历史。使用 `git reset HEAD^` 重置本地，然后强制推送：
  ```
  git push --force
  ```
  这会影响共享历史，所以要小心。

我用 `git reset --soft` 救了自己无数次——完美地用于提交过早并需要调整某些内容的情况。

#### 总结

Git 的灵活性使其如此强大，但如果不知道选项，很容易陷入困境。精选更改以获得外科精度，调整合并以适应你的工作流程，重新基础以获得光滑的历史，当你需要擦除错误时不要惊慌——无论是一个巨大的文件还是一个仓促的提交。如果你感到紧张，可以在测试仓库上练习这些，很快它们就会像第二本性一样。

你最喜欢的 Git 技巧是什么？告诉我——我总是愿意学习新东西！