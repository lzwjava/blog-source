---
audio: false
generated: true
lang: zh
layout: post
title: 使用 Jetty 嵌入 Web 服务器
translated: true
---

要在Java项目中使用 `org.eclipse.jetty`，通常希望利用Jetty库在应用程序中嵌入一个轻量级的Web服务器或Servlet容器。Jetty由Eclipse基金会维护，是一个开源项目，允许您提供Web内容、处理HTTP请求，并支持功能如Servlet和Web应用程序。以下是使用Maven作为构建工具在Java应用程序中设置基本Web服务器的分步指南。

---

### **步骤1：向项目添加Jetty依赖**
要使用Jetty，需要在项目中包含其库。如果使用Maven，将必要的依赖项添加到`pom.xml`文件中。对于具有Servlet支持的基本Web服务器设置，包括`jetty-server`和`jetty-servlet`。以下是示例：

```xml
<project>
    <dependencies>
        <!-- Jetty Server -->
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-server</artifactId>
            <version>9.4.31.v20200723</version>
        </dependency>
        <!-- Jetty Servlet Support -->
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-servlet</artifactId>
            <version>9.4.31.v20200723</version>
        </dependency>
        <!-- Servlet API (optional, often included transitively) -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>3.1.0</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>
</project>
```

- **`jetty-server`**：提供核心服务器功能来处理HTTP请求。
- **`jetty-servlet`**：添加对Servlet的支持，允许您使用Java Servlet API。
- **`javax.servlet-api`**：定义Servlet接口；这里明确包含以便清楚，尽管它通常由`jetty-servlet`传递包含。

**注意**：检查[Maven Central Repository](https://mvnrepository.com/artifact/org.eclipse.jetty)以获取最新的Jetty版本，并相应地更新`<version>`标签。

---

### **步骤2：创建一个简单的Jetty服务器**
可以通过创建`org.eclipse.jetty.server`包中的`Server`类的实例来以编程方式使用Jetty。以下是两种常见的方法：使用基本处理程序进行静态响应或使用Servlet进行动态内容。

#### **选项1：使用基本处理程序**
此示例设置一个服务器，对所有请求响应“Hello, World!”。

```java
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class SimpleJettyServer {
    public static void main(String[] args) throws Exception {
        // 创建一个在端口8080监听的服务器实例
        Server server = new Server(8080);

        // 设置一个处理程序来处理请求
        server.setHandler(new AbstractHandler() {
            @Override
            public void handle(String target, Request baseRequest, HttpServletRequest request, HttpServletResponse response)
                    throws IOException {
                // 设置响应属性
                response.setContentType("text/plain");
                response.setStatus(HttpServletResponse.SC_OK);
                response.getWriter().println("Hello, World!");

                // 标记请求已处理
                baseRequest.setHandled(true);
            }
        });

        // 启动服务器
        server.start();
        server.join(); // 保持服务器运行直到停止
    }
}
```

- **`Server server = new Server(8080)`**：在端口8080上创建一个Jetty服务器。
- **`AbstractHandler`**：一个简单的处理程序，您在`handle`方法中定义如何处理请求。
- **`baseRequest.setHandled(true)`**：指示此处理程序已处理请求，防止进一步处理。

运行此代码，然后在浏览器中导航到`http://localhost:8080/`以查看“Hello, World!”。

#### **选项2：使用Servlet**
对于更复杂的应用程序，可以使用`ServletContextHandler`中的Servlet。

```java
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.ServletContextHandler;
import org.eclipse.jetty.servlet.ServletHolder;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class ServletJettyServer {
    public static void main(String[] args) throws Exception {
        // 创建一个在端口8080上的服务器实例
        Server server = new Server(8080);

        // 创建一个Servlet上下文处理程序
        ServletContextHandler context = new ServletContextHandler();
        context.setContextPath("/"); // 根上下文路径

        // 设置服务器的处理程序
        server.setHandler(context);

        // 添加一个Servlet来处理请求
        context.addServlet(new ServletHolder(new HelloServlet()), "/*");

        // 启动服务器
        server.start();
        server.join();
    }
}

// 定义一个简单的Servlet
class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws IOException {
        response.setContentType("text/plain");
        response.setStatus(HttpServletResponse.SC_OK);
        response.getWriter().println("Hello from Jetty Servlet!");
    }
}
```

- **`ServletContextHandler`**：管理Servlet上下文和映射。
- **`context.addServlet`**：注册`HelloServlet`以处理所有请求（`/*`）。
- **`doGet`**：定义Servlet对GET请求的行为。

运行此代码并访问`http://localhost:8080/`以查看“Hello from Jetty Servlet!”。

---

### **步骤3：编译和运行**
1. 确保项目使用Maven设置（例如，运行`mvn compile`以下载依赖项）。
2. 编译并运行Java类（例如，`java SimpleJettyServer`或使用IDE的运行功能）。
3. 通过在浏览器或使用`curl`等工具访问`http://localhost:8080/`来测试服务器。

---

### **其他用例**
- **部署WAR文件**：使用`WebAppContext`部署Web应用程序归档（WAR）文件或目录：
  ```java
  import org.eclipse.jetty.server.Server;
  import org.eclipse.jetty.webapp.WebAppContext;

  public class WarJettyServer {
      public static void main(String[] args) throws Exception {
          Server server = new Server(8080);
          WebAppContext webapp = new WebAppContext();
          webapp.setContextPath("/");
          webapp.setWar("path/to/your.war"); // WAR文件的路径
          server.setHandler(webapp);
          server.start();
          server.join();
      }
  }
  ```
  将`jetty-webapp`依赖项添加到`pom.xml`以使用此功能。

- **配置Jetty**：通过编程或XML配置文件调整端口、线程池或HTTPS等设置（请参阅Jetty文档以获取高级设置）。

---

### **关键点**
- **导入**：通过按需导入使用`org.eclipse.jetty.server`、`org.eclipse.jetty.servlet`等类。
- **灵活性**：Jetty可以提供静态内容、处理Servlet、部署WAR文件，甚至支持WebSockets和HTTP/2（使用额外模块）。
- **文档**：有关更多详细信息，请参阅[官方Jetty文档](https://www.eclipse.org/jetty/documentation/)。

通过遵循这些步骤，您可以有效地使用`org.eclipse.jetty`在Java应用程序中嵌入Web服务器，并根据具体需求进行定制！