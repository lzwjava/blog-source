---
audio: false
generated: true
lang: zh
layout: post
title: 理解Git Fetch
translated: true
type: note
---

让我逐步解释 Git 命令 `/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=5 origin`。该命令用于从远程 Git 仓库获取更新，并通过特定选项控制获取数据的范围和方式。以下是详细解析：

### 命令详解

1. **`/usr/bin/git`**  
   这是系统中 Git 可执行文件的路径，指示系统运行后续带选项和参数的 Git 程序。

2. **`-c protocol.version=2`**  
   为本次 Git 命令设置配置选项，强制其使用协议版本 2 与远程仓库通信。该版本是 Git 通信协议的新一代标准，相比旧版协议版本 1 能提供更好的性能或功能特性。

3. **`fetch`**  
   `fetch` 命令从远程仓库获取更新（如新提交和分支）。与 `pull` 不同，它不会将这些变更合并到本地分支——仅更新你的*远程跟踪分支*（例如 `origin/main`），使你能够查看远程仓库的新内容。

4. **`--no-tags`**  
   默认情况下 `fetch` 会同时获取标签（用于标记特定提交的标签，如发布版本号）。此选项指示 Git *不*从远程仓库获取标签，避免这些标记存入本地仓库。

5. **`--prune`**  
   该选项会清理本地远程跟踪分支。如果远程仓库中某分支已被删除，`--prune` 将移除本地仓库中对应的远程跟踪分支（例如 `origin/old-branch`），保持仓库整洁。

6. **`--no-recurse-submodules`**  
   子模块是嵌套在主仓库中的独立仓库。默认情况下 `fetch` 可能会同时获取子模块的更新。此选项将阻止此行为，确保仅获取主仓库数据而忽略子模块。

7. **`--depth=5`**  
   该选项执行*浅层获取*，将每个分支的历史记录限制为最近 5 次提交。无需下载完整提交历史即可获得截断版本，既能节省时间又能减少磁盘占用——当你不需要完整历史时非常实用。

8. **`origin`**  
   这是要获取更新的远程仓库名称。`origin` 是克隆项目时 Git 为默认远程仓库赋予的名称，因此该命令是从该源获取更新。

### 整体功能概述

此 Git 命令在从 `origin` 远程仓库获取更新时设置了多重约束：

- 使用协议版本 2 进行通信
- 每个分支仅获取最近 5 次提交（`--depth=5`）
- 跳过标签获取（`--no-tags`）
- 删除远程已不存在的本地远程跟踪分支（`--prune`）
- 忽略子模块（`--no-recurse-submodules`）

简言之，这是更新本地远程仓库视图的轻量级方式，专注于近期变更并避免获取标签、子模块或完整历史等额外数据。适用于节省带宽、加速流程或保持本地仓库精简的场景。

### 示例场景
假设你正在处理一个大型仓库项目，只需快速查看 `main` 分支的最新变更。运行此命令将：
- 用最近 5 次提交更新 `origin/main`
- 移除所有过时分支（如远程已删除的 `origin/feature-x`）
- 跳过标签和子模块，保持获取操作快速专注

这就是该命令的全部要点——在与远程仓库同步时实现效率与控制力的平衡。