---
audio: false
generated: true
image: false
lang: zh
layout: post
title: Git变基压缩顺序详解
translated: true
type: note
---

当你运行 `git rebase -i`（交互式变基）来压缩提交时，Git 会遵循特定的顺序和逻辑：

---

### 1. 默认顺序

启动交互式变基时（例如 `git rebase -i HEAD~5`），Git 会在编辑器中按**从旧到新的顺序**列出提交（顶部=最旧，底部=最新）。  
这个顺序很重要：这是 Git 尝试在新基底上重放的序列。

---

### 2. 选取与压缩

* **pick** → 保留该提交不变
* **squash（或 s）** → 将此提交与**前一个标记为 `pick` 的提交**合并
* **fixup（或 f）** → 与 squash 相同，但丢弃提交信息（仅保留首个提交的信息）

若你编写：

```
pick  a1b2c3  初始功能
squash d4e5f6  细微修复
squash g7h8i9  小型清理
pick  j1k2l3  另一功能
```

Git 会将 `d4e5f6` 和 `g7h8i9` 合并到 `a1b2c3` 中，最终生成单个提交。

---

### 3. 重排提交顺序

你可以直接在变基编辑器中**通过上下移动行来重排提交顺序**。  
例如：

```
pick  a1b2c3  初始功能
pick  j1k2l3  另一功能
squash d4e5f6  细微修复
squash g7h8i9  小型清理
```

此时 Git 会先应用 `a1b2c3`，接着是 `j1k2l3`。  
而 `squash` 类提交（`d4e5f6` 和 `g7h8i9`）现在会被压缩至 **`j1k2l3`**，因为 squash 始终会合并到最近的前置 `pick` 提交中。

---

### 4. 编辑提交信息

完成压缩后，Git 会暂停运行并允许你**编辑被压缩提交的提交信息**。你可以：

* 保留所有提交信息
* 手动组合这些信息
* 仅保留第一条信息

---

### 5. 常见陷阱

* 若将 `squash` 置于首行（前面没有 `pick` 提交），Git 会报错——它需要基础提交才能进行压缩
* 重排后若提交出现冲突，需在变基过程中手动解决冲突
* 重排操作会显著改变历史记录，请仅在未推送/未共享的分支上执行，除非你确需重写历史

---

✅ 核心要点：

* 提交按**从旧到新**的顺序排列
* `pick` 保留提交，`squash` 会合并到**最近的前置 `pick` 提交**
* 可在编辑器中手动重排提交顺序，squash 操作始终会将后续提交归并至前一个被选取的提交

---

需要我用**提交历史前后对比示例**（展示压缩前后的 `git log --oneline`）来演示吗？这通常能让顺序关系更清晰。