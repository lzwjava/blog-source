---
audio: false
generated: true
lang: zh
layout: post
title: JavaScript 播放 HLS 库
translated: true
---

看起来你在询问如何使用 `hls.js` 库，特别是版本 `^0.7.6`，这是一个用于在浏览器中播放 HLS（HTTP Live Streaming）视频流的 JavaScript 库。我将提供一个简洁的指南，说明如何设置和使用该库，基于对该库的一般了解。请注意，版本 `0.7.6` 相当旧（发布于 2017 年左右），因此某些功能或 API 可能与最新版本不同。如果你需要与该特定版本相关的具体信息，请告诉我，我可以进一步完善答案！

### 使用 `hls.js` (v0.7.6) 的步骤

#### 1. **安装或包含库**
你可以通过以下方式在项目中包含 `hls.js`：

- **通过 npm**（如果你使用构建工具如 Webpack）：
  ```bash
  npm install hls.js@^0.7.6
  ```
  然后在 JavaScript 中导入它：
  ```javascript
  var Hls = require('hls.js');
  ```

- **通过 CDN**（如果你直接将其添加到 HTML 文件中）：
  ```html
  <script src="https://cdn.jsdelivr.net/npm/hls.js@0.7.6"></script>
  ```
  这将使 `Hls` 作为全局变量可用。

#### 2. **设置 HTML**
你需要在 HTML 中有一个 `<video>` 元素来附加 HLS 流：
```html
<video id="video" controls></video>
```

#### 3. **初始化 `hls.js`**
这是一个基本示例，说明如何使用 `hls.js` 加载和播放 HLS 流（例如，一个 `.m3u8` 文件）：

```javascript
// 检查浏览器是否原生支持 HLS（例如，Safari）
// 如果不支持，则使用 hls.js
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8'; // 替换为你的 HLS URL

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // 对于原生支持 HLS 的浏览器（例如，Safari）
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', function () {
        video.play();
    });
}
```

#### 4. **关键概念**
- **`Hls.isSupported()`**：检查浏览器是否需要 `hls.js`（如果支持 Media Source Extensions，则返回 `true`）。
- **`loadSource(url)`**：加载 HLS 资源清单（`.m3u8` 文件）。
- **`attachMedia(video)`**：将视频元素附加到 `hls.js` 实例。
- **`Hls.Events.MANIFEST_PARSED`**：在加载资源清单时触发的事件，表示流准备好播放。

#### 5. **带有错误处理的示例**
为了使其更加健壮：
```javascript
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8';

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
    hls.on(Hls.Events.ERROR, function (event, data) {
        console.error('HLS Error:', data);
        if (data.fatal) {
            switch (data.type) {
                case Hls.ErrorTypes.NETWORK_ERROR:
                    console.log('Network error, retrying...');
                    hls.startLoad();
                    break;
                case Hls.ErrorTypes.MEDIA_ERROR:
                    console.log('Media error, recovering...');
                    hls.recoverMediaError();
                    break;
                default:
                    hls.destroy();
                    break;
            }
        }
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
}
```

#### 版本 `^0.7.6` 的注意事项
- 该版本发布于 2017 年，因此缺少在后续版本中添加的新功能，如自适应比特率切换改进或低延迟 HLS 支持。
- 核心 API（`loadSource`、`attachMedia`、`MANIFEST_PARSED` 等事件）应该如上所示工作。
- 如果需要精确细节，请查看 [官方 `hls.js` GitHub 发布](https://github.com/video-dev/hls.js/releases/tag/v0.7.6)。

#### 6. **测试**
- 使用公开可用的 HLS 流进行测试，例如：
  ```
  https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8
  ```
- 打开浏览器的开发者工具（F12）以调试任何问题。

如果你有特定的用例或问题（例如，与框架集成、处理字幕等），请告诉我，我将进一步定制回答！