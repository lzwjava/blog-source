---
audio: false
lang: zh
layout: post
title: 无线桥接配置OpenWRT
translated: true
---

要解决您关于如何配置OpenWRT作为无线桥接的问题，并提供正确的实现方法，我将评估您提供的步骤，并根据OpenWRT的最佳实践进行完善。您的目标是将OpenWRT路由器（例如，安装了OpenWRT 24.10.0的小米路由器4C）设置为无线桥接——无线连接到现有的Wi-Fi网络作为客户端，并通过其自己的Wi-Fi接入点（AP）或以太网端口共享该连接，使所有设备与主路由器在同一子网中。

您提供的步骤大致准确，但缺少一个关键调整，以确保正确的桥接并避免IP冲突。以下，我将首先评估您的配置，然后提供使用简单桥接方法（客户端+AP在同一桥接）的正确、完整步骤来实现无线桥接，这与您的意图一致。我还将简要提及使用`relayd`的替代方法，以防简单方法失败，尽管您的设置可能支持更简单的方法。

---

### **评估您提供的步骤**

您的步骤旨在：
1. 将OpenWRT路由器作为客户端连接到现有的Wi-Fi网络。
2. 设置一个AP来广播一个新的Wi-Fi网络。
3. 桥接客户端和AP接口以共享互联网。

以下是快速回顾：
- **步骤1：登录到LuCI** - 正确，访问Web界面是起点。
- **步骤2：配置无线客户端** - 加入目标Wi-Fi并将其分配到`lan`网络是一个很好的开始，但OpenWRT的默认`lan`配置（静态IP，通常是192.168.1.1）可能会与主路由器冲突，如果它使用相同的IP。这需要调整。
- **步骤3：配置无线AP** - 设置AP并将其分配到`lan`是桥接的正确方法，但依赖于`lan`接口被正确配置。
- **步骤4：桥接网络** - 将两个接口分配给`lan`理论上可以桥接它们，但如果不禁用DHCP服务器或调整IP设置，可能无法顺利工作。
- **步骤5：测试设置** - 测试是必要的，但成功取决于前面的步骤是否完全正确。

**缺少或错误的内容？**
- 默认情况下，OpenWRT的`lan`接口具有静态IP（例如，192.168.1.1）并运行DHCP服务器。如果主路由器也是192.168.1.1，这将导致IP冲突。您需要将`lan`接口设置为DHCP客户端模式，以从主路由器获取IP，并禁用本地DHCP服务器，以让主路由器为所有设备分配IP。
- 防火墙区域分配到`lan`对于简单性是可以的，但IP配置是关键。

考虑到这一点，您的步骤是“大致正确”，但没有调整`lan`接口设置是不完整的。以下是纠正后的步骤。

---

### **正确步骤：配置OpenWRT作为无线桥接（简单桥接方法）**

此方法将您的OpenWRT路由器设置为连接到现有Wi-Fi网络作为客户端，并通过其自己的AP或以太网端口共享该连接，所有设备都在与主路由器相同的子网（例如，192.168.1.x）。以下是通过LuCI Web界面实现的方法：

#### **前提条件**
- 安装了OpenWRT（例如，版本24.10.0在小米路由器4C上）。
- 您有主Wi-Fi网络的SSID、密码和加密类型（例如，WPA2-PSK）。
- 访问LuCI的权限，网址为`http://192.168.1.1`（或当前IP）和您的管理员凭据。

#### **步骤1：登录到LuCI**
- 打开浏览器并导航到`http://192.168.1.1`。
- 使用OpenWRT用户名（默认：`root`）和密码（安装时设置）登录。

#### **步骤2：配置无线客户端**
- **导航到无线设置：**
  - 转到**网络 > 无线**。
- **扫描网络：**
  - 找到您的无线电（例如，`radio0`用于小米路由器4C的2.4GHz）。
  - 点击**扫描**以列出可用的Wi-Fi网络。
- **加入主Wi-Fi网络：**
  - 找到主路由器Wi-Fi的SSID。
  - 点击**加入网络**。
- **配置客户端设置：**
  - **Wi-Fi密钥：** 输入主Wi-Fi的密码。
  - **网络：** 选择或设置为`lan`（这将客户端接口添加到`br-lan`桥接）。
  - **防火墙区域：** 分配到`lan`（这简化了桥接的流量规则）。
  - **接口名称：** LuCI可能建议`wwan`；您可以保留它或将其重命名为`client`以便于理解，但确保它与`lan`关联。
- **保存并应用：**
  - 点击**保存并应用**以连接到主Wi-Fi。

#### **步骤3：将LAN接口调整为DHCP客户端**
- **转到接口：**
  - 转到**网络 > 接口**。
- **编辑LAN接口：**
  - 点击`lan`接口旁边的**编辑**。
- **将协议设置为DHCP客户端：**
  - 在**协议**下拉菜单中，选择**DHCP客户端**。
  - 这允许`br-lan`桥接（现在包括无线客户端）从主路由器的DHCP服务器获取IP地址（例如，192.168.1.x）。
- **禁用DHCP服务器：**
  - 由于`lan`现在是DHCP客户端，本地DHCP服务器将自动禁用。在**高级设置**或**DHCP和DNS**下验证这一点——如果出现选项，请确保勾选“忽略接口”。
- **保存并应用：**
  - 点击**保存并应用**。路由器现在将从主路由器请求IP。

#### **步骤4：配置无线接入点**
- **添加新的无线网络：**
  - 返回**网络 > 无线**。
  - 点击同一无线电（例如，`radio0`）下的**添加**以创建新的无线接口。
- **设置AP：**
  - **ESSID：** 为您的Wi-Fi选择一个名称（例如，`OpenWRT_AP`）。
  - **模式：** 设置为**接入点（AP）**。
  - **网络：** 分配到`lan`（这将其与客户端接口和以太网端口桥接）。
- **配置安全性：**
  - 转到**无线安全**选项卡。
  - **加密：** 选择**WPA2-PSK**（推荐）。
  - **密钥：** 为您的AP设置一个强密码。
- **保存并应用：**
  - 点击**保存并应用**。您的路由器现在将广播其自己的Wi-Fi。

#### **步骤5：验证桥接**
- **检查接口：**
  - 转到**网络 > 接口**。
  - 确保`lan`接口列出了无线客户端（例如，`wlan0`）和AP（例如，`wlan0-1`）在`br-lan`桥接下。
- **检查IP分配：**
  - 转到**状态 > 概述**。
  - 注意`lan`接口由主路由器分配的IP地址（例如，`192.168.1.100`）。

#### **步骤6：测试设置**
- **测试Wi-Fi：**
  - 将设备连接到`OpenWRT_AP` Wi-Fi。
  - 验证它是否从主路由器（例如，`192.168.1.x`）接收IP并具有互联网访问权限。
- **测试以太网（如果适用）：**
  - 将设备插入路由器的一个LAN端口。
  - 确认它从主路由器获取IP并连接到互联网。
- **访问LuCI：**
  - 使用新的IP地址（例如，`http://192.168.1.100`）访问OpenWRT界面。

---

### **为什么这有效**
- 将客户端和AP接口分配给`lan`网络将它们添加到`br-lan`桥接，允许层2流量在它们和主路由器之间流动。
- 将`lan`设置为DHCP客户端确保OpenWRT路由器从主路由器获取唯一IP，避免冲突（例如，与`192.168.1.1`），并禁用本地DHCP服务器，以便主路由器管理所有IP分配。
- 连接到AP或以太网端口的设备将出现在与主网络相同的子网（例如，`192.168.1.x`），满足无线桥接要求。

---

### **替代方法：使用relayd（伪桥接）**
如果简单桥接方法失败（例如，由于无线驱动程序限制），您可以使用`relayd`包进行伪桥接。这创建了一个路由设置，其中OpenWRT路由器的客户端在不同的子网上，但在某些硬件上更可靠。以下是简要概述：

1. **安装relayd：**
   - 转到**系统 > 软件**，搜索`relayd`并安装它。
2. **配置无线客户端：**
   - 加入主Wi-Fi，但将其分配到新接口（例如，`wwan`）设置为DHCP客户端。
3. **配置LAN：**
   - 将`lan`设置为静态IP（例如，`192.168.2.1`）并启用其自己的DHCP服务器。
4. **设置relayd：**
   - 通过SSH或LuCI（在**网络 > 主机名**下）配置`relayd`以在`wwan`和`lan`之间中继。
5. **配置AP：**
   - 将AP设置在`lan`网络上。
6. **测试：**
   - 连接到`OpenWRT_AP`的设备将在`192.168.2.x`上，互联网通过主路由器中继。

**注意：** 这不是真正的桥接（不同的子网），因此仅在简单方法无效时使用。对于安装了OpenWRT 24.10.0的小米路由器4C，简单桥接应该足够。

---

### **结论**
您的原始步骤是**大致正确**，但没有将`lan`接口设置为DHCP客户端模式来避免IP冲突并确保正确的桥接。上述纠正后的步骤提供了一种可靠的方法来配置OpenWRT作为无线桥接。如果您按照这些步骤操作，您的路由器将连接到主Wi-Fi并通过其AP或以太网端口无缝共享该连接，所有设备都在同一子网。测试设置，如果出现问题（使用现代OpenWRT时很少见），请考虑`relayd`替代方案。