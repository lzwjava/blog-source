---
audio: false
generated: true
image: false
lang: zh
layout: post
title: 配置OpenWRT为无线网桥
translated: true
type: note
---

在 Grok 的帮助下，我仍在努力推进以下工作。

---

针对您关于“配置 OpenWRT 作为无线桥接的步骤是否正确”的疑问，以及为了提供实现此目标的正确方法，我将评估您提供的步骤，并根据 OpenWRT 的最佳实践进行完善。您的目标是将 OpenWRT 路由器（例如，刷写了 OpenWRT 24.10.0 的小米路由器 4C）设置为无线桥接——即作为客户端无线连接到现有的 Wi-Fi 网络，并通过其自身的 Wi-Fi 接入点或以太网端口共享该连接，使所有设备与主路由器处于同一子网。

您提供的步骤大体上是正确的，但缺少一个关键调整，以确保正确的桥接并避免 IP 冲突。下面，我将首先评估您的配置，然后介绍使用简单桥接方法（客户端和 AP 在同一桥接上）在 OpenWRT 中实现无线桥接的正确、完整步骤，这与您的意图一致。我还将简要提及使用 `relayd` 的替代方案，以防简单方法失败，不过您的设置很可能支持更简单的方法。

---

### **对您所提供步骤的评估**

您的步骤旨在：
1.  将 OpenWRT 路由器作为客户端连接到现有的 Wi-Fi 网络。
2.  设置一个 AP 来广播新的 Wi-Fi 网络。
3.  桥接客户端和 AP 接口以共享互联网。

以下是简要回顾：
- **步骤 1：登录 LuCI** - 正确，访问 Web 界面是第一步。
- **步骤 2：配置无线客户端** - 加入目标 Wi-Fi 并将其分配给 `lan` 网络是一个好的开始，但 OpenWRT 中默认的 `lan` 配置（静态 IP，通常是 192.168.1.1）如果与主路由器使用相同的 IP，则会发生冲突。这需要进行调整。
- **步骤 3：配置无线 AP** - 设置 AP 并将其分配给 `lan` 对于桥接是正确的，但这依赖于 `lan` 接口被正确配置。
- **步骤 4：桥接网络** - 将两个接口都分配给 `lan` 在理论上桥接了它们，但如果不禁用 DHCP 服务器或调整 IP 设置，可能无法无缝工作。
- **步骤 5：测试设置** - 测试是必要的，但成功取决于之前的步骤完全正确。

**缺少或错误的是什么？**
- 默认情况下，OpenWRT 的 `lan` 接口具有静态 IP（例如 192.168.1.1）并运行 DHCP 服务器。如果主路由器也是 192.168.1.1，这会导致 IP 冲突。您需要将 `lan` 接口设置为 DHCP 客户端模式，以从主路由器获取 IP，并禁用本地 DHCP 服务器，让主路由器为所有设备分配 IP。
- 将防火墙区域分配给 `lan` 对于简化操作是可以的，但 IP 配置至关重要。

考虑到这一点，您的步骤“基本正确”，但如果不调整 `lan` 接口设置，则是不完整的。以下是修正后的步骤。

---

### **将 OpenWRT 配置为无线桥接的正确步骤（简单桥接方法）**

此方法将您的 OpenWRT 路由器设置为客户端连接到现有 Wi-Fi 网络，并通过其自身的 AP 或以太网端口共享该连接，所有设备都与主路由器（例如 192.168.1.x）处于同一子网。以下是通过 LuCI Web 界面操作的方法：

#### **前提条件**
- 已安装 OpenWRT（例如，小米路由器 4C 上的 24.10.0 版本）。
- 您拥有主 Wi-Fi 网络的 SSID、密码和加密类型（例如 WPA2-PSK）。
- 可以在 `http://192.168.1.1`（或当前 IP）访问 LuCI 以及您的管理员凭据。

#### **步骤 1：登录 LuCI**
- 打开浏览器并导航至 `http://192.168.1.1`。
- 使用您的 OpenWRT 用户名（默认：`root`）和密码（在安装过程中设置）登录。

#### **步骤 2：配置无线客户端**
- **导航到无线设置：**
  - 转到 **网络 > 无线**。
- **扫描网络：**
  - 找到您的无线设备（例如，小米路由器 4C 上的 2.4 GHz `radio0`）。
  - 点击 **扫描** 以列出可用的 Wi-Fi 网络。
- **加入主 Wi-Fi 网络：**
  - 找到您主路由器的 Wi-Fi 的 SSID。
  - 点击 **加入网络**。
- **配置客户端设置：**
  - **无线密钥：** 输入主 Wi-Fi 的密码。
  - **网络：** 选择或设置为 `lan`（这将客户端接口添加到 `br-lan` 桥接）。
  - **防火墙区域：** 分配给 `lan`（这简化了桥接的流量规则）。
  - **接口名称：** LuCI 可能会建议 `wwan`；您可以保留它或为了清晰起见重命名为 `client`，但要确保它绑定到 `lan`。
- **保存并应用：**
  - 点击 **保存并应用** 以连接到主 Wi-Fi。

#### **步骤 3：将 LAN 接口调整为 DHCP 客户端**
- **转到接口：**
  - 导航至 **网络 > 接口**。
- **编辑 LAN 接口：**
  - 点击 `lan` 接口旁边的 **编辑**。
- **将协议设置为 DHCP 客户端：**
  - 在 **协议** 下拉菜单中，选择 **DHCP 客户端**。
  - 这允许 `br-lan` 桥接（现在包含无线客户端）从主路由器的 DHCP 服务器获取 IP 地址（例如 192.168.1.x）。
- **禁用 DHCP 服务器：**
  - 由于 `lan` 现在是 DHCP 客户端，本地 DHCP 服务器会自动禁用。在 **高级设置** 或 **DHCP 和 DNS** 下验证——如果出现“忽略接口”选项，请确保其被勾选。
- **保存并应用：**
  - 点击 **保存并应用**。路由器现在将向主路由器请求 IP。

#### **步骤 4：配置无线接入点**
- **添加新的无线网络：**
  - 返回 **网络 > 无线**。
  - 在同一无线设备（例如 `radio0`）下点击 **添加** 以创建新的无线接口。
- **设置 AP：**
  - **ESSID：** 为您的 Wi-Fi 选择一个名称（例如 `OpenWRT_AP`）。
  - **模式：** 设置为 **接入点 (AP)**。
  - **网络：** 分配给 `lan`（这将使其与客户端接口和以太网端口桥接）。
- **配置安全：**
  - 转到 **无线安全** 选项卡。
  - **加密：** 选择 **WPA2-PSK**（推荐）。
  - **密钥：** 为您的 AP 设置一个强密码。
- **保存并应用：**
  - 点击 **保存并应用**。您的路由器现在将广播其自身的 Wi-Fi。

#### **步骤 5：验证桥接**
- **检查接口：**
  - 转到 **网络 > 接口**。
  - 确保 `lan` 接口在 `br-lan` 桥接下列出了无线客户端（例如 `wlan0`）和 AP（例如 `wlan0-1`）。
- **检查 IP 分配：**
  - 转到 **状态 > 概览**。
  - 记下主路由器分配给 `lan` 接口的 IP 地址（例如 `192.168.1.100`）。

#### **步骤 6：测试设置**
- **测试 Wi-Fi：**
  - 将设备连接到 `OpenWRT_AP` Wi-Fi。
  - 验证它是否从主路由器获取了 IP（例如 `192.168.1.x`）并具有互联网访问权限。
- **测试以太网（如果适用）：**
  - 将设备插入路由器的任一 LAN 端口。
  - 确认它从主路由器获取了 IP 并连接到互联网。
- **访问 LuCI：**
  - 使用新的 IP 地址（例如 `http://192.168.1.100`）访问 OpenWRT 界面。

---

### **为什么这能工作**
- 将客户端和 AP 接口都分配给 `lan` 网络，会将它们添加到 `br-lan` 桥接，允许第 2 层流量在它们与主路由器之间流动。
- 将 `lan` 设置为 DHCP 客户端可确保 OpenWRT 路由器从主路由器获取唯一的 IP，避免冲突（例如与 `192.168.1.1`），并禁用本地 DHCP 服务器，以便主路由器管理所有 IP 分配。
- 连接到 AP 或以太网端口的设备出现在与主网络相同的子网（例如 `192.168.1.x`）上，满足了无线桥接的要求。

---

### **替代方法：使用 relayd（伪桥接）**
如果简单桥接方法失败（例如，由于无线驱动限制），您可以使用 `relayd` 包进行伪桥接。这会创建一个路由设置，其中 OpenWRT 路由器的客户端位于不同的子网，但在某些硬件上更可靠。以下是简要概述：

1.  **安装 relayd：**
    - 转到 **系统 > 软件**，搜索 `relayd` 并安装。
2.  **配置无线客户端：**
    - 加入主 Wi-Fi，但将其分配给一个新的接口（例如 `wwan`），并设置为 DHCP 客户端。
3.  **配置 LAN：**
    - 将 `lan` 设置为静态 IP（例如 `192.168.2.1`）并启用其自身的 DHCP 服务器。
4.  **设置 relayd：**
    - 通过 SSH 或 LuCI（在 **网络 > 主机名** 下）配置 `relayd` 以在 `wwan` 和 `lan` 之间进行中继。
5.  **配置 AP：**
    - 在 `lan` 网络上设置 AP。
6.  **测试：**
    - `OpenWRT_AP` 上的设备将位于 `192.168.2.x` 子网，互联网通过主路由器中继。

**注意：** 这不是真正的桥接（不同子网），因此仅在简单方法不起作用时使用。对于您刷写了 OpenWRT 24.10.0 的小米路由器 4C，简单桥接方法应该足够了。

---

### **结论**
您最初的步骤**基本正确**，但如果不将 `lan` 接口设置为 DHCP 客户端模式以避免 IP 冲突并确保正确桥接，则是不完整的。上面修正后的步骤提供了一种将 OpenWRT 配置为无线桥接的可靠方法。如果您遵循这些步骤，您的路由器将连接到主 Wi-Fi，并通过其 AP 或以太网端口无缝共享该连接，所有设备都位于同一子网。测试该设置，如果出现问题（现代 OpenWRT 中很少见），请考虑 `relayd` 替代方案。