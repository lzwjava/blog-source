---
audio: false
generated: true
lang: zh
layout: post
title: Java 命名和目录接口 (JNDI)
translated: true
---

### 关键点
- 似乎 `javax.naming` 用于 Java 命名和目录接口（JNDI）来查找和管理服务（如数据库）中的命名对象。
- 研究表明，您需要一个初始上下文来开始，通常由 Java EE 应用程序服务器在生产中设置，或手动设置以进行测试。
- 证据倾向于使用 `InitialContext` 进行查找，例如使用名称（如 "java:comp/env/jdbc/datasource"）查找 DataSource。

### 使用 `javax.naming` 入门
`javax.naming` 是 JNDI 的一部分，它帮助 Java 应用程序与命名和目录服务交互，例如查找数据库连接。在 Java EE 环境中，应用程序服务器通常设置此项，使得通过名称找到资源变得容易。

### 示例用法
这是在 Java EE 应用中查找 DataSource 的简单方法：
```java
InitialContext ctx = new InitialContext();
DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
```
这假设 DataSource 已在您的服务器上配置。对于没有服务器的测试，您可能需要额外的库，如 Simple-JNDI。

### 意外细节
您可能不会预料到，对于独立应用程序，设置 JNDI 可能需要配置自定义上下文，这在没有工具（如 Simple-JNDI）的情况下可能会很复杂。

---

### 问卷说明：使用 `javax.naming` 的全面指南

此说明提供了对使用 `javax.naming` 的详细探讨，这是 Java 命名和目录接口（JNDI）的一部分，它促进了 Java 应用程序与命名和目录服务的交互。JNDI 设计为独立于特定服务实现，允许以统一的方式访问各种服务，如数据库、LDAP 和文件系统。本节扩展了直接答案，为开发人员提供了全面的理解，包括设置、示例和不同环境的考虑。

#### 了解 `javax.naming` 和 JNDI
`javax.naming` 是 JNDI 的核心包，作为 Java 标准库的一部分引入，以提供命名和目录功能。它定义了 `Context` 接口，这是 JNDI 操作的核心，包括用于查找、绑定、解绑和重命名对象以及创建和销毁子上下文的方法。`lookup()` 方法通常用于通过名称检索对象，使其对企业应用程序中的资源访问至关重要。

JNDI 在 Java EE 环境中特别有用，它允许应用程序与特定服务详细信息脱钩，从而提高了可移植性和灵活性。例如，它通常用于访问资源，如数据库连接（DataSources）、JMS 提供程序和 JavaMail 服务，这些资源由应用程序服务器管理。

#### 设置和使用 JNDI
要使用 `javax.naming`，您需要创建一个初始上下文，它作为命名操作的入口点。这通常使用 `InitialContext` 类完成。设置因环境而异：

- **在 Java EE 应用程序中：** 应用程序服务器（例如 Tomcat、JBoss、WebSphere）配置初始上下文。您可以使用标准 JNDI 名称查找资源，这些名称通常以 "java:comp/env/" 为前缀。例如，DataSource 可能在 "java:comp/env/jdbc/datasource" 处访问。
- **在独立应用程序中：** 如果没有应用程序服务器，您需要手动配置初始上下文，指定属性，如命名服务提供程序和 URL。这可能会很复杂，需要额外的库进行测试，例如 Simple-JNDI，它提供了内存实现。

以下是总结 `javax.naming` 中关键类及其角色的表格：

| 类/接口        | 角色                                                                 |
|-------------------------|----------------------------------------------------------------------|
| `Context`              | 用于命名操作（如查找、绑定和解绑）的核心接口。   |
| `InitialContext`       | 创建初始上下文以开始 JNDI 操作。             |
| `Name`                 | 表示通用名称，即组件的有序序列。         |
| `NamingException`      | 基类，用于在命名操作期间抛出的异常。            |

#### 实际示例
让我们探索 Java EE 和独立场景的示例：

##### 示例 1：在 Java EE 中查找 DataSource
在 Java EE 应用程序中，您可能会查找配置的 DataSource 如下：

```java
import javax.naming.InitialContext;
import javax.sql.DataSource;
import java.sql.*;

public class JNDIExample {
    public static void main(String[] args) throws Exception {
        InitialContext ctx = new InitialContext();
        DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
        Connection conn = ds.getConnection();
        // 使用连接...
        conn.close();
        ctx.close();
    }
}
```

此示例假设 DataSource 已在应用程序服务器中配置，通常在文件（如 Tomcat 的 `context.xml`）中。JNDI 名称 "java:comp/env/jdbc/datasource" 是标准约定，但它可能会根据服务器配置而有所不同。

##### 示例 2：绑定和查找自定义对象
对于测试或独立使用，您可能希望创建一个简单的内存上下文。虽然标准 API 不包括内存上下文工厂，但库（如 Simple-JNDI）可以帮助。以下是假设这种设置的概念示例：

```java
import javax.naming.*;

public class JNDIExample {
    public static void main(String[] args) throws NamingException {
        Context ctx = new InitialContext();
        ctx.rebind("myObject", "Hello, World!");
        String value = (String) ctx.lookup("myObject");
        System.out.println(value);
        ctx.close();
    }
}
```

注意：此独立示例需要使用适当的属性配置初始上下文，这可能涉及将 `java.naming.factory.initial` 设置为自定义上下文工厂，例如由 Simple-JNDI 提供的工厂。

#### 不同环境的考虑
- **生产（Java EE）：** 在生产中，应用程序服务器处理 JNDI 设置，使查找资源变得简单。通常使用 JNDI 进行数据库连接池，服务器管理连接，从而提高了可扩展性和安全性。例如，更改数据库凭据只需更新服务器配置，而不需要更改应用程序代码。
- **测试（独立）：** 对于单元和集成测试，通常需要在没有应用程序服务器的情况下运行。库（如 Simple-JNDI）允许您模拟 JNDI 环境，以编程方式绑定资源。这对于测试依赖于 JNDI 查找的代码至关重要，确保它在不部署到服务器的情况下工作。
- **安全和最佳实践：** 对 JNDI 注入要特别小心，特别是在较旧的 Java 版本中，因为它们可能导致安全漏洞，如远程代码执行。Oracle 已解决了许多此类问题，更新（如 Java 8u191）关闭了 LDAP 向量漏洞。始终验证输入并使用最新的 Java 版本以确保安全。

#### 意外细节：独立设置的复杂性
您可能不会预料到在没有应用程序服务器的情况下设置 JNDI 的复杂性。虽然 Java EE 通过服务器管理的上下文简化了此过程，但独立设置需要配置上下文工厂和属性，通常需要第三方库。这可能是对新手 JNDI 开发人员的障碍，但工具（如 Simple-JNDI）通过提供基于内存的实现来缓解了这种情况。

#### 进一步阅读和资源
要深入了解，请参阅以下内容：
- [Oracle Java 教程：JNDI 概述](https://docs.oracle.com/en/java/tutorial/jndi/overview/index.html) 以获取官方文档。
- [Baeldung：Java 命名和目录接口概述](https://www.baeldung.com/jndi) 以获取实用示例和现代用法。
- [Simple-JNDI GitHub](https://github.com/h-thurow/Simple-JNDI) 以在没有服务器的情况下测试 JNDI。

这些资源提供了代码示例、教程和最佳实践，确保您能够在各种场景中有效地实现 JNDI。

#### 关键引用
- [Oracle Java 教程 JNDI 概述](https://docs.oracle.com/en/java/tutorial/jndi/overview/index.html)
- [Baeldung Java 命名和目录接口概述](https://www.baeldung.com/jndi)
- [Simple-JNDI 通过 JNDI 查找访问属性文件](https://github.com/h-thurow/Simple-JNDI)