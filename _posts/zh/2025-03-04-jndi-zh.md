---
audio: false
generated: true
lang: zh
layout: post
title: Java命名与目录接口
translated: true
type: note
---

### 核心要点
- 看起来 `javax.naming` 可能用于 Java 命名和目录接口（JNDI），以查找和管理数据库等服务中的命名对象。
- 研究表明，您需要一个初始上下文来开始，通常由 Java EE 应用服务器为生产环境设置，或为测试手动设置。
- 证据倾向于使用 `InitialContext` 进行查找，例如使用诸如 "java:comp/env/jdbc/datasource" 之类的名称查找 DataSource。

### 开始使用 `javax.naming`
`javax.naming` 是 JNDI 的一部分，它帮助 Java 应用程序与命名和目录服务交互，例如查找数据库连接。在 Java EE 环境中，应用服务器通常设置此功能，使得通过名称查找资源变得容易。

### 使用示例
以下是在 Java EE 应用程序中查找 DataSource 的简单方法：
```java
InitialContext ctx = new InitialContext();
DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
```
这假设 DataSource 已在您的服务器中配置。对于没有服务器的测试，您可能需要额外的库，例如 Simple-JNDI。

### 意外细节
您可能没想到，对于独立应用程序，设置 JNDI 可能需要配置自定义上下文，如果没有像 Simple-JNDI 这样的工具，这可能会很复杂。

---

### 调研笔记：使用 `javax.naming` 的全面指南

本笔记详细探讨了如何使用 `javax.naming`，这是 Java 命名和目录接口（JNDI）的一部分，它促进了 Java 应用程序中与命名和目录服务的交互。JNDI 被设计为独立于特定的服务实现，允许以统一的方式访问各种服务，如数据库、LDAP 和文件系统。本节在直接答案的基础上扩展，为开发人员提供全面的理解，包括设置、示例以及针对不同环境的考虑。

#### 理解 `javax.naming` 和 JNDI
`javax.naming` 是 JNDI 的核心包，作为 Java 标准库的一部分引入，以提供命名和目录功能。它定义了 `Context` 接口，这是 JNDI 操作的核心，包括查找、绑定、解绑和重命名对象的方法，以及创建和销毁子上下文。`lookup()` 方法通常用于按名称检索对象，使其在企业应用程序中的资源访问中至关重要。

JNDI 在 Java EE 环境中特别有用，它允许应用程序与特定服务细节解耦，从而增强了可移植性和灵活性。例如，它通常用于访问由应用服务器管理的资源，如数据库连接（DataSources）、JMS 提供者和 JavaMail 服务。

#### 设置和使用 JNDI
要使用 `javax.naming`，您首先需要创建一个初始上下文，该上下文作为命名操作的入口点。这通常使用 `InitialContext` 类完成。设置因环境而异：

- **在 Java EE 应用程序中：** 应用服务器（例如 Tomcat、JBoss、WebSphere）配置初始上下文。您可以使用标准的 JNDI 名称查找资源，通常以 "java:comp/env/" 为前缀。例如，可以通过 "java:comp/env/jdbc/datasource" 访问 DataSource。
- **在独立应用程序中：** 没有应用服务器时，您需要手动配置初始上下文，指定命名服务提供者和 URL 等属性。这可能很复杂，需要额外的库进行测试，例如 Simple-JNDI，它提供了内存中的实现。

以下是总结 `javax.naming` 中关键类及其角色的表格：

| 类/接口                 | 角色                                                                 |
|-------------------------|----------------------------------------------------------------------|
| `Context`              | 命名操作的核心接口，如查找、绑定和解绑。                               |
| `InitialContext`       | 创建用于启动 JNDI 操作的初始上下文。                                   |
| `Name`                 | 表示通用名称，即组件的有序序列。                                       |
| `NamingException`      | 命名操作期间抛出的异常的基类。                                         |

#### 实际示例
让我们探讨 Java EE 和独立场景的示例：

##### 示例 1：在 Java EE 中查找 DataSource
在 Java EE 应用程序中，您可能会查找已配置的 DataSource，如下所示：

```java
import javax.naming.InitialContext;
import javax.sql.DataSource;
import java.sql.*;

public class JNDIExample {
    public static void main(String[] args) throws Exception {
        InitialContext ctx = new InitialContext();
        DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
        Connection conn = ds.getConnection();
        // 使用连接...
        conn.close();
        ctx.close();
    }
}
```

此示例假设 DataSource 已在应用服务器中配置，通常在 Tomcat 的 `context.xml` 等文件中。JNDI 名称 "java:comp/env/jdbc/datasource" 是标准约定，但可能因服务器配置而异。

##### 示例 2：绑定和查找自定义对象
对于测试或独立使用，您可能希望创建一个简单的内存上下文。虽然标准 API 不包含内存上下文工厂，但像 Simple-JNDI 这样的库可以提供帮助。以下是假设此类设置的概念性示例：

```java
import javax.naming.*;

public class JNDIExample {
    public static void main(String[] args) throws NamingException {
        Context ctx = new InitialContext();
        ctx.rebind("myObject", "Hello, World!");
        String value = (String) ctx.lookup("myObject");
        System.out.println(value);
        ctx.close();
    }
}
```

注意：此独立示例需要配置具有适当属性的初始上下文，这可能涉及将 `java.naming.factory.initial` 设置为自定义上下文工厂，例如由 Simple-JNDI 提供的工厂。

#### 不同环境的考虑
- **生产环境（Java EE）：** 在生产环境中，应用服务器处理 JNDI 设置，使得查找资源变得简单。通常使用 JNDI 进行数据库连接池管理，服务器管理连接，从而提高可扩展性和安全性。例如，更改数据库凭据只需要更新服务器配置，而不需要修改应用程序代码。
- **测试环境（独立）：** 对于单元和集成测试，通常需要在没有应用服务器的情况下运行。像 Simple-JNDI（[Simple-JNDI GitHub](https://github.com/h-thurow/Simple-JNDI)）这样的库允许您模拟 JNDI 环境，以编程方式绑定资源。这对于测试依赖于 JNDI 查找的代码至关重要，确保其无需部署到服务器即可工作。
- **安全性和最佳实践：** 注意 JNDI 注入，尤其是在旧版 Java 中，因为它们可能导致远程代码执行等安全漏洞。Oracle 已经解决了许多此类问题，例如 Java 8u191 更新关闭了 LDAP 向量利用。始终验证输入并使用最新的 Java 版本以确保安全。

#### 意外细节：独立设置的复杂性
人们可能没想到在没有应用服务器的情况下设置 JNDI 所涉及的复杂性。虽然 Java EE 通过服务器管理的上下文简化了这一点，但独立设置需要配置上下文工厂和属性，通常需要第三方库。这对于刚接触 JNDI 的开发人员来说可能是一个障碍，但像 Simple-JNDI 这样的工具通过提供基于内存的实现来缓解这一问题。

#### 进一步阅读和资源
为了更深入的理解，请参考以下内容：
- [Oracle Java 教程：JNDI 概述](https://docs.oracle.com/en/ java/ tutorial/jndi/ overview/index.html) 获取官方文档。
- [Baeldung：Java 命名和目录接口概述](https://www.baeldung.com/jndi) 获取实际示例和现代用法。
- [Simple-JNDI GitHub](https://github.com/h-thurow/Simple-JNDI) 用于在没有服务器的情况下测试 JNDI。

这些资源提供了代码示例、教程和最佳实践，确保您可以在各种场景中有效实现 JNDI。

#### 关键引用
- [Oracle Java 教程 JNDI 概述](https://docs.oracle.com/en/ java/ tutorial/jndi/ overview/index.html)
- [Baeldung Java 命名和目录接口概述](https://www.baeldung.com/jndi)
- [Simple-JNDI 通过 JNDI 查找访问属性文件](https://github.com/h-thurow/Simple-JNDI)