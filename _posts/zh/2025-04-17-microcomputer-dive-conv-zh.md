---
audio: false
lang: zh
layout: post
title: 微型计算机探秘——对话篇
translated: true
type: note
---

A：最近我在重新研究微计算机架构。我们能否从对比冯·诺依曼架构与哈佛架构开始？

B：当然！冯·诺依曼架构使用单一总线处理数据和指令，容易形成瓶颈。哈佛架构则将二者分离，支持并行存取——这在DSP和微控制器中很常见。你更关注哪种应用场景？

A：其实是嵌入式系统。哈佛架构在那里似乎占主导地位。但像改进型哈佛架构这类现代混合架构是如何弥补差距的？

B：好问题！混合架构采用分离式缓存（L1缓存分指令/数据），但使用统一内存空间。以ARM Cortex-M为例：它类似哈佛架构以提升速度，同时简化了编程。这里存在什么权衡？

A：确实是权衡问题。统一内存方便开发但牺牲了吞吐量。你认为RISC-V的灵活性会颠覆这个领域吗？

B：有可能！RISC-V的模块化指令集架构允许设计者根据应用添加类哈佛架构特性。对物联网边缘设备来说，这将是颠覆性的。但ARM的生态系统根深蒂固。你怎么看？

A：生态系统具有粘性，但RISC-V的开源模式可能加速细分领域的优化。换个话题——DMA在现代微控制器中有多关键？

B：至关重要！卸载数据传输（比如从ADC到内存）能节省CPU周期。STM32的DMA甚至支持外设到外设的传输。你用过环形DMA缓冲区吗？

A：用过，用于音频处理。但配置突发模式比较棘手。当多个外设竞争时，DMA如何确定请求优先级？

B：优先级通常可通过硬件配置。NXP的微控制器采用加权轮询，而某些TI器件允许动态重定优先级。中断延迟也会成为影响因素——你测量过吗？

A：仅通过经验判断。说到中断，像FreeRTOS这样的RTOS与裸机系统在处理嵌套ISR时有何不同？

B：RTOS会增加层次：上下文保存、ISR后的调度器调用。FreeRTOS的'FromISR' API能安全管理这些。但裸机ISR更轻量——这是复杂度与控制力之间的权衡。

A：有道理。对于硬实时系统，你会推荐超级循环而非RTOS吗？

B：仅适用于简单系统！超级循环难以处理多速率任务。正确调优的RTOS配合优先级继承可避免优先级反转。Zephyr近期的改进值得关注。

A：Zephyr的设备树模型很有意思。在嵌入式应用中它与Linux的相比如何？

B：Linux的设备树对微控制器来说过于臃肿。Zephyr的Kconfig+设备树取得了平衡——静态配置降低了运行时开销。你有在两者间移植过驱动吗？

A：还没有，但我注意到Zephyr的GPIO API能很好地抽象硬件差异。你对微控制器的内存映射I/O与端口映射I/O有何看法？

B：内存映射现在是主流——统一寻址简化了编译器设计。x86的遗留端口I/O因向后兼容而保留。ARM的MMIO甚至支持位绑定以实现原子访问！

A：位绑定是共享变量的救星！但像MRAM这类新兴非易失性内存呢？它会颠覆内存层次结构吗？

B：MRAM的持久性+速度很有前景，但成本/耐久性落后。目前仍属小众——比如航天器日志记录。NVDIMM可能更早进入微控制器领域。你对比过FRAM和Flash的性能吗？

A：测过——FRAM的写入速度远超Flash，但密度是问题。转到接口方面：在传感器枢纽中，SPI是否正被I3C取代？

B：I3C的多点连接和带内中断很有吸引力，但SPI的简洁性使其保持生命力。MEMS传感器仍默认使用SPI。你试过I3C的动态寻址吗？

A：还没有——我当前项目使用QSPI连接外部NOR Flash。谈到存储，工业温度下eMMC与SD卡对比如何？

B：在振动环境中，eMMC的焊接可靠性胜过SD卡的连接器。但SD卡可拆卸便于现场更新。SLC NAND在寿命方面仍是王者。你遇到过磨损均衡的bug吗？

A：遇到过一次——糟糕的FTL实现导致记录器变砖。聊聊安全：微控制器