---
audio: false
generated: true
image: false
lang: ja
layout: post
title: Java EEコンテナ管理タスクスケジューラ
translated: true
type: note
---

**ManagedScheduledExecutorService** は、アプリケーションサーバー（例: WebSphere、WebLogic、WildFly）によって提供される Java EE (Jakarta EE) リソースであり、標準 Java SE の `ScheduledExecutorService` と同様に、将来または定期的にタスクをスケジュール実行することを可能にします。ただし、**コンテナ管理のメリット** が付加されます：

---

### 仕組み

*   **コンテナとの統合**
    アプリケーションサーバーによって管理されるため、タスクはアプリケーションのセキュリティコンテキスト、クラスローダー、トランザクション境界内で実行されます。これにより、Java EE における非管理スレッドの一般的な問題を回避できます。

*   **スケジューリング機能**
    以下のようにタスクをスケジュールできます：

    *   遅延後に1度実行する。
    *   固定レートで実行する（例: 5秒毎）。
    *   実行間で固定の遅延を置いて実行する。

*   **ライフサイクル管理**
    コンテナはスレッドプールのライフサイクル、クリーンアップ、リソース管理を担当します。通常の `ExecutorService` のように手動でシャットダウンする必要はありません。

---

### タイムアウト

*   プール自体に対する単一の「タイムアウト」設定はありませんが、以下の2点が関連します：

    *   **タスク実行タイムアウト**: タスクを `ManagedTaskListener` でラップし、`ManagedTask.TIMEOUT` のようなプロパティを指定できます（ベンダーのサポートに依存）。一部のサーバーでは、デフォルトのタスクタイムアウトを設定でき、ハングしたタスクをコンテナがキャンセルするようにできます。
    *   **Future get() タイムアウト**: 通常の `ScheduledExecutorService` と同様に、`future.get(timeout, unit)` を使用して結果を待機する時間を制限できます。

したがって、「タイムアウト」は通常、プールレベルではなくタスク毎に適用されます。

---

### プールサイズの設定

*   各アプリケーションサーバーは、基盤となるスレッドプールに対して独自の設定方法を持ちます。
    例:

    *   **WebSphere Liberty / Traditional**: `server.xml` 内の `<managedScheduledExecutorService>` の下で、`corePoolSize` や `maximumPoolSize` などの属性を設定してプールを構成します。
    *   **WebLogic**: Admin Console または `weblogic-managed-executor` を介して構成します。
    *   **WildFly / JBoss EAP**: EE サブシステムの下で構成します。

*   典型的なプール設定には以下が含まれます：

    *   **コアプールサイズ**: 維持される最小スレッド数。
    *   **最大プールサイズ**: 同時実行可能な最大スレッド数。
    *   **キューサイズ / 拒否ポリシー**: 全てのスレッドがビジー状態の場合の動作。
    *   **キープアライブ時間**: アイドル状態のスレッドが解放されるまで保持される時間。

---

✅ **まとめ**:
`ManagedScheduledExecutorService` は Java SE のスケジューラと同様に動作しますが、コンテナを認識するため、Java EE アプリケーションで安全なスレッド処理を実現します。タイムアウトは通常タスク毎に適用され（API またはサーバー設定を介して）、プールサイズ（コア/最大スレッド数）はアプリケーションコードではなくコンテナレベルで設定されます。

---

**WebSphere Liberty のプールサイズとタイムアウトの設定例**をお見せしましょうか？