---
audio: false
generated: true
image: false
lang: ja
layout: post
model: openai/gpt-5
title: ビットコインハッシュ計算とマイニング
translated: true
type: note
---

### ビットコインのハッシュ計算方法

ビットコインは、暗号化ハッシュ関数である **SHA-256** (Secure Hash Algorithm 256-bit) を使用してハッシュを計算します。これは一方向関数であり、入力データ（ブロックヘッダーなど）を受け取り、固有で予測不可能な固定長の256ビット（32バイト）の出力を生成します。

- **ハッシュ化の対象:** 主にブロックヘッダーで、以下を含みます：
  - バージョン番号
  - 前のブロックのハッシュ
  - マークルルート（ブロック内の全取引の要約）
  - タイムスタンプ
  - 難易度ターゲット（ビット）
  - ナンス（マイナーが調整する数値）

- **プロセス:**
  1.  マイナーはブロックヘッダーを組み立てます。
  2.  SHA-256を2回適用します: `ハッシュ = SHA256(SHA256(ヘッダー))`。
  3.  結果のハッシュが現在のターゲット（例えば、000000...のように十分な数の先頭ゼロで始まるか）より小さいかどうかをチェックします。
  4.  条件を満たさない場合、ナンスを増分して繰り返します。これがProof of Work (PoW) の「試行錯誤」部分です。

ハッシュは決定的です—同じ入力は常に同じ出力を与えます—しかし、わずかな変更（ナンスに+1するなど）でも全く異なる出力を生成します。これにより、出力から入力を逆算することは事実上不可能になります。

### なぜビットコインをマイニングするのか？（そしてそれがどのように2100万枚の供給上限を保証するのか）

「なぜ鋳造する」ではなく「なぜマイニングする」という意味だと思います—マイニングは取引を検証し、ブロックをブロックチェーンに追加するプロセスであり、新しいビットコインが報酬として与えられます。

- **なぜマイニングするのか？**
  - **セキュリティ:** マイナーはPoWのパズルを解くために競争することでネットワークを保護し、二重支払い（同じBTCを二回使うこと）などの攻撃を防ぎます。
  - **分散化:** 誰でもマイニングに参加でき、管理が分散されます—中央機関は存在しません。
  - **インセンティブ:** マイナーは**ブロック報酬**（新しく鋳造されたBTC）＋取引手数料を獲得します。これはネットワークを立ち上げ、エネルギーコストを補償します。

- **供給上限の保証（実際は1000万ではなく2100万枚です）:**
  ビットコインのプロトコルは、**2100万BTC**という総供給量をハードコードしており、これはマイニング報酬を通じて生成され、21万ブロックごと（約4年）に**半減**します。
  - 2009年にはブロックあたり50BTCから始まりました。
  - 2012年に25、2016年に12.5、2020年に6.25、2024年に3.125へ半減し、以降も続きます。
  - 最後のビットコインは2140年頃に採掘されると予想され、その後は手数料のみが残ります。
  - これはコードによって強制されています: 報酬の計算式は `報酬 = 50 * 0.5^(floor(ブロック高 / 210000))` です。ネットワークの95％の合意なしには誰もこれを変更できず、インフレは予測可能で上限が固定されています。

この希少性は金を模しており、価値を生み出します。

### Proof of Work (PoW) の仕組み

PoWはビットコインのコンセンサスメカニズムであり、マイナーがブロックを追加するために「仕事」（CPU/GPU/ASICの計算能力）を投入したことを証明する計算パズルです。

- **ステップバイステップ:**
  1.  **取引の収集:** マイナーは保留中の取引をブロックにまとめます（SegWitに依存して約1-4MBまで）。
  2.  **ヘッダーの構築:** 取引のマークルルート、前のブロックへのリンクなどを含めます。
  3.  **ターゲットの設定:** ネットワークは2016ブロックごとに難易度を調整し、平均ブロック時間を10分に保ちます。ターゲット = 非常に小さな数値（例: ハッシュが < 0x00000000FFFF... である必要がある）。
  4.  **ナンスの発見:** ナンスを総当たりで推測します（0から2^32-1まで）。それぞれに対してヘッダーをハッシュ化します。ハッシュ < ターゲットであれば有効！
  5.  **ブロックのブロードキャスト:** 他のノードが検証します（簡単—ただ一度再ハッシュ化するだけ）。有効であればチェーンに追加し、マイナーは次のブロックに取り掛かります。
  6.  **チェーンルール:** 最も長い有効なチェーンが優先されます（フォークを解決します）。

PoWは、ブロックの作成には高コストがかかりますが、検証は安価に行えるようにし、51%攻撃（履歴を書き換えるためにハッシュレートの50%以上を支配すること）からネットワークを保護します。

### なぜ一つの取引にこれほど多くの計算が必要なのか？

取引自体がユーザーから直接莫大な計算を必要とするわけではありません—単に秘密鍵で署名するだけです（楕円曲線暗号、高速）。重い処理は**マイニング**で行われます：

- **取引単位ではなくブロック単位:** 1ブロックは約2,000〜3,000の取引を束ねます。マイナーはPoWを解くためにブロックあたり何兆回もハッシュ計算します。
- **難易度調整:** より多くのマイナーが参加する（総ハッシュレートが高くなる）と、難易度は指数関数的に上昇し、10分間隔のブロック生成を維持します。現在の全球ハッシュレートは約600 EH/s（エクサハッシュ/秒）—これは毎秒60京回のハッシュ計算です！
- **なぜこの「無駄」があるのか？**
  - **セキュリティコスト:** 高い計算量により、攻撃が経済的に見合わなくなります。ブロックを書き換えるには、その後のすべてのPoWを再実行するコストがかかります。
  - **Sybil攻撃耐性:** 偽の識別子でネットワークを氾濫させることを防ぎます。
  - **トレードオフ:** エネルギー集約的（ビットコインは年間約150 TWhを使用、中規模国並み）ですが、支持者はそれが信頼を必要としない通貨のための特徴であると主張します。

ユーザーは手数料を支払うことで、ブロック内での自分の取引の優先度を高めます；手数料の低い取引は待たされます。

何か特定の意味（例えばマイニングのハードウェアなど）をお考えでしたら、お知らせください！

**参考文献:**  
[ビットコイン原論文](https://bitcoin.org/bitcoin.pdf)  
[ビットコインWiki: Proof of Work](https://en.bitcoin.it/wiki/Proof_of_work)  
[Blockchain.com: ビットコインハービング](https://www.blockchain.com/learning-crypto/bitcoin-halving)