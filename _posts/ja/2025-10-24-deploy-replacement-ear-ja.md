---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: WebSphereへの代替EARのデプロイ
translated: true
type: note
---

### IBM WebSphere Application Server (WAS) で既存のEARファイルを置き換える新規EARファイルのデプロイ

IBM WAS で EAR (Enterprise Archive) ファイルを置き換えることは標準的なデプロイメントタスクですが、ダウンタイム、設定の不一致、またはランタイムエラーを避けるためにベストプラクティスに従うことが重要です。以下に、アップロード/デプロイプロセスの前、最中、後に確認し検証すべき主要な詳細を説明します。ここでは、WAS 管理コンソール（または自動化のための wsadmin スクリプト）を使用しており、サポートされている環境（例: WAS 8.5, 9.x, または Liberty プロファイル）で作業していることを想定しています。

#### 1. **デプロイ前の準備 (アップロード前にこれらを確認)**
   - **現在のアプリケーションのバックアップ**:
     - コンソールから既存のEARをエクスポートする（アプリケーション > エンタープライズ・アプリケーション > [アプリ名] > エクスポート）するか、wsadmin 経由で `backupConfig` コマンドを使用して設定全体をバックアップします。
     - 理由: 新しいEARに問題が発生した場合にロールバックが可能になります。バックアップが完了し安全に保管されていることを確認してください。

   - **互換性チェック**:
     - 新しいEARが正しいWASバージョン向けにビルドされていることを確認します（例: Javaバージョン、EJB仕様 (Jakarta EE 対 Java EE)）。
     - 使用しているWASバージョンでの非推奨機能がないかチェックします（例: IBM Knowledge Center ドキュメント経由）。可能であれば、`AdminConfig.validateAppDeployment` を指定して `wsadmin` を実行します。
     - EARのデプロイメント記述子（application.xml, ibm-application-ext.xmi）がサーバーのモジュール（EAR内のWAR、JAR）と一致していることを確認します。

   - **環境とリソース依存関係**:
     - JNDIリソースを確認します: データソース、JMSキュー、環境変数。参照されているリソース（例: JDBCプロバイダー）が設定され正常であることを確認します。コンソール（リソース > JDBC > データ・ソース）経由で接続をテストします。
     - セキュリティ: ユーザーロール、セキュリティ制約、マッピング（例: ibm-application-bnd.xmi内）がレルム（例: LDAP, フェデレーテッド）と整合していることを確認します。新しいEARが新しいカスタムレルムや証明書を必要とするかどうかを確認します。
     - クラスローダーポリシー: 現在のWARクラスローダーモード（PARENT_FIRST または PARENT_LAST）と共有ライブラリ参照をメモします—新しいEARとの競合がないことを確認します。
     - クラスタリング/高可用性: クラスタ環境の場合、新しいEARがノード間で同一であることを確認し、ダウンタイムを最小化するためのローリングデプロイメントを計画します。

   - **アプリケーション固有の詳細**:
     - コンテキストルートと仮想ホスト: コンテキストルートが他のアプリと競合しないことを確認します（アプリケーション > [アプリ名] > Webモジュールのコンテキスト・ルート）。
     - ポートとマッピング: サーブレットマッピングとURLパターンを確認します。
     - カスタムプロパティ: コンソールで設定されたアプリケーション固有のカスタムプロパティを確認します—これらはデプロイ後に再適用が必要な場合があります。

   - **新しいEARのテスト**:
     - ステージング/開発環境で最初にEARをビルドしてテストします。Rational Application Developer や Eclipse with WAS プラグインなどのツールを使用して検証します。
     - 既知の問題のスキャン: 使用しているWASバージョン向けに IBM の Fix Packs および APARs 検索を使用します。

#### 2. **アップロードとデプロイ中**
   - **現在のアプリケーションの停止**:
     - コンソールで: アプリケーション > エンタープライズ・アプリケーション > [アプリ名] > 停止。アプリケーションが完全に停止したことを確認します（セッションアフィニティが有効な場合、アクティブなセッションがないこと）。
     - 設定を保存し、クラスタ設定ではノードを同期します（システム管理 > ノード > 同期）。

   - **新しいEARのアップロード**:
     - アプリケーション > 新しいアプリケーション > 新しいエンタープライズ・アプリケーション に移動します。
     - EARファイルをアップロードします。ウィザード中に:
       - プロンプトが表示されたら「既存のアプリケーションを置き換える」を選択します（または、最初にアプリケーション > [アプリ名] > アンインストール 経由で古いものをアンインストールします）。
       - デプロイメントオプションを確認します: モジュールからサーバー、ターゲットクラスター、共有ライブラリへのマッピング。
       - ウィザード内でステップバイステップで確認します: セキュリティロールバインディング、リソース参照、メタデータの完全性。
     - wsadminを使用する場合: `AdminApp.update` または `installInteractive` を使用した置換用のスクリプト。例:
       ```
       wsadmin> AdminApp.update('AppName', '[-operation update -contenturi /path/to/new.ear]')
       ```
       適用前に常に `AdminConfig.validateAppDeployment` で検証してください。

   - **設定の同期**:
     - アップロード後、マスター設定を保存し、デプロイメントマネージャー/ノードに同期します。
     - デプロイメントサマリーの警告/エラーをチェックします—モジュールバインディングの問題があれば直ちに対処します。

   - **アプリケーションの起動**:
     - コンソール経由で起動し、エラーなく初期化することを確認します（プロファイルの logs ディレクトリ内の SystemOut.log と SystemErr.log を監視します）。

#### 3. **デプロイ後の検証**
   - **ログと監視**:
     - デプロイメントの成功、バインディングエラー、または起動例外についてログ（例: `tail -f profile/logs/server1/SystemOut.log`）を監視します。
     - 詳細なトレースが必要な場合は、コンソールのトラブルシューティング > ログとトレースを使用します。ClassNotFoundException や NoSuchMethodError がないことを確認します。

   - **機能テスト**:
     - スモークテスト: URL経由でアプリにアクセスし、コア機能（例: ログイン、APIコール）を検証します。
     - 重要な場合は負荷テストを実施します—メモリリークやパフォーマンスの退行がないかチェックします。
     - データベース/外部統合: データフローを確認するためにクエリやコールを実行します。

   - **ロールバック計画**:
     - バックアップしたEARを迅速に再デプロイできることを確認します。ヘルスチェックを設定します（例: IBM Health Center またはカスタムスクリプト経由）。

#### 注意すべき一般的な落とし穴
- **セッション管理**: アプリが HTTPSession を使用する場合、データ損失を避けるために停止前にアクティブなセッションをドレインします。
- **ファイルパーミッション**: EARファイルがWASユーザー（例: wasadmin）に対して読み取り権限を持っていることを確認します。
- **サイズと時間**: 大きなEARファイルはデプロイに時間がかかる場合があります—メンテナンスウィンドウ中に計画します。
- **Liberty プロファイルの違い**: WAS Liberty を使用する場合、デプロイメントは server.xml の編集または `install-feature` 経由で行われます。XML設定が一致していることを確認します。
- **バージョン固有の注意点**: WAS 9+ の場合、microProfile または CDI の変更をチェックします。常に正確なバージョンに対応する IBM Docs を参照してください。

詳細（例: WASバージョン、クラスタ設定、または特定のエラー）を提供していただければ、このアドバイスを具体化できます。正式なガイダンスについては、IBM Knowledge Center またはサポートポータルを確認してください。他にどのような支援ができるかお知らせください！