---
audio: false
generated: true
lang: ja
layout: post
title: マスタリングYourKit Javaプロファイラ：完全ガイド
translated: true
type: note
---

# YourKit Java Profiler 総合ガイド

YourKit Java Profilerは、開発者とパフォーマンスエンジニアがJavaアプリケーションのパフォーマンスを分析・最適化するための、強力で機能豊富なツールです。CPU使用率、メモリ割り当て、スレッドアクティビティなどを詳細に把握でき、Javaアプリケーションのパフォーマンスボトルネックやメモリリークを診断するための必須ツールとなっています。このガイドでは、YourKit Java Profilerの機能、セットアップ、使用方法、ベストプラクティスを含む包括的な概要を提供します。

## 目次
1. [YourKit Java Profilerの紹介](#introduction-to-yourkit-java-profiler)
2. [主な機能](#key-features)
3. [システム要件とインストール](#system-requirements-and-installation)
4. [YourKit Java Profilerのセットアップ](#setting-up-yourkit-java-profiler)
5. [YourKit Java Profilerの使用](#using-yourkit-java-profiler)
6. [効果的なプロファイリングのためのベストプラクティス](#best-practices-for-effective-profiling)
7. [ユースケース](#use-cases)
8. [開発ツールとの統合](#integration-with-development-tools)
9. [ライセンスとサポート](#licensing-and-support)
10. [一般的な問題のトラブルシューティング](#troubleshooting-common-issues)
11. [結論](#conclusion)

## YourKit Java Profilerの紹介
YourKit Java Profilerは、YourKit LLCによって開発されたプロフェッショナルグレードのプロファイリングツールで、Java EEおよびJava SEプラットフォーム上で動作するJavaアプリケーションのパフォーマンスを監視・最適化するように設計されています。開発者がパフォーマンスボトルネック、メモリリーク、スレッド同期の問題、非効率なコードを特定するために広く使用されています。このプロファイラはローカルとリモートの両方のプロファイリングをサポートしており、開発、テスト、本番環境に適しています。低オーバーヘッドの設計、ユーザーフレンドリーなインターフェース、高度な分析ツールにより、YourKitはアプリケーションパフォーマンスを向上させたいJava開発者の定番ツールとなっています。

## 主な機能
YourKit Java Profilerは、Javaアプリケーションを診断・最適化するための包括的な機能セットを提供します。以下に主な機能を示します：

### CPUプロファイリング
- **コールツリーとホットスポット**: メソッド実行時間を可視化し、CPU集約的なメソッドをコールツリーまたはホットスポットリストで特定します。
- **フレームグラフ**: コールスタックを視覚的に表現し、パフォーマンスボトルネックを素早く特定します。
- **スマートWhat-If分析**: アプリケーションを再プロファイリングせずに潜在的なパフォーマンス改善を評価します。
- **サンプリングとトレーシング**: サンプリング（低オーバーヘッド）またはトレーシング（詳細）を選択して、パフォーマンスと精度のバランスを取ります。

### メモリプロファイリング
- **オブジェクトヒープ分析**: オブジェクトグラフを走査し、オブジェクトプロパティを検査し、メモリリークを特定します。
- **メモリ保持パス**: オブジェクトがメモリに残る理由を理解し、オブジェクトライフサイクルを最適化します。
- **スナップショット比較**: メモリスナップショットを比較して、時間経過に伴うメモリ使用量の変化を追跡します。
- **難読化解除サポート**: ProGuardやZelix KlassMasterなどのツールで難読化されたアプリケーションの元のクラス、メソッド、フィールド名を復元します。

### スレッドプロファイリング
- **スレッドアクティビティ可視化**: スレッド状態を監視し、ブロックされたスレッドを検出し、同期問題を分析します。
- **デッドロック検出**: デッドロックを自動的に識別し、関連するスレッドとモニターの詳細を提供します。
- **フローズンスレッドビュー**: 長時間の待機や潜在的なデッドロックにより非アクティブになっているスレッドを特定します。

### 例外プロファイリング
- **例外分析**: 実行中にスローされた例外を検出・分析し、過剰な例外スローによる隠れたパフォーマンス問題を含みます。
- **例外フレームグラフ**: 例外発生を可視化して問題のある領域を特定します。

### データベースとI/Oプロファイリング
- **SQLおよびNoSQLサポート**: MongoDB、Cassandra、HBaseなどのデータベースに対するクエリをプロファイリングし、遅いクエリを特定します。
- **HTTPリクエスト分析**: スレッド状態とHTTPリクエストを組み合わせて、リクエスト処理パフォーマンスを理解します。
- **I/O操作**: 非効率なI/O操作を検出し、リソース使用を最適化します。

### パフォーマンスインスペクション
- **40以上の組み込みインスペクション**: リークしたWebアプリ、重複オブジェクト、閉じられていないSQLステートメント、非効率なコレクションなどの一般的な問題を自動的に特定します。
- **カスタムインスペクション**: アプリケーション固有のパフォーマンスデータを収集するためのカスタムプローブを作成します。

### テレメトリとパフォーマンスチャート
- **リアルタイム監視**: CPU、メモリ、ガベージコレクション（GC）、その他のメトリクスをリアルタイムで追跡します。
- **カスタマイズ可能なインターフェース**: 関連するパフォーマンスデータに焦点を当てるようにUIを調整します。

### 統合と自動化
- **IDEプラグイン**: Eclipse、IntelliJ IDEA、NetBeansとのシームレスな統合により、ワンクリックでのプロファイリングを実現します。
- **コマンドラインツール**: プロファイリングタスクを自動化し、CI/CDパイプライン（Jenkins、TeamCityなど）と統合します。
- **APIサポート**: 拡張可能なAPIを使用して、プロファイリングモードを管理し、スナップショットをプログラムでキャプチャします。

### リモートプロファイリング
- **SSHトンネリング**: 最小限のセットアップでリモートアプリケーションを安全にプロファイリングします。
- **クラウドおよびコンテナサポート**: Dockerなどのクラウド、コンテナ、クラスタ環境でアプリケーションをプロファイリングします。

## システム要件とインストール
### システム要件
- **サポートプラットフォーム**: Windows、macOS、Linux、Solaris、FreeBSD（arm32、arm64、ppc64le、x64、x86）。
- **Javaバージョン**: Java 8からJava 24をサポート。
- **JDK要件**: プロファイラを実行するにはJDK 1.5以上が必要。
- **ハードウェア**: 最小2GB RAM（大規模アプリケーションには4GB以上を推奨）。

### インストール
1. **ダウンロード**: 公式ウェブサイト（https://www.yourkit.com/java/profiler/download/）からYourKit Java Profilerの最新バージョンを入手します。15日間の無料トライアルが利用可能です。
2. **インストール**:
   - **Windows**: インストーラーを実行し、プロンプトに従います。
   - **Linux/Solaris**: インストールディレクトリ（`<YourKit Home>/bin/yjp.sh`）から`yjp.sh`スクリプトを実行します。
   - **macOS**: ダウンロードしたアプリケーションを解凍し、アイコンをクリックします。
3. **インストールの確認**: `java -agentpath:<完全なエージェントライブラリパス> -version`を実行して、プロファイラエージェントが正しくロードされるか確認します。

## YourKit Java Profilerのセットアップ
### プロファイリングの有効化
Javaアプリケーションをプロファイリングするには、YourKitプロファイラエージェントをJVMにアタッチする必要があります。これは手動で、またはIDE統合を介して行うことができます。

#### 手動セットアップ
1. **エージェントライブラリの場所を特定**:
   - エージェントライブラリは`<YourKit Home>/bin/<platform>/libyjpagent.so`（Linux）または`libyjpagent.dll`（Windows）にあります。
2. **JVMの設定**:
   - エージェントをJVM起動コマンドに追加します：
     ```bash
     java -agentpath:<完全なエージェントライブラリパス> YourMainClass
     ```
   - Linuxの例：
     ```bash
     java -agentpath:/home/user/yjp-2025.3/bin/linux-x86-64/libyjpagent.so YourMainClass
     ```
   - オプションパラメータ：
     - `onexit=memory,dir=<パス>`: 終了時にメモリスナップショットをキャプチャします。
     - `usedmem=70`: メモリ使用率が70%に達したときにスナップショットをトリガーします。
3. **エージェントロードの確認**:
   - コンソール出力に`[YourKit Java Profiler 2025.3] Profiler agent is listening on port 10001`のようなメッセージがあるか確認します。

#### IDE統合
1. 各IDEのプラグインマーケットプレイスを介して、使用するIDE（Eclipse、IntelliJ IDEA、NetBeans）用のYourKitプラグインをインストールします。
2. プラグインがYourKitインストールディレクトリを指すように設定します。
3. IDEのプロファイリングオプションを使用して、YourKitがアタッチされた状態でアプリケーションを起動します。

#### リモートプロファイリング
1. **SSHアクセスを確保**: リモートサーバーへのSSHアクセスが必要です。
2. **エージェントのコピー**:
   - 適切なエージェントライブラリをリモートサーバーにコピーします。
   - Dockerの例：
     ```bash
     docker cp libyjpagent.so <コンテナID>:/path/to/agent
     ```
3. **アプリケーションの起動**:
   - リモートサーバー上のJVM起動コマンドにエージェントを追加します。
4. **プロファイラUIの接続**:
   - YourKit Profiler UIを開き、「Profile remote Java server or application」を選択します。
   - リモートホストとポート（デフォルト：10001）を入力するか、SSHトンネリングを使用します。
   - 接続をテストし、アプリケーションに接続します。

## YourKit Java Profilerの使用
### プロファイリングセッションの開始
1. **プロファイラUIの起動**:
   - Windows: スタートメニューから起動します。
   - Linux/Solaris: `<YourKit Home>/bin/yjp.sh`を実行します。
   - macOS: YourKit Java Profilerアイコンをクリックします。
2. **アプリケーションへの接続**:
   - ローカルアプリケーションは「Monitor Applications」リストに表示されます。
   - リモートアプリケーションの場合は、上記のように接続を設定します。
3. **プロファイリングモードの選択**:
   - ツールバーからCPU、メモリ、または例外プロファイリングを選択します。
   - 低オーバーヘッドのCPUプロファイリングにはサンプリングを、詳細分析にはトレーシングを使用します。

### CPUパフォーマンスの分析
1. **CPUプロファイリングの開始**:
   - ツールバーから目的のプロファイリングモード（サンプリングまたはトレーシング）を選択します。
   - 結果はコールツリー、フレームグラフ、メソッドリストなどのビューに表示されます。
2. **結果の解釈**:
   - **コールツリー**: メソッド呼び出しチェーンと実行時間を表示します。
   - **フレームグラフ**: CPU集約的なメソッドを視覚的に強調表示します。
   - **ホットスポット**: 最も多くのCPU時間を消費するメソッドをリストします。
3. **トリガーの使用**: 高いCPU使用率や特定のメソッド呼び出しに基づいて自動的にプロファイリングを開始します。

### メモリ使用量の分析
1. **メモリプロファイリングの開始**:
   - メモリプロファイリングを有効にして、オブジェクト割り当てとガベージコレクションを追跡します。
2. **オブジェクトヒープの検査**:
   - オブジェクトグラフを走査して保持されているオブジェクトを特定します。
   - 保持パスを使用してメモリリークを見つけます。
3. **スナップショットの比較**:
   - 異なる時点でスナップショットをキャプチャし、比較してメモリ増加を特定します。

### スレッドとデッドロック分析
1. **スレッドの監視**:
   - スレッド状態を表示し、ブロックまたはフローズンしたスレッドを特定します。
   - 自動デッドロック検出のために「Deadlocks」タブを確認します。
2. **モニターの分析**:
   - モニタータブを使用して、待機およびブロッキングイベントを検査します。
   - モニターフレームグラフで競合を可視化します。

### 例外とデータベースプロファイリング
1. **例外プロファイリング**:
   - 例外プロファイリングを有効にして、スローされた例外を追跡します。
   - 例外ツリーまたはフレームグラフを使用して例外パターンを分析します。
2. **データベースプロファイリング**:
   - SQL/NoSQLクエリを監視して、遅いまたは非効率なクエリを特定します。
   - スレッド状態と組み合わせて、データベース呼び出しとアプリケーションパフォーマンスを関連付けます。

### スナップショットのキャプチャと分析
1. **スナップショットのキャプチャ**:
   - UIまたはコマンドラインツールを使用します：
     ```bash
     java -jar <YourKit Home>/lib/yjp-controller-api-redist.jar localhost 10001 capture-performance-snapshot
     ```
   - スナップショットはデフォルトで`<ユーザーホーム>/Snapshots`に保存されます。
2. **スナップショットの分析**:
   - オフライン分析のためにYourKit UIでスナップショットを開きます。
   - HTML、CSV、XMLなどの形式でレポートをエクスポートして共有します。

## 効果的なプロファイリングのためのベストプラクティス
1. **オーバーヘッドの最小化**:
   - 本番環境でのCPUプロファイリングにはサンプリングを使用してオーバーヘッドを削減します。
   - 高負荷時のJ2EEプロファイリングなどの不要な機能の有効化を避けます。
2. **十分な期間のプロファイリング**:
   - 断続的な問題を特定するのに十分な長さでデータをキャプチャしますが、過剰なデータ収集は避けます。
3. **主要メトリクスへの焦点**:
   - CPU集約的なメソッド、メモリリーク、スレッド競合を優先します。
4. **比較のためのスナップショットの使用**:
   - パフォーマンスの変化を追跡するために、定期的にスナップショットをキャプチャして比較します。
5. **自動化の活用**:
   - コマンドラインツールを使用してCI/CDパイプラインと統合し、継続的なパフォーマンス監視を実現します。
6. **最初にステージング環境でテスト**:
   - 本番環境で使用する前にステージング環境でプロファイリングを練習し、その影響を理解します。

## ユースケース
- **パフォーマンス最適化**: CPU集約的なメソッドや遅いデータベースクエリを特定・最適化します。
- **メモリリーク検出**: 不必要にメモリに保持されているオブジェクトを見つけ、ガベージコレクションを最適化します。
- **スレッド同期**: マルチスレッドアプリケーションのデッドロックと競合問題を解決します。
- **本番環境監視**: 低オーバーヘッドのプロファイリングを使用して、本番環境でアプリケーションを監視し、大幅なパフォーマンス影響なしに運用します。
- **CI/CD統合**: ビルドパイプラインでパフォーマンステストを自動化し、早期に回帰を検出します。

## 開発ツールとの統合
- **IDEプラグイン**: YourKitはEclipse、IntelliJ IDEA、NetBeansと統合され、ワンクリックでのプロファイリングとプロファイリング結果からソースコードへのナビゲーションを可能にします。
- **CI/CDツール**: 自動化されたプロファイリングのためにJenkins、Bamboo、TeamCity、Gradle、Maven、Ant、JUnitをサポートします。
- **Docker**: Dockerコンテナ内のアプリケーションをプロファイリングするための最適化されたエージェントバイナリを使用します。
- **クラウド環境**: SSHまたはAWS CLI統合を使用して、AWS、Azure、その他のクラウドプラットフォームでアプリケーションをプロファイリングします。

## ライセンスとサポート
- **ライセンスオプション**:
  - 個人またはチーム使用のための商用ライセンス。
  - 15日間の無料トライアルが利用可能。
  - 非商用のオープンソースプロジェクト向けの無料ライセンス。
  - 教育および科学機関向けの割引ライセンス。
- **サポート**:
  - 包括的なオンラインドキュメント：`<YourKit Home>/docs/help/index.html`。
  - フォーラムとメールによるコミュニティサポート。
  - オープンソースプロジェクト向けの無料サポート。

## 一般的な問題のトラブルシューティング
1. **エージェントのロード失敗**:
   - エージェントパスと互換性（例：64ビットJVM用の64ビットエージェント）を確認します。
   - コンソールのエラーメッセージを確認し、トラブルシューティングガイドを参照します。
2. **高いプロファイリングオーバーヘッド**:
   - CPUプロファイリングにはサンプリングモードに切り替えます。
   - J2EEプロファイリングなどの不要な機能を無効にします。
3. **リモートプロファイリングの接続問題**:
   - SSHアクセスと正しいポート設定（デフォルト：10001）を確認します。
   - プロファイラ通信を許可するようにファイアウォール設定を確認します。
4. **スナップショット分析の問題**:
   - スナップショット用の十分なディスク容量を確保します。
   - サードパーティツールの代わりにYourKit UIを使用してスナップショットを開きます。

## 結論
YourKit Java Profilerは、Javaアプリケーションパフォーマンスを診断・最適化するための多用途で強力なツールです。その包括的な機能セット、低オーバーヘッド設計、さまざまな環境へのサポートにより、開発者とパフォーマンスエンジニアの両方に適しています。このガイドのセットアップと使用ガイドラインに従うことで、YourKitを効果的に活用してパフォーマンスボトルネック、メモリリーク、スレッド問題を特定・解決し、最終的にJavaアプリケーションの応答性とスケーラビリティを向上させることができます。

より詳細な情報については、公式YourKitドキュメント（https://www.yourkit.com/docs/java/）を参照するか、15日間の無料トライアルを探索して実践的な経験を積んでください。

---
**ソース**:
- YourKit公式ウェブサイト: https://www.yourkit.com[](https://www.yourkit.com/java/profiler/)[](https://www.yourkit.com/java/profiler/features/)[](https://www.yourkit.com/)
- DevOpsSchool: https://www.devopsschool.com[](https://www.devopsschool.com/blog/what-is-yourkit-java-profiler-and-use-cases-of-yourkit-java-profiler/)
- Baeldung: https://www.baeldung.com[](https://www.baeldung.com/java-profilers)
- Jahia: https://www.jahia.com[](https://www.jahia.com/blog/analyzing-system-performance-with-yourkit-java-profiler)[](https://www.jahia.com/fr/blog/analyzingsystemperformancewit)
- YourKitドキュメント: https://www.yourkit.com/docs/java/[](https://www.yourkit.com/docs/java-profiler/latest/help/enabling-profiling-manually.jsp)[](https://www.yourkit.com/docs/java-profiler/latest/help/cpu_profiling.jsp)[](https://www.yourkit.com/docs/java-profiler/latest/help/connect-to-profiled-application.jsp)
- MuleSoftドキュメント: https://docs.mulesoft.com[](https://docs.mulesoft.com/mule-runtime/latest/profiling-mule)