---
audio: false
generated: true
lang: ja
layout: post
title: Gitスタッシュ
translated: true
type: note
---

未コミットの変更がある状態で `git stash` を効果的に使用し、ブランチやタグを頻繁に切り替える方法を以下に示します：

## `git stash` の使用方法

`git stash` は、未コミットの変更（ステージ済みと未ステージの両方）を一時的に保存し、ワーキングディレクトリを最後のコミットの状態に戻すことができる強力なコマンドです。これは、現在の未完了の作業をコミットせずにブランチを切り替えたり、他の作業に取り組む必要がある場合に便利です。

以下に、一般的な `git stash` 操作の詳細を示します：

**1. 現在の変更をスタッシュする：**

```bash
git stash
```

このコマンドは、未コミットの変更を取得し、新しいスタッシュとして保存し、ワーキングディレクトリをクリーンな状態にします。次のようなメッセージが表示されます：

```
Saved working directory and index state WIP on <your_branch>: <commit_hash> <commit_message>
```

**2. メッセージ付きでスタッシュする：**

特に複数のスタッシュがある場合、説明的なメッセージを追加すると便利です：

```bash
git stash save "あなたの説明的なメッセージ"
# または
git stash push -m "あなたの説明的なメッセージ"
```

**3. スタッシュの一覧を表示する：**

保存されたすべてのスタッシュのリストを表示するには、次を使用します：

```bash
git stash list
```

これにより、通常は次の形式でスタッシュのリストが表示されます：

```
stash@{0}: On <branch_name>: <commit_hash> <stash_message>
stash@{1}: WIP on <another_branch>: ...
```

`stash@{0}` が最新のスタッシュです。

**4. スタッシュを適用する：**

スタッシュからの変更を戻すには、`git stash apply` を使用します。これは変更を適用しますが、スタッシュをリストに保持します。デフォルトでは、最新のスタッシュ (`stash@{0}`) を適用します。

```bash
git stash apply
# または特定のスタッシュを適用する場合：
git stash apply stash@{1}
```

**5. スタッシュを適用して削除する：**

変更を適用し、すぐにスタッシュをリストから削除したい場合は、`git stash pop` を使用します。これもデフォルトで最新のスタッシュを対象とします。

```bash
git stash pop
# または特定のスタッシュをポップする場合：
git stash pop stash@{1}
```

**6. スタッシュの詳細を表示する：**

スタッシュ内の変更の概要を表示するには、次を使用します：

```bash
git stash show
# または特定のスタッシュの場合：
git stash show stash@{2}
```

スタッシュの完全な diff を表示するには、`-p` または `--patch` フラグを追加します：

```bash
git stash show -p stash@{0}
```

**7. 未追跡ファイルをスタッシュする：**

デフォルトでは、`git stash` は追跡済みファイルへの変更のみをスタッシュします。未追跡ファイルを含めるには、`-u` または `--include-untracked` オプションを使用します：

```bash
git stash -u
git stash save -u "未追跡ファイルを含むスタッシュ"
```

**8. 無視ファイルもスタッシュする：**

未追跡ファイルと無視ファイルの両方を含めるには、`-a` または `--all` オプションを使用します：

```bash
git stash -a
git stash save -a "すべてのファイルを含むスタッシュ"
```

**9. スタッシュからブランチを作成する：**

いくつかの変更をスタッシュし、新しいブランチで作業したい場合は、スタッシュから直接ブランチを作成できます：

```bash
git stash branch <new_branch_name> stash@{0}
# または最新のスタッシュの場合：
git stash branch <new_branch_name>
```

このコマンドは、スタッシュが作成されたコミットをベースに新しいブランチを作成し、スタッシュされた変更を新しいブランチに適用し、その後スタッシュを削除します。

**10. スタッシュの削除：**

* 特定のスタッシュを削除する：
    ```bash
    git stash drop stash@{1}
    ```
* すべてのスタッシュを削除する：
    ```bash
    git stash clear
    ```

## 未コミットの変更がある状態でのブランチやタグの頻繁な切り替え

未コミットの変更がある状態でブランチやタグを頻繁に切り替えるために `git stash` を使用する方法を以下に示します：

**シナリオ1: 別のブランチへの切り替え**

1.  **現在の変更をスタッシュする：**
    ```bash
    git stash save "現在のブランチでの作業中"
    ```
2.  **ターゲットブランチに切り替える：**
    ```bash
    git checkout <target_branch_name>
    # または新しい `git switch` コマンドを使用：
    git switch <target_branch_name>
    ```
3.  **ターゲットブランチで作業を行う。**
4.  **元のブランチに戻る必要がある場合：**
    ```bash
    git checkout <original_branch_name>
    # または
    git switch <original_branch_name>
    ```
5.  **スタッシュされた変更を再適用する：**
    ```bash
    git stash pop  # スタッシュを適用して削除したい場合
    # または
    git stash apply # スタッシュを適用して保持したい場合
    ```
6.  **元のブランチがスタッシュ作成後から大きく分岐している場合に発生する可能性のあるマージコンフリクトを解決する。**

**シナリオ2: タグへの切り替え**

タグに直接切り替えると、「detached HEAD」状態になります。これは、一般的にコミットを作成するためには推奨されません。特定のタグのコードを検査したいだけの場合：

1.  **現在の変更をスタッシュする：**
    ```bash
    git stash save "タグ検査前の作業中"
    ```
2.  **タグに切り替える：**
    ```bash
    git checkout <tag_name>
    ```
3.  **コードを検査する。**
4.  **ブランチに戻るには：**
    ```bash
    git checkout <your_branch_name>
    # または
    git switch <your_branch_name>
    ```
5.  **スタッシュされた変更を再適用する：**
    ```bash
    git stash pop
    # または
    git stash apply
    ```

**シナリオ3: スタッシュされた変更を使用してタグから新しいブランチを作成する**

特定のタグに基づいて新機能や修正の作業を開始したい場合、かつ以前のコンテキストからのスタッシュされた変更がある場合：

1.  **現在の変更をスタッシュする（まだ行っていない場合）：**
    ```bash
    git stash save "作業中"
    ```
2.  **タグから新しいブランチを作成する：**
    ```bash
    git checkout -b <new_branch_name> <tag_name>
    # または
    git switch -c <new_branch_name> <tag_name>
    ```
3.  **スタッシュされた変更を新しいブランチに適用する：**
    ```bash
    git stash pop # または git stash apply
    ```
4.  **発生する可能性のあるマージコンフリクトを解決する。**

**重要な考慮事項：**

*   **スタッシュを整理する：** スタッシュを簡単に識別できるように、説明的なメッセージを使用します。
*   **スタッシュはローカルである：** スタッシュはリポジトリ内にローカルに保存され、リモートリポジトリにはプッシュされません。
*   **コンフリクトの可能性：** スタッシュを再適用するとき、スタッシュを作成してから適用先のブランチが大きく変更されている場合、マージコンフリクトが発生する可能性があります。これらのコンフリクトは手動で解決する必要があります。
*   **一時的なブランチの作成を検討する：** コミットする準備ができていない長期的な作業の場合、スタッシュに大きく依存するよりも、一時的なブランチを作成する方が良いアプローチかもしれません。ブランチ間を簡単に切り替え、進捗状況をコミットできます。

`git stash` を効果的に使用することで、未コミットの変更がある状態でもブランチやタグをシームレスに切り替えることができ、より柔軟で効率的なワークフローが可能になります。スタッシュを管理し、潜在的なマージコンフリクトに対処できるように準備することを忘れないでください。