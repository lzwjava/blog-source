---
audio: false
generated: true
lang: ja
layout: post
title: ブートローダーの書き込み
translated: true
type: note
---

Arduino Uno R3にブートローダーを書き込むのは、マイクロコントローラ（ATmega328P）が空白の場合、破損している場合、または交換が必要な場合に必要です。このプロセスでは、Arduino IDEと通信しスケッチを実行するために必要なファームウェアをチップにプログラムします。以下は一般的な方法を使用してブートローダーを書き込むステップバイステップガイドです。

---

### **必要なもの**
- **Arduino Uno R3**（プログラム対象のATmega328Pを搭載したターゲットボード）
- **プログラマ**: 以下のいずれか:
  - 別の動作するArduinoボード（例: 別のUno R3）を「Arduino as ISP」として使用
  - **USBasp**、**AVRISP mkII**、**Atmel-ICE**などの専用プログラマ
- **Arduino IDE**（[arduino.cc](https://www.arduino.cc/en/software)からダウンロード）
- **ジャンパワイヤ**（Arduino as ISPを使用する場合）
- **USBケーブル**（プログラマまたはArduinoをコンピュータに接続するため）

---

### **方法 1: 別のArduinoを使用する方法 (Arduino as ISP)**

この方法では、2つ目のArduinoボード（例: 別のUno R3）をインシステムプログラマ（ISP）として使用して、ターゲットボードにブートローダーを書き込みます。

#### **手順**
1. **プログラマ用Arduinoの準備**:
   - 2つ目のArduino（プログラマ）をUSB経由でコンピュータに接続します。
   - Arduino IDEを開き、**ファイル > スケッチ例 > 11.ArduinoISP > ArduinoISP** に移動し、このスケッチをプログラマ用Arduinoに書き込みます。これによりISPとして動作します。

2. **ボードの接続**:
   - プログラマ用Arduinoを、ブートローダーが必要なターゲットのArduino Uno R3に以下のように配線します:
     - **プログラマ用Arduino** → **ターゲット Arduino Uno R3**:
       - 5V → 5V
       - GND → GND
       - ピン 10 → リセット
       - ピン 11 → ピン 11 (MOSI)
       - ピン 12 → ピン 12 (MISO)
       - ピン 13 → ピン 13 (SCK)
   - または、ターゲットのUno R3に**ICSPヘッダ**がある場合は、対応するICSPピン（MOSI, MISO, SCK, VCC, GND, リセット）をジャンパワイヤで直接接続します。

3. **Arduino IDEの設定**:
   - Arduino IDEで、**ツール > ボード** に移動し、**Arduino Uno**（ターゲットのUno R3用）を選択します。
   - **ツール > プログラマ** に移動し、**Arduino as ISP**を選択します。
   - **ツール > ポート** で、プログラマ用Arduinoの正しいポートが選択されていることを確認します。

4. **ブートローダーの書き込み**:
   - **ツール > ブートローダを書き込む** に移動します。
   - IDEがプログラマ用Arduinoを使用して、ターゲットUno R3のATmega328Pにブートローダーを書き込みます。これには約1分かかることがあります。
   - 成功すると、「ブートローダの書込みが完了しました」というメッセージが表示されます。エラーが発生した場合は、接続を再確認し、プログラマ用ArduinoがArduinoISPスケッチを実行していることを確認してください。

5. **ターゲットボードのテスト**:
   - プログラマ用Arduinoとワイヤを外します。
   - ターゲットのUno R3をUSB経由でコンピュータに接続します。
   - 簡単なスケッチ（例: **ファイル > スケッチ例 > 01.Basics > Blink**）を書き込んで、ブートローダーが動作することを確認します。

---

### **方法 2: 専用ISPプログラマを使用する方法 (例: USBasp)**

USBaspなどの専用プログラマをお持ちの場合は、プロセスがより簡単で、多くの場合より信頼性が高くなります。

#### **手順**
1. **プログラマの接続**:
   - USBasp（または同様のプログラマ）をUSB経由でコンピュータに接続します。
   - 6ピンのICSPケーブルを使用して、プログラマをターゲットArduino Uno R3の**ICSPヘッダ**に接続します。正しい向き（ICSPヘッダのピン1は点または切り欠きでマークされています）を確認してください。

2. **Arduino IDEの設定**:
   - Arduino IDEを開きます。
   - **ツール > ボード** に移動し、**Arduino Uno**を選択します。
   - **ツール > プログラマ** に移動し、使用するプログラマ（例: **USBasp** または **AVRISP mkII**）を選択します。
   - **ツール > ポート** で正しいポートを選択します（該当する場合。一部のプログラマはポート選択を必要としません）。

3. **ブートローダーの書き込み**:
   - **ツール > ブートローダを書き込む** に移動します。
   - IDEがプログラマを使用してブートローダーを書き込みます。これには約10〜30秒かかります。
   - 「ブートローダの書込みが完了しました」というメッセージは成功を示します。失敗した場合は、接続を確認し、プログラマがコンピュータに認識されていることを確認してください。

4. **ボードのテスト**:
   - プログラマを外します。
   - Uno R3をUSB経由でコンピュータに接続し、テスト用スケッチ（例: Blink）を書き込んで機能を確認します。

---

### **トラブルシューティングのヒント**
- **エラーメッセージ**: 「avrdude: stk500_getsync()」や「not in sync」などのエラーが表示される場合は、以下を確認してください:
  - すべての接続（ワイヤまたはICSPケーブル）
  - プログラマ用ArduinoがArduinoISPスケッチを実行していること（方法1）
  - IDEで正しいプログラマが選択されていること
- **ドライバの問題**: USBaspなどのプログラマの場合、ドライバがインストールされていることを確認してください（例: WindowsでのUSBasp用Zadig）
- **空白のマイクロコントローラ**: ATmega328Pが新品または空白の場合、Uno R3ボード上にまだ存在しない場合は、ピン9と10（XTAL1/XTAL2）に外部16MHz水晶振動子と2つの22pFコンデンサを接続する必要があるかもしれません
- **電源供給**: プログラミング中はターゲットボードに電源が供給されている（USBまたはVIN経由）ことを確認してください

---

### **補足事項**
- **ブートローダーを書き込む理由**: ブートローダーにより、Arduino Uno R3はスケッチをアップロードするためにUSB経由でArduino IDEと通信できます。これがないと、ボードはUSBアップロードに応答しません
- **ブートローダーの種類**: Uno R3は**Optibootブートローダー**を使用しており、これはコンパクトで、古いブートローダーと比較して高速なアップロードをサポートします
- **マイクロコントローラの交換**: ATmega328Pを交換する場合は、Uno R3のソケット用にATmega328P-PU（DIPパッケージ）であることを確認してください。SMDバージョンには高度なはんだ付け技術が必要です
- **代替ツール**: ブートローダーの書き込みには**AVRDUDE**や**PlatformIO**を使用することもできますが、Arduino IDEは初心者にとって最も簡単です

特定の手順について不明点や、特定のプログラマに関するヘルプが必要な場合は、お知らせください！