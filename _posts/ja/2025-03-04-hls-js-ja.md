---
audio: false
generated: true
lang: ja
layout: post
title: JavaScriptでHLSを再生するライブラリ
translated: true
---

`hls.js` ライブラリ、特にバージョン `^0.7.6` についてお尋ねのようです。これは、ブラウザで HLS (HTTP Live Streaming) ビデオストリームを再生するための JavaScript ライブラリです。一般的なライブラリの知識に基づいて、設定方法と使用方法の簡潔なガイドを提供します。バージョン `0.7.6` はかなり古い（2017年にリリース）ため、最新バージョンと比べていくつかの機能や API が異なる可能性があります。そのバージョンに特化した情報が必要であれば、お知らせください。さらに詳細な回答を提供いたします！

### `hls.js` (v0.7.6) の使用方法

#### 1. **ライブラリのインストールまたはインクルード**
プロジェクトに `hls.js` を含める方法は以下の通りです：

- **npm を使用する場合**（ビルドツールのような Webpack を使用している場合）：
  ```bash
  npm install hls.js@^0.7.6
  ```
  そして、JavaScript でインポートします：
  ```javascript
  var Hls = require('hls.js');
  ```

- **CDN を使用する場合**（直接 HTML ファイルに追加する場合）：
  ```html
  <script src="https://cdn.jsdelivr.net/npm/hls.js@0.7.6"></script>
  ```
  これにより、`Hls` がグローバル変数として利用可能になります。

#### 2. **HTML の設定**
HLS ストリームをアタッチするために、HTML に `<video>` 要素が必要です：
```html
<video id="video" controls></video>
```

#### 3. **`hls.js` の初期化**
HLS ストリーム（例：`.m3u8` ファイル）を読み込んで再生するための `hls.js` の基本的な使用例です：

```javascript
// ブラウザが HLS をネイティブでサポートしているかどうかを確認します（例：Safari）
// サポートしていない場合は、hls.js を使用します
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8'; // HLS URL に置き換えてください

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // ネイティブ HLS サポートがあるブラウザ（例：Safari）の場合
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', function () {
        video.play();
    });
}
```

#### 4. **主要な概念**
- **`Hls.isSupported()`**: ブラウザが `hls.js` を必要とするかどうかを確認します（Media Source Extensions がサポートされている場合は `true` を返します）。
- **`loadSource(url)`**: HLS マニフェスト（`.m3u8` ファイル）を読み込みます。
- **`attachMedia(video)`**: ビデオ要素を `hls.js` インスタンスにアタッチします。
- **`Hls.Events.MANIFEST_PARSED`**: マニフェストが読み込まれたときに発火するイベントで、ストリームが再生準備ができたことを示します。

#### 5. **エラーハンドリング付きの例**
より堅牢にするために：
```javascript
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8';

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
    hls.on(Hls.Events.ERROR, function (event, data) {
        console.error('HLS Error:', data);
        if (data.fatal) {
            switch (data.type) {
                case Hls.ErrorTypes.NETWORK_ERROR:
                    console.log('Network error, retrying...');
                    hls.startLoad();
                    break;
                case Hls.ErrorTypes.MEDIA_ERROR:
                    console.log('Media error, recovering...');
                    hls.recoverMediaError();
                    break;
                default:
                    hls.destroy();
                    break;
            }
        }
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
}
```

#### バージョン `^0.7.6` の注意点
- このバージョンは 2017 年のものであり、後続のバージョンで追加された機能（例：適応的ビットレート切り替えの改善や低遅延 HLS サポート）が欠けている可能性があります。
- コア API（`loadSource`、`attachMedia`、`MANIFEST_PARSED` などのイベント）は上記のように動作するはずです。
- 正確な詳細が必要な場合は、[公式 `hls.js` GitHub リリース](https://github.com/video-dev/hls.js/releases/tag/v0.7.6) の変更履歴を参照してください。

#### 6. **テスト**
- テストには、公開されている HLS ストリームを使用してください。例：
  ```
  https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8
  ```
- ブラウザの開発者ツール（F12）を開いて問題をデバッグします。

特定の使用例や問題（例：フレームワークとの統合、字幕の処理など）があれば、お知らせください。さらに詳細な回答を提供いたします！