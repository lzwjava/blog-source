---
audio: false
generated: true
lang: ja
layout: post
title: HLS再生用JavaScriptライブラリ
translated: true
type: note
---

`hls.js`ライブラリ、特にバージョン`^0.7.6`（ブラウザでHLS（HTTP Live Streaming）ビデオストリームを再生するためのJavaScriptライブラリ）の使用方法についてお問い合わせのようです。このライブラリの一般的な知識に基づいて、セットアップと使用方法の簡潔なガイドを提供します。バージョン`0.7.6`はかなり古い（2017年頃リリース）ため、一部の機能やAPIは最新バージョンと異なる可能性があることに注意してください。その正確なバージョンに特化した詳細が必要な場合は、お知らせいただければ、さらに回答を絞り込みます！

### `hls.js` (v0.7.6) の使用方法

#### 1. **ライブラリのインストールまたは読み込み**
以下のいずれかの方法で、プロジェクトに`hls.js`を含めることができます：

- **npm経由**（Webpackなどのビルドツールを使用している場合）:
  ```bash
  npm install hls.js@^0.7.6
  ```
  その後、JavaScriptでインポートします：
  ```javascript
  var Hls = require('hls.js');
  ```

- **CDN経由**（HTMLファイルに直接追加する場合）:
  ```html
  <script src="https://cdn.jsdelivr.net/npm/hls.js@0.7.6"></script>
  ```
  これにより、`Hls`がグローバル変数として利用可能になります。

#### 2. **HTMLの設定**
HLSストリームをアタッチするための`<video>`要素がHTML内に必要です：
```html
<video id="video" controls></video>
```

#### 3. **`hls.js`の初期化**
以下は、`hls.js`を使用してHLSストリーム（例：`.m3u8`ファイル）を読み込み、再生する基本的な例です：

```javascript
// ブラウザがネイティブでHLSをサポートするかチェック（例: Safari）
// サポートしていない場合はhls.jsを使用
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8'; // あなたのHLS URLに置き換えてください

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // ネイティブHLSサポートのあるブラウザ向け（例: Safari）
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', function () {
        video.play();
    });
}
```

#### 4. **主要な概念**
- **`Hls.isSupported()`**: ブラウザが`hls.js`を必要とするかチェックします（Media Source Extensionsがサポートされていれば`true`を返します）。
- **`loadSource(url)`**: HLSマニフェスト（`.m3u8`ファイル）を読み込みます。
- **`attachMedia(video)`**: ビデオ要素を`hls.js`インスタンスにアタッチします。
- **`Hls.Events.MANIFEST_PARSED`**: マニフェストが読み込まれ、ストリームの再生準備が整ったことを示すイベントです。

#### 5. **エラーハンドリングを含む例**
より堅牢にするには：
```javascript
var video = document.getElementById('video');
var videoSrc = 'https://example.com/playlist.m3u8';

if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.play();
    });
    hls.on(Hls.Events.ERROR, function (event, data) {
        console.error('HLS Error:', data);
        if (data.fatal) {
            switch (data.type) {
                case Hls.ErrorTypes.NETWORK_ERROR:
                    console.log('ネットワークエラー、再試行中...');
                    hls.startLoad();
                    break;
                case Hls.ErrorTypes.MEDIA_ERROR:
                    console.log('メディアエラー、回復中...');
                    hls.recoverMediaError();
                    break;
                default:
                    hls.destroy();
                    break;
            }
        }
    });
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
}
```

#### バージョン `^0.7.6` に関する注意点
- このバージョンは2017年のものであるため、後続バージョンで追加された適応ビットレート切り替えの改善や低遅延HLSサポートなどの新機能が欠けています。
- コアAPI（`loadSource`, `attachMedia`, `MANIFEST_PARSED`などのイベント）は上記のように動作するはずです。
- 正確な詳細が必要な場合は、[公式`hls.js` GitHub リリース](https://github.com/video-dev/hls.js/releases/tag/v0.7.6)で正確な変更履歴を確認してください。

#### 6. **テスト**
- テストには、以下のような公開されているHLSストリームを使用します：
  ```
  https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8
  ```
- 問題が発生した場合は、ブラウザの開発者ツール（F12）を開いてデバッグしてください。

特定のユースケースや問題（フレームワークとの統合、字幕の処理など）がある場合は、お知らせいただければ、回答をさらに調整します！