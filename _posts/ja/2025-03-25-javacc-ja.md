---
audio: false
generated: true
lang: ja
layout: post
title: JavaCC文法定義とコンパイル
translated: true
type: note
---

```java
/* 基本的なJavaCC文法の例 */

// オプションとパーサークラスの宣言
options {
    STATIC = false;  // 複数のパーサーインスタンスを許可
    LOOKAHEAD = 2;   // 先読みを2トークンに設定
}

PARSER_BEGIN(SimpleParser)
public class SimpleParser {
    public static void main(String[] args) throws ParseException {
        SimpleParser parser = new SimpleParser(System.in);
        parser.Start();
    }
}
PARSER_END(SimpleParser)

// 字句仕様（トークン）
TOKEN : {
    // キーワード
    < VAR: "var" >
    < INT: "int" >
    < BOOLEAN: "boolean" >
    < STRING: "string" >

    // リテラルと識別子
    < NUMBER: (["0"-"9"])+ >
    < IDENTIFIER: ["a"-"z","A"-"Z","_"] (["a"-"z","A"-"Z","0"-"9","_"])* >

    // 演算子と句読点
    < ASSIGN: "=" >
    < SEMICOLON: ";" >
    < PLUS: "+" >
    < MINUS: "-" >
    < MULTIPLY: "*" >
    < DIVIDE: "/" >
    < LPAREN: "(" >
    < RPAREN: ")" >
}

// 空白とコメントをスキップ
SKIP : {
    " " | "\t" | "\n" | "\r"
    | <SINGLE_LINE_COMMENT: "//" (~["\n","\r"])* ("\n"|"\r"|"\r\n")>
    | <MULTI_LINE_COMMENT: "/*" (~["*"])* "*" ("*" | (~["*","/"] (~["*"])* "*"))* "/">
}

// 文法規則
void Start() : {} {
    (Statement())* <EOF>
}

void Statement() : {} {
    VariableDeclaration()
    | Expression()
    | AssignmentStatement()
}

void VariableDeclaration() : {} {
    // 構文: var [type] [identifier] (= [expression])?;
    <VAR> Type() <IDENTIFIER> 
    ( <ASSIGN> Expression() )? 
    <SEMICOLON>
}

void Type() : {} {
    <INT> | <BOOLEAN> | <STRING>
}

void Expression() : {} {
    AdditiveExpression()
}

void AdditiveExpression() : {} {
    MultiplicativeExpression() 
    (
        <PLUS> MultiplicativeExpression()
        | <MINUS> MultiplicativeExpression()
    )*
}

void MultiplicativeExpression() : {} {
    PrimaryExpression() 
    (
        <MULTIPLY> PrimaryExpression()
        | <DIVIDE> PrimaryExpression()
    )*
}

void PrimaryExpression() : {} {
    <NUMBER>
    | <IDENTIFIER>
    | <LPAREN> Expression() <RPAREN>
}

void AssignmentStatement() : {} {
    <IDENTIFIER> <ASSIGN> Expression() <SEMICOLON>
}

```

以下に、JavaCCとこの文法の使い方に関する包括的な説明を提供します：

### JavaCC概要
JavaCC（Java Compiler Compiler）は、カスタム言語やドメイン固有言語のためのパーサーとトークナイザーを作成するのに役立つパーサージェネレーターです。

### 例における主要コンポーネント：

1. **オプションブロック**
   - `STATIC = false`：複数のパーサーインスタンスの作成を許可
   - `LOOKAHEAD = 2`：曖昧さ回避のために2トークン先読みするようにパーサーを設定

2. **トークン定義**
   - キーワード、識別子、数値、演算子などのトークンを定義
   - トークンパターンに一致する正規表現を使用
   - トークンの例：
     - `< NUMBER: (["0"-"9"])+ >` は1つ以上の数字に一致
     - `< IDENTIFIER: ["a"-"z","A"-"Z","_"] (["a"-"z","A"-"Z","0"-"9","_"])* >` は変数名に一致

3. **スキップ仕様**
   - パーシング中に無視するものを定義（空白、コメント）
   - 単一行コメントと複数行コメントの処理を含む

4. **文法規則**
   - 言語の構文と構造を定義
   - 再帰下降構文解析を使用
   - `VariableDeclaration()`、`Expression()`などの規則が言語構成要素を定義

### コンパイルと使用手順

1. **パーサーの生成**
   ```bash
   javacc SimpleParser.jj
   ```
   このコマンドで以下を生成：
   - `SimpleParserConstants.java`
   - `SimpleParserTokenManager.java`
   - `ParseException.java`
   - `SimpleParser.java`

2. **生成ファイルのコンパイル**
   ```bash
   javac *.java
   ```

3. **パーサーの実行**
   ```bash
   java SimpleParser
   ```

### 入力例
```
var int x = 10;
var int y = 20;
x = x + y;
```

### 実証されている機能
- オプションの初期化付き変数宣言
- 基本的な算術式
- 型システム（int、boolean、string）
- 代入文
- 算術演算（+、-、*、/）

### この例の制限
- 基本的なエラー処理
- 限定的な型チェック
- 簡略化された文法

### 高度な使用法のヒント
- より複雑なパーシングにはセマンティックアクション（`{}`内のJavaコード）を使用
- カスタムエラー回復を実装
- 型チェックと意味解析を追加

JavaCCまたはこの文法例の特定の側面について詳しく説明しましょうか？