---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: シャドウロケット設定ファイル解析
translated: true
type: note
---

これはShadowrocket（iOS用のルールベースプロキシアプリ）の設定ファイルのようです。SurgeやQuantumultなどの類似ツールと同様に、トラフィックのルーティング方法、DNS処理、ルール適用、リライトやMITM（中間者攻撃）インターセプトを定義するテキストベースの設定ファイルとして構成されています。ファイルには「2025-10-02 20:25:43」という日付が記載されており、これはタイムスタンプまたはプレースホルダーの可能性があります。

セクションごとに説明し、各部分の機能と、このように設定されている理由を解説します。この設定は、インターネット制限のある地域（例：中国）のユーザー向けに最適化されているように見えます。特定のグローバル/ブロックされたサービスはプロキシサーバー経由でルーティングし、ローカル/国内トラフィックは速度向上と不必要なリダイレクトを避けるために直接接続します。これは完全なセットアップではありません。アプリ内でプロキシサーバー（Shadowsocks、V2Rayなど）を別途設定する必要があり、この設定はGitHubから自動更新される外部ルールセットを参照しています。

### 主な前提と注意点
- **プロキシ設定**: この設定は、Shadowrocketで動作するプロキシサーバー（SOCKS5、HTTP、または暗号化プロトコル）が設定されていることを前提としています。これがないと、「PROXY」ルールは機能しません。
- **目的**: 検閲（例：中国のGreat Firewall）を回避するためのものと思われます。AIサービス（OpenAI/ChatGPTなど）はプロキシ経由にし、中国のドメイン/IPはスロットリングを避けるために直接接続します。
- **TUNモード**: すべてのトラフィックをデバイス経由でルーティングするための「tun」（トンネルモード）を参照しています。
- **外部依存関係**: 一部のルールはGitHub URL（ルールリストなど）から読み込まれます。これらは自動更新される可能性があるため、信頼できるソースであることを確認してください。
- 不明点や適用に関するサポートが必要な場合は、設定の詳細をお知らせください。

### セクションの詳細

#### **[General]**
アプリのグローバルな動作、DNS解決、ネットワークルーティングを設定します。Shadowrocketの「環境設定」または「システム設定」のようなものです。

- `bypass-system = true`: iOSのシステムプロキシ設定を無視します。Shadowrocketがシステム全体の設定に依存せず、すべてのプロキシ処理を自身で行います。
  
- `skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com,*.ccb.com,*.abchina.com.cn,*.psbc.com,www.baidu.com`: **常に直接ルーティングする**（プロキシを使用しない）ドメイン/IP範囲のカンマ区切りリスト。これには以下が含まれます：
  - プライベートネットワーク（例：自宅Wi-Fi IP、192.168.x.xなど）。
  - ローカルドメイン（*.local）とlocalhost。
  - Appleのキャプティブポータルチェック。
  - 中国の銀行ドメイン（*.ccb.comは中国建設銀行、*.abchina.com.cnは中国農業銀行、*.psbc.comは郵政貯蓄銀行）。
  - Baidu（www.baidu.com）、主要な中国の検索エンジン。
  - *理由*: 国内の中国サイト（特に銀行と検索）はプロキシなしでアクセス可能であり、プロキシ経由でルーティングするとスロットリングやフラグが立てられる可能性があります。

- `tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32`: トンネル（TUN）モードでは、これらのIP範囲はプロキシトンネルから**除外**されます。これにより、ループバックIP、マルチキャスト、テスト範囲などのローカル/ルーティングトラフィックへの干渉を防ぎます。

- `dns-server = https://doh.pub/dns-query,https://dns.alidns.com/dns-query,223.5.5.5,119.29.29.29`: プロキシトラフィック用の優先DNSリゾルバのリスト。これらはDoH（DNS over HTTPS）サーバーとプレーンDNS（Tencentの119.29.29.29とAliyunの223.5.5.5）です。プライバシー/セキュリティのために、暗号化/公開されたもの（doh.pubとalidns.com）から始まります。

- `fallback-dns-server = system`: プライマリDNSが失敗した場合、iOSのシステムDNSにフォールバックします。

- `ipv6 = true`: IPv6サポートを有効にします。`prefer-ipv6 = false`: 接続にIPv4をIPv6よりも優先します（安定性や互換性のため）。

- `dns-direct-system = false`: 直接接続にシステムDNSを使用しません。代わりに設定されたDNSを使用します。

- `icmp-auto-reply = true`: ICMP（ping）リクエストに自動的に応答します。接続チェックに便利です。

- `always-reject-url-rewrite = false`: URLリライト（後述の設定で使用）のトリガーを許可します。

- `private-ip-answer = true`: プライベートIP（例：ルーター）を含むDNS応答を許可します。

- `dns-direct-fallback-proxy = true`: 直接DNSクエリが失敗した場合、プロキシ経由で再試行します。

- `tun-included-routes = `: （空）TUNモードにカスタムルートを含めません。デフォルトを使用します。

- `always-real-ip = `: （空）強制的な実IP公開はありません。標準的な動作です。

- `hijack-dns = 8.8.8.8:53,8.8.4.4:53`: Googleの公開DNS（ポート53の8.8.8.8/8.8.4.4）からのDNSトラフィックをインターセプトし、プロキシ経由でルーティングします。これにより、ブロックまたは監視されている可能性のある公開DNSの代わりに、設定されたDNSを強制的に使用します。

- `udp-policy-not-supported-behaviour = REJECT`: UDPトラフィックがポリシーでサポートされていない場合、許可する代わりに拒否します。

- `include = `: （空）追加の設定ファイルを含めません。

- `update-url = `: （空）URLからの自動設定更新はありません。

#### **[Rule]**
トラフィックルーティングルールを定義し、順番に処理されます。ドメイン、キーワード、GEOIPなどに基づいて、何をプロキシし、何を直接送信するかをShadowrocketに指示するACL（アクセス制御リスト）のようなものです。ルールに一致しない場合、`FINAL,DIRECT`にフォールバックします。

- `DOMAIN-SUFFIX,anthropic.com,PROXY`: anthropic.comのすべてのサブドメインをプロキシ経由でルーティングします（例：api.anthropic.com）。AnthropicはAI企業で、おそらくブロックを回避するためです。

- `DOMAIN-SUFFIX,chatgpt.com,PROXY`: ChatGPTドメインをプロキシ経由でルーティングします。ChatGPTは特定の地域で制限されることが多いです。

- `DOMAIN-SUFFIX,openai.com,PROXY`: OpenAIドメインをプロキシ経由でルーティングします（同様の理由）。

- `DOMAIN-SUFFIX,googleapis.com,PROXY`: GoogleのAPIサービスをプロキシ経由でルーティングします（Googleサービスに間接的にアクセスするためかもしれません）。

- `DOMAIN-SUFFIX,zhs.futbol,DIRECT`: この特定のドメイン（おそらくスペイン語/中国語のスポーツサイト）を直接ルーティングします。

- `RULE-SET,https://github.com/lzwjava/lzwjava.github.io/raw/refs/heads/main/scripts/auto-ss-config/AI.list,PROXY`: GitHubから外部ルールセット（AI関連ドメインのリスト）を読み込み、それらをプロキシします。これにより、AIプロキシルールが自動更新および拡張されます。

- `RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Lan/Lan.list,DIRECT`: ローカルネットワーク（LAN）ドメインのルールセットを読み込み、それらを直接ルーティングします。ホーム/内部トラフィックのプロキシを回避します。

- `DOMAIN-KEYWORD,cn,DIRECT`: キーワード「cn」を含むドメイン（例：anything.cn）は直接接続します。中国のサイトに便利です。

- `GEOIP,CN,DIRECT`: 中国（CN）に地理位置特定されたIPはすべて直接接続します。国内トラフィックのプロキシを防ぎ、高速で制限なしです。

- `FINAL,DIRECT`: デフォルトアクション。ルールに一致しない場合、直接ルーティングします。効率性のためにほとんどのトラフィックをプロキシなしに保ちます。

*全体的な効果*: これは「ブロックされたグローバル向けプロキシ」設定です。AI/ChatGPT/OpenAIトラフィックは地域制限を回避するためにVPN/プロキシ経由に強制され、中国/ローカルなものは直接接続を維持します。

#### **[Host]**
手動のホストマッピング（ローカルhostsファイルのようなもの）。

- `localhost = 127.0.0.1`: 「localhost」をループバックIPにマッピングします。標準的。アプリがローカルサービスに接続できることを保証します。

#### **[URL Rewrite]**
リクエストが行われる前に、受信URLをリライトします。正規表現マッチングを使用します。

- `^https?://(www.)?g.cn https://www.google.com 302`: g.cn（またはwww.g.cn）のHTTP/HTTPS URLを、302ステータス（一時リダイレクト）でgoogle.comにリダイレクトするようにリライトします。g.cnはGoogleの中国ドメインで、これをバイパスします。

- `^https?://(www.)?google.cn https://www.google.com 302`: google.cnからgoogle.comに対しても同様です。中国ではgoogle.comがブロックまたはリダイレクトされることが多いため、これはクリーンなリダイレクトを強制します。

*理由*: 検閲地域では、google.cnが変更/禁止された結果を提供する可能性があります。これにより、グローバルなGoogleサイトに直接アクセスすることが保証されます。

#### **[MITM]**
HTTPSトラフィックをインターセプトおよび変更するためのMan-in-the-middle設定（ShadowrocketにルートCA証明書が必要）。

- `hostname = *.google.cn`: google.cnの任意のサブドメインのトラフィックをインターセプトします。URLリライトと組み合わせると、これはGoogle CNドメインのトラフィックを復号/リダイレクトする可能性があります。

*理由*: これは、リライトを強制するため、またはgoogle.cnが中国で異なる証明書を使用する証明書ピニングの問題を処理するためかもしれません。

### この設定の使用方法
1. **インポート**: Shadowrocketで、これを設定ファイルとしてインポートします。
2. **プロキシサーバー**: 「サーバー」セクションで実際のプロキシ（Shadowsocksサーバーなど）を追加します。「PROXY」のようなルールはこれに依存します。
3. **有効化**: この設定に切り替え、必要に応じてトンネルモード（VPN）を有効にします。
4. **CA証明書**: MITMの場合、まだ行われていない場合はShadowrocketのCAをインストールして信頼します。
5. **テスト**: whatismyipaddress.comなどのサイトをチェックして、IP/ルーティングが期待通りに動作するか確認します。遅い中国サイトを監視します。
6. **トラブルシューティング**: ルールセットの読み込みに失敗した場合、レート制限または変更されている可能性があります。接続のためにIPv6設定を切り替える必要があるかもしれません。

### 潜在的な問題/セキュリティ注意点
- **プライバシー**: 公開されたルールセット（GitHubリンク）は、ルーティングしている内容を漏洩する可能性があります。MITMは機密トラフィックをインターセプトできます。信頼できるCAのみを使用してください。
- **更新**: ルールセットは自動読み込みされます。GitHubがブロックされている場合、それらのプロキシを使用してください。
- **将来の日付**: 設定は2025年10月とラベル付けされています。タイプミスまたは将来性確保の可能性がありますが、機能はこれに依存しません。
- **合法性**: 検閲回避のためのプロキシ使用は、場所によっては問題ありませんが、他の場所では制限されています。自己責任で使用してください。
- エラーログや達成しようとしている目標を共有していただければ、アドバイスを改善できます！