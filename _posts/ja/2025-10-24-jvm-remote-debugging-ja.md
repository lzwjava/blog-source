---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: JVMリモートデバッグのオプション解説
translated: true
type: note
---

### JVM デバッグオプション: JDWP、Suspend、Socket、ポート7777

「JVM オプション」、「suspend」、「7777 socket」、「jdwp」という用語は、Java Virtual Machine (JVM) 上で動作する Java アプリケーションのリモートデバッグを有効にする際によく関連付けられます。これらは、ネットワーク接続を介して実行中の Java プロセスにデバッガ (IntelliJ IDEA、Eclipse、jdb など) をアタッチするために使用される標準的なコマンドラインフラグの一部です。ステップバイステップで説明します。

#### 1. **JVM オプション (概要)**
   - JVM オプションは、Java アプリケーションを起動する際に `java` 実行ファイルに渡されるコマンドライン引数です。これらは、メモリ割り当て (例: `-Xmx2g`)、ガベージコレクション、またはデバッグなど、JVM の動作を設定します。
   - デバッグオプションは、「エージェント」ライブラリに分類され、コード、変数、スレッドのリモート検査などの機能を有効にするために動的にロードされます。

#### 2. **JDWP (Java Debug Wire Protocol)**
   - JDWP は、デバッガがワイヤ (ネットワークまたはローカルパイプ) を介して JVM と通信することを可能にするコアプロトコルです。これは Java におけるリモートデバッグの基盤です。
   - これを有効にするには、JVM オプション `-agentlib:jdwp=...` を使用します。これにより、起動時に JDWP エージェントが JVM にロードされます。
   - 完全な例:  
     ```
     java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:7777 -jar your-app.jar
     ```
     これは、ポート7777でデバッグを有効にしてアプリを起動します。

#### 3. **Transport=dt_socket (ソケット接続)**
   - `dt_socket` は、JDWP 通信のためのトランスポートメカニズムを指定します。リモートデバッグに TCP ソケットを使用し、デバッガがネットワーク経由 (例: ローカルホスト上の IDE やリモートサーバーから) 接続することを可能にします。
   - 代替手段には `dt_shmem` (共有メモリ、ローカルのみ) やパイプなどがありますが、リモート設定ではソケットが最も一般的です。
   - 「7777 socket」は、この接続を TCP ポート 7777 (一般的なデフォルトですが、任意の空きポートで可) にバインドすることを指します。

#### 4. **Server=y と Suspend (サスペンドフラグ)**
   - `server=y`: JVM にデバッグ*サーバー*として動作するように指示し、デバッガクライアント (あなたの IDE) からの着信接続を待ち受けます。`server=n` の場合、デバッガへのアウトバウンド接続を試みます (あまり一般的ではありません)。
   - `suspend=y` または `suspend=n`: JVM が起動時にデバッガがアタッチされるまで実行を一時停止するかどうかを制御します。
     - `suspend=y`: アプリは起動直後に停止します (開始時の問題を捕捉するのに便利)。デバッガをアタッチした後にのみ再開します。
     - `suspend=n`: アプリは正常に実行されます。中断することなく後でデバッガをアタッチできます (プロダクションに近いテストでは安全です)。
   - デフォルトは通常、ブロックを避けるために `n` です。

#### 一般的な使用例
- **これを使用する理由:** ライブアプリを停止することなくトラブルシューティングするためです。これらのフラグを付けて Java アプリを起動し、IDE で `localhost:7777` (またはサーバーの IP) を指す「Remote JVM Debug」設定を作成します。
- **セキュリティ注意:** JDWP をパブリックポート (7777 など) で公開することは脆弱性となる可能性があります—誰でもアタッチしてアプリを検査できます。プロダクション環境では、ファイアウォール、localhost のみへのバインド (`address=localhost:7777`)、または SSH トンネリングなどのツールを使用してください。

#### クイックリファレンス表

| オプションパラメータ | 説明 | 例 | 備考 |
|------------------|-------------|---------------|-------|
| `transport`     | 通信方法 | `dt_socket` | TCP/IP 用のソケット。リモートデバッグに使用。 |
| `server`        | 待機モード | `y` | JVM がポートを待ち受ける。デバッガがそれに接続する。 |
| `suspend`       | 起動時の一時停止 | `n` | `y` はデバッガのアタッチまでブロック。`n` は自由に実行。 |
| `address`       | バインドアドレス/ポート | `*:7777` | `*` は任意の IP を許可。`localhost:7777` はローカルに制限。 |

詳細については、公式の OpenJDK デバッグドキュメントを確認してください。

[Java Debugging with JDWP](https://docs.oracle.com/en/java/javase/21/docs/specs/jdwp-transport.html)  
[Enabling Remote Debugging](https://www.baeldung.com/java-debugging-with-intellij)