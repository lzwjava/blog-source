---
audio: false
generated: true
image: false
lang: ja
layout: post
title: 強制純粋コード出力手法
translated: true
type: note
---

了解しました。Claude Code（およびそれを呼び出す「ルーター」ワークフロー）に**コードのみ**を出力させ、**インラインコメントやdocstring、説明文を含めない**ようにしたいのですね。ここでは、ソフトな方法から強力な方法まで3つの確実な方法を紹介します。表は使いませんーシンプルな手順のみです。

---

# 1) `CLAUDE.md`にルールを記載する（グローバルまたはプロジェクト単位）

Claude Codeは「メモリ」ファイルを自動的に読み込み、セッションを跨いで従います。短く明確なルールを追加しましょう：

**グローバル（全プロジェクト）：** `~/.claude/CLAUDE.md`
**プロジェクト単位（チェックイン可能）：** `./CLAUDE.md`

```md
# 出力ルール
- コード生成時は、コードのみを出力すること。
- 明示的に要求しない限り、インラインコメント、ブロックコメント、docstring、説明文を含めないこと。
- メッセージは簡潔に保つこと。説明が必要な場合は、コードブロックの後にのみ記載し、かつ私が要求した場合のみとする。
```

ヒント：これらのメモリは`/memory`で管理でき、Claude Codeでメッセージを`#`で始めることで新しいメモリを素早く追加できます。（[Anthropic][1]）

---

# 2) コメントを禁止する**カスタム出力スタイル**を作成する（より強力）

出力スタイルはClaude Codeの**システムプロンプト**を変更します。作成して切り替えましょう：

**作成：**

```
/output-style:new コメントやdocstring、説明文なしで常にコードのみを出力する出力スタイルが欲しい。
```

これにより`~/.claude/output-styles/…`下にファイルが作成されます。ルールが明確であることを確認するために編集できます：

```md
---
name: コードのみ（コメントなし）
description: 常にコメント/docstringなしでコードを出力。明示的に要求されない限り説明文もなし。
---
# 指示
- あなたは「コードのみ」モードでコーディングしています。
- インラインコメント、ブロックコメント、docstringを決して含めないでください。
- 明示的に要求されない限り、コードの前後に文章を追加しないでください。

## 具体的な動作
- タスクがテストを暗示する場合は、テストファイルをコードのみで出力します。
- 明確化が必要な場合は、簡潔に質問し、説明はしないでください。
```

**有効化：**

```
/output-style "コードのみ（コメントなし）"
```

（出力スタイルはシステムプロンプトを直接変更します。`/output-style`でいつでも切り替えられます。）（[Anthropic][2]）

---

# 3) 実行時に追加のシステムプロンプトを付加する（最強／セッション単位）

CLIやスクリプトからClaude Codeを起動する場合は、以下を追加します：

```bash
claude --append-system-prompt "常にコードのみを出力すること。インラインコメント、ブロックコメント、docstring、明示的に要求されない限りの説明文は一切含めない。"
```

永続的なプロジェクト設定を希望する場合は、`/config`経由でこれを設定することもできます。（Anthropicは`--append-system-prompt`を使用してClaude Codeの動作を変更できることを記しています。）（[Anthropic][3]）

---

## 「ルーター」全体のルールをどこに置くか

* あなたの「Claude Codeルーター」が単なる通常のClaude Codeセッション（複数リポジトリに跨る）である場合、ルールがどこにでも適用されるように、**グローバルメモリ**（`~/.claude/CLAUDE.md`）または**カスタム出力スタイル**を推奨します。（[Anthropic][1]）
* スクリプト経由で起動する場合は、`--append-system-prompt`フラグを組み込み、すべての実行がルールを継承するようにします。（[Anthropic][3]）

---

## 追加のガードレール（オプションだが有用）

* プロジェクトメモリに**「違反」**行を追加し、モデルに自己チェックさせます：「コメント/docstringを出力しようとしている場合は、停止してそれらを削除すること。」
* 時々コメントを*欲しい*場合は、プロンプトにワンショットのオーバーライドを追加します：「今回のみ、簡単なコメントを含めること。」

以上です。Claude Codeの起動方法（デスクトップ、VS Code、JetBrains、またはターミナル）を教えていただければ、その設定に即したスニペットをお伝えできます。

[1]: https://docs.anthropic.com/en/docs/claude-code/memory "Manage Claude's memory - Anthropic"
[2]: https://docs.anthropic.com/en/docs/claude-code/output-styles "Output styles - Anthropic"
[3]: https://docs.anthropic.com/en/docs/claude-code/settings "Claude Code settings - Anthropic"