---
audio: false
generated: true
lang: ja
layout: post
title: ネットワーク層
translated: true
type: note
---

では、中国の自学試験（自考）システムにおけるコンピュータネットワーク技術コース向けに特化した、ネットワーク層の詳細なチュートリアルに深く入っていきましょう。この章は、データがネットワークをどのように移動するかを理解する上で極めて重要です。

## ネットワーク層チュートリアル

ネットワーク層は、OSIモデルおよびTCP/IPモデルにおける第3層です。その主な責任は、1つまたは複数のネットワークを介して、送信元ホストから宛先ホストへのデータパケットの移動を容易にすることです。これをインターネットの郵便サービスと考えてください。最適な経路を見つけ、あなたの「小包」（データパケット）が正しい住所に届くようにします。

この章で扱う主なトピックを以下に示します：

### 1. ネットワーク層の機能

ネットワーク層は、主に3つの機能を実行します：

#### a) 論理アドレッシング

*   **目的:** ネットワーク上の各ホストを一意に識別すること。これは、ローカルネットワーク内のデバイスを識別する物理アドレス（MACアドレス）とは異なります。論理アドレスは階層的であり、効率的なルーティングを可能にします。
*   **重要な概念:** IPアドレス（Internet Protocolアドレス）は、ネットワーク層で使用される論理アドレッシングの主要な形態です。
*   **例え:** 自宅の住所を考えてみてください。それは論理アドレスであり、郵便局の物理的な場所に関係なく、都市や国の中であなたの特定の家を見つけるのに役立ちます。

#### b) ルーティング

*   **目的:** データパケットが送信元から宛先へ移動するための最適な経路を決定すること。これには、パケットが通過する一連のネットワークデバイス（ルーター）の選択が含まれます。
*   **重要な概念:** ルーティングアルゴリズムは、ルーターによって使用され、異なるネットワークへの最適な経路に関する情報を含むルーティングテーブルを構築および維持します。
*   **例え:** ロードトリップを計画することを想像してください。地図を見るかGPSを使用して、距離や交通状況などの要因を考慮して目的地への最適な経路を見つけます。ルーターはデータパケットに対して同様のことを行います。

#### c) 転送

*   **目的:** ルーティング決定に基づいて、ルーターの入力ポートから適切な出力ポートへデータパケットを実際に移動させるプロセス。
*   **重要な概念:** ルーターがパケットを受信すると、宛先IPアドレスを調べ、そのルーティングテーブルを参照して、次のホップ（別のルーターまたは宛先ホスト）を決定します。
*   **例え:** 経路を計画したら、転送は実際にその経路に沿って車を運転し、ある地点から次の地点へ移動するようなものです。

### 2. IPアドレッシング

IPアドレスはネットワーク層の基本です。主なバージョンとしてIPv4とIPv6の2つがあります。

#### a) IPv4の構造

*   **形式:** 32ビットの数値アドレスで、ドット付き10進表記（例：192.168.1.10）で記述されます。4つの8ビットオクテットに分割されています。
*   **アドレスクラス（歴史的）:** 現在ではClassless Inter-Domain Routing (CIDR)によりほとんど廃止されていますが、歴史的なクラス（A, B, C, D, E）を理解することは基礎知識として役立ちます。
    *   **クラスA:** 大規模ネットワーク（最初のオクテット 1-126）。
    *   **クラスB:** 中規模ネットワーク（最初のオクテット 128-191）。
    *   **クラスC:** 小規模ネットワーク（最初のオクテット 192-223）。
    *   **クラスD:** マルチキャストアドレス（最初のオクテット 224-239）。
    *   **クラスE:** 実験用に予約（最初のオクテット 240-255）。
*   **ネットワークIDとホストID:** IPv4アドレスは、ネットワークID（ネットワークを識別）とホストID（そのネットワーク内の特定のデバイスを識別）で構成されます。これらのID間の分割は、アドレスクラス（またはCIDRにおけるサブネットマスク）に依存します。
*   **特殊なIPv4アドレス:**
    *   **0.0.0.0:** 現在のネットワークを表します。
    *   **127.0.0.1 (ループバックアドレス):** ローカルマシンのネットワークスタックをテストするために使用されます。
    *   **プライベートIPアドレス:** プライベートネットワーク内での使用のために予約された範囲（例：10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16）。これらのアドレスは公衆インターネット上でルーティング可能ではありません。
    *   **パブリックIPアドレス:** 公衆インターネット上でルーティング可能なアドレス。

#### b) IPv6の構造

*   **形式:** 128ビットの数値アドレスで、16進数形式で記述され、コロンで区切られた8つの16ビットセグメントにグループ化されます（例：2001:0db8:85a3:0000:0000:8a2e:0370:7334）。
*   **IPv4に対する利点:** 大きなアドレス空間（IPv4アドレス枯渇問題の解決）、セキュリティの向上（IPsecが統合されていることが多い）、簡素化されたヘッダ形式、モバイルデバイスへのより良いサポート。
*   **アドレス表現:**
    *   **先行ゼロ:** セグメント内の先行ゼロは省略できます（例：0000 は 0 と記述できます）。
    *   **ダブルコロン:** 単一のダブルコロン (::) は、1つ以上の連続するすべてゼロのセグメントを表すために使用できます。これはアドレス内で1回だけ使用できます。
*   **IPv6アドレスの種類:**
    *   **ユニキャスト:** 単一のインターフェースを識別します。
    *   **マルチキャスト:** インターフェースのグループを識別します。
    *   **エニーキャスト:** インターフェースのセットを識別し、パケットはセット内の最も近いインターフェースに配信されます。
*   **リンクローカルアドレス (fe80::/10):** 単一のネットワークリンク内での通信に使用されます。
*   **グローバルユニキャストアドレス:** インターネット上でグローバルにルーティング可能なアドレス。

#### c) サブネットting

*   **目的:** 大きなネットワークを、より小さく管理しやすいサブネットワーク（サブネット）に分割すること。これはネットワークの整理、セキュリティの向上、ネットワークパフォーマンスの最適化に役立ちます。
*   **メカニズム:** サブネットtingは、IPアドレスのホスト部分からビットを借用し、それらを使用してサブネットIDを作成することによって実現されます。これは **サブネットマスク** を使用して行われます。
*   **サブネットマスク:** IPアドレスのネットワーク部分とサブネット部分を識別する32ビットの数値（IPv4の場合）。ネットワークおよびサブネットビットに対して連続した1のシーケンスを持ち、その後にホストビットに対して連続した0のシーケンスが続きます。
*   **CIDR表記 (Classless Inter-Domain Routing):** スラッシュとネットワークビット数を続けて表記する、ネットワークプレフィックスを表現するより柔軟な方法（例：192.168.1.0/24 は、最初の24ビットがネットワークを表すことを示します）。これは現在使用されている標準的な方法です。
*   **サブネットting計算 (IPv4):**
    1.  必要なサブネットの数を決定します。
    2.  サブネットごとに必要なホストの数を決定します。
    3.  サブネットとホストに必要なビット数を計算します。
    4.  サブネットマスクを決定します。
    5.  各サブネットの有効なサブネットアドレス、ブロードキャストアドレス、および使用可能なホスト範囲を特定します。
*   **IPv6におけるサブネットting:** サブネットtingの概念はIPv6にも存在しますが、広大なアドレス空間により、アドレスの節約というよりもネットワークの整理に関するものになっています。IPv6サブネットは通常、固定サイズ (/64) です。

### 3. ルーティングアルゴリズム

ルーティングアルゴリズムは、ルーターがデータパケットの最適な経路を決定するために使用されます。大まかに以下のように分類できます：

#### a) スタティックルーティング vs ダイナミックルーティング

*   **スタティックルーティング:**
    *   ルーティングテーブルはネットワーク管理者によって手動で設定されます。
    *   小規模で安定したネットワークでは実装が簡単です。
    *   ネットワークの変更や障害に適応できません。
    *   単一のリモートネットワークへの接続などの特定のシナリオに適しています。
*   **ダイナミックルーティング:**
    *   ルーターは、他のルーターと情報を交換することにより、ネットワークトポロジについて自動的に学習し、ルーティングテーブルを更新します。
    *   初期設定はより複雑ですが、ネットワークの変更や障害に非常に適応しやすいです。
    *   大規模で複雑なネットワークに拡張可能です。

#### b) ディスタンスベクタールーティング

*   **原理:** 各ルーターは、各宛先ネットワークへの既知の最適な距離（例：ホップ数）と方向（次のホップルーター）をリストしたルーティングテーブルを維持します。
*   **情報交換:** ルーターは、直接接続されたネイバーと定期的にルーティングテーブル全体を交換します。
*   **アルゴリズム例:** **Bellman-Fordアルゴリズム** は、ディスタンスベクタールーティングプロトコルで使用される一般的なアルゴリズムです。
*   **プロトコル:** RIP (Routing Information Protocol) は、ディスタンスベクタールーティングプロトコルのよく知られた例です。
*   **制限事項:** 収束が遅い（ネットワークが変更に適応するのに時間がかかる）ことや、「カウント・トゥ・インフィニティ」問題（ルーティングループが発生する可能性がある）に悩まされることがあります。

#### c) リンクステートルーティング

*   **原理:** 各ルーターは、ネットワークトポロジの完全なマップを維持します。すべてのルーターとそれらの間のリンク、および各リンクのコストを知っています。
*   **情報交換:** ルーターは、直接接続されたリンクの状態に関する情報を、ネットワーク内の他のすべてのルーターと交換します。この情報はLink State Advertisement (LSA) と呼ばれます。
*   **アルゴリズム例:** **Dijkstraのアルゴリズム** (Shortest Path First - SPF) が各ルーターによって使用され、収集されたリンクステート情報に基づいて、他のすべての宛先への最短経路を計算します。
*   **プロトコル:** OSPF (Open Shortest Path First) と IS-IS (Intermediate System to Intermediate System) は、一般的なリンクステートルーティングプロトコルです。
*   **利点:** 収束が速く、ディスタンスベクタールーティングと比較してルーティングループが発生しにくい。

### 4. プロトコル

ネットワーク層では、いくつかの重要なプロトコルが動作します：

#### a) IP (Internet Protocol)

*   **中核プロトコル:** ネットワーク間でパケットのアドレッシングとルーティングを担当する基本的なプロトコル。
*   **コネクションレス型で信頼性なし:** IPはコネクションレス型サービス（事前の接続確立なし）を提供し、信頼性がありません（配信の保証なし）。エラー検出は実行されますが、エラー回復は上位層プロトコル（TCPなど）の責任です。
*   **パケット形式:** IPはIPパケット（データグラム）の構造を定義します。これには、送信元および宛先IPアドレス、ヘッダ情報（例：Time-to-Live - TTL）、およびペイロード（上位層からのデータ）が含まれます。

#### b) ICMP (Internet Control Message Protocol)

*   **目的:** ネットワークデバイス間でエラーメッセージおよび制御/情報メッセージを送信するために使用されます。
*   **機能性:** ICMPメッセージは、エラーの報告（例：宛先到達不能、時間超過）、情報の要求（例：`ping`コマンドで使用されるエコー要求/応答）、およびその他のネットワーク診断を実行するために使用されます。
*   **例:** `ping`ユーティリティは、ICMPエコー要求と応答を使用してネットワーク接続をテストします。`traceroute`（Windowsでは`tracert`）は、ICMP時間超過メッセージを使用してパケットの経路を追跡します。

#### c) ARP (Address Resolution Protocol)

*   **目的:** 同じローカルネットワークセグメント内で、論理アドレス（IPアドレス）を物理アドレス（MACアドレス）に解決するために使用されます。
*   **プロセス:** ホストが同じネットワーク上の別のホストにパケットを送信する必要がある場合、それは宛先IPアドレスを知っていますが、データリンク層でパケットをフレーム化するために宛先MACアドレスが必要です。送信ホストは、宛先IPアドレスを含むARP要求をブロードキャストします。そのIPアドレスを持つホストは、そのMACアドレスを含むARP応答で応答します。
*   **ARPキャッシュ:** ホストは、すべての通信に対してARP要求を送信することを避けるために、最近解決されたIPアドレスとMACアドレスのマッピングを格納するARPキャッシュを維持します。

### 5. ネットワークデバイス

ネットワーク層には、主に2つの主要なタイプのネットワークデバイスが関与します：

#### a) ルーター

*   **主な機能:** 宛先IPアドレスに基づいて、異なるネットワーク間でデータパケットを転送すること。
*   **主な特徴:**
    *   パケットの最適な経路を決定するためにルーティングテーブルを維持します。
    *   異なるネットワークセグメント（異なるネットワーク技術でも可能）を接続します。
    *   ルーティング決定に基づいてパケット転送を実行します。
    *   ファイアウォールやアクセス制御リスト（ACL）などのセキュリティ機能を実装できます。

#### b) ゲートウェイ

*   **より広義な用語:** ゲートウェイは、別のネットワークへのエントリポイントとして機能するデバイスです。ルーター、ファイアウォール、または別のタイプのデバイスである可能性があります。
*   **デフォルトゲートウェイ:** IPネットワーキングの文脈では、デフォルトゲートウェイは、ホストが自身のネットワーク外の宛先にトラフィックを送信するために使用するローカルネットワーク上のルーターです。
*   **プロトコル変換:** ゲートウェイは、異なるネットワークアーキテクチャやプロトコル間のプロトコル変換も実行できますが、これは単純なIPルーティングではあまり一般的ではありません。

## 自学試験のための重要なポイント

*   **中核機能を理解する:** 論理アドレッシング（IPアドレス）、ルーティング（経路選択）、転送（パケット移動）。
*   **IPアドレッシングを習得する:** IPv4およびIPv6アドレスの構造を説明でき、サブネットtingの概念と計算（特にIPv4の場合）を理解し、異なるタイプのIPアドレスを知っていること。
*   **ルーティングアルゴリズムを区別する:** スタティックルーティングとダイナミックルーティングの違いを理解し、ディスタンスベクターおよびリンクステートルーティングアルゴリズムの基本原則を説明できること。それぞれに関連する一般的なプロトコルを知っていること。
*   **主要なネットワーク層プロトコルを知る:** IP、ICMP、ARPの目的と基本的な動作を理解すること。
*   **ネットワークデバイスの役割を特定する:** ネットワーク層におけるルーターとゲートウェイの機能を明確に理解すること。

## 練習と復習

*   **例題を解く:** IPv4のサブネットting計算を練習します。
*   **比較対照する:** 異なるルーティングアルゴリズムとIPアドレスのバージョンを比較する表を作成します。
*   **実世界のシナリオに関連付ける:** これらの概念が自身のインターネット使用やネットワーク設定にどのように適用されるかを考えます。
*   **過去の試験問題を復習する:** 中国の自学試験でこのトピックに関して通常どのような種類の質問がされるかを理解します。

これらの概念を徹底的に理解することで、コンピュータネットワーキングのさらなる研究に不可欠な、ネットワーク層における強固な基盤を構築するでしょう。学習の成功を祈ります！