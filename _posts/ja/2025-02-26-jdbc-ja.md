---
audio: false
generated: true
lang: ja
layout: post
title: JDBCを使用したデータベース接続
translated: true
type: note
---

JavaでJDBC（Java Database Connectivity）ドライバを使用するには、データベースへの接続確立、クエリの実行、結果の処理を行うための一連の手順に従う必要があります。以下では、明確で実践的な方法でステップバイステップでプロセスを説明します。

### ステップ1: プロジェクトにJDBCドライバを追加する
まず、使用するデータベース（MySQL、PostgreSQL、Oracleなど）に適したJDBCドライバが必要です。各データベースベンダーが独自のドライバを提供しています。

- **Mavenプロジェクトの場合**:
  `pom.xml`に依存関係を追加します。例としてMySQLの場合：
  ```xml
  <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.33</version> <!-- 最新バージョンを確認してください -->
  </dependency>
  ```
  PostgreSQLの場合：
  ```xml
  <dependency>
      <groupId>org.postgresql</groupId>
      <artifactId>postgresql</artifactId>
      <version>42.7.3</version> <!-- 最新バージョンを確認してください -->
  </dependency>
  ```

- **Mavenを使用しないプロジェクトの場合**:
  ベンダーのWebサイト（例：mysql.comからMySQL Connector/J）からJDBCドライバのJARファイルをダウンロードし、プロジェクトのクラスパスに手動で追加します。

### ステップ2: JDBCドライバをロードする
古いバージョンのJava（JDBC 4.0以前）では、`Class.forName()`を使用してドライバを明示的にロードする必要がありました。現代のJDBCドライバ（JDBC 4.0以降）では、この手順はオプションです。ドライバはService Providerメカニズムを通じて自動登録されます。ただし、明確にするために方法を示します：

```java
try {
    Class.forName("com.mysql.cj.jdbc.Driver"); // MySQLの例
    // PostgreSQLの場合: Class.forName("org.postgresql.Driver");
} catch (ClassNotFoundException e) {
    e.printStackTrace();
}
```

### ステップ3: 接続を確立する
`DriverManager`クラスを使用して、接続URL、ユーザー名、パスワードを提供することでデータベースに接続します。URLの形式はデータベースによって異なります。

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase"; // MySQLの例
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            System.out.println("Connected to the database!");
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

- **URLの例**:
  - MySQL: `jdbc:mysql://localhost:3306/mydatabase?useSSL=false`
  - PostgreSQL: `jdbc:postgresql://localhost:5432/mydatabase`
  - Oracle: `jdbc:oracle:thin:@localhost:1521:xe`

### ステップ4: ステートメントを作成しクエリを実行する
接続したら、`Statement`、`PreparedStatement`（パラメータ化クエリで推奨）、または`CallableStatement`（ストアドプロシージャ用）を使用してSQLクエリを実行できます。

#### 簡単なクエリの例：
```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase";
        String username = "your_username";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            Statement statement = connection.createStatement();
            ResultSet resultSet = statement.executeQuery("SELECT * FROM users");

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", Name: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

#### PreparedStatementを使用した例（ユーザー入力に対してより安全）：
```java
try (Connection connection = DriverManager.getConnection(url, username, password)) {
    String sql = "SELECT * FROM users WHERE id = ?";
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.setInt(1, 5); // パラメータ値を設定
    ResultSet resultSet = preparedStatement.executeQuery();

    while (resultSet.next()) {
        System.out.println("ID: " + resultSet.getInt("id") + ", Name: " + resultSet.getString("name"));
    }
} catch (SQLException e) {
    e.printStackTrace();
}
```

### ステップ5: リソースをクローズする
リソースを解放するために、`ResultSet`、`Statement`、`Connection`オブジェクトは常にクローズしてください。上記で示したtry-with-resourcesを使用すると、これが自動的に処理されます。

### 完全な動作例（MySQL）
`id`（int）と`name`（varchar）カラムを持つ`users`テーブルを想定した完全な例です：

```java
import java.sql.*;

public class JdbcExample {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/mydatabase?useSSL=false";
        String username = "root";
        String password = "your_password";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            String sql = "SELECT * FROM users WHERE id = ?";
            PreparedStatement preparedStatement = connection.prepareStatement(sql);
            preparedStatement.setInt(1, 1);
            ResultSet resultSet = preparedStatement.executeQuery();

            while (resultSet.next()) {
                System.out.println("ID: " + resultSet.getInt("id") + ", Name: " + resultSet.getString("name"));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

### 主なヒント
- **エラーハンドリング**: データベース関連のエラーを処理するために、常に`SQLException`をキャッチしてください。
- **依存関係**: JDBCドライバがデータベースのバージョンと一致していることを確認してください。
- **セキュリティ**: SQLインジェクションを防ぐために、ユーザー入力を含むクエリには`PreparedStatement`を使用してください。
- **コネクションプーリング**: 本番アプリケーションでは、`DriverManager`の代わりにコネクションプール（例：HikariCP）の使用を検討してください。

特定のデータベースやより高度なユースケースについてヘルプが必要な場合はお知らせください！