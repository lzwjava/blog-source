---
audio: false
generated: true
lang: ja
layout: post
title: Jettyを使用してWebサーバを埋め込む
translated: true
---

`org.eclipse.jetty` を Java プロジェクトで使用するには、通常、Jetty ライブラリを利用して軽量な Web サーバーまたはサーブレットコンテナをアプリケーション内に埋め込むことを目指します。Jetty は Eclipse Foundation の下でメンテナンスされており、Web コンテンツを提供し、HTTP リクエストを処理し、サーブレットや Web アプリケーションをサポートするオープンソースプロジェクトです。以下は、Maven をビルドツールとして使用して基本的な Web サーバーを設定するための手順です。

---

### **ステップ 1: プロジェクトに Jetty の依存関係を追加**

Jetty を使用するには、プロジェクトにそのライブラリを含める必要があります。Maven を使用している場合は、`pom.xml` ファイルに必要な依存関係を追加します。基本的な Web サーバー設定とサーブレットのサポートには、`jetty-server` と `jetty-servlet` を含めます。以下は例です：

```xml
<project>
    <dependencies>
        <!-- Jetty サーバー -->
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-server</artifactId>
            <version>9.4.31.v20200723</version>
        </dependency>
        <!-- Jetty サーブレット サポート -->
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-servlet</artifactId>
            <version>9.4.31.v20200723</version>
        </dependency>
        <!-- サーブレット API（オプション、通常は `jetty-servlet` によってトランジティブに含まれます） -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>3.1.0</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>
</project>
```

- **`jetty-server`**: HTTP リクエストを処理するためのコアサーバー機能を提供します。
- **`jetty-servlet`**: サーブレットのサポートを追加し、Java サーブレット API を使用できるようにします。
- **`javax.servlet-api`**: サーブレットインターフェースを定義します。ここでは明確に含めていますが、通常は `jetty-servlet` によってトランジティブに含まれます。

**注意**: 最新の Jetty バージョンと `<version>` タグを更新するために、[Maven Central Repository](https://mvnrepository.com/artifact/org.eclipse.jetty) を確認してください。

---

### **ステップ 2: 簡単な Jetty サーバーを作成**

Jetty をプログラム的に使用するには、`org.eclipse.jetty.server` パッケージから `Server` クラスのインスタンスを作成します。以下に、基本的なハンドラを使用する方法とサーブレットを使用する方法の 2 つの一般的なアプローチを示します。

#### **オプション 1: 基本的なハンドラを使用**

この例では、すべてのリクエストに対して "Hello, World!" と応答するサーバーを設定します。

```java
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class SimpleJettyServer {
    public static void main(String[] args) throws Exception {
        // ポート 8080 でリッスンするサーバーのインスタンスを作成
        Server server = new Server(8080);

        // リクエストを処理するハンドラを設定
        server.setHandler(new AbstractHandler() {
            @Override
            public void handle(String target, Request baseRequest, HttpServletRequest request, HttpServletResponse response)
                    throws IOException {
                // レスポンスのプロパティを設定
                response.setContentType("text/plain");
                response.setStatus(HttpServletResponse.SC_OK);
                response.getWriter().println("Hello, World!");

                // このハンドラがリクエストを処理したことを示す
                baseRequest.setHandled(true);
            }
        });

        // サーバーを開始
        server.start();
        server.join(); // サーバーが停止されるまで実行を続ける
    }
}
```

- **`Server server = new Server(8080)`**: ポート 8080 で Jetty サーバーを作成します。
- **`AbstractHandler`**: リクエストの処理方法を定義する簡単なハンドラです。
- **`baseRequest.setHandled(true)`**: このハンドラがリクエストを処理したことを示し、さらに処理を防ぎます。

このコードを実行し、ブラウザで `http://localhost:8080/` にアクセスすると "Hello, World!" が表示されます。

#### **オプション 2: サーブレットを使用**

より複雑なアプリケーションでは、`ServletContextHandler` を使用してサーブレットを使用できます。

```java
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.ServletContextHandler;
import org.eclipse.jetty.servlet.ServletHolder;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class ServletJettyServer {
    public static void main(String[] args) throws Exception {
        // ポート 8080 でサーバーのインスタンスを作成
        Server server = new Server(8080);

        // サーブレットコンテキストハンドラを作成
        ServletContextHandler context = new ServletContextHandler();
        context.setContextPath("/"); // ルートコンテキストパス

        // サーバーのハンドラを設定
        server.setHandler(context);

        // リクエストを処理するサーブレットを追加
        context.addServlet(new ServletHolder(new HelloServlet()), "/*");

        // サーバーを開始
        server.start();
        server.join();
    }
}

// 簡単なサーブレットを定義
class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws IOException {
        response.setContentType("text/plain");
        response.setStatus(HttpServletResponse.SC_OK);
        response.getWriter().println("Hello from Jetty Servlet!");
    }
}
```

- **`ServletContextHandler`**: サーブレットコンテキストとマッピングを管理します。
- **`context.addServlet`**: `HelloServlet` をすべてのリクエスト (`/*`) を処理するように登録します。
- **`doGet`**: サーブレットの GET リクエストに対する動作を定義します。

このコードを実行し、`http://localhost:8080/` にアクセスすると "Hello from Jetty Servlet!" が表示されます。

---

### **ステップ 3: コンパイルと実行**

1. Maven でプロジェクトが設定されていることを確認します（例: `mvn compile` を実行して依存関係をダウンロード）。
2. Java クラスをコンパイルして実行します（例: `java SimpleJettyServer` または IDE の実行機能を使用）。
3. サーバーをテストするためにブラウザで `http://localhost:8080/` にアクセスするか、`curl` などのツールを使用します。

---

### **追加の使用例**

- **WAR ファイルのデプロイ**: `WebAppContext` を使用して Web アプリケーションアーカイブ (WAR) ファイルまたはディレクトリをデプロイします：
  ```java
  import org.eclipse.jetty.server.Server;
  import org.eclipse.jetty.webapp.WebAppContext;

  public class WarJettyServer {
      public static void main(String[] args) throws Exception {
          Server server = new Server(8080);
          WebAppContext webapp = new WebAppContext();
          webapp.setContextPath("/");
          webapp.setWar("path/to/your.war"); // WAR ファイルへのパス
          server.setHandler(webapp);
          server.start();
          server.join();
      }
  }
  ```
  この機能を使用するには、`pom.xml` に `jetty-webapp` 依存関係を追加します。

- **Jetty の設定**: ポート、スレッドプール、HTTPS などの設定をプログラム的にまたは XML 設定ファイルを使用して調整します（詳細な設定については Jetty ドキュメントを参照）。

---

### **重要なポイント**

- **インポート**: `org.eclipse.jetty.server`、`org.eclipse.jetty.servlet` などのクラスを必要に応じてインポートします。
- **柔軟性**: Jetty は静的コンテンツを提供し、サーブレットを処理し、WAR ファイルをデプロイすることができ、追加モジュールを使用して WebSocket や HTTP/2 をサポートすることもできます。
- **ドキュメント**: 詳細については、[公式 Jetty ドキュメント](https://www.eclipse.org/jetty/documentation/)を参照してください。

これらの手順に従うことで、`org.eclipse.jetty` を使用して Java アプリケーションに Web サーバーを埋め込み、特定のニーズに合わせてカスタマイズすることができます！