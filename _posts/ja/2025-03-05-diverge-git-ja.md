---
audio: false
generated: true
lang: ja
layout: post
title: 分岐したGitブランチ
translated: true
type: note
---

ローカルの `main` ブランチとリモートの `origin/main` ブランチが Git で分岐している場合（それぞれ74と70の異なるコミットがある）、これらは共通の祖先を持っていますが、その後独自のコミットが行われたことを意味します。あなたの目標は、ローカルの `main` ブランチを共通の祖先（「両方の親」）にリセットし、その後 `git pull` を使用してリモートの変更を取り込むことで、ローカルの分岐コミットを破棄してリモートのコミットを採用し、ローカルの `main` ブランチを `origin/main` に一致させることです。これを実現する手順を以下に示します。

### 分岐を修正する手順

1. **最新のリモート変更を取得する**  
   まず、ローカルリポジトリがリモートからの最新情報を持っていることを確認します。これにより、`origin/main` への参照が更新されますが、この時点ではローカルの `main` ブランチは変更されません。

   ```bash
   git fetch origin
   ```

2. **共通の祖先コミットを見つける**  
   `git merge-base` を使用して、ローカルの `main` と `origin/main` の間の共通の祖先コミットを特定します。これはブランチが分岐したポイントです。

   ```bash
   ancestor=$(git merge-base main origin/main)
   ```

   このコマンドは、共通祖先のコミットハッシュを変数 `ancestor` に保存します。

3. **ローカルの `main` を共通の祖先にリセットする**  
   ローカルの `main` ブランチを共通の祖先コミットにリセットします。`--hard` オプションは、ブランチのポインタと作業ディレクトリの両方が更新され、この時点以降に行われたすべてのローカルコミットと変更が破棄されることを保証します。

   ```bash
   git reset --hard $ancestor
   ```

   **注意**: この手順は、作業ディレクトリとステージング領域の未コミットの変更、およびローカルの `main` に特有の74のコミットをすべて破棄します。これらを保持する必要がある場合は、まずバックアップブランチを作成することを検討してください（後述の「オプションのバックアップ」を参照）。

4. **リモートの変更をプルする**  
   次に、`origin/main` からの変更をプルします。ローカルの `main` が共通の祖先にあるため、`origin/main` が70コミット先に進んでいるので、これによりローカルの `main` が `origin/main` に一致するように早送りされます。

   ```bash
   git pull origin main
   ```

   この後、ローカルの `main` ブランチは `origin/main` と同一になり、すべてのローカルの分岐コミットは破棄されます。

### 完全なコマンドシーケンス

実行する完全なコマンドシーケンスは以下の通りです：

```bash
git fetch origin
ancestor=$(git merge-base main origin/main)
git reset --hard $ancestor
git pull origin main
```

### 何が起こるか？
- **ステップ1の後**: ローカルリポジトリは `origin/main` の最新の状態を認識します。
- **ステップ2の後**: 共通の祖先コミット（例: `abc123` のようなハッシュ）を特定しました。
- **ステップ3の後**: ローカルの `main` が `abc123` にリセットされ、74の固有のローカルコミットが失われます。
- **ステップ4の後**: `git pull` により `main` が `origin/main` に早送りされ、リモートブランチからの70のコミットが取り込まれます。

結果として、ローカルの `main` が `origin/main` と完全に一致し、リモートブランチを使用するという目標が達成されます。

### オプションのバックアップ
ローカルコミットを破棄することに不安があり、後で参照できるように保持したい場合は、リセットする前にバックアップブランチを作成してください：

```bash
git branch backup-main
```

このコマンドを `git reset` コマンドの前に実行してください。74のローカルコミットは `backup-main` に残り、必要に応じて後で参照できます。

### 重要な注意点
- **未コミットの変更**: 保持したい未コミットの変更（作業ディレクトリやステージング領域内）がある場合は、リセットする前にスタッシュしてください：
  ```bash
  git stash
  ```
  プロセス完了後、`git stash pop` でそれらを取得できます。
- **これが機能する理由**: 共通の祖先にリセットしてからプルすることで、分岐したブランチから直接プルした場合に発生する可能性のあるマージコンフリクトを回避し、`origin/main` へのクリーンな早送りが保証されます。

これらの手順に従うことで、ローカルの `main` を希望通り `origin/main` に一致するようにリセットすることができます。