---
audio: false
generated: true
lang: ja
layout: post
title: 分岐したGitブランチ
translated: true
---

ローカルの `main` ブランチとリモートの `origin/main` ブランチが Git で分岐している場合—それぞれ 74 と 70 の異なるコミットがある場合—これは共通の祖先を持つが、その後独自のコミットを持つことを意味します。ローカルの `main` ブランチを `origin/main` に一致させるためには、ローカルブランチを共通の祖先（両方の「親」）にリセットし、その後 `git pull` を使用してリモートの変更を取り込み、ローカルの分岐したコミットをリモートのものに置き換える必要があります。以下にその手順を示します。

### 分岐を修正する手順

1. **最新のリモート変更を取得**
   ローカルリポジトリがリモートから最新の情報を持っていることを確認します。これにより、`origin/main` への参照が更新されますが、まだローカルの `main` ブランチは変更されません。

   ```bash
   git fetch origin
   ```

2. **共通の祖先コミットを特定**
   `git merge-base` を使用して、ローカルの `main` と `origin/main` の間の共通の祖先コミットを特定します。これは分岐したポイントです。

   ```bash
   ancestor=$(git merge-base main origin/main)
   ```

   このコマンドは、共通の祖先のコミットハッシュを変数 `ancestor` に保存します。

3. **ローカル `main` を共通の祖先にリセット**
   ローカルの `main` ブランチを共通の祖先コミットにリセットします。`--hard` オプションは、ブランチポインタと作業ディレクトリの両方が更新され、このポイント以降のすべてのローカルコミットと変更が破棄されることを保証します。

   ```bash
   git reset --hard $ancestor
   ```

   **注意**: この手順では、作業ディレクトリとステージングエリアのすべての未コミットの変更、およびローカル `main` に固有の 74 のコミットが破棄されます。これらを保存する必要がある場合は、まずバックアップブランチを作成することを検討してください（「オプションのバックアップ」を参照）。

4. **リモートの変更をプル**
   これで、`origin/main` から変更をプルします。ローカルの `main` は現在共通の祖先にあり、`origin/main` は 70 のコミットで先行しているため、これによりローカルの `main` が `origin/main` に一致するようにファストフォワードされます。

   ```bash
   git pull origin main
   ```

   これで、ローカルの `main` ブランチは `origin/main` と完全に一致し、すべてのローカルの分岐したコミットが破棄されます。

### 完全なコマンドシーケンス

実行する完全なコマンドシーケンスは以下の通りです:

```bash
git fetch origin
ancestor=$(git merge-base main origin/main)
git reset --hard $ancestor
git pull origin main
```

### 何が起こるか？
- **手順 1 後**: ローカルリポジトリは `origin/main` の最新状態を知っています。
- **手順 2 後**: 共通の祖先コミット（例: `abc123` のようなハッシュ）を特定しました。
- **手順 3 後**: ローカルの `main` は `abc123` にリセットされ、74 のローカル固有のコミットが失われました。
- **手順 4 後**: `git pull` は `main` を `origin/main` にファストフォワードし、リモートブランチから 70 のコミットを取り込みます。

結果として、ローカルの `main` は `origin/main` と完全に一致し、リモートブランチを使用するという目標を達成します。

### オプションのバックアップ
ローカルのコミットを破棄することに不安がある場合、リセットする前にバックアップブランチを作成してコミットを保存することができます:

```bash
git branch backup-main
```

このコマンドは `git reset` コマンドの前に実行してください。74 のローカルコミットは `backup-main` に残り、後で必要に応じて再度確認できます。

### 重要な注意点
- **未コミットの変更**: 作業ディレクトリまたはステージングエリアに保持したい未コミットの変更がある場合は、リセットする前にスタッシュしてください:
  ```bash
  git stash
  ```
  プロセスを完了した後、`git stash pop` で取得できます。
- **なぜこれが機能するか**: 共通の祖先にリセットし、プルすることで `origin/main` に対してクリーンなファストフォワードが保証され、分岐したブランチから直接プルすることで発生する可能性のあるマージコンフリクトを避けます。

これらの手順に従うことで、ローカルの `main` を `origin/main` と一致させることができます。