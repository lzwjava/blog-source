---
audio: false
generated: true
lang: ja
layout: post
title: WebSphere Libertyにおける不足JARファイル
translated: true
type: note
---

WebSphere Libertyで、`console.log`ファイルに次のような警告が表示されていることに気づいたかもしれません：*"the manifest class path: grpc-protobuf.jar cannot be found in jar file ..ear/war or its parent"*。これらの警告は、アプリケーション内のEARまたはWARファイルのマニフェストクラスパスで参照されている`grpc-protobuf.jar`ファイルをサーバーが見つけられないことを示しています。以下では、これらの警告が重要かどうか、アプリケーションの実行に影響するかどうか、そしてそれらを削除する方法について説明します。

---

### これらの警告は重要ですか？

はい、そして場合によります。これは、不足しているJARがアプリケーションに必要なものかどうかに依存します：

- **JARが必要な場合:**  
  `grpc-protobuf.jar`に、アプリケーションがランタイムに必要とするクラスやリソースが含まれている場合、この警告は重要です。JARがないと、アプリケーションは`ClassNotFoundException`のようなランタイムエラーに遭遇し、その一部が失敗したり正しく動作しなかったりする可能性があります。

- **JARが不要な場合:**  
  JARが実際には必要ない場合（例えば、古い設定からの残りの参照やオプションの依存関係である可能性があります）、警告は無害であり、アプリケーションの機能に影響を与えません。ただし、ログを乱雑にすることには変わりありません。

要するに、これらの警告は、不足しているJARがアプリケーションにとって重要な場合に重要です。その重要性を判断するために調査する必要があります。

---

### アプリケーションの実行に影響しますか？

アプリケーションのランタイムへの影響は、不足しているJARの役割に依存します：

- **はい、JARが必要な場合:**  
  アプリケーションが`grpc-protobuf.jar`からのクラスやリソースを使用しようとし、それが不足している場合、ランタイムエラーが発生する可能性が高いです。これにより、アプリケーションが正しく動作しなくなったり、完全に失敗したりする可能性があります。

- **いいえ、JARが不要な場合:**  
  JARが必要ない場合、警告にもかかわらずアプリケーションは正常に実行されます。メッセージは単にログに煩わしさとして残ります。

確認するには、アプリケーションの動作とログを、警告自体を超えてエラーがないかチェックしてください。すべてが期待通りに動作する場合、JARは必須ではない可能性があります。

---

### 警告を削除する方法

警告を排除するには、JARがアプリケーションに適切に含まれていることを確認するか、不要な参照を削除する必要があります。以下にステップバイステップのアプローチを示します：

1. **JARが必要かどうかを確認する:**  
   - アプリケーションのドキュメント、ソースコード、または依存関係リスト（例：Mavenを使用している場合は`pom.xml`）を確認して、`grpc-protobuf.jar`が必要かどうかを判断します。
   - 不要な場合は、ステップ3に進んで参照を削除します。必要な場合は、ステップ2に進みます。

2. **パッケージングを修正する（JARが必要な場合）:**  
   - `grpc-protobuf.jar`がアプリケーションパッケージ内の正しい場所に含まれていることを確認します：
     - **WARファイルの場合:** `WEB-INF/lib`ディレクトリに配置します。
     - **EARファイルの場合:** EARのルートまたは指定されたライブラリディレクトリ（例：`lib/`）に配置します。
   - アプリケーションをリビルドして再デプロイし、WebSphere LibertyによってJARが認識されるようになったことを確認します。
   - `console.log`をチェックして、警告が消えているかどうかを確認します。

3. **マニフェストを更新する（JARが不要な場合）:**  
   - EARまたはWAR内の`META-INF/`ディレクトリにある`MANIFEST.MF`ファイルを開きます。
   - `Class-Path`属性を探します。次のようになっているかもしれません：
     ```
     Class-Path: grpc-protobuf.jar some-other-lib.jar
     ```
   - `grpc-protobuf.jar`への参照を削除し、リストに表示されないようにします。
   - ファイルを保存し、アプリケーションをリビルドして再デプロイします。警告は表示されなくなるはずです。

4. **クラスパス設定を確認する:**  
   - アプリケーションがWebSphere Libertyで共有ライブラリやカスタムクラスローダーを使用している場合、サーバーの設定（例：`server.xml`）に必要なJARが含まれているか、または`grpc-protobuf.jar`を誤って参照していないことを確認します。
   - 必要に応じて設定を調整し、サーバーを再起動します。

---

### 一般的なアドバイス

- **警告を調査する:** アプリケーションが正常に動作しているように見えても、後で驚くことを避けるために警告の原因を理解することは良い習慣です。
- **変更後にテストする:** JARを追加したりマニフェストを更新した後は、アプリケーションが期待通りに動作することを徹底的にテストしてください。
- **ログをクリーンに保つ:** 不要な警告を解決することでログが明確になり、将来の実際の問題を見つけやすくなります。

これらの手順に従うことで、`grpc-protobuf.jar`の警告が重大かどうかを判断し、潜在的なランタイムへの影響に対処し、WebSphere Libertyの`console.log`から警告を削除することができます。

---

EARファイルをビルドするために`mvn package`を実行し、マニフェストクラスパスで不足しているJAR（`grpc-protobuf.jar`など）に関する警告に遭遇した場合、問題が不足しているコマンドライン引数に起因する可能性は低いです。`mvn package`コマンド自体は、コンパイル、テスト、およびEARのパッケージングを含む、`package`フェーズまでのMavenビルドライフサイクルをトリガーするのに十分です。しかし、この警告は、コマンドやその引数に関する問題ではなく、Mavenプロジェクトの設定の問題を示唆しています。これをステップバイステップで探ってみましょう。

---

### 警告は何を意味しますか？

この警告は、EAR内の`MANIFEST.MF`ファイルがその`Class-Path`属性で`grpc-protobuf.jar`を参照しているが、このJARがEAR内の期待される場所（例：`lib/`ディレクトリ）に見つからないことを示しています。`Class-Path`属性は、アプリケーションがランタイムに必要とするJARをリストし、不足しているJARは`ClassNotFoundException`のようなランタイムエラーを引き起こす可能性があります。

---

### 不足している引数に関する問題ですか？

いいえ、これを解決するために`mvn package`に追加の引数は必要ありません。Mavenは、EARに何が含まれるか、そしてマニフェストがどのように生成されるかを決定するために、プロジェクトの`pom.xml`ファイルとプラグイン設定（`maven-ear-plugin`など）に依存しています。`-DskipTests`や`-U`のような引数を追加するとビルドプロセスが調整されるかもしれませんが、この警告に直接対処するものではありません。根本原因はコマンド自体ではなく、プロジェクトの設定にあります。

---

### 警告の一般的な原因

警告の考えられる理由は以下の通りです：

1. **依存関係宣言の欠落**  
   `grpc-protobuf.jar`がアプリケーションに必要な場合、EARモジュールの`pom.xml`またはそのサブモジュール（例：WARまたはJARモジュール）で依存関係として宣言されていない可能性があります。

2. **誤った依存関係スコープ**  
   `grpc-protobuf.jar`が`provided`のようなスコープで宣言されている場合、Mavenはそれがランタイム環境（例：WebSphere Liberty）によって提供されると想定し、EARにパッケージしません。

3. **不要なマニフェストエントリ**  
   `maven-ear-plugin`が、EARに含まれていないにもかかわらず、マニフェストの`Class-Path`に`grpc-protobuf.jar`を追加するように設定されている可能性があります。

4. **推移的依存関係の問題**  
   JARが推移的依存関係（他の依存関係の依存関係）であり、除外されているか、EARに適切に含まれていない可能性があります。

---

### 調査方法

問題を特定するために、以下の手順を試してください：

1. **マニフェストファイルを確認する**  
   `mvn package`を実行した後、生成されたEARを解凍し、`META-INF/MANIFEST.MF`を確認します。`Class-Path`に`grpc-protobuf.jar`がリストされているかどうかをチェックします。これにより、警告がマニフェストの内容と一致するかどうかが確認されます。

2. **EARの`pom.xml`を確認する**  
   `maven-ear-plugin`の設定を確認します。例：
   ```xml
   <plugin>
       <groupId>org.apache.maven.plugins</groupId>
       <artifactId>maven-ear-plugin</artifactId>
       <version>3.2.0</version>
       <configuration>
           <version>7</version> <!-- 使用しているJava EEのバージョンに合わせてください -->
           <defaultLibBundleDir>lib</defaultLibBundleDir>
       </configuration>
   </plugin>
   ```
   JARが含まれるべき場所（例：`lib/`ディレクトリ）に依存関係が含まれるように設定されていることを確認します。

3. **依存関係を検査する**  
   EARモジュールで`mvn dependency:tree`を実行して、`grpc-protobuf.jar`が表示されるかどうかを確認します。もし表示されない場合、依存関係ツリーのどこにも宣言されていません。

4. **サブモジュールを確認する**  
   EARにWARやJARが含まれている場合、それらの`pom.xml`ファイルで`grpc-protobuf.jar`への依存関係がないかチェックします。

---

### 修正方法

見つかった内容に応じて、以下のいずれかの解決策を適用してください：

1. **JARが必要な場合**  
   EARの`pom.xml`に`grpc-protobuf.jar`を依存関係として追加します：
   ```xml
   <dependency>
       <groupId>io.grpc</groupId>
       <artifactId>grpc-protobuf</artifactId>
       <version>1.39.0</version> <!-- 正しいバージョンを使用してください -->
   </dependency>
   ```
   `maven-ear-plugin`がそれをEARに（例：`lib/`ディレクトリに）含めるようにします。

2. **スコープが誤っている場合**  
   `<scope>provided</scope>`として宣言されているが、パッケージする必要がある場合は、`<scope>compile</scope>`（デフォルトスコープ）に変更します。

3. **JARが不要な場合**  
   `grpc-protobuf.jar`がマニフェストに含まれるべきでない場合、`maven-ear-plugin`のカスタムマニフェスト設定を確認します：
   ```xml
   <configuration>
       <manifestFile>META-INF/MANIFEST.MF</manifestFile>
   </configuration>
   ```
   `grpc-protobuf.jar`への手動エントリを削除するか、Mavenにマニフェストを自動生成させます。

4. **推移的依存関係を扱う**  
   必要のない推移的依存関係である場合は、それを除外します：
   ```xml
   <dependency>
       <groupId>some.group</groupId>
       <artifactId>some-artifact</artifactId>
       <exclusions>
           <exclusion>
               <groupId>io.grpc</groupId>
               <artifactId>grpc-protobuf</artifactId>
           </exclusion>
       </exclusions>
   </dependency>
   ```

5. **リビルドと検証**  
   `mvn clean package`を実行してEARをリビルドし、出力されたEARファイルをチェックして、警告が消え、構造が正しいことを確認します。

---

### 結論

この警告を修正するために、`mvn package`コマンド自体に追加の引数は必要ありません。代わりに、問題は`pom.xml`または`maven-ear-plugin`の設定ミスによる可能性が高いです。`grpc-protobuf.jar`が（必要な場合）適切に含まれるようにするか、または（不要な場合）マニフェストから削除することで、警告を排除できます。マニフェストと依存関係を検査することから始め、それに応じて設定を調整してください。これにより、ビルドコマンドを変更することなく問題が解決するはずです。