---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: Pythonユーザーサイトパッケージ無効化
translated: true
type: note
---

このパッケージは**既にユーザーディレクトリにインストールされています**（`~/.local/lib/python3.13/site-packages`）が、`python3 ./scripts/train/extract_wiki.py` でスクリプトを実行するとき、何らかの理由でPythonが**ユーザーサイトパッケージディレクトリを参照していません**。

これは多くのLinuxディストリビューション（Ubuntu 22.04/24.04、Debian、Archなど）上のPython 3.11+で非常に一般的な問題です。デフォルトの `python3` は、システムパッケージマネージャーによって環境変数 `PYTHONNOUSERSITE=1` が設定されていたり、`-I`（分離）フラグが有効になっていたりするため、**ユーザーサイトパッケージパスが完全に無効化されている**ことが原因です。

### これが問題であることを確認する簡単な方法

以下の2つのコマンドを実行してください：

```bash
python3 -c "import sys, pathlib; print('user site:', pathlib.Path(sys.path[-1]).resolve() if 'site-packages' in sys.path[-1] else 'DISABLED')"
python3 -c "import site; print(site.ENABLE_USER_SITE)"
```

`DISABLED` または `False` または `None` が表示された場合、まさにこの問題です。

### 解決策（いずれかを選択）

#### オプション1 – `python3 -m pip` を使用し、同じPythonで実行する（推奨）

```bash
# モジュール形式を使用して、どのPythonにインストールするか100%確実にします
python3 -m pip install --user --upgrade mediawiki-dump

# その後、同じPythonでスクリプトを実行します
python3 ./scripts/train/extract_wiki.py
```

それでも失敗する場合は、ユーザーサイトを強制的に有効にします：

```bash
python3 -s ./scripts/train/extract_wiki.py
# または
PYTHONNOUSERSITE=0 python3 ./scripts/train/extract_wiki.py
```

#### オプション2 – 仮想環境を使用する（ベストプラクティス）

```bash
cd /home/lzw/projects/blog-source
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install mediawiki-dump   # venvにインストールされるため、権限の問題は発生しません
python ./scripts/train/extract_wiki.py   # これで確実に見つかるようになります
```

#### オプション3 – ユーザーサイトを恒久的に強制有効化する（システムPythonには非推奨）

`~/.bashrc` または `~/.zshrc` に以下を追加します：

```bash
export PYTHONNOUSERSITE=
```

または、以下を含む `~/.config/pythonstartup.py` を作成します：

```python
import site
import os
os.environ["PYTHONNOUSERSITE"] = ""
```

### 今すぐできる簡単なワンライナーテスト

現在のシェルで以下を実行してください：

```bash
python3 -s -c "from mediawiki_dump.tokenizer import WikiTokenizer; print('Works!')"
```

「Works!」と表示されれば、修正は単純に常に `python3 -s` を使用するか、venvを作成するだけです。

venvルート（オプション2）を選択することをお勧めします — これにより他のすべてのパッケージに関する無限の頭痛からも解放されます。その後、新しいエラーが発生した場合はお知らせください！