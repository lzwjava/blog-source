---
audio: false
generated: true
image: false
lang: ja
layout: post
title: Gitガベージコレクションの解説
translated: true
type: note
---

`git gc` は **Git garbage collection** を意味します。これはローカルリポジトリをクリーンアップし最適化するハウスキーピングコマンドです。

### 機能

* **ファイル履歴の圧縮**: Gitはオブジェクト（コミット、ツリー、ブロブ）をデータベースに保存します。時間の経過とともに多くのルーズオブジェクトが蓄積されます。`git gc` はこれらをコンパクトなバイナリファイルにまとめて、ディスク容量を節約します。
* **到達不能オブジェクトの削除**: ブランチを削除したりリベースしたりした場合、参照から到達不能になったコミットが生じることがあります。Gitは安全のためにこれらを保持しますが、`git gc` は最終的にこれらをクリーンアップします。
* **参照の最適化**: タグやブランチなどの ref を書き換えてパックし、参照を高速化します。
* **reflog の整理**: 有効期限を過ぎた古い reflog エントリ（HEAD 変更の記録）が削除されます。

### 自動実行される場合

* Git はルーズオブジェクトやパックファイルの数がしきい値を超えると、**自動バックグラウンド `gc`** を実行します。例えば、多くのコミット、リベース、マージを行った場合、Git はこれをトリガーすることがあります。
* 多くの Git コマンド（`git fetch`、`git merge`、`git rebase` など）は、`gc` の実行が推奨されるかどうかをチェックし、必要に応じて自動的に実行します。
* これにより、ユーザーが意識しなくてもリポジトリのパフォーマンスを維持できます。

### 手動実行のタイミング

* リポジトリの動作が**遅い**、または**肥大化している**と感じる場合（例：大きな `.git` フォルダ）。
* **大規模なクリーンアップ**を行った後（ブランチの削除や履歴からの大規模ファイルの削除など）。
* 即時のクリーンアップを強制したい場合:

  ```bash
  git gc --prune=now --aggressive
  ```

  *（注意: `--aggressive` は特に大規模なリポジトリでは長時間かかる可能性があります）*

---

**Git が最後に自動で `gc` を実行した時期を確認する方法**や、それをトリガーするしきい値についても説明しましょうか？