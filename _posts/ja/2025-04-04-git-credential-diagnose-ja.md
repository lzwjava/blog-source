---
audio: false
generated: true
lang: ja
layout: post
title: Git資格情報マネージャーの診断
translated: true
type: note
---

`git credential-manager diagnose` の出力に、TLS証明書検証の警告に加えて、**ネットワーク障害**が明確に示されるようになりました。エラーとその修正方法を詳しく見ていきましょう：

**主な発見事項:**

*   **ネットワーク障害:**
    *   診断テストが `System.Net.Http.HttpRequestException: nodename nor servname provided, or not known (example.com:443)` というエラーで失敗しました。
    *   このエラーは、Git Credential Manager がホスト名 `example.com` をIPアドレスに解決できなかったか、そのホストのポート443に接続できなかったことを意味します。
    *   診断ログは、`https://example.com` へのHEADリクエストが失敗したことを示しています。
*   **プロキシの干渉 (可能性の高い原因):**
    *   `HTTP_PROXY: http://127.0.0.1:7890` と `HTTPS_PROXY: http://127.0.0.1:7890` が存在することは、プロキシがネットワーク障害の根本原因であることを強く示唆しています。
    *   診断が [http://httpforever.com](http://httpforever.com) にはアクセスできるが、[https://example.com](https://example.com) にはアクセスできないという事実は、プロキシがhttpsリクエストに問題を抱えていることを示しています。
*   **TLS証明書検証の無効化 (セキュリティリスク):**
    *   以前と同様に、TLS証明書の検証が無効化されており、これは重大なセキュリティ上の懸念事項です。

**トラブルシューティングの手順:**

1.  **プロキシの検証:**
    *   **プロキシのテスト:** Webブラウザを開き、直接 `https://example.com` にアクセスしてみてください。「接続できない」または「ホスト名が見つからない」というエラーが発生した場合、プロキシが誤って設定されている可能性が高いです。
    *   **プロキシソフトウェアの問題:**
        *   プロキシソフトウェア (Shadowsocks, Clashなど) を再起動してください。
        *   プロキシソフトウェアのログを確認し、エラーメッセージがないか調べてください。
        *   プロキシがHTTPSトラフィックを正しく処理するように設定されていることを確認してください。
        *   プロキシソフトウェアが実行中であることを確認してください。
    *   **プロキシ設定:**
        *   オペレーティングシステムのネットワーク設定と、Git設定ファイル内のプロキシ設定を再確認してください。
        *   プロキシアドレス (`127.0.0.1`) とポート (`7890`) が正しいことを確認してください。
        *   オペレーティングシステムのネットワーク設定でプロキシを一時的に無効化し、`git credential-manager diagnose` を再実行してください。
2.  **DNS解決:**
    *   エラーメッセージはホスト名解決の問題を示唆していますが、プロキシが最も可能性の高い原因です。それでも、DNS設定を確認する価値はあります。
    *   パブリックDNSサーバー (例: 8.8.8.8, 1.1.1.1) を使用してみてください。
3.  **TLS証明書検証:**
    *   **証明書検証の再有効化:** これはセキュリティ上極めて重要です。 `https://aka.ms/gcm/tlsverify` リンクに記載されている手順に従ってください。
    *   お使いのプロキシソフトウェアがHTTPSトラフィックを傍受するように設計されている場合は、プロキシのルート証明書をオペレーティングシステムの信頼されたルート証明書ストアにインストールしてください。これは、プロキシを機能させるための安全な方法です。
4.  **Git設定:**
    *   `git config --global --list` を実行して、Git設定を確認してください。
    *   問題を切り分けるために、Gitからプロキシ設定を一時的に削除してください：
        ```bash
        git config --global --unset http.proxy
        git config --global --unset https.proxy
        ```
    *   プロキシ設定を削除した後、`git credential-manager diagnose` コマンドを再実行してください。
5.  **ファイアウォール:**
    *   コンピューター上のファイアウォールを一時的に無効化し、ファイアウォールの干渉がないかどうか確認してください。
6.  **ネットワーク接続:**
    *   他のネットワークアプリケーションを使用してネットワーク接続をテストし、ネットワーク自体が安定していることを確認してください。
    *   モバイルホットスポットを使用している場合は、電波状態の良い場所に移動してください。

**重要な要点:** プロキシがネットワーク障害の原因であることはほぼ間違いありません。プロキシを正しく設定し、TLS証明書検証を再有効化することが最も重要なステップです。