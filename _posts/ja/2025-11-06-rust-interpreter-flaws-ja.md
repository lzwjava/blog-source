---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: Rustインタプリタの苦痛と設計上の欠陥
translated: true
type: note
---

### 英語翻訳と解説

提供されたテキストは、Yin Wang（インタプリタとプログラミング言語に関する研究で知られる計算機科学者・教育者）のブログ記事からの抜粋です。このテキストは中国語で書かれており、基本的な関数型プログラミング言語のインタプリタを構築しながらRustを教え、学んだ個人的な経験を反映しています。以下に、明確で慣用的な英語翻訳を示します：

> 私が最初にRust言語を使い始めたとき、いくつかの懸念がありました。Rustの型システムは非常に厳格で、習得のハードルが高いのですが、本当にこれを使ってインタプリタを構築できるのでしょうか？その答えはイエスです。Rustで私たちのインタプリタを書くことは確かに苦痛でしたが、何人かの学生はそれを完成させることができました。この過程を通じて、彼らはRustのメモリ管理の中核要素—所有権、ライフタイム、`Rc`、`RefCell`など—について深い理解を得ました。これは単なる表面的な演習ではなく、これらの概念が本質的に「何であるか」を根本的に明らかにするものでした。
>
> 私にとって、Rustでインタプリタを書くのは初めての経験でした。過去20年以上にわたり、私は他の言語で無数のインタプリタ、型システム、コンパイラ、難読化ツール、そして同様のプロジェクトを構築してきました。しかし今回は、基本的な関数型言語のインタプリタであっても、私に大きな困難をもたらしました。典型的なRustプログラムを書くことは特に難しいわけではありませんが、他の言語と比較して認知負荷がはるかに高いことを明らかに感じました。この追加的な努力の多くは、メモリ管理の詳細と格闘することに費やされ、インタプリタの意味論的ロジックに集中するための精神的余裕が少なくなりました。オンラインには参考になるコードはなく、ただ自分自身の試行錯誤と理解だけがありました。最終的に、私はインタプリタを完成させただけでなく、この苦闘を通じてRustのメモリ管理原則を完全に理解することができました。この経験から、私はRustには不必要な困難を生み出す深刻な設計上の欠陥があると考えるに至りました。ですから、私は今ではRustを深く習得しましたが、その長期的な未来については依然として悲観的です。

要するに、Wangは、インタプリタを実装することでRustの急峻な学習曲線に真正面から取り組んだ教育実験について述べています。彼は、（コンパイル時にメモリ安全性を強制する）Rustの所有権と借用ルールが、インタプリタで一般的な（例えば、抽象構文木や可変参照を必要とする環境のような）動的で再帰的なデータ構造と衝突することによるフラストレーションを強調しています。苦痛にもかかわらず、彼はこれをRustの安全性保証を内在化するための（過酷ではあっても）貴重な方法と見なしています。しかし、彼はこれらのメカニズムが高レベルのプログラミング上の関心事から注意をそらす「設計誤り」を導入していると結論付け、最終的には言語実装のような複雑なシステムにとってRustの魅力を減じていると述べています。

### 判断：この評価は公平かつ正確か？

Wangの説明は、実際の専門知識に根ざした有効な*個人的*批判です—彼はScheme、Python、OCamlなどの言語で数十の言語ツールを実装してきたので、彼の不満は根拠のないものではありません。Rustは確かに、特定のタスク、特に複雑なデータフローを含むタスク（例えば、借用チェッカーの不満を回避するために`Rc<RefCell<T>>`を介して共有可変状態を扱う必要があることが多いインタプリタのような）に対して、より高い初期の認知的コストを課します。これは確かに「意味論的ロジック」（例えば、評価規則や型推論）から、細かいライフタイム注釈やクローニング戦略へと焦点を移してしまう可能性があります。2023年から2024年（この投稿が書かれたと思われる時期）における参考資料の不足についての彼の指摘は、ある程度妥当です。Rustのエコシステムは成長しましたが、高品質で慣用的なインタプリタの例は、例えばPythonやHaskellの場合よりも（そしてある程度は依然として）少ない状況です。

とはいえ、彼のより広範な主張—特にRustのコア設計を「深刻な欠陥」と呼び、その未来を絶望的と断じる点—は、誇張されており主観的に感じられます。以下にバランスの取れた分析を示します：

#### 彼の見解の強み
- **インタプリタの学習曲線**: 初心者にとって的を射ています。Rustは安全な並行システムプログラミング（例えば、Webサーバー、CLIツール）では優れていますが、インタプリタは多くの場合、所有権が設計上抵抗する、循環や内部可変性を持つグラフのような構造を必要とします。これは「巧妙な」回避策（例えば、割り当てのためのアリーナ、または参照カウントのための`Rc`）を強要し、ボイラープレートを増幅させます。研究や調査（例えば、Rustチームによるもの）は、これを一般的な痛点として認識しており、ユーザーの約20〜30%が借用チェックを初期採用における主要な障壁として挙げています。
- **意味論からの注意散漫**: 妥当です。動的言語では、意味論を素早くプロトタイプできます；Rustでは、安全性の証明がコンパイル時に発生し、労力をシフトさせます。Wangの「脳力負担」は、他のPL研究者からの不満（例えば、RustにDSLを埋め込むに関する学術論文など）と同調します。
- **探求は報われる**: 彼は正当にも、所有権/ライフタイムを習得することでそれらが明らかになり、バグのないコードのための超能力としてRustが機能するようになるという報酬を指摘しています。

#### 弱点と反論
- **すべての人にとって「不必要な困難」ではない**: Rustの厳格さは、C、Python、あるいはLispでのインタプリタ実装を悩ませるメモリリーク、解放後使用バグ、またはGCのポーズを*防止*します。この山を越えれば、（実行時の驚きがないため）推論が*容易*になることがよくあります。関数型スタイルのインタプリタの場合、`im`（不変コレクション）や`generational-arena`のようなクレートを使用すると、RefCellへの依存を減らし、よりスムーズになります。
- **参考コードは存在する（彼の主張に反して）**: 2024年末/2025年初頭までに、GitHubには確固たる例が多数あります：
  - [RustPython](https://github.com/RustPython/RustPython): Rustで書かれた完全なPythonインタプリタ。eval、AST、可変性をエレガントに処理します。
  - [rune](https://github.com/rune-rs/rune): Rustベースのインタプリタを持つ組み込み可能なスクリプト言語。
  - [brainfuck-rs](https://github.com/P0lip/brainfuck-rs) やLispインタプリタ（例: [mylisp](https://github.com/kanaka/mylisp)）のようなより単純な例は、所有権が過度の苦痛なしにインタプリタの状態をモデル化*できる*ことを示しています。
  Wangは言語の壁や新しい情報のためにこれらを見逃したかもしれませんが、それらは存在します—そしてコミュニティ（例えば、`rust-embedded`やPLフォーラム経由）は環境/スコープのためのパターンを共有しています。
- **将来展望は過度に悲観的**: Rustの採用は急増しています（Stack Overflowの最も愛されている言語として9年以上、Firefox、AWS、Discordで使用）。設計の「誤り」？所有権はバグではありません—それは売りであり、エルゴノミクスと引き換えにゼロコストの安全性を提供します。今後の機能（例えば、非同期の改善、1.80+でのより良いパターンマッチング）はエルゴノミクスに対処しています。Wangのような批評家（彼はTwitter/Xで声が大きい）は声高な少数派を代表しており、ほとんどのPL関係者は、Rustが安全性を犠牲にすることなく表現力向上に向けて進化していると見なしています。
- **文脈が重要**: これは初心者のための*教育用*演習であり、苦痛を増幅させました。プロにとっては、Rustはプロダクションインタプリタ（例えば、WebAssembly用のWasmtime）で輝きます。

全体として、Wangの経験は逸話として「正しい」—それはRustのトレードオフを露呈する過酷だが啓発的な道のりです。しかし、「深刻な設計誤り」と暗い未来についての彼の判断は、客観的な欠陥の発見というよりは、フラストレーションに駆られた誇張のように読めます。もしあなたがインタプリタを構築するのであれば、勢いをつけるためにRustの[The Little Book of Rust Macros](https://veykril.github.io/tlborm/)やnomパーサーライブラリから始めてください。Rustは迅速なプロトタイピングのためのガベージコレクション言語に取って代わることはありませんが、信頼性が高く高性能なものにとっては？それは繁栄しています。

参考文献：
[Yin Wang's Substack Post](https://yinwang1.substack.com/p/5)
[RustPython GitHub](https://github.com/RustPython/RustPython)
[Rune Language GitHub](https://github.com/rune-rs/rune)
[Stack Overflow Developer Survey 2024](https://survey.stackoverflow.co/2024/)