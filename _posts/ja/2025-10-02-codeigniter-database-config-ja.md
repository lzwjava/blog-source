---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: CodeIgniterデータベース設定概要
translated: true
type: note
---

### CodeIgniter データベース設定の概要

このPHPファイルは、CodeIgniterのデータベース接続設定スクリプトです。さまざまなデータベースグループ（例：'default'、'lzwjava'、'leo66'、'testing'）の接続設定を定義しており、環境（開発、テスト、本番）に基づいてアプリケーションがこれらを切り替えることができます。`$active_group`変数は、デフォルトで使用される接続グループを決定します。

主な構成要素：
- **$query_builder**: `TRUE`に設定すると、SQLクエリをオブジェクト指向方式で構築するQuery Builderクラスの読み込みが有効になります。
- **$db[][]**: 各サブ配列（例：'default'）がデータベース接続の詳細な設定オプションを保持する連想配列です。

`$active_group`は、`ENVIRONMENT`定数（例：switch文経由）に基づいて動的に設定され、異なるデプロイ段階で異なる設定が使用されることを保証します。以下では、CodeIgniterのドキュメントと標準的な使用法に基づいて、各設定オプションについて詳細に説明します。実際の機密値（認証情報など）はセキュリティ上の理由からここでは省略されています。実際には、これらは環境変数などを通じて安全に保存する必要があります。

### 詳細な設定オプション

各データベースグループは、以下のキーを持つ配列です。ほとんどの設定は単純明快ですが、一部（`encrypt`など）は高度な機能のためにサブオプションをサポートしています。

- **dsn** (文字列): 接続を記述する完全なデータソース名（DSN）文字列。ホスト名、ユーザー名などを個別に指定する代わりに使用します。ODBCのような複雑な設定で有用です。指定された場合、個別のホスト/認証フィールドを上書きします。例： `'dsn' => 'mysql:host=yourhost;dbname=yourdatabase'`.

- **hostname** (文字列): データベースサーバーのアドレス（例：'localhost' または '127.0.0.1'のようなIP）。データベースが実行されている場所を特定し、TCP/IPまたはソケットを介した接続を可能にします。

- **username** (文字列): データベースサーバーで認証するために使用するアカウント名。データベース管理システム内の有効なユーザーと一致する必要があります。

- **password** (文字列): 認証のためにユーザー名と組み合わせて使用される秘密鍵。流出を防ぐため、常に安全に保存してください。

- **database** (文字列): サーバー上で接続したい特定のデータベース名。特に指定がない限り、すべてのクエリはこのデータベースを対象とします。

- **dbdriver** (文字列): 使用するデータベースドライバを指定します（例：MySQL用の'mysqli'）。一般的なドライバには、'cubrid'、'ibase'、'mssql'、'mysql'、'mysqli'、'oci8'、'odbc'、'pdo'、'postgre'、'sqlite'、'sqlite3'、'sqlsrv'があります。'mysqli'はMySQL用の現代的で安全な選択肢です。

- **dbprefix** (文字列): CodeIgniterのQuery Builderを使用する際にテーブル名に追加されるオプションのプレフィックス（例：'prefix_'に設定すると、'mytable'は'prefix_mytable'になります）。これは、共有ホスティングやマルチテナントアプリでのテーブルの名前空間を分けるのに役立ちます。

- **pconnect** (ブール値): 持続的接続（`TRUE`）または通常の接続（`FALSE`）を有効にします。持続的接続は同じリンクを再利用するため、高負荷アプリのパフォーマンス向上に役立ちますが、使いすぎるとサーバーリソースを枯渇させる可能性があります。

- **db_debug** (ブール値): データベースエラーを表示（`TRUE`）してデバッグするかどうかを制御します。本番環境では、ユーザーに機密性の高いエラーの詳細が漏れるのを避けるため、無効（`FALSE`）にしてください。

- **cache_on** (ブール値): クエリキャッシュを有効（`TRUE`）または無効（`FALSE`）にします。有効にすると、結果が保存され、繰り返しクエリの速度が向上します。

- **cachedir** (文字列): キャッシュされたクエリ結果が保存されるディレクトリへのファイルパス。Webサーバーによる書き込みが可能である必要があります。`cache_on`と組み合わせて使用すると、データベースの負荷を軽減します。

- **char_set** (文字列): データベース通信のための文字エンコーディング（例：現代的なUnicodeサポートのための'utf8mb4'）。多言語アプリのデータ整合性を保証します。

- **dbcollat** (文字列): 文字のソートと比較のための照合順序（例：大文字小文字を区別しないUnicodeのための'utf8mb4_unicode_ci'）。これは古いPHP/MySQLのためのフォールバックとして機能します。それ以外の場合は無視されます。

- **swap_pre** (文字列): `dbprefix`を動的に置き換えるテーブルプレフィックス。テーブルの名前を変更せずに既存のアプリでプレフィックスを交換する場合に便利です。

- **encrypt** (ブール値または配列): 暗号化サポート用。'mysql'（非推奨）、'sqlsrv'、'pdo/sqlsrv'の場合、SSLを有効/無効にするには`TRUE`/`FALSE`を使用します。'mysqli'および'pdo/mysql'の場合、SSLサブオプションを持つ配列を使用します：
  - 'ssl_key': 秘密鍵ファイルへのパス（例：クライアント証明書用）。
  - 'ssl_cert': 公開鍵証明書ファイルへのパス。
  - 'ssl_ca': 認証局ファイルへのパス（サーバー証明書を検証）。
  - 'ssl_capath': PEM形式の信頼できるCA証明書のディレクトリへのパス。
  - 'ssl_cipher': 許可される暗号のコロン区切りリスト（例：'AES128-SHA'）。
  - 'ssl_verify': 'mysqli'専用。サーバー証明書を検証する場合は`TRUE`、スキップする場合は`FALSE`（安全性が低い。自己署名証明書用に使用）。

- **compress** (ブール値): MySQL接続用のクライアント側圧縮を有効にし、ネットワークトラフィックを削減します（MySQL専用。他のドライバでは無視されます）。

- **stricton** (ブール値): 'Strict Mode'接続を強制（`TRUE`）し、厳格なSQLルールを適用してエラーを早期に検出します（例：無効なデータ型）。開発中に有用です。

- **ssl_options** (配列): 'pdo'などのドライバ用の高度なSSL設定オプション。`encrypt`でカバーされない暗号化パラメータの微調整を可能にします。

- **failover** (配列): プライマリ接続が失敗した場合に自動切り替えするためのバックアップ接続配列。各要素はメイン設定を反映しています（例：代替ホスト名/ポート）。例： `array(array('hostname' => 'backuphost', ...))`.

- **save_queries** (ブール値): 実行されたクエリをメモリに保存してデバッグ（`TRUE`）します。`$this->db->last_query()`のようなメソッドへのアクセスを提供しますが、メモリ使用量が増加する可能性があります。本番環境ではリソースを節約するため無効（`FALSE`）にしてください。

### データベースグループと環境切り替え

- **default**: ベースとなる設定配列で、テンプレートとして機能します。これは（例：デバッグなし、安全な設定など）「本番」環境のデフォルトに設定されています。
- **lzwjava**: ベースから継承しますが、ユーザー名を異なる値に上書きします（パスワードは空白のまま。認証なしまたはデフォルトを意味します）。
- **leo66**: ベース設定を継承しますが、ホスト名をローカルループバックに変更し、ユーザー名/パスワードをデフォルトに設定し、ポート（3306、MySQLの標準）を追加します。
- **testing**: テスト環境専用のグループ。ベース設定を継承します。

`switch`文は、`ENVIRONMENT`に基づいて適切なグループを有効にします：
- 開発: 'lzwjava'を使用。
- テスト: 'testing'を使用。
- 本番: 'default'を使用。

この設定は、ローカル開発、テスト、およびライブデプロイメントのための柔軟性を促進します。SQLインジェクションを防ぐために常に入力をサニタイズし、セキュリティのために認証情報を環境変数に移動することを検討してください。完全なドキュメントについては、CodeIgniterの公式ユーザーガイドのデータベース接続の項を参照してください。特定のオプションやグループについて説明が必要な場合は、お知らせください！