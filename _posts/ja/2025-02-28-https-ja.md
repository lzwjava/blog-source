---
audio: false
generated: true
lang: ja
layout: post
title: HTTPSの仕組み
translated: true
type: note
---

HTTPSの仕組みについて、SSL、証明書、暗号化プロセス、TLS 1.2とTLS 1.3の違いを段階的にわかりやすく説明します。

---

### **HTTPSとは**
HTTPSは **Hypertext Transfer Protocol Secure** の略です。これはHTTPの安全なバージョンであり、ブラウザとウェブサイト間でデータを転送するためのプロトコルです。「Secure」の部分は、**SSL（Secure Sockets Layer）** またはその現代的な後継である **TLS（Transport Layer Security）** によって提供される暗号化と認証の層が追加されたことに由来します。つまり、HTTPSは本質的に、データを安全に保つためにTLS（または歴史的にはSSL）上で動作するHTTPなのです。

---

### **HTTPSはどのように動作するのか？ TLSハンドシェイク**
HTTPSを使用するウェブサイト（例: `https://example.com`）にアクセスすると、データを交換する前に、ブラウザとウェブサイトのサーバー間で安全な接続が確立されます。このプロセスを **TLSハンドシェイク** と呼びます。簡単なステップで説明します：

1. **Client Hello**:
   - ブラウザはサーバーにメッセージを送信します。「こんにちは！私がサポートするTLSバージョン（例: TLS 1.3）、使用可能な暗号化アルゴリズム（暗号スイート）、そしてランダムなバイト列（クライアントランダム）を送ります。」

2. **Server Hello**:
   - サーバーは応答します。「こんにちは！あなたのリストからこのTLSバージョンとこの暗号スイートを使用します。こちらが私のランダムな文字列（サーバーランダム）です。」

3. **Certificate**:
   - サーバーはその **SSL証明書** を送信します。これにはサーバーの **公開鍵** が含まれており、信頼された **認証局（CA）** によって署名されています。この証明書はサーバーの身元を証明します。

4. **Client Key Exchange**:
   - ブラウザは、証明書が有効であり、信頼できるCAによって署名されていることを確認します。確認が通ると、ブラウザは **プリマスタシークレット** を生成し、サーバーの公開鍵で暗号化してサーバーに送信します。

5. **Session Keys**:
   - ブラウザとサーバーの両方が、クライアントランダム、サーバーランダム、プリマスタシークレットを使用して、同じ **セッション鍵** をそれぞれ独立して生成します。この鍵はセッション中にすべてのデータを暗号化および復号化するために使用されます。

6. **Finished**:
   - 両者は、セキュアな接続の準備ができたことを確認するために、セッション鍵で暗号化された「finished」メッセージを送信します。

ハンドシェイクが完了すると、すべてのデータ（ウェブページ、フォーム、ファイルなど）がセッション鍵で暗号化され、傍受した者には読めないようになります。

---

### **SSL証明書とは何か、どのように機能するのか？**
**SSL証明書** は、ウェブサイトの身元を証明し、暗号化を可能にするデジタル文書です。以下に知っておくべきことを示します：

- **内容**: 証明書には、ウェブサイトのドメイン名、その公開鍵、および **認証局（CA）** によるデジタル署名が含まれます。
- **目的**: サーバーが正当であること（例：偽のサイトではなく、実際に `example.com` に接続していること）を保証し、暗号化のための公開鍵を提供します。
- **検証**: ブラウザは以下を確認します：
  1.  証明書は有効か（期限切れや失効していないか）？
  2.  信頼できるCAによって署名されているか？（ブラウザには、DigiCertやLet's Encryptなどの信頼できるCAのリストが組み込まれています。）
- チェックが通ると、ブラウザはサーバーを信頼し、ハンドシェイクを続行します。

CAは、ウェブサイトを保証する信頼できる第三者として機能します。これがないと、攻撃者は任意のサイトを装ってあなたのデータを盗む可能性があります。

---

### **暗号化アルゴリズム**
HTTPSにおける暗号化は、**非対称暗号** と **対称暗号** の組み合わせに依存しています：

1.  **非対称暗号**（ハンドシェイク中）:
    - **公開鍵**（公開して共有）と **秘密鍵**（サーバーが秘密に保持）を使用します。
    - ブラウザはプリマスタシークレットをサーバーの公開鍵で暗号化します。秘密鍵を持つサーバーのみがそれを復号化できます。
    - 例となるアルゴリズム: RSA または 楕円曲線暗号 (ECC)。

2.  **対称暗号**（セッション用）:
    - セッション鍵が作成されると、両者はそれを使用してデータを暗号化および復号化します。
    - これは非対称暗号化よりも高速であり、大量のデータ転送に理想的です。
    - 例となるアルゴリズム: AES (Advanced Encryption Standard)。

ハンドシェイクでは、セッション鍵を安全に共有するために非対称暗号を使用し、その後、効率化のために対称暗号が引き継ぎます。

---

### **TLS 1.2 と TLS 1.3 の違い**
**TLS 1.2** と **TLS 1.3** はTLSプロトコルのバージョンであり、TLS 1.3はより新しく改良されたバージョンです。主な違いは以下の通りです：

| **機能**               | **TLS 1.2**                                      | **TLS 1.3**                                      |
|-------------------------|--------------------------------------------------|--------------------------------------------------|
| **ハンドシェイク速度**   | クライアントとサーバー間の往復が複数回発生し、遅延が追加される。 | 往復回数が少なく、多くの場合1回だけであり、接続が高速化される。再接続時にはデータを即時送信可能（「0-RTT」）。 |
| **暗号スイート**         | 古くて安全性の低い暗号化アルゴリズム（例: SHA-1）をサポートする。 | 時代遅れの暗号スイートを削除し、モダンで安全なもの（例: AES-GCM）のみを使用する。 |
| **プライバシー**         | ハンドシェイクデータの一部（証明書など）が平文で送信される。 | ハンドシェイクのほぼ全体が暗号化され、盗聴者からより多くの詳細が隠される。 |
| **0-RTT 再接続**         | 利用不可。                                       | 再接続時に即座にデータ送信を可能にするが、適切に保護されない場合はリプレイ攻撃のリスクがある。 |
| **セキュリティ**         | 古い機能のために特定の攻撃に対して脆弱。           | 弱いオプションを排除することで、設計上より強固。 |

要するに、TLS 1.3はTLS 1.2よりも **高速**、**より安全**、**よりプライバシー性が高く**、現代のHTTPSの標準となっています。

---

### **全体のまとめ**
HTTPSは、以下によってウェブ通信を保護します：
1.  **TLSハンドシェイク** を使用して暗号化された接続を設定する。
2.  信頼できるCAからの **SSL証明書** に依存してサーバーの身元を確認する。
3.  **非対称暗号**（ハンドシェイク用）と **対称暗号**（データ転送用）を組み合わせてデータを保護する。
4.  **TLS 1.3** のようなプロトコルで進化し、速度、セキュリティ、プライバシーを向上させる。

これが、HTTPSがあなたのブラウジングを安全に保つ核心の仕組みです！どの部分についてさらに深く掘り下げてほしいかがあれば、お知らせください。