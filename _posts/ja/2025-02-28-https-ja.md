---
audio: false
lang: ja
layout: post
title: HTTPSの仕組み
translated: true
---

HTTPSの仕組みについて、SSL、証明書、暗号化プロセス、そしてTLS 1.2とTLS 1.3の違いを含めて、明確でステップバイステップで説明します。

---

### **HTTPSとは？**
HTTPSは、**Hypertext Transfer Protocol Secure**の略で、ブラウザとウェブサイト間でデータを転送するために使用されるプロトコルHTTPのセキュアなバージョンです。「セキュア」という部分は、**SSL（Secure Sockets Layer）**またはその現代的な置き換えである**TLS（Transport Layer Security）**によって提供される暗号化と認証の層を追加することで実現されます。したがって、HTTPSは、データを安全に保護するためにTLS（または歴史的にはSSL）上で動作するHTTPです。

---

### **HTTPSの仕組み：TLSハンドシェイク**
HTTPSを使用してウェブサイトにアクセスすると（例：`https://example.com`）、ブラウザとウェブサイトのサーバーはデータの交換前に安全な接続を確立します。このプロセスは**TLSハンドシェイク**と呼ばれます。以下に簡単なステップで説明します：

1. **クライアントハロー**：
   - ブラウザはサーバーに「こんにちは！サポートしているTLSバージョン（例：TLS 1.3）、使用可能な暗号化アルゴリズム（暗号スイート）、ランダムなバイト列（クライアントランダム）」というメッセージを送信します。

2. **サーバーハロー**：
   - サーバーは「こんにちは！あなたのリストからこのTLSバージョンとこの暗号スイートを使用します。ここが私のランダムな文字列（サーバーランダム）です」と返信します。

3. **証明書**：
   - サーバーは**SSL証明書**を送信し、これは**公開鍵**を含み、**信頼できる証明機関（CA）**によって署名されています。この証明書はサーバーのアイデンティティを証明します。

4. **クライアントキー交換**：
   - ブラウザは証明書が有効で信頼できるCAによって署名されていることを確認します。通過すると、ブラウザは**プリマスターシークレット**を生成し、サーバーの公開鍵で暗号化してサーバーに送信します。

5. **セッションキー**：
   - ブラウザとサーバーはクライアントランダム、サーバーランダム、プリマスターシークレットを使用して独立して同じ**セッションキー**を生成します。このキーはセッション中のすべてのデータの暗号化と復号化に使用されます。

6. **完了**：
   - 両方の側がセッションキーで暗号化された「完了」メッセージを送信して、安全な接続が準備できたことを確認します。

ハンドシェイクが完了すると、すべてのデータ（ウェブページ、フォーム、ファイルなど）はセッションキーで暗号化され、誰かがそれをインターセプトしても読めなくなります。

---

### **SSL証明書とは？その仕組み**
**SSL証明書**は、ウェブサイトのアイデンティティを証明し、暗号化を可能にするデジタル文書です。以下に知っておくべきことを説明します：

- **内容**：証明書にはウェブサイトのドメイン名、その公開鍵、そして**証明機関（CA）**からのデジタル署名が含まれています。
- **目的**：サーバーが合法であることを確認し（例：本当に`example.com`に接続しているか、偽サイトではないか）、暗号化のための公開鍵を提供します。
- **検証**：ブラウザは以下を確認します。
  1. 証明書が有効（期限切れまたは失効していない）か？
  2. 信頼できるCAによって署名されているか？（ブラウザにはDigiCertやLet's Encryptなどの信頼できるCAのリストが組み込まれています。）

検証が通過すると、ブラウザはサーバーを信頼し、ハンドシェイクを続行します。

CAはウェブサイトを信頼できる第三者として証明する役割を果たします。これを欠くと、攻撃者が任意のサイトを偽装し、データを盗むことができます。

---

### **暗号化アルゴリズム**
HTTPSの暗号化は、**非対称**と**対称**暗号化の組み合わせに依存しています：

1. **非対称暗号化**（ハンドシェイク中）：
   - **公開鍵**（公開されている）と**秘密鍵**（サーバーが秘密に保持）を使用します。
   - ブラウザはサーバーの公開鍵でプリマスターシークレットを暗号化します。秘密鍵を持つサーバーだけがそれを復号化できます。
   - 例：RSAまたは楕円曲線暗号化（ECC）。

2. **対称暗号化**（セッション中）：
   - セッションキーが作成されると、両方の側がそれを使用してデータを暗号化および復号化します。
   - これは非対称暗号化よりも速く、大量のデータ転送に適しています。
   - 例：AES（高度暗号化標準）。

ハンドシェイクは非対称暗号化を使用してセッションキーを安全に共有し、その後対称暗号化が効率を高めるために引き継ぎます。

---

### **TLS 1.2とTLS 1.3の違い**
**TLS 1.2**と**TLS 1.3**はTLSプロトコルのバージョンで、TLS 1.3が新しく改良されたバージョンです。以下に主要な違いを示します：

| **機能**              | **TLS 1.2**                              | **TLS 1.3**                              |
|---------------------------|------------------------------------------|------------------------------------------|
| **ハンドシェイクの速度**       | クライアントとサーバー間の複数の往復で遅延が発生します。 | 往復が少なく、通常は1回で、再接続時には「0-RTT」で即座にデータを送信できます。 |
| **暗号スイート**         | 古い、より安全でない暗号化アルゴリズム（例：SHA-1）をサポートします。 | 古い暗号スイートを削除し、現代的で安全なもの（例：AES-GCM）のみを使用します。 |
| **プライバシー**               | ハンドシェイクデータ（証明書など）は平文で送信されます。 | ハンドシェイクのほとんどが暗号化され、詳細が盗聴者から隠されます。 |
| **0-RTT再開**      | 利用できません。                           | 再接続時に即座にデータを送信できますが、適切に保護されていない場合はリプレイ攻撃のリスクがあります。 |
| **セキュリティ**              | 古い機能のために特定の攻撃に脆弱です。 | 設計上強力で、弱いオプションを削除します。 |

要するに、TLS 1.3は**速く**、**より安全で**、**よりプライベート**なため、現代のHTTPSの標準です。

---

### **全体をまとめる**
HTTPSはウェブ通信を以下のようにセキュアにします：
1. **TLSハンドシェイク**を使用して暗号化された接続を設定します。
2. **信頼できるCA**からの**SSL証明書**を使用してサーバーのアイデンティティを検証します。
3. **非対称暗号化**（ハンドシェイク用）と**対称暗号化**（データ転送用）を組み合わせてデータを保護します。
4. **TLS 1.3**などのプロトコルで進化し、TLS 1.2よりも速く、安全で、プライベートです。

これがHTTPSがブラウジングを安全に保つ基本的な仕組みです！どの部分について詳しく知りたいですか？