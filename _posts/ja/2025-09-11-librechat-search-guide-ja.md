---
audio: false
date: 2025-09-11
generated: true
image: false
lang: ja
layout: post
model: mistralai/mistral-medium-3.1
title: LibreChat検索機能ガイド
translated: true
type: note
---

**LibreChat v0.8.0-rc3** における**検索機能**の仕組み（会話検索とフォーク機能との違いを含む）は以下の通りです：

---

### **1. LibreChat での検索方法**
LibreChat では**主に2つの検索方法**を提供しています：
#### **A. グローバル検索 (すべての会話を横断)**
- **場所**: サイドバー上部の検索バー。
- **検索対象**:
  - 会話の**タイトル**（自動生成またはカスタム）。
  - **メッセージ内容**（ユーザーのプロンプト + AIの応答）。
  - **メタデータ**（例：使用モデル、タイムスタンプ）。
- **仕組み**:
  - **MongoDB/PostgreSQL の全文検索**を使用（バックエンドに依存）。
  - 一致する会話/メッセージのリストを**スニペット付き**で返す。
  - 結果をクリックすると、その会話/メッセージにジャンプ。

#### **B. 会話内検索 (Ctrl+F の代替)**
- **場所**: 開いているチャット内（一部のバージョンでは**虫眼鏡アイコン**または `Ctrl+F` ショートカット）。
- **検索対象**:
  - **現在の会話のメッセージ**のみ。
  - チャットウィンドウ内で一致箇所をハイライト。

---

### **2. 検索とフォークの違い**

| 機能               | **検索**                          | **フォーク**                          |
|-----------------------|-------------------------------------|--------------------------------------|
| **目的**           | 過去のメッセージ/会話を見つける。   | ある時点から別の経路を作成する。|
| **出力**            | 一致した結果のリスト。                    | 新しい分岐した会話。          |
| **使用例**          | 「React フックについてどこで聞いたっけ？」| 「別のデバッグ方法を試してみよう。」|
| **永続性**       | 一時的（UIフィルター）。              | 永続的（DBに新しい会話として保存）。  |

---
### **3. 技術的詳細 (セルフホスター向け)**
#### **バックエンド (データベース検索)**
- **MongoDB**:
  - `messages.content` と `conversations.title` に対して `$text` 検索を使用。
  - [テキストインデックス](https://www.mongodb.com/docs/manual/core/index-text/)が必要（LibreChat は自動で設定）。
  - クエリ例：
    ```javascript
    db.messages.find({ $text: { $search: "React hooks" } })
    ```
- **PostgreSQL**:
  - `tsvector` 全文検索を使用。
  - 例：
    ```sql
    SELECT * FROM messages
    WHERE to_tsvector('english', content) @@ to_tsquery('React & hooks');
    ```

#### **フロントエンド (UI 検索)**
- **React ステート** + バックエンドへのデバウンスされた API 呼び出しによって駆動。
- 結果はドロップダウン/リストとしてレンダリング（Slack や Discord の検索に類似）。

---
### **4. 制限事項と回避策**
#### **既知の問題**
- **あいまい検索なし**: タイプミスがあると結果が見つからない可能性（厳密なキーワード一致）。
- **正規表現/構文サポートなし**: UI で `AND/OR` 演算子を使用できない（現時点では）。
- **大規模 DB では遅い**: 10,000+ メッセージがあると全文検索が遅延する可能性。

#### **回避策**
- **キーワードを使用**: ユニークな用語で検索（例：`"help"` ではなく `"error: ENOENT"`）。
- **モデルでフィルター**: 一部のバージョンでは、AI モデルで検索をフィルター可能（例：GPT-4 の会話のみ）。
- **エクスポートと grep**: 上級ユーザー向け：
  ```bash
  mongodump --db librechat --collection messages --query '{"userId": "YOUR_ID"}' --out=- | jq '.' | grep "React"
  ```

---
### **5. ChatGPT の検索との比較**

| 機能               | LibreChat                          | ChatGPT (Web)                     |
|-----------------------|------------------------------------|-----------------------------------|
| **範囲**             | すべての会話 + メッセージ。      | 現在のチャット履歴のみ。        |
| **演算子**         | 基本（キーワードのみ）。               | `AND`, `OR`, 引用符をサポート。     |
| **速度**             | DB に依存（遅い可能性）。      | 最適化済み（最近のチャットでは高速）。|
| **UI**                | サイドバー + チャット内。                  | 上部バーのみ。                     |
| **セルフホスティング**       | 可（インデックスを制御可能）。         | 不可（クローズドシステム）。               |

---
### **6. LibreChat の検索を改善する方法**
#### **ユーザー向け**
- **説明的なタイトルを使用**: 会話の名前を変更（例："New Chat" ではなく "Debugging Python Async 2024-05"）。
- **重要なメッセージをブックマーク**: 一部のバージョンでは重要なメッセージのピン留めをサポート。

#### **開発者/セルフホスター向け**
- **インデックスに重みを追加**: MongoDB で `content` よりも `title` を優先：
  ```javascript
  db.conversations.createIndex(
    { title: "text", "messages.content": "text" },
    { weights: { title: 10, "messages.content": 1 } }
  );
  ```
- **Meilisearch/Typesense を統合**: より高速なあいまい検索のため（コミュニティプラグインが存在）。
- **ページネーションを有効化**: 大規模な結果セット向け（プルリクエスト歓迎！）。

---
### **7. ワークフローの例**
1. **過去のデバッグセッションを見つける**:
   - `"TypeError: cannot read property"` を検索 → LibreChat がそのエラーを含むすべてのチャットを表示。
   - 結果をクリック → 正確なメッセージにジャンプ。

2. **解決策からフォークする**:
   - 見つかった会話で、AI が修正を提案したメッセージでフォーク。
   - 元の会話を失うことなく、フォークで新しいアプローチをテスト。

---
### **8. 将来の計画 (今後のバージョンで可能性)**
- **セマンティック検索**: 埋め込みを使用して（例：`sentence-transformers` 経由）関連するコンテンツを見つける。
- **検索の保存**: 頻繁なクエリをブックマーク（例：「すべての Python バグ」）。
- **会話横断的な洞察**: 「Docker ネットワーキングについて尋ねたすべての箇所を表示」。

---
### **さらに情報が必要ですか？**
- **検索が動作しない場合のトラブルシューティング？**
  DB ログでインデックスエラーを確認するか、以下を実行：
  ```bash
  # MongoDB の場合
  db.messages.getIndexes();
  db.conversations.getIndexes();
  ```
- **貢献したいですか？**
  検索ロジックは以下にあります：
  - バックエンド: [`src/server/db`](https://github.com/danny-avila/LibreChat/tree/dev/src/server/db)
  - フロントエンド: [`src/components/Chat/Sidebar`](https://github.com/danny-avila/LibreChat/tree/dev/src/components/Chat/Sidebar)