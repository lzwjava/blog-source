---
audio: false
generated: true
lang: ja
layout: post
title: 包括的なCronガイド
translated: true
type: note
---

Cronは、Unix系オペレーティングシステムにおける強力な時間ベースのジョブスケジューラで、ユーザーが指定した時間や間隔でコマンドやスクリプトを自動的に実行できるようにします。以下は、cronを効果的に理解し使用するための完全ガイドです。

## Cronとは？

Cronは、スケジュールされたコマンドを実行するデーモン（バックグラウンドサービス）です。特定のコマンドをいつ実行するかを決定するために「crontab」（cronテーブル）と呼ばれる設定ファイルを読み込みます。Cronは以下の用途に最適です：
- 定期的なシステムメンテナンス
- 自動化されたバックアップ
- 定期的なデータ処理のスケジューリング
- 特定の時間にスクリプトを実行
- 手動介入なしで定期的に実行する必要がある任意のタスク

## Cronの構成要素

### Crontabファイル

Crontab（cronテーブル）は、定期的に実行するシェルコマンドを指定する設定ファイルです。各ユーザーは独自のcrontabを持つことができ、システム全体のcrontabも存在します。

個人のcrontabを編集するには：
```bash
crontab -e
```

現在のcrontabを表示するには：
```bash
crontab -l
```

crontabを削除するには：
```bash
crontab -r
```

### Crontabの構文

crontabファイルの各行はスケジュールされたジョブを表し、次の形式に従います：

```
* * * * * command-to-execute
│ │ │ │ │
│ │ │ │ └─── 曜日 (0-6, 日曜日=0)
│ │ │ └───── 月 (1-12)
│ │ └─────── 日 (1-31)
│ └───────── 時 (0-23)
└─────────── 分 (0-59)
```

各位置には以下を含めることができます：
- 特定の数値
- 範囲（例：`1-5`）
- 値のリスト（例：`1,3,5`）
- アスタリスク（`*`）「毎」
- ステップ値（`*/n`）「n毎」

5つの時間/日付フィールドの後に実行するコマンドが続きます。

## 一般的なCronスケジュール例

# 一般的なCronスケジュール例

## 基本的な時間間隔

| Cron式 | 説明 | 例 |
|----------------|-------------|---------|
| `* * * * *` | 毎分実行 | `* * * * * date >> /tmp/date_log.txt` |
| `*/5 * * * *` | 5分毎に実行 | `*/5 * * * * /scripts/check_server.sh` |
| `0 * * * *` | 毎時0分に実行 | `0 * * * * /scripts/hourly_backup.sh` |
| `0 0 * * *` | 毎日深夜0時に実行 | `0 0 * * * /scripts/daily_backup.sh` |
| `0 0 * * 0` | 日曜日の深夜0時に実行 | `0 0 * * 0 /scripts/weekly_maintenance.sh` |
| `0 0 1 * *` | 毎月1日の深夜0時に実行 | `0 0 1 * * /scripts/monthly_report.sh` |
| `0 0 1 1 *` | 1月1日の深夜0時に実行（毎年） | `0 0 1 1 * /scripts/yearly_cleanup.sh` |

## 特定の時間

| Cron式 | 説明 | 例 |
|----------------|-------------|---------|
| `30 8 * * 1-5` | 平日（月曜日-金曜日）の8時30分に実行 | `30 8 * * 1-5 /scripts/workday_start.sh` |
| `0 18 * * 1-5` | 平日の18時00分に実行 | `0 18 * * 1-5 /scripts/workday_end.sh` |
| `0 9-17 * * *` | 営業時間中（9時-17時）の毎時0分に実行 | `0 9-17 * * * /scripts/hourly_check.sh` |
| `0 0,12 * * *` | 深夜0時と正午に実行 | `0 0,12 * * * /scripts/twice_daily.sh` |

## 複数の時間指定

| Cron式 | 説明 | 例 |
|----------------|-------------|---------|
| `0 */4 * * *` | 4時間毎に実行 | `0 */4 * * * /scripts/periodic_task.sh` |
| `0 4,16 * * *` | 4時00分と16時00分に実行 | `0 4,16 * * * /scripts/twice_daily_at_4.sh` |
| `15,45 * * * *` | 毎時15分と45分に実行 | `15,45 * * * * /scripts/quarter_hourly.sh` |

## 特別な時間指定

| Cron式 | 説明 | 例 |
|----------------|-------------|---------|
| `@reboot` | 起動時に1回実行 | `@reboot /scripts/startup_task.sh` |
| `@yearly` または `@annually` | 年に1回実行（`0 0 1 1 *`と同等） | `@yearly /scripts/annual_task.sh` |
| `@monthly` | 月に1回実行（`0 0 1 * *`と同等） | `@monthly /scripts/monthly_task.sh` |
| `@weekly` | 週に1回実行（`0 0 * * 0`と同等） | `@weekly /scripts/weekly_task.sh` |
| `@daily` または `@midnight` | 日に1回実行（`0 0 * * *`と同等） | `@daily /scripts/daily_task.sh` |
| `@hourly` | 時間に1回実行（`0 * * * *`と同等） | `@hourly /scripts/hourly_task.sh` |

## 複雑な例

| Cron式 | 説明 | 例 |
|----------------|-------------|---------|
| `0 0 */2 * *` | 1日おきの深夜0時に実行 | `0 0 */2 * * /scripts/every_other_day.sh` |
| `0 3 * * 1,3,5` | 月曜日、水曜日、金曜日の3時00分に実行 | `0 3 * * 1,3,5 /scripts/mwf_task.sh` |
| `30 23 * * 2,4` | 火曜日と木曜日の23時30分に実行 | `30 23 * * 2,4 /scripts/tue_thu_night.sh` |
| `45 11 1-7 * *` | 毎月第1週の11時45分に実行 | `45 11 1-7 * * /scripts/first_week_task.sh` |
| `0 20 * 10,11,12 *` | 10月、11月、12月の20時00分に実行 | `0 20 * 10,11,12 * /scripts/q4_evening_task.sh` |
| `0 9-17/2 * * 1-5` | 平日の営業時間中に2時間毎に実行 | `0 9-17/2 * * 1-5 /scripts/biweekly_workday.sh` |


## 特別なCron文字列

Cronは一般的な時間指定のためのいくつかの特別な文字列もサポートしています：

- `@reboot`: 起動時に1回実行
- `@yearly` または `@annually`: 年に1回実行（`0 0 1 1 *`と同等）
- `@monthly`: 月に1回実行（`0 0 1 * *`と同等）
- `@weekly`: 週に1回実行（`0 0 * * 0`と同等）
- `@daily` または `@midnight`: 日に1回実行（`0 0 * * *`と同等）
- `@hourly`: 時間に1回実行（`0 * * * *`と同等）

## 出力とエラーの処理

デフォルトでは、cronはコマンドの出力をcrontabを所有するユーザーにメールで送信します。出力をファイルにリダイレクトしたり破棄したりできます：

```bash
# 出力をログファイルに追記
30 5 * * * /path/to/script.sh >> /path/to/logfile.log 2>&1

# すべての出力を破棄
0 12 * * * /path/to/script.sh > /dev/null 2>&1
```

## Cronでの環境変数

Cronジョブは最小限の環境で実行されるため、スクリプトが失敗することがあります。crontabファイルで変数を設定できます：

```bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
SHELL=/bin/bash
MAILTO=your-email@example.com

# ジョブはこれらの環境変数を使用するようになります
0 5 * * * /path/to/script.sh
```

## Cronのセキュリティ考慮事項

1. すべてのコマンドとスクリプトに絶対パスを使用する
2. crontabファイルの権限を制限する
3. cronジョブの設定時に最小権限の原則を使用する
4. デバッグのためにcronジョブの出力をログに記録し監視する
5. 機密性の高いcronジョブには専用ユーザーを使用することを検討する

## Cronジョブのトラブルシューティング

Cronジョブの一般的な問題：

1. **ジョブが実行されない**: 権限とパスを確認する
2. **タイミングの問題**: 時間形式が正しいことを確認する
3. **環境の問題**: 必要な変数が設定されていることを確認する
4. **スクリプトエラー**: 最初にスクリプトを手動でテストする

cron関連のメッセージについてシステムログを確認：
```bash
grep CRON /var/log/syslog
```

## Cronの代替手段

Cronが広く使われていますが、代替手段もあります：

- **Anacron**: 24時間365日実行されていないシステムに適している
- **Systemd Timers**: systemdベースのシステムでの現代的代替手段
- **Fcron**: anacronのような機能を持つ拡張cron
- **Schedule**: Webアプリケーションでよく使用される高レベルジョブスケジューラ

## 高度なCronの使用法

### 異なるユーザーとしてジョブを実行

他のユーザーのcrontabを編集するには（root権限が必要）：
```bash
sudo crontab -u username -e
```

### システム全体のCrontab

システム全体のcronジョブは以下に追加できます：
- `/etc/crontab`
- `/etc/cron.d/`内のファイル
- `/etc/cron.daily/`、`/etc/cron.hourly/`などのディレクトリ

システムcrontabの構文には追加のユーザーフィールドが含まれます：
```
* * * * * user command-to-execute
```

### 特定の環境でCronジョブを実行

実際のコマンドを実行する前に環境を設定するラッパースクリプトを作成：

```bash
#!/bin/bash
source /home/user/.profile
cd /path/to/working/directory
/path/to/actual/command
```

そして、このラッパースクリプトをcronから呼び出します。

## Cronジョブのベストプラクティス

1. **cronジョブを文書化する**: 各ジョブの機能を説明するコメントを追加する
2. **説明的なスクリプト名を使用する**: メンテナンスを容易にする
3. **出力をログに記録する**: トラブルシューティングのためにジョブの出力を保存する
4. **ジョブ実行を監視する**: 重要なジョブの監視を実装する
5. **失敗を適切に処理する**: スクリプトにエラー処理を追加する
6. **ロックファイルを使用する**: 予想以上に時間がかかる場合の重複実行を防ぐ
7. **タイムゾーンを考慮する**: システムのタイムゾーン設定に注意する

このガイドに従うことで、Unix系システムでcronジョブを効果的に設定、管理、トラブルシューティングできるようになります。