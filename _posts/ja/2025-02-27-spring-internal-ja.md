---
audio: false
lang: ja
layout: post
title: 春の内部作用
translated: true
---

Springの内部動作について詳しく説明します。Springは、Javaアプリケーションを構築するための強力なフレームワークであり、各部分の質問に対してステップバイステップで明確な説明を提供します。

### Springの動作原理
Springは、**制御の逆転（IoC）**の原理に基づいて動作します。これは、アプリケーションコードがオブジェクトの作成と管理を制御するのではなく、Springがその役割を担うことを意味します。これは、**IoCコンテナ**と呼ばれるコンポーネントを通じて行われます。IoCコンテナは以下の責任を持ちます：

- **オブジェクト（Springではビーンと呼ばれます）のインスタンス化**。
- **設定**を基にそのオブジェクトを構成。
- **依存関係を管理**してオブジェクトを組み立てる。

このアプローチにより、コードの緊密な結合が減少し、モジュール化されやすく、保守が容易になります。

### Springがビーンを管理する方法
Springでは、**ビーン**はIoCコンテナによって管理されるオブジェクトです。以下のようにSpringがビーンを扱います：

1. **定義**：ビーンは以下のいずれかで定義します：
   - **XML設定ファイル**。
   - **Javaベースの設定**で、アノテーション `@Bean`、`@Component`、`@Service`などを使用。
2. **作成**：アプリケーションが開始すると、IoCコンテナはこれらの定義を読み取り、ビーンを作成します。
3. **依存関係の注入（DI）**：Springは、必要な場所で他のビーン（依存関係）を自動的にビーンに注入します。以下の方法を使用します：
   - **コンストラクタ注入**。
   - **セッター注入**。
   - **フィールド注入**（`@Autowired`を使用）。

コンテナはこれらのビーンのライフサイクル全体を管理し、必要なときに利用可能であることを保証します。

### サービスとコントローラの違い
**Spring MVC**（SpringのWebフレームワーク）の文脈では、これらの2つのコンポーネントは異なる目的を果たします：

- **コントローラ**：
  - ユーザーからの**HTTPリクエスト**を処理。
  - 入力を処理し、ビジネスロジックを呼び出し、どの**ビュー**（例えば、ウェブページ）を返すかを決定。
  - `@Controller`または`@RestController`でアノテート。
  - **Web層**に存在。

- **サービス**：
  - アプリケーションの**ビジネスロジック**をカプセル化。
  - 計算、データ処理、データベースとの相互作用などのタスクを実行。
  - `@Service`でアノテート。
  - **ビジネス層**に存在。

**例**：
- コントローラは、ユーザープロファイルを表示するリクエストを受け取り、サービスを呼び出してユーザーデータを取得するかもしれません。
- サービスはデータベースからデータを取得し、それをコントローラに返し、コントローラはそれをビューに送信します。

要するに、**コントローラはWebの相互作用を管理し**、**サービスはコア機能を処理します**。

### Springが提供するもの
Springは、企業向けアプリケーションのための幅広いツールを提供する包括的なフレームワークです。主要な機能は以下の通りです：

- **依存関係の注入**：オブジェクトの依存関係を管理するのを簡単にします。
- **アスペクト指向プログラミング（AOP）**：ロギングやセキュリティなどの横断的な関心事を追加。
- **トランザクション管理**：操作間のデータ整合性を保証。
- **Spring MVC**：強力なWebアプリケーションを構築。
- **Spring Boot**：事前設定されたデフォルトと埋め込みサーバーでセットアップを簡素化。
- **Spring Data**：データベースアクセスを簡素化。
- **セキュリティ**：認証と認可ツールを提供。

Springのモジュール設計により、必要な機能だけを選択できます。

### Springがオブジェクトやビーンを探す方法
Springアプリケーションが開始すると：

1. **IoCコンテナ**が初期化。
2. **ビーン定義**を以下の場所でスキャン：
   - XMLファイル。
   - アノテーション付きクラス（例：`@Component`、`@Bean`）。
3. コンテナはビーンを作成し、名前または型でインデックス付きの**マップ**に格納。
4. ビーンが必要な場合（例：注入または直接取得）コンテナは以下の方法で提供：
   - **名前による検索**。
   - **型による検索**（例：`@Autowired`を使用）。

このプロセスにより、ビーンがアプリケーション全体で利用可能になります。

### TomcatまたはNettyをサーバーとして使用する方法
Spring Bootは、サーバーを直接アプリケーションに埋め込むことで、サーバーのセットアップを簡素化します。以下のように**Tomcat**と**Netty**で動作します：

- **Tomcat**（サーブレットベース）：
  - Spring Bootの`spring-boot-starter-web`依存関係のデフォルトサーバー。
  - `pom.xml`に以下を追加：
    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    ```
  - Spring BootはTomcatを埋め込み、アプリはスタンドアロン実行可能なJARとして実行。

- **Netty**（サーブレット非対応）：
  - 反応型Webアプリケーション（例：Spring WebFlux）で使用。
  - Tomcatを排除し、Nettyを追加：
    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
    ```
  - Spring BootはNettyを埋め込み、非同期、非ブロッキングI/Oをサポート。

サーバーは`application.properties`で設定（例：ポートを`server.port=8080`で設定）。外部サーバーのデプロイは不要で、Spring Bootが全てを処理します。

### まとめ
- **Springのコア**：IoCコンテナを使用してオブジェクトを管理。
- **ビーン管理**：XMLまたはアノテーションで定義し、依存関係を自動的に注入。
- **サービス対コントローラ**：サービスはビジネスロジックを処理し、コントローラはWebリクエストを管理。
- **機能**：DI、AOP、Webサポートなどを提供。
- **ビーンの検索**：コンテナが設定からビーンを見つけて提供。
- **サーバー**：Spring Bootは依存関係の変更でTomcatまたはNettyを埋め込む。