---
audio: false
generated: true
lang: ja
layout: post
title: クラウドフレアにおけるRustの影響
translated: true
type: note
---

CloudflareがRustを採用したことは、パフォーマンス、安全性、スケーラビリティの独自の組み合わせによって、革新的な変化をもたらしました。以下に、CloudflareがRustを選択した理由と、それによってもたらされた具体的な成果を詳細に説明します：

---

### **CloudflareがRustを使用する理由**
1. **パフォーマンスを損なわないメモリ安全性**
   - Rustの所有権モデルは、C/C++コードを悩ませる脆弱性の全クラス（例：バッファオーバーフロー、use-after-freeエラー）を排除し、Cloudflareのセキュリティファーストのインフラにとって極めて重要でした。
   - ガベージコレクションのある言語とは異なり、Rustはランタイムオーバーヘッドなしでこれを実現し、プロキシやエッジコンピューティングなどの高性能システムに理想的です。

2. **並行性とスケーラビリティ**
   - Rustの非同期ランタイム（Tokio）は、数百万の同時接続を効率的に処理し、NGINXのスレッド毎リクエストモデルを凌駕します。例えば、CloudflareのRustベースのプロキシであるPingoraは、**毎秒3500万以上のリクエスト**を、より低いCPU/メモリ使用率で処理します。
   - Workers内での非同期サポート（`wasm-bindgen-futures`経由）により、RustベースのWorkerがI/Oバウンドなタスクをシームレスに処理できます。

3. **パフォーマンス向上**
   - CloudflareのRust駆動のQUIC/HTTP/3スタックは、以前のC++版よりも**30%高速**で、同じハードウェア上で**メモリ使用量が35%低く**、**スループットが50%向上**しています。
   - Rustでのマイクロ最適化（例：リクエスト毎のレイテンシをマイクロ秒単位で削減）は、Cloudflareの規模では計算コストを数千単位で節約します。

4. **開発者の生産性**
   - Rustの強力な型システムとモダンなツーリング（例：Cargo）は、保守を簡素化しバグを削減します。例えば、CloudflareのプロキシフレームワークであるOxyでは、機能豊富なアプリケーションを**200行未満のコード**で構築できます。
   - WorkersのRust SDK（`workers-rs`）は、KV、Durable Objects、AI用のエルゴノミックなAPIを提供し、迅速な開発を可能にします。

5. **エコシステムと将来性**
   - Rustの採用の広がり（例：AWS Lambda、Discord）は、Cloudflareの長期的なビジョンと一致しています。PingoraやOxyのようなプロジェクトをオープンソース化することは、コミュニティとの協力を促進します。

---

### **Rust使用の成果**
- **Pingora**: NGINXを置き換え、毎月何兆ものリクエストを、**より低いレイテンシ**と**より強力なDDoS耐性**で処理しています。
- **Workers**: Rustサポートにより、AI推論などの計算負荷の高いタスクをネイティブに近い速度で実行可能にし、フィンテックやデリバリープラットフォームなどの大手クライアントを惹きつけています。
- **信頼性**: Rustの安全性機能により、QUICやTLSなどの重要なサービス（例：OxyでのBoringSSL統合）におけるクラッシュが減少しました。
- **コスト削減**: Pingoraでの最適化により、グローバルで**500以上のCPU**を節約し、運用コストを大幅に削減しました。

---

### **課題と対策**
- **学習曲線**: Rustの複雑さには初期のトレーニングが必要でしたが、Cloudflareは内部ライブラリ（例：`workers-rs`）やテンプレートを用いてこれを緩和しました。
- **Wasmの制限**: 初期のWorkers Rustサポートにはサイズ制約がありましたが、`wasm-opt`や`worker-build`などのツールにより、バイナリは効果的に最適化されるようになりました。

---

### **今後の方向性**
CloudflareはRustの役割を拡大し続けており、以下を含みます：
- **コンテナ**: RustベースのDurable Objectsが新しいコンテナオーケストレーションを支えます（2025年6月ローンチ予定）。
- **AI**: Workers AIは、低レイテンシのモデル推論にRustを活用します。

要約すると、RustはCloudflareのインフラの基盤となり、コストを削減しながら**安全性、パフォーマンス、スケーラビリティ**を提供しています。その採用は、重要なシステムにおけるメモリ安全な言語への業界全体のシフトを示唆しています。