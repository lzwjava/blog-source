---
audio: false
generated: true
lang: ja
layout: post
title: JMeterマスタリング：パフォーマンステスト
translated: true
type: note
---

Apache JMeterは、主にパフォーマンステスト向けに設計された強力なオープンソースツールですが、機能テストにも使用できます。Webアプリケーション、API、データベースなどのパフォーマンステストに広く利用されており、複数ユーザーをシミュレートし、負荷下でのシステムの応答を計測します。以下では、インストールから基本的なテストの実行、結果の分析まで、JMeterを効果的に使用するためのステップバイステップガイドを紹介します。

---

## ステップ1: JMeterのインストール
JMeterを使用する前に、マシンにインストールする必要があります。手順は以下の通りです：

1. **前提条件**:  
   JMeterはJavaベースのアプリケーションであるため、Java Development Kit（JDK）またはJava Runtime Environment（JRE）がインストールされている必要があります。バージョン8以上を推奨します。ターミナルまたはコマンドプロンプトで`java -version`を実行して確認できます。Javaがインストールされていない場合は、[公式Javaウェブサイト](https://www.java.com)からダウンロードしてインストールしてください。

2. **JMeterのダウンロード**:  
   [Apache JMeterウェブサイト](https://jmeter.apache.org/download_jmeter.cgi)にアクセスし、最新のバイナリリリース（通常は`.zip`または`.tgz`ファイル）をダウンロードします。

3. **ファイルの展開**:  
   ダウンロードしたファイルを任意のディレクトリ（例：Windowsでは`C:\JMeter`、Unixベースのシステムでは`~/JMeter`）に解凍します。展開されたフォルダには、JMeterを実行するために必要なすべてのファイルが含まれています。

4. **JMeterの起動**:  
   - 展開されたディレクトリ内の`bin`フォルダに移動します（例：`C:\JMeter\apache-jmeter-5.x\bin`）。
   - 適切な実行ファイルを実行します：
     - **Windows**: `jmeter.bat`をダブルクリックするか、コマンドプロンプトから実行します。
     - **Unix/Linux/macOS**: ターミナルで`./jmeter.sh`を実行します。
   - これによりJMeterのグラフィカルユーザーインターフェース（GUI）が開き、テストプランを作成および管理できます。

---

## ステップ2: テストプランの作成
JMeterにおける**テストプラン**は、何をテストするか、どのようにテストするかを定義します。パフォーマンステストの設計図です。基本的なテストプランの設定方法は以下の通りです：

### スレッドグループの追加
1. JMeter GUIで、左ペインの**テストプラン**ノードを右クリックし、**追加 > スレッド（ユーザー） > スレッドグループ**を選択します。
2. スレッドグループを設定します：
   - **Number of Threads (Users)**: シミュレートする仮想ユーザー数（例：10）。
   - **Ramp-Up Period (seconds)**: すべてのスレッドを開始するまでの時間（例：10秒の場合、10スレッドに対して1秒あたり1スレッドが開始されます）。
   - **Loop Count**: 各スレッドがテストを繰り返す回数（例：1回の実行の場合は1、継続的なループの場合は「Forever」をチェック）。

スレッドグループはユーザートラフィックをシミュレートします。例えば、10スレッド、10秒のランプアップ、1ループの場合、10人のユーザーが10秒間にわたってアプリケーションにアクセスし、各ユーザーがテストを1回実行します。

### サンプラーの追加
サンプラーは、JMeterが対象システムに送信するリクエストを定義します。Webテストでは、HTTPリクエストサンプラーが最も一般的です：
1. スレッドグループを右クリックし、**追加 > サンプラー > HTTPリクエスト**を選択します。
2. HTTPリクエストを設定します：
   - **Protocol**: `http`または`https`。
   - **Server Name or IP**: 対象システムのドメインまたはIP（例：`example.com`）。
   - **Port Number**: 通常はHTTPの場合は`80`、HTTPSの場合は`443`（標準の場合は空白のまま）。
   - **Method**: リクエストタイプに応じて`GET`、`POST`など。
   - **Path**: 特定のエンドポイントまたはページ（例：ホームページの場合は`/`）。
   - 必要に応じてパラメータまたはリクエストボディを追加します（例：POSTリクエストの場合）。

このサンプラーは、各仮想ユーザーが実行するアクションをJMeterに指示します。

### リスナーの追加
リスナーはテスト結果を収集し表示します：
1. スレッドグループを右クリックし、**追加 > リスナー > 結果ツリー**（または**サマリーレポート**などの他のリスナー）を選択します。
2. **結果ツリー**は、各リクエストの詳細な結果（応答時間、ステータスコード、応答データなど）を表示します。

リスナーは、テスト中のアプリケーションのパフォーマンスを分析するために不可欠です。

### テストプランの保存
**ファイル > テストプラン另名で保存**をクリックし、`.jmx`ファイル（例：`mytest.jmx`）を保存します。これにより、後で再利用または修正できます。

---

## ステップ3: テストの実行
テストを実行するには：
1. JMeter GUIで、ツールバーの緑色の**再生**ボタン（▶）をクリックするか、**実行 > 開始**を選択します。
2. JMeterはスレッドグループで定義されたユーザーをシミュレートし、設定されたHTTPリクエストを送信します。
3. テストの実行中に、リスナー（例：結果ツリー）に結果が表示されるのを確認します。

小規模なテストでは、GUI経由での実行が適しています。大規模なテストの場合は、以下の「高度な使用方法」セクションで非GUIモードを参照してください。

---

## ステップ4: 結果の分析
テスト完了後、リスナーを使用して結果を確認します：
- **結果ツリー**: 各リクエストの成功/失敗、応答時間、応答データを表示します。
- **サマリーレポート**: 平均応答時間、スループット（1秒あたりのリクエスト数）、エラー率などの集計メトリクスを提供します。

これらのメトリクスは、アプリケーションのパフォーマンス（例：負荷下での応答速度や、特定のユーザー数での障害の有無）を評価するのに役立ちます。

---

## 例: シンプルなWebページのテスト
`example.com`を10ユーザーでテストする例：
1. JMeterを起動します。
2. スレッドグループを追加：
   - スレッド数: 10
   - ランプアップ期間: 10秒
   - ループ数: 1
3. HTTPリクエストサンプラーを追加：
   - プロトコル: `http`
   - サーバー名: `example.com`
   - メソッド: `GET`
   - パス: `/`
4. 結果ツリーリスナーを追加。
5. テストを保存して実行。
6. 結果ツリーで応答時間とステータスコード（例：200 OK）を確認。

このシンプルなテストは、10人の同時ユーザーでの`example.com`のパフォーマンスを計測します。

---

## 高度な使用方法
より複雑なシナリオでは、JMeterは追加機能を提供します：

### パラメータ化
**CSV Data Set Config**を使用して、CSVファイルからテストに異なるデータ（例：ユーザー名、パスワード）を投入します：
1. スレッドグループに**設定要素 > CSV Data Set Config**を追加します。
2. ファイルパスと変数名（例：`${username}`）を指定し、これらの変数をHTTPリクエストで使用します。

### 相関関係
動的な値（例：セッションID、トークン）を処理します：
1. リクエスト後に**後処理プログラム > 正規表現抽出器**または**JSON抽出器**を追加します。
2. 値（例：トークン）を変数（例：`${token}`）に抽出します。
3. 後続のリクエスト（例：ヘッダーやパラメータ）で`${token}`を使用します。

### アサーション
応答を検証します：
1. サンプラーに**アサーション > 応答アサーション**を追加します。
2. 特定のテキスト、応答コード（例：200）、またはAPIテスト用にJSONPathを使用して確認します。

### 非GUIモード
大規模なテストや自動化の場合：
- コマンドラインからJMeterを実行：
  ```
  jmeter -n -t mytest.jmx -l results.jtl
  ```
  - `-n`: 非GUIモード。
  - `-t`: テストプランファイル。
  - `-l`: 結果ログファイル（例：`.jtl`）。
- HTMLレポートを生成：
  ```
  jmeter -n -t mytest.jmx -l results.jtl -e -o report_folder
  ```
  - `-e`: レポートを生成。
  - `-o`: HTMLレポートの出力フォルダ。

### 分散テスト
高負荷の場合：
1. 異なるマシンに複数のJMeterインスタンスを設定します。
2. マスターマシンの`jmeter.properties`ファイルにスレーブのIPを含めるように設定します。
3. マスターからテストを実行して負荷生成を調整します。

---

## 追加のヒント
- **サポートプロトコル**: HTTP以外に、JMeterはFTP、JDBC、JMSなどをサポートし、さまざまなシステムに対応できます。
- **サーバーモニタリング**: JMeterをサーバーサイドツール（例：PerfMon）と組み合わせて、テスト中のCPU、メモリ、データベースのパフォーマンスを監視します。
- **現実的なシミュレーション**: **HTTP Cookie Manager**、**HTTP Cache Manager**、または**Timers**を追加して、ブラウザの動作やユーザーの待機時間を模倣します。
- **機能テスト**: パフォーマンスだけでなく、アサーションを使用して応答の正確性を検証します。

---

## 結論
JMeterを使用するには：
1. Javaとともにインストールし、GUIを起動します。
2. スレッドグループ、サンプラー、リスナーを含むテストプランを作成します。
3. テスト要素（ユーザー、リクエストなど）を設定します。
4. テストを実行し、結果を分析します。

簡単な開始として、上記のように`example.com`などのWebページをテストします。経験を積むにつれて、パラメータ化、相関関係、分散テストなどの高度な機能を探索し、複雑な実世界のシナリオに対応します。JMeterの柔軟性と豊富なドキュメントは、初心者から上級テスターまでにとって貴重なツールです。