---
audio: false
generated: false
lang: ja
layout: post
title: 'JMeterのマスター: パフォーマンステスト'
translated: true
---

Apache JMeterは、主にパフォーマンステストのために設計された強力なオープンソースツールですが、機能テストにも使用できます。ウェブアプリケーション、API、データベース、その他のサービスのパフォーマンスをテストするために、複数のユーザーをシミュレートし、システムが負荷下でどのように応答するかを測定するために広く使用されています。以下は、インストールから基本的なテストの実行と結果の分析まで、JMeterを効果的に使用するためのステップバイステップガイドです。

---

## ステップ1: JMeterのインストール
JMeterを使用する前に、まずマシンにインストールする必要があります。以下のようにします：

1. **前提条件**:
   JMeterはJavaベースのアプリケーションなので、Java Development Kit (JDK) または Java Runtime Environment (JRE) がインストールされている必要があります。バージョン8以上が推奨されます。ターミナルまたはコマンドプロンプトで `java -version` を実行して確認できます。Javaがインストールされていない場合は、[公式Javaウェブサイト](https://www.java.com)からダウンロードしてインストールしてください。

2. **JMeterのダウンロード**:
   [Apache JMeterウェブサイト](https://jmeter.apache.org/download_jmeter.cgi)にアクセスし、最新のバイナリリリース（通常は `.zip` または `.tgz` ファイル）をダウンロードします。

3. **ファイルの展開**:
   ダウンロードしたファイルを好きなディレクトリに展開します（例：Windowsでは `C:\JMeter`、Unixベースのシステムでは `~/JMeter`）。展開されたフォルダには、JMeterを実行するために必要なすべてのファイルが含まれています。

4. **JMeterの起動**:
   - 展開されたディレクトリ内の `bin` フォルダに移動します（例：`C:\JMeter\apache-jmeter-5.x\bin`）。
   - 適切な実行ファイルを実行します：
     - **Windows**: `jmeter.bat` をダブルクリックするか、コマンドプロンプトから実行します。
     - **Unix/Linux/macOS**: ターミナルで `./jmeter.sh` を実行します。
   - これにより、JMeterのグラフィカルユーザーインターフェース（GUI）が開き、テストプランを作成および管理できます。

---

## ステップ2: テストプランの作成
JMeterの**テストプラン**は、テストの内容と方法を定義します。これは、パフォーマンステストの設計図です。以下のように基本的なテストプランを設定します：

### スレッドグループの追加
1. JMeter GUIで、左側のペインの **Test Plan** ノードを右クリックし、**Add > Threads (Users) > Thread Group** を選択します。
2. スレッドグループを設定します：
   - **Number of Threads (Users)**: シミュレートする仮想ユーザーの数（例：10）。
   - **Ramp-Up Period (seconds)**: JMeterがすべてのスレッドを開始する時間（例：10秒は1秒ごとに1スレッドが開始され、10スレッドが開始されます）。
   - **Loop Count**: 各スレッドがテストを繰り返す回数（例：1回の実行、または「Forever」をチェックして連続ループ）。

スレッドグループはユーザートラフィックをシミュレートします。例えば、10スレッドで10秒のランプアップと1回のループは、10ユーザーが10秒間にアプリケーションにアクセスし、各ユーザーが1回テストを実行することを意味します。

### サンプラーの追加
サンプラーは、JMeterがターゲットシステムに送信するリクエストを定義します。ウェブテストでは、最も一般的なものがHTTPリクエストサンプラーです：
1. スレッドグループを右クリックし、**Add > Sampler > HTTP Request** を選択します。
2. HTTPリクエストを設定します：
   - **Protocol**: `http` または `https`。
   - **Server Name or IP**: ターゲットシステムのドメインまたはIP（例：`example.com`）。
   - **Port Number**: 通常はHTTPの場合は `80`、HTTPSの場合は `443`（標準の場合は空白にしておく）。
   - **Method**: `GET`、`POST` など、リクエストの種類に応じて。
   - **Path**: 特定のエンドポイントまたはページ（例：ホームページの場合は `/`）。
   - 必要に応じてパラメータやリクエストボディを追加します（例：POSTリクエスト）。

このサンプラーは、各仮想ユーザーが実行するアクションをJMeterに指示します。

### リスナーの追加
リスナーはテスト結果を収集し表示します：
1. スレッドグループを右クリックし、**Add > Listener > View Results Tree**（または他のリスナーである **Summary Report**）を選択します。
2. **View Results Tree** は、各リクエストの詳細な結果を表示します。応答時間、ステータスコード、応答データなどが含まれます。

リスナーは、アプリケーションのテスト中のパフォーマンスを分析するために不可欠です。

### テストプランの保存
**File > Save Test Plan As** をクリックし、`.jmx` ファイル（例：`mytest.jmx`）として保存します。これにより、後で再利用または変更できます。

---

## ステップ3: テストの実行
テストを実行するには：
1. JMeter GUIで、ツールバーの緑の **Play** ボタン（▶）をクリックするか、**Run > Start** を選択します。
2. JMeterは、スレッドグループで定義されたユーザーをシミュレートし、設定されたHTTPリクエストを送信します。
3. テストが実行中に、リスナー（例：View Results Tree）に結果が表示されます。

小規模なテストでは、GUIを使用して実行するのが良いです。大規模なテストについては、以下の「高度な使用法」セクションで非GUIモードについて説明します。

---

## ステップ4: 結果の分析
テストが完了したら、リスナーを使用して結果を確認します：
- **View Results Tree**: 各リクエストの成功/失敗、応答時間、応答データを表示します。
- **Summary Report**: 平均応答時間、スループット（リクエスト/秒）、エラー率などの集計メトリクスを提供します。

これらのメトリクスを使用して、アプリケーションのパフォーマンスを評価できます（例：負荷下での応答速度や特定のユーザー数での失敗）。

---

## 例: 簡単なウェブページのテスト
`example.com` を10ユーザーでテストします：
1. JMeterを起動します。
2. スレッドグループを追加します：
   - スレッド: 10
   - ランプアップ: 10秒
   - ループカウント: 1
3. HTTPリクエストサンプラーを追加します：
   - プロトコル: `http`
   - サーバー名: `example.com`
   - メソッド: `GET`
   - パス: `/`
4. View Results Treeリスナーを追加します。
5. 保存してテストを実行します。
6. View Results Treeで応答時間とステータスコード（例：200 OK）を確認します。

この簡単なテストは、`example.com` が10人の同時ユーザーでどのように動作するかを測定します。

---

## 高度な使用法
より複雑なシナリオには、JMeterは追加の機能を提供します：

### パラメータ化
**CSV Data Set Config** を使用して、CSVファイルから異なるデータ（例：ユーザー名、パスワード）をテストに供給します：
1. スレッドグループに **Config Element > CSV Data Set Config** を追加します。
2. ファイルパスと変数名（例：`${username}`）を指定し、HTTPリクエストでこれらの変数を使用します。

### コレレーション
動的な値（例：セッションID、トークン）を処理します：
1. リクエストの後に **Post-Processor > Regular Expression Extractor** または **JSON Extractor** を追加します。
2. 値（例：トークン）を変数（例：`${token}`）に抽出します。
3. 後続のリクエストで `${token}` を使用します（例：ヘッダーまたはパラメータ）。

### アサーション
応答を検証します：
1. サンプラーに **Assertion > Response Assertion** を追加します。
2. 特定のテキスト、応答コード（例：200）、またはAPIテストにJSONPathを使用してチェックします。

### 非GUIモード
大規模なテストや自動化のため：
- コマンドラインからJMeterを実行します：
  ```
  jmeter -n -t mytest.jmx -l results.jtl
  ```
  - `-n`: 非GUIモード。
  - `-t`: テストプランファイル。
  - `-l`: 結果ログファイル（例：`.jtl`）。
- HTMLレポートを生成します：
  ```
  jmeter -n -t mytest.jmx -l results.jtl -e -o report_folder
  ```
  - `-e`: レポートを生成。
  - `-o`: HTMLレポートの出力フォルダ。

### 分散テスト
高負荷のため：
1. 異なるマシンに複数のJMeterインスタンスを設定します。
2. マスターマシンの `jmeter.properties` ファイルにスレーブIPを含めるように設定します。
3. マスターからテストを実行して負荷生成を調整します。

---

## 追加のヒント
- **サポートされるプロトコル**: HTTP以外にも、FTP、JDBC、JMSなどをサポートしており、さまざまなシステムに対応できます。
- **サーバーモニタリング**: JMeterをサーバーサイドツール（例：PerfMon）と組み合わせて、テスト中のCPU、メモリ、データベースのパフォーマンスを監視します。
- **リアルなシミュレーション**: **HTTP Cookie Manager**、**HTTP Cache Manager**、**Timers** を追加して、ブラウザの動作やユーザーの思考時間を模倣します。
- **機能テスト**: アサーションを使用して応答の正確性を検証し、パフォーマンスだけでなく機能も確認します。

---

## 結論
JMeterを使用するには：
1. JavaとGUIをインストールして起動します。
2. スレッドグループ、サンプラー、リスナーを含むテストプランを作成します。
3. テスト要素（ユーザー、リクエストなど）を設定します。
4. テストを実行し、結果を分析します。

簡単なスタートとして、上記のように `example.com` のウェブページをテストします。経験を積むにつれて、パラメータ化、コレレーション、分散テストなどの高度な機能を探索して、複雑なリアルなシナリオに対応します。JMeterの柔軟性と豊富なドキュメントは、初心者から高度なテスターまでにとって価値のあるツールです。