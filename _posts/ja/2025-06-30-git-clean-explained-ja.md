---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: Git Clean コマンドの解説
translated: true
type: note
---

### コマンドの機能
`git clean -f -d`（「clean clean」はタイプミスで `git clean` を意図したものと想定）は、Git ワーキングディレクトリから追跡されていないファイルとディレクトリを削除します。各フラグの意味は以下の通りです：
- `-f` (force): ファイルを実際に削除するために必須です。Git はデフォルトでは誤ったデータ損失を防ぐため、ファイルを削除しません。
- `-d` (directories): クリーンアップの対象をファイルだけでなく、追跡されていないディレクトリにも拡張します。

`-fd -f` と記述されていますが、これは `-f -d -f` を結合したものです。`-f` が2回出現していますが、冗長ではあるものの問題はありません。フラグは繰り返し指定しても問題なく動作します。別の意図があった場合は、詳細を説明してください！

### 動作の仕組み
Git clean は、リポジトリ自体ではなくワーキングツリー（ローカルのファイル）に対して動作します。その挙動をステップバイステップで説明します：

1. **ワーキングディレクトリのスキャン**: Git インデックスに含まれていない、またはどのコミットによっても追跡されていない「追跡されていない」アイテム（ファイルやディレクトリ）を特定します。例: `*.log` のような一時ファイル、ビルド成果物、削除されたブランチからの空ディレクトリなど。

2. **オプションの適用**:
   - `-f` なしの場合、削除される内容を表示するだけです（ドライランモード）。`-f` がある場合、実際に削除を実行します。
   - `-d` なしの場合、ディレクトリはスキップされます。`-d` がある場合、追跡されていないファイルを含む空のディレクトリ、または再帰的に空のディレクトリを削除します。
   - デフォルトでは `.gitignore` ファイルを尊重します：無視されたファイルは、`-x`（無視ルールから除外）または `-X`（無視されたファイルのみをクリーン）を追加しない限り、そのまま残ります。

3. **安全対策**: Git は `-f` が使用されていない場合に警告を表示します。明示的に指示されない限り、無視されたディレクトリ内のファイルは削除されません。変更をプレビューするには、まず `git clean --dry-run -f -d` を実行してください。

4. **使用例**:
   - 対話的にクリーンアップする場合: `git clean -i`（各アイテムごとにプロンプトが表示されます）。
   - 典型的なワークフロー: `git reset` の後、このコマンドを使用して最終コミットと完全に一致する状態にします。

### 注意点と検証
- **リスク**: ファイルの削除は、バックアップや `git reflog` がない限り元に戻せません。重要な作業は必ず最初にコミットしてください。
- **Git ドキュメントからの証拠**: 公式 Git ドキュメント（例: `man git-clean` または git-scm.com のドキュメント）はこれを確認しています：`-f` は削除を強制し、`-d` はディレクトリを含みます。これは `unlink` や `rmdir` のようなファイルシステム操作を使用しますが、追跡されたデータの破損を避けるため、追跡されていないアイテムに対してのみ実行されます。
- **テストのヒント**: モックリポジトリで追跡されていないファイルとディレクトリを作成し、コマンドを実行して出力とファイルシステムの変更を確認してください。

これが意図と一致しない場合は、より多くのコンテキストを提供してください！