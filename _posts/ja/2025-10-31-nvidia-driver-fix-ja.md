---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: NVIDIAドライバーバージョン不一致の修正
translated: true
type: note
---

### エラーの理解
`nvidia-smi` コマンドが失敗しているのは、NVIDIA カーネルドライバ（OS カーネルにロードされている）とユーザー空間の NVML（NVIDIA Management Library）コンポーネント間のバージョン不一致が原因です。これは、カーネルの更新、ドライバの部分的なインストール、またはドライバの完全な再インストールなしでのシステムアップグレード後に頻繁に発生します。報告されている NVML バージョン (535.274) は、比較的最近の NVIDIA ドライバブランチ (おそらく 535 シリーズ) を使用していることを示唆していますが、カーネルモジュールが一致していません。

心配ありません。データを失うことなく修正できます。以下に、最も簡単な方法から始まる、ステップバイステップのトラブルシューティングと解決手順を示します。

### 簡単な修正 (まずこれらを試してください)
1.  **システムの再起動**
    最も一般的な原因は、古いカーネルモジュールです。再起動するとすべてがクリーンに再ロードされます。
    ```
    sudo reboot
    ```
    再起動後、再度 `nvidia-smi` を実行してください。動作すれば完了です！

2.  **現在のドライバとカーネルのバージョンを確認する**
    インストールされているものを確認します：
    ```
    # カーネルドライバのバージョンを確認
    cat /proc/driver/nvidia/version

    # ロードされたカーネルモジュールを確認
    lsmod | grep nvidia

    # 現在のカーネルバージョンを確認
    uname -r
    ```
    ここで表示されるドライバのバージョンと 535.274 を比較してください。一致しない場合 (例: カーネルが 535.x を表示するが x が 274 でない場合) は、再インストールに進みます。

### 完全な解決: NVIDIA ドライバの再インストール
再起動で問題が解決しない場合は、ドライバを再インストールしてすべてを同期させます。これは Ubuntu/Debian を使用していることを想定しています (nanoGPT セットアップで一般的。Fedora などの他のディストリビューションの場合は調整してください)。

#### オプション 1: パッケージマネージャ経由 (安定性を求める場合に推奨)
1.  **既存のドライバをパージ** (不一致を削除):
    ```
    sudo apt update
    sudo apt purge 'nvidia*'
    sudo apt autoremove
    sudo rm -rf /usr/lib/nvidia*  # オプション: 残り物をクリーンアップ
    ```

2.  **モジュールをクリアするために再起動**:
    ```
    sudo reboot
    ```

3.  **一致するドライバをインストール**:
    NVML が 535.274 なので、535 シリーズ (または利用可能な場合は新しいもの) をインストールします。お使いの GPU については NVIDIA のサイトで確認してください。535 の場合:
    ```
    sudo apt install nvidia-driver-535 nvidia-utils-535
    ```
    (必要に応じて、お使いのディストリビューションのパッケージ名に置き換えてください。例: Fedora の `dnf`)

4.  **再起動して確認**:
    ```
    sudo reboot
    nvidia-smi  # これで動作するはず
    ```

#### オプション 2: NVIDIA から直接 (最新/カスタムバージョンの場合)
1.  [NVIDIA のアーカイブ](https://www.nvidia.com/Download/driverResults.aspx/227xxx/en-us/) から 535.274 の runfile をダウンロードします (お使いの GPU と 535.274 で検索)。
    ```
    wget https://us.download.nvidia.com/XFree86/Linux-x86_64/535.274.05/NVIDIA-Linux-x86_64-535.274.05.run
    chmod +x NVIDIA-Linux-x86_64-535.274.05.run
    ```

2.  **ディスプレイマネージャを停止** (コンソールに切り替え):
    ```
    sudo systemctl stop gdm  # または lightdm/sddm
    sudo telinit 3  # または Ctrl+Alt+F3 で TTY に切り替え
    ```

3.  **インストール**:
    ```
    sudo ./NVIDIA-Linux-x86_64-535.274.05.run --no-questions
    ```
    プロンプトに従います。不一致に関する警告が表示される場合がありますが、続行してください。

4.  **再起動**:
    ```
    sudo reboot
    ```

### 問題が解決しない場合
-   **セキュアブートが有効？** BIOS/UEFI で無効にしてください。署名されていないカーネルモジュールをブロックします。
-   **カーネルの不一致？** 最近カーネルを更新した場合は、GRUB 経由 (起動時に Shift キーを押し続ける) で古いカーネルで起動し、ドライバを再インストールしてください。
-   **ログを手がかりに**: `dmesg | grep nvidia` または `/var/log/Xorg.0.log` をチェックしてエラーを探してください。
-   **GPU 固有の問題？** `lspci | grep -i nvidia` を実行して、GPU が検出されていることを確認してください。

修正後、`nvidia-smi` で GPU 使用率、メモリなどが表示されるはずです。nanoGPT でモデルをトレーニングしている場合、これで CUDA のブロックが解除されます。詳細 (ディストリビューション、GPU モデル、バージョンチェックの出力など) を共有していただければ、さらに詳しくアドバイスできます！