---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: Gitチェリーピックの概要と使用方法
translated: true
type: note
---

### Git Cherry-Pickとは

Git cherry-pickは、特定のコミット（またはコミットのセット）からの変更を現在のブランチに適用し、それらの変更を含む新しいコミットを作成するコマンドです。ブランチ全体をマージせずに、特定の修正や機能を別のブランチから取り込みたい場合に便利です。すべての履歴を統合するマージとは異なり、cherry-pickは変更を選択的にコピーします。

### Git Cherry-Pickの内部動作

1. **コミットの選択**: 取り込みたい変更を含むコミットハッシュ（例: `git log` で検索）を指定します。

2. **変更の適用**: Gitはそのコミットからの差分（実際のコード変更）を取得し、可能な場合はGitの3-wayマージロジックを使用して、現在のブランチの作業ディレクトリに適用を試みます。

3. **新しいコミットの作成**: 成功した場合、以下の内容でブランチに新しいコミットが作成されます：
   - 元のコミットと同じ変更内容
   - 新しいコミットハッシュ（新規コミットのため）
   - 元のコミットを参照するコミットメッセージ（例: -xフラグを使用して "cherry picked from commit <hash>" を追加）

   マージコンフリクトが発生した場合（例: ターゲットブランチに互換性のない変更がある）、Gitは一時停止し、コミット前に手動で解決することを可能にします。

このプロセスは元のコミットの履歴を変更せず、単に変更をコピーします。この特性により、cherry-pickはバグ修正のバックポートや機能の選択的な適用に適しています。

### 基本的な使用手順

1. ターゲットブランチにいることを確認します（`git checkout <branch>` で切り替え）。
2. 必要なコミットハッシュを見つけます（例: `git log --oneline`）。
3. 実行: `git cherry-pick <commit-hash>`
   - 複数指定: `git cherry-pick <hash1> <hash2>`
   - `-n`（コミットせずステージングのみ）や `-x`（元のコミットを参照）などのオプションも使用可能。
4. コンフリクトが発生した場合、ファイルを編集し、`git add` でステージングした後、`git cherry-pick --continue` を実行します。
5. 途中で中止する場合: `git cherry-pick --abort`。

### 例

機能ブランチにコミット A -> B -> C があり、コミットBの変更をmainブランチにcherry-pickしたいとします。

- mainブランチで: `git checkout main`
- `git cherry-pick B` (Bを実際のハッシュに置き換え)

これにより、Bからの変更がmainブランチに新しいコミットDとして追加され、AやCは取り込まれません。元のコミットBは機能ブランチに残ります。

### 注意点とヒント

- マージコミット（複数の親を持つコミット）のcherry-pickは問題を引き起こす可能性があるため避けましょう。`git cherry-pick -m 1 <merge-commit>` を使用して親を指定できます。
- コミットのメタデータ（作者や日付など）は保持されませんが、`git cherry-pick --edit` でメッセージを修正できます。
- 連続した変更の場合、依存関係が欠落しないように、複数のコミットを順序通りにcherry-pickしてください。
- コンテキストが異なる場合、バグが混入する可能性があるため、cherry-pick後は必ずテストしてください。

詳細については、公式Gitドキュメントに包括的なガイダンスがあります: https://git-scm.com/docs/git-cherry-pick。特定の問題が発生した場合は、Gitログの出力を共有してください！