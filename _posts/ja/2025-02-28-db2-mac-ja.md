---
audio: false
lang: ja
layout: post
title: IBM Db2をmacOSで使用する
translated: true
---

IBM Db2をMacで使用するには、いくつかの設定が必要です。IBMはmacOS用のネイティブDb2サーバーインストールを提供していないためです。しかし、開発/テスト用にローカルのDb2インスタンスを実行したり、リモートのDb2データベースに接続したりするための実用的な方法があります。以下に、2025年2月28日現在の最も一般的で効果的なアプローチを示します。

---

### オプション1: Dockerを使用してmacOS上でDb2をローカルに実行する
Db2はmacOS上でネイティブサーバーとしてサポートされていないため、ローカルのDb2インスタンスを実行する最も簡単な方法はDockerを使用することです。これは、IntelベースのMacとAppleシリコン（M1/M2/M3）の両方で動作し、必要に応じてエミュレーションを利用します。

#### 手順:
1. **Dockerのインストール:**
   - [docker.com](https://www.docker.com/products/docker-desktop/)からDocker Desktop for Macをダウンロードし、インストールします。Mac（IntelまたはAppleシリコン）のインストール手順に従います。

2. **Db2コミュニティエディションイメージをプル:**
   - ターミナルを開き、以下を実行します:
     ```
     docker pull icr.io/db2_community/db2
     ```
   - これは、IBMのコンテナレジストリから公式のDb2コミュニティエディションコンテナイメージをプルします。

3. **Db2コンテナを実行:**
   - 次のコマンドでDb2インスタンスを開始します（必要に応じてカスタマイズしてください）：
     ```
     docker run -itd --name db2server --privileged=true -p 50000:50000 -e LICENSE=accept -e DB2INST1_PASSWORD=your_password -e DBNAME=testdb icr.io/db2_community/db2
     ```
     - 説明:
       - `-itd`: コンテナをインタラクティブ、デタッチモードで実行します。
       - `--name db2server`: コンテナに名前を付けます。
       - `--privileged=true`: Db2が正しく機能するために必要です。
       - `-p 50000:50000`: ポート50000（Db2のデフォルト）をMacにマッピングします。
       - `-e LICENSE=accept`: ライセンス契約を受諾します。
       - `-e DB2INST1_PASSWORD=your_password`: `db2inst1`ユーザーのパスワードを設定します（`your_password`を置き換えます）。
       - `-e DBNAME=testdb`: `testdb`という名前のデータベースを作成します。

4. **コンテナが実行されていることを確認:**
   - 次で確認します:
     ```
     docker ps
     ```
   - `db2server`がリストに表示されるはずです。

5. **Db2インスタンスにアクセス:**
   - コンテナのシェルに入力します:
     ```
     docker exec -ti db2server bash -c "su - db2inst1"
     ```
   - 中に入ったら、Db2コマンドを使用できます:
     ```
     db2 connect to testdb
     db2 "SELECT * FROM SYSIBM.SYSDUMMY1"
     ```

6. **AppleシリコンMac用の注意:**
   - Db2イメージはx86_64（Intel）用に構築されていますが、AppleシリコンのDocker DesktopはRosetta 2を使用してx86_64をエミュレートするため、シームレスに動作するはずです。パフォーマンスに問題がある場合は、Lima（オプション3）などの代替の仮想化ツールを検討してください。

---

### オプション2: IBM Data Server Driverを使用してリモートDb2データベースに接続する
ローカルのDb2サーバーが不要で、既存のリモートDb2データベース（サーバーまたはクラウド上）に接続したい場合は、MacにIBM Data Server Driver for ODBC and CLIをインストールできます。

#### 手順:
1. **ドライバーのダウンロード:**
   - Intel Mac: Db2 11.5ドライバー（x86_64）を使用します。
   - AppleシリコンMac: 2024年11月にリリースされたDb2 12.1ドライバー（ARM64）を使用します。
   - [IBM Support Fix Central](https://www.ibm.com/support/fixcentral/)から取得します。検索「IBM Data Server Driver for ODBC and CLI」し、適切なバージョンを選択します:
     - Intel: `macos64_odbc_cli.tar.gz`（11.5）。
     - Appleシリコン: 12.1 ARM64ドライバーパッケージ（例: `clidriver` for macOS ARM）を探します。

2. **ドライバーのインストール:**
   - ダウンロードしたファイルを展開します:
     ```
     tar -xzf macos64_odbc_cli.tar.gz
     ```
   - `/usr/local/db2_clidriver`などのディレクトリに移動します:
     ```
     mv clidriver /usr/local/db2_clidriver
     ```

3. **unixODBCの設定:**
   - Homebrewを使用してunixODBCがまだインストールされていない場合はインストールします:
     ```
     brew install unixodbc
     ```
   - ドライバーを登録するために`/usr/local/etc/odbcinst.ini`を編集します:
     ```
     [IBM DB2 ODBC DRIVER]
     Description = IBM DB2 ODBC Driver
     Driver = /usr/local/db2_clidriver/lib/libdb2.dylib
     ```

4. **接続の設定:**
   - `/usr/local/etc/odbc.ini`（またはユーザー固有の設定のための`~/.odbc.ini`）を作成または編集します:
     ```
     [MYDB2]
     Driver = IBM DB2 ODBC DRIVER
     Database = your_db_name
     Hostname = your_db_host
     Port = 50000
     Protocol = TCPIP
     UID = your_username
     PWD = your_password
     ```
   - `your_db_name`、`your_db_host`、`your_username`、`your_password`をリモートデータベースの詳細に置き換えます。

5. **接続のテスト:**
   - `isql`を使用して確認します:
     ```
     isql -v MYDB2
     ```
   - 成功すると、リモートDb2データベースに接続されます。

6. **アプリケーションとの使用:**
   - このODBC設定をPython（`pyodbc`）、Java（JDBC via ODBCブリッジ）、またはODBC互換アプリケーションなどのツールと一緒に使用できます。

---

### オプション3: Limaを使用した高度な設定（Appleシリコン最適化）
AppleシリコンユーザーがDockerのエミュレーションよりも高いパフォーマンスを求める場合、LimaはRosetta 2「Fast Mode」サポートを持つ軽量Linux VMを提供します。これはより複雑ですが、ネイティブなような体験を提供します。

#### 手順:
1. **LimaとPodmanのインストール:**
   - Homebrewがまだインストールされていない場合はインストールします:
     ```
     /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
     ```
   - LimaとPodmanをインストールします:
     ```
     brew install lima podman
     ```

2. **Lima VMの開始:**
   - Rosettaサポートを持つVMを起動します:
     ```
     limactl start --name=db2-vm --rosetta
     ```

3. **PodmanでDb2を実行:**
   - VM内でPodmanを使用してDb2コンテナを実行します（上記のDocker手順と同様）：
     ```
     podman run -itd --name db2server --privileged=true -p 50000:50000 -e LICENSE=accept -e DB2INST1_PASSWORD=your_password -e DBNAME=testdb icr.io/db2_community/db2
     ```

4. **macOSからのアクセス:**
   - Lima VMのIP（例: `192.168.5.15:50000`）を使用して、クライアントツールまたはODBCドライバーからDb2インスタンスに接続します。

---

### 追加のヒント
- **ライセンスの考慮事項:** Db2コミュニティエディションは開発とテスト用に無料です。製品用またはz/OSまたはiSeries上のDb2に接続する場合は、Db2 Connectライセンスが必要になるかもしれません。
- **パフォーマンス:** Appleシリコンではエミュレーションが動作しますが、速度が遅くなることがあります。ネイティブARM64サポート（Db2 12.1ドライバー）は現在、クライアントのみに限られています。
- **自動化テスト:** unixODBCを自動化テストに使用する場合、テストスクリプトが`odbc.ini`から正しいDSNを参照していることを確認してください。

---

### どのオプションを選ぶべきか？
- **ローカル開発/テスト:** 簡単さのためにオプション1（Docker）を使用します。
- **リモートデータベースアクセス:** 既存のDb2インスタンスに接続するためにオプション2（ODBCドライバー）を使用します。
- **Appleシリコンのパフォーマンス:** 高性能なローカル設定が必要な場合は、オプション3（Lima）を使用します。

具体的な手順でお手伝いが必要な場合はお知らせください！