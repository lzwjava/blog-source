---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: Javaã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–
translated: true
type: note
---

ãã®é€šã‚Šã§ã™ï¼ç¾åœ¨ã®Fabricãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã‚ˆã†ãªç›´æŽ¥JARãƒ‡ãƒ—ãƒ­ã‚¤ã‹ã‚‰DockeråŒ–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ç§»è¡Œã™ã‚‹ã“ã¨ã¯ã€å°†æ¥ã®ã‚µãƒ¼ãƒãƒ¼ç§»è¡Œã‚’ã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºã‹ã¤ä¿¡é ¼æ€§ã®é«˜ã„ã‚‚ã®ã«ã™ã‚‹ãŸã‚ã®ç¢ºå›ºãŸã‚‹æˆ¦ç•¥ã§ã™ã€‚ç°¡å˜ã«è¦ç‚¹ã‚’æ•´ç†ã—ã€ãªãœã“ã‚ŒãŒç†ã«ã‹ãªã£ã¦ã„ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ã¨ã¨ã‚‚ã«ã€å§‹ã‚ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

### ã“ã®Javaãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«Dockerã‚’æŽ¡ç”¨ã™ã‚‹ç†ç”±
- **ç¾åœ¨ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: JARãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`blog-server-1.0.jar`ï¼‰ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`application.properties` ã‚„ `.env` ãªã©ï¼‰ã‚’rsync/Fabricã§EC2ã‚µãƒ¼ãƒãƒ¼ã«ç›´æŽ¥ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ `java -jar blog-server-1.0.jar` ã®ã‚ˆã†ãªã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦èµ·å‹•ã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ã“ã‚Œã¯1å°ã®ã‚µãƒ¼ãƒãƒ¼ã§ã¯å•é¡Œãªãå‹•ä½œã—ã¾ã™ãŒã€ç§»è¡Œæ™‚ã«ä¸æ•´åˆãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šæ–°ã—ã„ãƒ›ã‚¹ãƒˆã§ã®Javaãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ä¾å­˜é–¢ä¿‚ã€ç’°å¢ƒã®å•é¡Œã®é•ã„ï¼‰ã€‚

- **Dockerã®åˆ©ç‚¹**:
  - **ã‚«ãƒ—ã‚»ãƒ«åŒ–**: Dockerã‚³ãƒ³ãƒ†ãƒŠã¯ã€ã‚¢ãƒ—ãƒªã«å¿…è¦ãªã™ã¹ã¦ï¼ˆJavaãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€JARã€è¨­å®šï¼‰ã‚’ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã«Javaã‚„ä»–ã®ä¾å­˜é–¢ä¿‚ã‚’ç›´æŽ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Dockerï¼ˆè»½é‡ã§ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ï¼‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã°ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚
  - **ç§»è¡Œã®ç°¡ç´ åŒ–**: æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã«ç§»è¡Œã™ã‚‹éš›ã¯ã€ãã“ã«Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã ã‘ã§ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã—ã¦1ã¤ã®ã‚³ãƒžãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚Œã°å®Œäº†ã§ã™ã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€æ¨©é™ã€ç’°å¢ƒå¤‰æ•°ã®é¢å€’ãªå†è¨­å®šã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚
  - **ä¸€è²«æ€§**: ã‚¢ãƒ—ãƒªãŒã©ã“ã§ã‚‚åŒã˜ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã€ã€Œç§ã®ãƒžã‚·ãƒ³ã§ã¯å‹•ã„ãŸã€å•é¡Œã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚
  - **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ä¸€åº¦DockeråŒ–ã™ã‚Œã°ã€ãƒ‹ãƒ¼ã‚ºãŒå¢—ãˆãŸéš›ã«Kubernetesãªã©ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ç§»è¡Œã™ã‚‹ã®ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚
  - ã“ã‚Œã¯å˜ç´”ãªã€Œ1ã‚µãƒ¼ãƒãƒ¼ã€1ã‚¢ãƒ—ãƒªã€ã®ã‚·ãƒŠãƒªã‚ªã«ã†ã¾ãé©åˆã—ã¾ã™ãŒã€ãƒžãƒ«ãƒã‚µãƒ¼ãƒãƒ¼/ãƒžãƒ«ãƒç’°å¢ƒã¸ã‚‚ä½™åˆ†ãªæ‰‹é–“ã‚’ã‹ã‘ãšã«æ‹¡å¼µã§ãã¾ã™ã€‚

è¦ã™ã‚‹ã«ï¼šå°†æ¥ã‚’è¦‹æ®ãˆãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’å®Ÿç¾ã—ã¤ã¤ã€çŸ­æœŸçš„ã«ã¯ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’ä¿ã¤ãŸã‚ã«ã¯ã€Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒæ­£ã—ã„é¸æŠžã§ã™ã€‚

### Javaã‚¢ãƒ—ãƒªã‚’DockeråŒ–ã—ã¦å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ç°¡å˜ãªæ‰‹é †
ã“ã‚ŒãŒæ¨™æº–çš„ãªJava Spring Bootã‚¢ãƒ—ãƒªï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ¤æ–­ï¼‰ã§ã‚ã‚‹ã¨ä»®å®šã—ã¦ã€Dockerã§å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜Žã—ã¾ã™ã€‚é«˜ãƒ¬ãƒ™ãƒ«ã§ straightforward ã«èª¬æ˜Žã—ã¾ã™ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦é©å¿œã•ã›ã¦ãã ã•ã„ã€‚

1. **ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã®æ›´æ–°**:
   - `prepare_local_jar()` é–¢æ•°ã¾ãŸã¯åŒæ§˜ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¿®æ­£ã—ã¦ã€å˜ã«JARã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã ã‘ã§ãªãã€ãƒ­ãƒ¼ã‚«ãƒ«ã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
   - ä¾‹ï¼š
     ```python
     @task
     def build_and_deploy(c):
         _prepare_local_jar()
         prepare_remote_dirs(c)
         # ãƒ­ãƒ¼ã‚«ãƒ«ã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒžã‚·ãƒ³ã«DockerãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹æƒ³å®šï¼‰
         local(f"docker build -t blog-server:latest {tmp_dir}")
         # ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¿å­˜/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
         local(f"docker save blog-server:latest | gzip > /tmp/blog-server.tar.gz")
         c.put("/tmp/blog-server.tar.gz", "/tmp/")
         c.run("gzip -d /tmp/blog-server.tar.gz && docker load < /tmp/blog-server.tar")
         # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
         local("rm /tmp/blog-server.tar.gz")
         # ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œ
         c.run(f"docker run -d --name blog-server -p 8080:8080 blog-server:latest")  # å¿…è¦ã«å¿œã˜ã¦ãƒãƒ¼ãƒˆã‚’èª¿æ•´
         chown(c)  # æ‰€æœ‰æ¨©ã®èª¿æ•´ãŒã¾ã å¿…è¦ãªå ´åˆ
         _clean_local_dir()
     ```

2. **Dockerfileã®ä½œæˆ**:
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼ˆã¾ãŸã¯ tmp_dir å†…ï¼‰ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãª `Dockerfile` ã‚’è¿½åŠ ã—ã¾ã™ï¼ˆOpenJDKãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ï¼‰ï¼š
     ```
     # JDKã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨
     FROM openjdk:17-jdk-slim

     # ã‚¢ãƒ—ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
     WORKDIR /app

     # JARã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
     COPY blog-server-1.0.jar app.jar
     COPY application.properties application.properties  # ã¾ãŸã¯ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«

     # ãƒãƒ¼ãƒˆã‚’å…¬é–‹ï¼ˆä¾‹: Spring Bootç”¨ã«8080ï¼‰
     EXPOSE 8080

     # JARã‚’å®Ÿè¡Œ
     ENTRYPOINT ["java", "-jar", "app.jar"]
     ```
   - ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ `docker build -t blog-server:latest .` ã‚’å®Ÿè¡Œ
   - ã¾ãšãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ: `docker run -p 8080:8080 blog-server:latest`ï¼ˆãã®å¾Œ http://localhost:8080 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç¢ºèªï¼‰

3. **ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**:
   - EC2ã‚µãƒ¼ãƒãƒ¼ã«DockerãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆAmazon Linuxã®å ´åˆ `sudo yum install docker`ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’æœ‰åŠ¹åŒ–/é–‹å§‹ï¼‰ã€‚
   - ä¸Šè¨˜ã§æ›´æ–°ã—ãŸFabricã‚¿ã‚¹ã‚¯ãŒã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã¨å®Ÿè¡Œã‚’å‡¦ç†ã—ã¾ã™ã€‚
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã«ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.envï¼‰ç”¨ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ãƒžã‚¦ãƒ³ãƒˆã™ã‚‹ã‹ã€`docker run` ã‚³ãƒžãƒ³ãƒ‰ã§ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¤œè¨Žã—ã¦ãã ã•ã„ã€‚

4. **ç§»è¡Œã®æº–å‚™**:
   - DockeråŒ–ã—ãŸã‚‰ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°/ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ï¼ˆDocker Hubã‚„ECRãªã©ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ï¼‰æ–‡æ›¸åŒ–ã—ã¾ã™ã€‚
   - ç§»è¡Œå½“æ—¥ï¼šæ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã«Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚éžå¸¸ã«ã‚¯ãƒªãƒ¼ãƒ³ã§ã™ï¼

### è€ƒãˆã‚‰ã‚Œã‚‹è½ã¨ã—ç©´ã¨ãƒ’ãƒ³ãƒˆ
- **ç’°å¢ƒå¤‰æ•°**: ã‚¢ãƒ—ãƒªãŒDBèªè¨¼æƒ…å ±ãªã©ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€`docker run -e KEY=value` ã¾ãŸã¯ãƒžã‚¦ãƒ³ãƒˆã•ã‚ŒãŸ.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»‹ã—ã¦æ¸¡ã—ã¾ã™ã€‚
- **æ°¸ç¶šãƒ‡ãƒ¼ã‚¿**: ã‚¢ãƒ—ãƒªãŒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼štmp_dirå†…ï¼‰ã‚’æ°¸ç¶šåŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€Dockerãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼ˆ`-v` ãƒ•ãƒ©ã‚°ï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
- **ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™**: ã‚µãƒ¼ãƒãƒ¼ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`docker run` ã« `--cpus` ã‚„ `--memory` ã‚’è¿½åŠ ã—ã¾ã™ã€‚
- **æ›´æ–°**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã®å ´åˆã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒªãƒ“ãƒ«ãƒ‰ã—ã€å†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
- **ãƒ†ã‚¹ãƒˆ**: å¯èƒ½ã§ã‚ã‚Œã°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®Dockerã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãªã©ã§ï¼‰å®Œå…¨ãªãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
- Javaå›ºæœ‰ã®å•é¡Œï¼ˆãƒ’ãƒ¼ãƒ—ã‚µã‚¤ã‚ºãªã©ï¼‰ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€Dockerfileã®ENTRYPOINTã‚’èª¿æ•´ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ç‰©äº‹ã‚’è¤‡é›‘ã«ã™ã‚‹ã“ã¨ãªãã€ã‚ˆã‚Šç°¡å˜ã«ãªã‚‹ã¯ãšã§ã™ã€‚ã‚¢ãƒ—ãƒªã®è©³ç´°ï¼ˆSpring Bootãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€å…¬é–‹ãƒãƒ¼ãƒˆãªã©ï¼‰ã‚’å…±æœ‰ã—ã¦ã„ãŸã ã‘ã‚Œã°ã€Dockerfileã‚„Fabricã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã•ã‚‰ã«æ”¹è‰¯ã§ãã¾ã™ã€‚æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼ŸðŸš€