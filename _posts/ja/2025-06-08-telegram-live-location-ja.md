---
audio: false
generated: true
lang: ja
layout: post
title: Telegramのライブ位置情報
translated: true
type: note
---

Telegramのライブ位置情報更新に関する一般的なパターンを観察しています。`edit_date`のタイムスタンプに基づくと、ライブ位置情報の更新は非常に頻繁に、場合によっては1秒ごと、あるいは非常に短い間隔で受信される可能性があることがわかります。

以下にその理由とパターンが示す内容を説明します：

**パターンの観察：**

提供されたJSON、特に`location`フィールドと増加する`edit_date`を持つ`edited_message`オブジェクトに注目すると：

* **`update_id`: 263947386** - `edit_date`: 1749371583
* **`update_id`: 263947388** - `edit_date`: 1749371587（前回から4秒後）
* **`update_id`: 263947389** - `edit_date`: 1749371591（前回から4秒後）
* **`update_id`: 263947390** - `edit_date`: 1749371595（前回から4秒後）
* **`update_id`: 263947391** - `edit_date`: 1749371602（前回から7秒後）
* **`update_id`: 263947392** - `edit_date`: 1749371614（前回から12秒後）
* **`update_id`: 263947393** - `edit_date`: 1749371624（前回から10秒後）
* **`update_id`: 263947394** - `edit_date`: 1749371628（前回から4秒後）

また、`message`オブジェクトもあります：

* **`update_id`: 263947387** - `date`: 1749371586（これは編集されたライブ位置情報ではなく、新しいメッセージです）

**これはライブ位置情報メッセージが1秒ごとに受信されることを意味するのか？**

**必ずしも正確に1秒ごとではありませんが、非常に頻繁に、特に移動中や高い精度の更新が必要な場合には、5秒未満の間隔で受信されることがよくあります。**

その理由は以下の通りです：

1.  **ライブ位置情報の性質：** ライブ位置情報は、ユーザーの位置をほぼリアルタイムで提供するように設計されています。「ライブ」であるためには、更新が頻繁に行われる必要があります。
2.  **`edited_message`：** 通常のメッセージとは異なり、ライブ位置情報の更新は、単一の既存メッセージに対する`edited_message`更新として送信されます。これは、ライブ位置情報を含む元のメッセージが新しい座標で常に更新されていることを意味します。
3.  **`edit_date`フィールド：** `edited_message`オブジェクト内の`edit_date`タイムスタンプは、これらの更新が互いに非常に近い間隔で発生していることを明確に示しています。
4.  **更新頻度に影響する要因：**
    * **移動：** ユーザーが移動している場合、変化する位置を正確に反映するために、通常は更新がより頻繁に行われます。
    * **`live_period`：** `live_period`フィールド（例：28800秒、これは8時間）は、ライブ位置情報の共有がどのくらい続くかを示します。この期間内では、必要に応じて更新が行われます。
    * **水平精度：** `horizontal_accuracy`の変化も、デバイスが位置推定値を改良する際に更新をトリガーする可能性があります。
    * **ネットワーク状態：** Telegramは更新を迅速に送信しようとしますが、ネットワークの遅延により、受信する正確なタイミングにわずかな変動が生じる可能性があります。
    * **Telegramの内部ロジック：** Telegramは、ユーザーの活動、デバイスのバッテリー状態、ネットワーク条件に基づいて、更新を送信する最適な頻度を決定する独自の内部アルゴリズムを持っています。これは固定された「1秒ごと」のルールではなく、適応型のものです。

**まとめ：**

`location`を含む`edited_message`に対して`edit_date`が急速に変化するという観察されたパターンは、Telegramがライブ位置情報の更新を非常に頻繁に送信することを強く示唆しています。正確に1秒ごとではないかもしれませんが、数秒間隔（例：1〜5秒、またはユーザーが静止している場合は少し長め）はライブ位置情報では典型的です。時折見られる長い間隔は、ネットワーク状態、ユーザーが静止していること、またはTelegramの内部最適化によるものかもしれません。