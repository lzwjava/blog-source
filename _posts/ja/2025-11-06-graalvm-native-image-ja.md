---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: GraalVMネイティブイメージの概要
translated: true
type: note
---

### GraalVMにおけるNative Imageとは？

GraalVMの紹介文脈において、**Native Image**とは、Java（または他のJVMベース）アプリケーションを事前コンパイル（AOT）し、スタンドアロンのネイティブ実行可能バイナリに変換する機能を指します。これらの実行ファイルは、実行時にJava Virtual Machine（JVM）を必要とせず、ホストマシン上で直接実行されます。本質的には、Java、Kotlin、Scalaのような高水準言語から書かれたコードを、C/C++のネイティブバイナリに似たものに変換する方法です。

#### 背後にある主要技術
- **GraalVM コンパイラ**: Native Imageは、GraalVMコンパイラ（JVM用の高度な最適化コンパイラ）を活用して、静的解析とAOTコンパイルを実行します。ビルドプロセス中に以下を行います：
  1.  **静的解析**: アプリケーション全体（依存関係を含む）をスキャンし、到達可能なすべてのコードパス、クラス、メソッド、リソースを特定します。これにより「閉じた世界」仮定が作成され、動的動作がビルド時に解決されます。
  2.  **部分評価**: コンパイラはコードの一部（リフレクション、動的クラスローディングなど）を記号的に事前評価し、最適化されたマシンコードに置き換えます。
  3.  **コード生成**: 低レベル仮想マシン（LLVM）またはSubstrateVM（GraalVMの組み込みVM）を使用してネイティブ実行ファイルを生成し、プラットフォーム固有のバイナリ（Linux、Windows、macOS、組み込みシステム向けなど）を作成します。

- **SubstrateVM**: これはNative Imageの基盤となるコアランタイムです。これは軽量で組み込み可能なVMであり、AOTに不要なJVM機能（ジャストインタイムコンパイルなど）を取り除き、アプリから静的にリンクされたもののみを含みます。

その結果、自己完結型のバイナリが得られます。外部のJVMやJREのインストールは不要です。`native-image` CLIやMaven/Gradleプラグインなどのツールがビルドを処理します。

#### 利点とトレードオフ
- **長所**:
  - **即時起動**: 数秒ではなく数ミリ秒（サーバーレス/マイクロサービスに最適）。
  - **低メモリフットプリント**: 多くの場合、JVMの使用量の10分の1。
  - **より小さいデプロイメントサイズ**: 単一ファイル、クラスパスの煩わしさなし。
- **短所**:
  - **ビルド時間**: 大規模なアプリでは解析のために数分から数時間かかる場合があります。
  - **動的機能の制限**: 動的プロキシや遅延バインディングリフレクションなどの機能は、明示的な設定（メタデータファイル経由）が必要です。
  - **プラットフォーム固有**: バイナリはビルドマシンのOS/アーキテクチャに紐づけられます。

この技術は、クラウドネイティブアプリ、コンテナ（例：50MB未満のDockerイメージ）、エッジコンピューティングで人気があります。

詳細については、公式のGraalVMドキュメントを参照してください: [GraalVM Native Image Guide](https://www.graalvm.org/latest/reference-manual/native-image/)