---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: クラッシュプロキシ選択のパフォーマンス最適化
translated: true
type: note
---

### 最適化の概要: Clashプロキシ選択スクリプト

Clashプロキシ選択スクリプトを最適化し、選択されないプロキシのテストを回避することで、不要な速度テストを最小限に抑え、パフォーマンスを大幅に向上させました。

#### 最適化の内容

元のコードは以下の非効率なワークフローに従っていました：
1. 利用可能なすべてのプロキシの速度をテストする。
2. その後、SG/TW（またはHK）プロキシのみを選択するためにフィルタリングする。
3. この結果、破棄されるプロキシのテストに時間を浪費していた。

#### 修正内容

`speed.py`の`get_top_proxies()`関数を修正し、`name_filter`パラメータを受け取り、速度テストの前にフィルタリングを適用するように変更：

```python
def get_top_proxies(num_results=5, name_filter=None):
    """
    Clashプロキシの速度を並列テストし、上位N個の最速個別プロキシを返します。

    Args:
        num_results (int): 返すトッププロキシの数（デフォルト: 5）
        name_filter (list): プロキシ名をフィルタリングする文字列のリスト。
                           名前内にこれらの文字列のいずれかを含むプロキシのみがテストされます。
    """
```

#### パフォーマンスのメリット

- **ネットワークリクエストの削減**: 実際に使用する予定のプロキシのみをテスト。
- **実行速度の向上**: 無関係なプロキシに費やす不要な時間を排除。
- **明確なロギング**: フィルタリングされたプロキシの数を正確に表示し、透明性を向上。

#### 設定の簡素化

`--hk`フラグを削除。スクリプトは現在、最大の焦点とシンプルさのために、デフォルトでSGおよびTWプロキシのみをテストします。

#### 結果

この最適化により、実行時間が劇的に短縮されました。なぜなら、ほとんどのプロキシは名前に「SG」または「TW」を含まないためです。これにより、速度テストフェーズがはるかに効率的になり、機能性を損なうことなく、より速く結果を提供します。