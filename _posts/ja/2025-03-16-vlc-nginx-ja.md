---
audio: false
generated: true
lang: ja
layout: post
title: Nginx からの MKV ファイルストリーミングと VLC
translated: true
type: note
---

Nginxサーバーで `.mkv` ファイル（例: `http://192.168.1.27/movies/`）を配信しており、ファイル全体をダウンロードすることなくMacで視聴したい場合、あなたは動画を**ストリーミング**したいと考えています。NginxはデフォルトでHTTP範囲リクエストをサポートする方法でファイルを配信できるため、メディアプレーヤーが完全にダウンロードするのではなく、ストリーミングすることが可能です。以下に、その方法とmacOSに適したツールを説明します。

### 前提条件
- Nginxの設定（例: `alias /var/www/movies/; autoindex on;`）が機能しており、`http://192.168.1.27/movies/` でファイル一覧が表示されること。
- `.mkv` ファイルがネットワーク経由でアクセス可能であること（他のマシンからテスト済みであること）。

### macOSで `.mkv` ファイルをストリーミングするためのツール
HTTP経由でのストリーミングをサポートし、`.mkv` ファイルを適切に処理できるメディアプレーヤーが必要です。最適なオプションは以下の通りです：

#### 1. VLC Media Player (無料、推奨)
VLCは多機能なオープンソースプレーヤーで、ファイル全体をダウンロードすることなく（範囲リクエストを使用）、HTTP経由で `.mkv` ファイルをストリーミングできます。
- **インストール方法**:
  - [videolan.org](https://www.videolan.org/vlc/) からダウンロード。
  - Macにインストール。
- **ストリーミング方法**:
  1. VLCを開く。
  2. `Cmd + N` を押す（または `ファイル > ネットワークストリームを開く` を選択）。
  3. URLを入力（例: `http://192.168.1.27/movies/yourfile.mkv`）。
  4. `開く` をクリック。
- **動作理由**: VLCは必要な部分のみをバッファリングするため、ファイル全体をダウンロードすることなくシークや再生が可能です。

#### 2. IINA (無料、macOSネイティブ)
IINAはモダンでmacOS専用のプレーヤーであり、優れた `.mkv` サポートとストリーミング機能を備えています。
- **インストール方法**:
  - [iina.io](https://iina.io/) からダウンロード、または `brew install iina`（Homebrewを使用）。
- **ストリーミング方法**:
  1. IINAを開く。
  2. `Cmd + U` を押す（または `ファイル > URLを開く`）。
  3. `http://192.168.1.27/movies/yourfile.mkv` を入力。
  4. `OK` をクリック。
- **動作理由**: 軽量で、HTTPストリーミングをサポートし、macOSと良好に統合されます。

#### 3. QuickTime Player (組み込み、機能限定)
macOSのデフォルトプレーヤーであるQuickTime Playerは一部の形式をストリーミングできますが、追加のコーデックなしでは `.mkv` のサポートは不安定です。
- **試す方法**:
  1. QuickTime Playerを開く。
  2. `Cmd + U` を押す（または `ファイル > ロケーションを開く`）。
  3. `http://192.168.1.27/movies/yourfile.mkv` を入力。
  4. `開く` をクリック。
- **注意点**: 動作しない場合は、Perian（旧式のコーデックパック）をインストールするか、代わりにVLCまたはIINAを使用してください。

#### 4. ブラウザ (Safari/Chrome、最もシンプル)
モダンブラウザは、サポートされているコーデック（例: H.264ビデオ、AACオーディオ）でエンコードされた `.mkv` ファイルを直接ストリーミングできます。
- **方法**:
  1. MacでSafariまたはChromeを開く。
  2. `http://192.168.1.27/movies/` にアクセス。
  3. `yourfile.mkv` をクリック。
- **動作理由**: ブラウザはHTML5 videoタグと範囲リクエストを使用してストリーミングします。
- **制限**: `.mkv` がサポートされていないコーデック（例: VP9、Opus）を使用している場合は再生されません。その場合はVLCまたはIINAにフォールバックしてください。

### Nginxがストリーミングをサポートしていることを確認
Nginxはデフォルトで範囲リクエストを処理します。これがストリーミングを可能にします。確認するには：
- 設定でこれが無効化されていないことを確認（例: `limit_rate` や範囲リクエストをブロックするカスタムヘッダーがないこと）。
- VLCまたはIINAでテストする。シーク（例: 5分にジャンプ）が可能であれば、ストリーミングは機能しています。

### 推奨ワークフロー
1. **VLCを使用**（最も信頼性が高い）:
   - VLCをインストール。
   - `Cmd + N` で `http://192.168.1.27/movies/yourfile.mkv` を開く。
   - 必要に応じて再生、一時停止、シーク。
2. **ディレクトリブラウジング**:
   - Safari/Chromeで `http://192.168.1.27/movies/` にアクセスし、ファイル一覧を表示（`autoindex on;` のおかげ）。
   - `yourfile.mkv` のURLをコピーし、VLCまたはIINAに貼り付ける。

### トラブルシューティング
- **バッファリングの問題**: 低速なネットワークや大きな `.mkv` ファイルはラグの原因となる可能性があります。LANが安定していることを確認（例: Wi-Fiが切断されていないこと）。
- **コーデックエラー**: VLCが「サポートされていない形式」と表示する場合、`.mkv` が珍しいコーデックを使用している可能性があります。HandBrakeでH.264/AACに再エンコードしてみてください。
- **接続拒否**: サーバーのファイアウォール設定を再確認（`sudo ufw allow 80` または同等のコマンド）。

VLCまたはIINAを使用すれば、ファイル全体をダウンロードすることなく、Macから `.mkv` ファイルをストリーミングできるようになります。問題が発生した場合はお知らせください。

---

MacにVLCをインストールするのは簡単です。Nginxサーバーから `.mkv` ファイルをストリーミングできるように設定するためのクイックガイドを以下に示します：

### 方法 1: 公式ウェブサイトからダウンロード
1. **VLCのウェブサイトにアクセス**:
   - ブラウザ（例: SafariまたはChrome）を開く。
   - [https://www.videolan.org/vlc/](https://www.videolan.org/vlc/) にアクセス。

2. **VLCをダウンロード**:
   - **Download VLC** ボタンをクリック。自動的にあなたのmacOSを検出し、適切なバージョン（例: 現在のところ VLC 3.0.20）を提供します。
   - `.dmg` ファイル（例: `vlc-3.0.20.dmg`）がダウンロードされます。

3. **VLCをインストール**:
   - ダウンロードした `.dmg` ファイルを開く（通常は `ダウンロード` フォルダ内）。
   - ウィンドウ内の指示に従ってVLCアイコンを **アプリケーション** フォルダにドラッグ。
   - `.dmg` ウィンドウを閉じ、それを取り出す（デスクトップまたはFinderでディスクアイコンを右クリックし、「取り出す」を選択）。

4. **VLCを実行**:
   - **アプリケーション** フォルダに移動（例: FinderまたはSpotlightで `Cmd + Space` を押し、「アプリケーション」と入力）。
   - **VLC** をダブルクリック。
   - macOSがブロックした場合（「開発元が未確認」）、VLCを右クリックし、**開く** を選択、その後ダイアログで **開く** をクリック。

5. **ファイルをストリーミング**:
   - VLCを開く。
   - `Cmd + N` を押す（または `ファイル > ネットワークストリームを開く`）。
   - `http://192.168.1.27/movies/yourfile.mkv` を入力。
   - **開く** をクリック。

### 方法 2: Homebrew経由でインストール (ターミナル)
コマンドラインを好み、Homebrewが既にインストールされている場合：
1. **Homebrewをインストール**（未インストールの場合）:
   - ターミナルを開く。
   - 以下を実行:
     ```bash
     /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
     ```
   - プロンプトに従う。

2. **VLCをインストール**:
   - ターミナルで:
     ```bash
     brew install vlc
     ```

3. **VLCを実行**:
   - ターミナルから起動:
     ```bash
     open -a VLC
     ```
   - または **アプリケーション** で `VLC.app` として見つける。

4. **ストリーミング**:
   - 上記と同じ: `Cmd + N`、URLを入力、再生。

### インストールの確認
- インストール後、VLCは **アプリケーション** フォルダに表示されるはずです。
- 最初にローカルファイル（`.mkv` をVLCにドラッグ）でテストして動作を確認し、その後 `http://192.168.1.27/movies/yourfile.mkv` のストリーミングを試みてください。

### トラブルシューティング
- **ダウンロード失敗**: メインのダウンロードが遅い場合は、VLCサイトのミラーリンクを使用してください。
- **セキュリティプロンプト**: macOSがブロックした場合、`システム設定 > プライバシーとセキュリティ > 一般` に移動し、**とにかく開く** をクリック。
- **再生しない**: URLが正しく、サーバーに到達可能であることを確認（ターミナルで `ping 192.168.1.27`）。

以上です！VLCはMac上で `.mkv` ファイルをストリーミングする準備が整っているはずです。次のステップでヘルプが必要な場合はお知らせください！