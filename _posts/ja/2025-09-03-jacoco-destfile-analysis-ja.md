---
audio: false
generated: true
image: false
lang: ja
layout: post
title: JaCoCo Destfile の使用方法と解析
translated: true
type: note
---

良い質問です — Java または Spring Boot アプリケーションを実行する際の JaCoCo の `destfile` の動作について詳しく見ていきましょう。

### 1. `destfile` とは何か

`destfile` は JaCoCo Java エージェント (`jacocoagent.jar`) のパラメータであり、エージェントが**実行データを書き込む場所**を指定します。
デフォルトでは `jacoco.exec` のような名前ですが、明示的に設定することもできます:

```bash
-javaagent:jacocoagent.jar=destfile=/path/to/jacoco.exec
```

### 2. 何が書き込まれるか

Spring Boot アプリが JaCoCo エージェントを付加して実行されると、エージェントはクラスのバイトコードをインストルメント化します。
実行中、JaCoCo は以下のようなカバレッジ情報を記録します:

*  どのクラスとメソッドがロードされたか
*  どの行が実行されたか
*  ブランチカバレッジ (例: `if`/`else` の両方のパスが実行されたかどうか)

この実行時カバレッジデータはメモリに保存され、定期的に `destfile` で定義されたファイルにフラッシュされます。

つまり、はい — JVM は JaCoCo エージェントを通じて、関数や行レベルの実行情報をそのファイルに書き込みます。

### 3. 分析の仕組み

`.exec` ファイル自体は**人間が読みやすい形式ではありません**。これは単なるバイナリのカバレッジデータです。
アプリの実行終了後、通常はレポートタスク (例: Maven の `jacoco:report` や Gradle の `jacocoTestReport`) を実行します。このタスクは以下を行います:

*   `destfile` のデータを読み取る
*   コンパイルされた `.class` ファイルとソースコードを読み取る
*   HTML、XML、または CSV のカバレッジレポートを生成する

このステップで、パーセンテージや色分けされたコード行などが表示されます。

### 4. 実行時とレポート生成時

*   **実行時:** エージェントは実行内容をメモリに記録し、`destfile` にダンプします。
*   **レポート生成時:** JaCoCo ツール (Maven、Gradle、CLI、Ant) を使用して、その `.exec` ファイルを解釈し、読みやすいレポートを生成します。

したがって、`destfile` 自体は**生の実行データに過ぎません** — レポートステップを実行するまで分析されません。

---

👉 要約: はい、Spring Boot アプリを JaCoCo エージェントと共に実行すると、メソッドや行に関するカバレッジ情報が `destfile` に保存されます。後で、JaCoCo のレポートツールがこれを使用し (クラスファイル/ソースファイルと共に)、人間が理解しやすいレポートを作成します。

Spring Boot でのこの動作をステップバイステップで説明しましょうか (例: Maven 設定、実行、レポート生成)？