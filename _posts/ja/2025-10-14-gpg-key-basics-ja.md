---
audio: false
generated: true
image: false
lang: ja
layout: post
model: openai/gpt-5
title: GPGキー管理の基礎
translated: true
type: note
---

## GPG鍵管理の概要

GPG（GNU Privacy Guard）は、安全な通信のためのOpenPGP標準の無料実装であり、データの暗号化、署名、検証に使用されます。その中核は**公開鍵暗号**であり、各ユーザーは**公開鍵**（暗号化と検証のために公開して共有）と**秘密鍵**（復号と署名のために秘密に保持）を持ちます。鍵管理には、これらの鍵の作成、配布、維持、保護が含まれ、改ざん、侵害、悪用を防ぎます。管理が不十分だと、攻撃者があなたの鍵を自身の鍵に置き換えて通信を傍受する「鍵置換攻撃」などの被害につながる可能性があります。

GPGの「信頼の輪」モデルでは、ユーザーが互いの鍵を認証し、検証済みのアイデンティティのネットワークを構築します。鍵は**鍵リング**（公開鍵と秘密鍵のファイル。古いバージョンでは `pubring.kbx` と `secring.gpg`、新しいバージョンでは統合）に保存されます。秘密鍵は常にバックアップし、強力なパスフレーズを使用してください。

## 鍵の構造

GPGの鍵ペアは単一の鍵ではなく、以下の要素を含むバンドルです：
- **プライマリ鍵**：他の鍵を認証（署名）したり、自身の鍵の構成要素に自己署名したりするためのマスター署名鍵（例：RSAまたはDSA）。
- **サブ鍵**：特定のタスクのためのオプションの従属鍵：
  - 署名サブ鍵：メッセージの署名用。
  - 暗号化サブ鍵：データの暗号化用（定期的にローテーションされることが多い）。
  - 認証サブ鍵：SSHなどでの認証用。
- **ユーザーID (UID)**：鍵を実際のアイデンティティに関連付ける「Alice (コメント) <alice@example.com>」のような文字列。異なる役割に対して複数のUIDを設定できます。
- **自己署名**：プライマリ鍵が自身の構成要素に署名し、改ざんを防ぎます。

鍵の構造を対話的に表示するには：
```
gpg --edit-key <鍵IDまたはメールアドレス>
```
メニュー内で、`check` を使用して自己署名を検証するか、`toggle` を使用して秘密部分を表示します（利用可能な場合）。

## 鍵の生成

プライマリ鍵ペアから始めます。初心者は対話方式を使用します：

1. `gpg --full-gen-key`（またはデフォルト設定の `--gen-key`）を実行します。
2. 鍵の種類を選択します（デフォルト：署名と暗号化の両方にRSA）。
3. 鍵サイズを選択します（例：より強力なセキュリティのため4096ビット。最低2048ビットを推奨）。
4. 有効期限を設定します（例：1年なら「1y」。無期限は「0」ですが、可能な限り無期限は避けてください）。
5. ユーザーID（名前、メールアドレス）を入力します。
6. 強力なパスフレーズ（20文字以上、大文字/小文字/記号混在）を設定します。

迅速な生成（非対話型）：
```
gpg --quick-generate-key "Alice <alice@example.com>" rsa default 1y
```

生成後、**失効証明書**（鍵が侵害された場合に無効化するためのファイル）を作成します：
```
gpg --output revoke.asc --gen-revoke <あなたの鍵ID>
```
これは安全な場所（例：金庫に印刷して保管）に保管し、必要な時まで共有しないでください。

後でサブ鍵やUIDを追加するには：
- `gpg --edit-key <鍵ID>` を実行し、`addkey`（サブ鍵用）または `adduid`（UID用）を使用します。これらは自動的に自己署名されます。

## 鍵の一覧表示と表示

- 公開鍵の一覧：`gpg --list-keys`（または `--list-public-keys`）。
- 秘密鍵の一覧：`gpg --list-secret-keys`。
- 詳細表示：`gpg --list-keys --with-subkey-fingerprint <鍵ID>`（サブ鍵のフィンガープリントを表示）。

出力には、鍵ID（短縮/完全）、作成日/有効期限、機能（例：`[SC]` は署名/認証）、UIDが表示されます。

## 鍵のエクスポートとインポート

**エクスポート**は公開鍵を共有したり、秘密鍵をバックアップしたりします：
- 公開鍵：`gpg --armor --export <鍵ID> > mykey.asc`（メール用にASCIIアーマー形式）。
- 秘密鍵（バックアップ専用）：`gpg --armor --export-secret-keys <鍵ID> > private.asc`。
- 鍵サーバーへ：`gpg --keyserver hkps://keys.openpgp.org --send-keys <鍵ID>`。

**インポート**は他のユーザーの鍵を公開鍵リングに追加します：
- `gpg --import <ファイル.asc>`（既存の鍵とマージ。新しい署名/サブ鍵を追加）。
- 鍵サーバーから：`gpg --keyserver hkps://keys.openpgp.org --recv-keys <鍵ID>`。

インポート後、`gpg --edit-key <鍵ID>` と `check` で自己署名を検証します。

## 鍵の署名と認証

信頼を構築するには：
- 鍵に署名（有効であることを認証）：`gpg --sign-key <他の鍵ID>`（またはローカルのみの場合は `lsign-key`）。
- 迅速な署名：`gpg --quick-sign-key <フィンガープリント> "ユーザーID"`。
- 信頼レベルを設定：`--edit-key` 内で `trust` を使用（例：絶対的な信頼は「5」）。

これにより鍵に署名が作成され、一覧表示で確認できます。信頼の輪は、署名者への信頼に基づいて有効性を計算します。

## 鍵の失効

失効は、鍵または構成要素を削除せずに無効化し、他のユーザーが無効であることを認識できるようにします：
- 鍵全体：失効証明書をインポート：`gpg --import revoke.asc`、その後、更新された鍵をエクスポート/送信。
- サブ鍵/UID：`--edit-key` 内で、`key 1` または `uid 1` で選択し、`revkey` または `revuid` を実行。
- UIDの迅速な失効：`gpg --quick-revoke-uid <鍵ID> <失効するUID>`。

失効の理由：侵害された、使用されなくなった、置き換えられた。失効した鍵は常に公開してください。

## ベストプラクティス

- **セキュリティ**：秘密鍵にはハードウェアトークン（例：YubiKey）を使用。暗号化サブ鍵は毎年ローテーション（`gpg --quick-add-key <フィンガープリント> rsa encr 1y`）。パスフレーズは定期的に変更（`gpg --change-passphrase <鍵ID>`）。
- **有効期限**：合理的な有効期限（1〜2年）を設定し、更新を強制して侵害を検出。
- **配布**：公開鍵は鍵サーバーまたは直接共有。フィンガープリントは対面または信頼できるチャネルで検証し、中間者攻撃を回避。
- **バックアップ**：秘密鍵を暗号化されたストレージにエクスポート。失効証明書は即座に生成。
- **クリーンアップ**：`gpg --edit-key` で `clean` を使用し、無効な署名を削除。
- **更新**：2025年現在、GnuPG 2.5+は量子耐性アルゴリズム（例：`--quick-generate-key ... pqc`）をサポート。将来性のために移行を検討。
- **一般的な落とし穴**：秘密鍵は絶対に共有しない。無期限の有効期限は避ける。失効はサンドボックスでテスト。

実践的な学習には、`gpg --homedir ./test-gpg` を使用してテストディレクトリで実験してください。

[GnuPG Handbook: Key Management](https://www.gnupg.org/gph/en/manual/c235.html)  
[GNU Privacy Guard Manual: OpenPGP Key Management](https://www.gnupg.org/documentation/manuals/gnupg/OpenPGP-Key-Management.html)  
[GnuPG Getting Started](https://www.gnupg.org/gph/en/manual/c14.html)