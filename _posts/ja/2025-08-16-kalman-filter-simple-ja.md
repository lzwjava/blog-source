---
audio: false
generated: true
image: false
lang: ja
layout: post
title: カルマンフィルターの簡単な説明
translated: true
type: note
---

以下は、明確さを考慮して構成された**カルマンフィルタ**に関する包括的なガイドです：

---

# 1. はじめに

**カルマンフィルタ**は、ノイズの多いセンサー測定値とシステムモデルからの予測を組み合わせることで、未知の変数の推定値を提供する**アルゴリズム**です。**制御システム、ナビゲーション、ロボティクス、コンピュータビジョン、金融**などで広く使用されています。

重要な考え方：
これは再帰的に動作します — つまり、データセット全体を待つのではなく、新しい測定値が到着するたびに継続的に推定値を更新します。

---

# 2. 核心概念

### 状態 (State)

推定したい変数の集合（例：位置、速度）。

### プロセスモデル (Process Model)

時間の経過とともに状態がどのように変化するかを、通常は何らかの不確実性を含めて記述します。

### 測定モデル (Measurement Model)

実際のセンサー測定値を基礎となる状態に関連付けます。

### ノイズ (Noise)

プロセスと測定の両方に不確実性（ランダムノイズ）があります。カルマンフィルタは確率を用いてこれを明示的にモデル化します。

---

# 3. 数学的定式化

カルマンフィルタは、ガウスノイズを持つ**線形システム**を仮定します。

* **状態方程式（予測）:**

  $$
  x_k = A x_{k-1} + B u_k + w_k
  $$

  * $x_k$: 時刻 $k$ における状態
  * $A$: 状態遷移行列
  * $B u_k$: 制御入力
  * $w_k$: プロセスノイズ（ガウス分布、共分散 $Q$）

* **観測方程式（測定）:**

  $$
  z_k = H x_k + v_k
  $$

  * $z_k$: 測定値
  * $H$: 観測行列
  * $v_k$: 測定ノイズ（ガウス分布、共分散 $R$）

---

# 4. 2つの主要なステップ

### ステップ 1: 予測 (Prediction)

* 状態を時間的に前方に予測します。
* 不確実性（誤差共分散）を予測します。

### ステップ 2: 更新（修正） (Update/Correction)

* 予測された測定値と実際の測定値を比較します。
* **カルマンゲイン**（測定値と予測のどちらをどれだけ信頼するか）を計算します。
* 推定値を更新し、不確実性を低減します。

---

# 5. カルマンフィルタの方程式（線形の場合）

1. **状態の予測:**

   $$
   \hat{x}_k^- = A \hat{x}_{k-1} + B u_k
   $$

2. **共分散の予測:**

   $$
   P_k^- = A P_{k-1} A^T + Q
   $$

3. **カルマンゲイン:**

   $$
   K_k = P_k^- H^T (H P_k^- H^T + R)^{-1}
   $$

4. **状態の更新:**

   $$
   \hat{x}_k = \hat{x}_k^- + K_k (z_k - H \hat{x}_k^-)
   $$

5. **共分散の更新:**

   $$
   P_k = (I - K_k H) P_k^-
   $$

ここで：

* $\hat{x}_k^-$: 更新前の予測状態
* $\hat{x}_k$: 更新後の状態
* $P_k$: 共分散行列（推定値の不確実性）

---

# 6. 直感的理解

* 測定値の**ノイズが非常に大きい**場合（$R$ が大きい）、カルマンゲインは小さくなる → 予測をより重視します。
* モデルの**不確実性が大きい**場合（$Q$ が大きい）、カルマンゲインは大きくなる → 測定値をより重視します。
* 時間の経過とともに、モデルを信頼するかセンサーを信頼するかの**最適なバランス**を見つけ出します。

---

# 7. 派生型

* **拡張カルマンフィルタ (EKF):** 非線形システム向け、線形化（ヤコビアン）を使用します。
* **無香料カルマンフィルタ (UKF):** 非線形システム向け、確定的サンプリングを使用します。
* **情報フィルタ (Information Filter):** 効率化のために逆共分散を扱います。
* **アンサンブルカルマンフィルタ (Ensemble Kalman Filter):** 気象予報や高次元システムで使用されます。

---

# 8. 応用例

* **ナビゲーション:** GPSと加速度センサーの融合による位置追跡。
* **ロボティクス:** SLAM（ Simultaneous Localization and Mapping：自己位置推定と地図作成の同時進行）。
* **金融:** ボラティリティのような隠れた変数の推定。
* **コンピュータビジョン:** 動画内の物体追跡。
* **制御システム:** 航空機や宇宙機の安定化。

---

# 9. 例示シナリオ

自動運転車が自身の位置を推定していると想像してください：

* モデルは、速度と前の状態を使用して位置を予測します。
* GPSは、ノイズを含む位置測定値を提供します。
* カルマンフィルタは、予測とGPSを組み合わせて、より滑らかで正確な位置を算出します。

時間が経つにつれて、GPSが一時的に途切れても、車は自分の位置を追跡し続けることができます。

---

# 10. 主な長所と限界

**長所:**

* 再帰的で効率的（必要なのは直前の状態のみで、履歴全体は不要）。
* 線形ガウスシステムに対して最適です。
* 広くテストされており、堅牢です。

**限界:**

* ダイナミクスとノイズの正確なモデルが必要です。
* 純粋に線形 — 非線形の場合はEKF/UKFが必要です。
* 仮定が破られると発散する可能性があります。

---

✅ 要するに：**カルマンフィルタ**は、不確実性の下で予測と測定を融合する数学的に優雅な方法であり、モデルとセンサーの間の信頼のバランスを取り、リアルタイムで可能な限り最良の推定値を生成します。

---

**ステップバイステップのPython実装例**（ノイズを含む位置追跡など）もご希望ですか？そうすれば、実際にどのように動作するかを確認できます。