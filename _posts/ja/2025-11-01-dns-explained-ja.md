---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: DNSの仕組みをわかりやすく解説
translated: true
type: note
---

### DNSとは何ですか？

DNSは**Domain Name System**の略です。これは基本的にインターネット（およびローカルネットワーク）の「電話帳」です。人間が読み取れるドメイン名（`www.example.com` や `google.com` など）を、マシンが読み取れるIPアドレス（`192.0.2.1` や `8.8.8.8` など）に変換します。DNSがなければ、ウェブサイトにアクセスするために生のIPアドレスを記憶して入力しなければならず、非現実的です。

DNSは階層的に動作します：あなたのデバイスはDNSサーバー（これらの検索を処理する専門サーバー）にクエリを送信し、DNSサーバーは答えを知っているか、名前がIPに解決されるまで、クエリを権威サーバーへとチェーン上に転送します。

### macOSまたはWindowsでのDNS設定

macOS（システム設定 > ネットワーク）またはWindows（設定 > ネットワークとインターネット > イーサネット/Wi-Fi > プロパティ）でネットワーク設定を構成する際、**DNS**セクションでは、DNSサーバーを手動で指定するか、ネットワークから提供されるデフォルトを使用できます。一般的なデフォルトは以下の通りです：
- あなたのISPのDNSサーバー。
- Googleの `8.8.8.8` と `8.8.4.4`、またはCloudflareの `1.1.1.1` などのパブリックなサーバー。

「自動」（多くの場合、あなたが言及したようにDHCP経由）に設定したままにすると、あなたのルーターまたはネットワークがこれらのDNSサーバーを提供します。

あなたがリストしたその他の詳細：
- **192.168.1.1**: これは通常、あなたのルーターのローカルIPアドレス（「デフォルトゲートウェイ」）です。これはあなたのホームネットワークから外部のインターネットへの扉です。
- **IPv4 Use DHCP**: DHCP（Dynamic Host Configuration Protocol）は、ネットワーク上のデバイスにIPアドレスやその他のネットワーク情報を自動的に割り当てるサービスです。「Use DHCP」は、あなたのコンピュータが静的IPを選択せず、代わりにDHCPサーバー（通常はあなたのルーター）に動的にIPを要求することを意味します。

### あなたのコンピュータがネットワークに接続し、IP/ホストクエリを処理する方法

あなたのコンピュータが「ネットワークにアクセスする」とき（つまり、Wi-Fiまたはイーサネットに接続するとき）のプロセスをステップバイステップで説明しましょう：

1. **初期接続とDHCPハンドシェイク**:
   - 接続時、あなたのコンピュータはDHCPの「発見」リクエストをブロードキャストします：「もしもし、誰か私に利用可能なIPアドレスを提供してくれる人はいますか？」
   - あなたの**ルーター**（DHCPサーバーとして動作）が「提供」で応答します：「はい、どうぞ、あなたへのIP（例：192.168.1.100）です。加えて、あなたのサブネットマスク（例：255.255.255.0）、デフォルトゲートウェイ（192.168.1.1）、およびDNSサーバーIP（例：8.8.8.8）もどうぞ。」
   - あなたのコンピュータがそれを受け入れ（「リクエスト」）、確認（「確認応答」）します。これで、ローカルネットワーク上で通信するために必要なすべてを入手しました。
   - この時点ではまだDNSは関与していません。これはあなたのデバイス自身のIPと基本的なルーティングのためだけです。あなたの「ホスト」（ホスト名、あなたのコンピュータの名前など）は、デバイス上でローカルに設定されているか、ローカル名前解決のためにルーターに登録されている可能性がありますが、それは別の話です。

2. **ホストの解決（DNSが関与する場所）**:
   - 一度接続され、あなたが `www.google.com` にアクセスしようとすると、あなたのコンピュータはまだIPを知りません。それはDHCPによって提供されたDNSサーバー（ルーターのIPまたは外部のもの）に**DNSクエリ**を送信します。
   - **それはルーターに行きますか？** 多くの場合、間接的にはそうです：
     - もしあなたのルーターがDNSプロキシ/フォワーダーとして構成されている場合（TP-Link、Netgear、Apple Airportなどの家庭用ルーターで一般的）、あなたのコンピュータは最初にルーターにクエリを送信します（例：DNSサーバーとして192.168.1.1経由）。
     - ルーターはそのローカルキャッシュ（速度向上のため）をチェックします。もし答えを（以前のクエリから）持っていれば、直接応答します。持っていない場合、クエリを上流のDNSサーバー（あなたのISPのものや、あなたが設定したパブリックなもの）に転送します。
   - 上流のDNSサーバーがそれを解決し（例：`www.google.com` → `142.250.190.14`）、IPをチェーンを経由してあなたのコンピュータに送り返します。
   - あなたのコンピュータはそのIPを使用してサイトに接続します。

3. **ルーターがこれらのクエリを処理する方法**:
   - **DHCPクエリ**: ルーターは利用可能なIPのプール（例：192.168.1.50 から 192.168.1.150）を維持します。あなたがリクエストすると、それは設定された時間（例：24時間）あなたにそれをリースし、そのテーブルで追跡し、必要に応じて更新します。また、ホスト名を設定した場合はそれも処理します（例：`ping mylaptop.local` のようなローカルアクセスのため）。
   - **DNSクエリ**: ルーターはDNSレコードを「所有」していません。それは仲介者です。それは以下のことを行います：
     - 応答をキャッシュし、繰り返しの上流クエリを避けます（速度向上と帯域幅削減）。
     - 未解決のクエリを設定された上流サーバーに転送します。
     - ペアレンタルコントロール、広告ブロック（Pi-holeのようなカスタムDNS経由）、またはロギングを適用する場合があります。
     - もしクエリがローカルデバイス（例：あなたのネットワーク上の別のコンピュータ）に対するものであれば、そのローカルホストファイルやmDNS（マルチキャストDNS、macOS/AppleデバイスでBonjourによって使用される）を介して解決する可能性があります。
   - エラー？もしDNSが失敗した場合（例：間違ったサーバーIP）、名前を解決できません。サイトは読み込まれませんが、IPに直接pingを打つことは動作する可能性があります。

要約すると：DHCPはあなたのコンピュータにルーターから「住所と道順」を取得させます。DNSはその後、それらの道順を使用して「このウェブサイトはどこですか？」と尋ねます。多くの場合、ルーターを経由して外部のリゾルバーに問い合わせます。

もし特定の設定でトラブルシューティングをしているのであれば、あなたのルーターモデルや正確なエラーなどの詳細を共有してください！