---
audio: false
generated: false
lang: ja
layout: post
title: Google Cloud サーバーのセットアップ
translated: true
---

Google Cloudでプロキシサーバーを設定すると、インターネットトラフィックをクラウドインスタンス経由で安全にルーティングできるようになり、プライバシーが向上し、制限を回避することができます。このガイドでは、Google Cloudで基本的なプロキシサーバーを設定し、トラフィックを許可するための必要なファイアウォールルールを構成する手順を説明します。

## 目次
1. [Google Cloud VMインスタンスの作成](#creating-a-google-cloud-vm-instance)
2. [プロキシサーバーの設定](#configuring-the-proxy-server)
3. [ファイアウォールルールの設定](#setting-up-firewall-rules)
4. [プロキシサーバーのテスト](#testing-the-proxy-server)
5. [結論](#conclusion)

---

## Google Cloud VMインスタンスの作成

プロキシサーバーを設定する前に、Google Cloudで仮想マシン（VM）インスタンスを作成する必要があります。

1. Google Cloud Consoleにログイン: [Google Cloud Console](https://console.cloud.google.com/)にアクセスし、アカウントにログインします。

2. 新しいVMインスタンスを作成:
   - Compute Engine > VMインスタンスに移動します。
   - 「インスタンスを作成」をクリックします。
   - 希望のリージョンとマシンタイプを選択します。シンプルにするために、デフォルト設定を使用するか、`e2-micro`インスタンスのような軽量な構成を選択できます。
   - ファイアウォールセクションで、ウェブアクセスを有効にするために「HTTPトラフィックを許可」と「HTTPSトラフィックを許可」の両方を選択します。

3. SSHアクセスの設定:
   - SSHキーセクションで、リモートでインスタンスにアクセスするためにSSH公開鍵を追加します。これは後でプロキシサーバーを設定するために重要です。

4. 「作成」をクリックしてVMを起動します。

VMがセットアップされたら、Google Cloud ConsoleからSSHで接続するか、ターミナルから以下のコマンドで接続できます:

```bash
gcloud compute ssh <あなたのVM名>
```

---

## プロキシサーバーの設定

VMのセットアップが完了したら、任意のプロキシサーバーソフトウェアを設定できます。プロキシソフトウェアは、指定されたポート（例：一般的なプロキシ設定では`3128`）で接続を受け入れるようにインストールおよび設定する必要があります。リモートクライアントからの接続を許可するようにソフトウェアを設定してください。

---

## ファイアウォールルールの設定

プロキシサーバーへのトラフィックを許可するには、Google Cloudのファイアウォールルールを設定して必要なポートを開く必要があります。

1. Google Cloud Consoleでファイアウォールルールに移動します：
   - Google Cloud Consoleで、VPCネットワーク > ファイアウォールルールに移動します。

2. 新しいファイアウォールルールを作成する:
   - 「ファイアウォールルールを作成」をクリックします。
   - ルールの名前を入力します（例: `allow-proxy-access`）。
   - トラフィックの方向を「Ingress」（着信トラフィック）に設定します。
   - 一致時のアクションを「許可」に設定します。
   - ターゲットを「ネットワーク内のすべてのインスタンス」または「指定されたターゲットタグ」（より詳細な制御を希望する場合）に設定します。
   - ソースIP範囲には、すべてのIPアドレスからのアクセスを許可するために `0.0.0.0/0` を設定するか、セキュリティを強化するために特定のIPまたは範囲を指定します。
   - プロトコルとポートの下で、「指定されたプロトコルとポート」を選択し、プロキシサーバーが使用するポート（例: `tcp:3128`）を入力します。

3. ファイアウォールルールを保存:
   ルールを設定したら、[作成]をクリックしてファイアウォールを有効にします。

---

## プロキシサーバーのテスト

ファイアウォールの設定が完了したら、次はプロキシサーバーのテストを行う時です。

1. ローカルマシンからプロキシをテストする:

ローカルマシンのブラウザやシステムのプロキシ設定を、Google Cloud VMの外部IPアドレスと、プロキシサーバーがリッスンしているポート（例: `3128`）を使用するように設定できます。

2. コマンドラインでのテスト:
   
   プロキシ環境変数を設定して、`curl` でプロキシをテストすることもできます:

```bash
export http_proxy=http://<あなたのVMの外部IP>:3128
export https_proxy=http://<あなたのVMの外部IP>:3128
curl -I http://example.com
```

接続が成功すると、ウェブサイトからの応答が表示されるはずです。

---

## 結論

このガイドに従うことで、Google Cloud上にプロキシサーバーを設定し、着信トラフィックを許可するためのファイアウォールルールを構成する方法を学びました。この設定により、インターネットトラフィックをクラウド経由で安全にルーティングし、ネットワーク制限を回避し、プライバシーを強化する簡単な方法を提供します。