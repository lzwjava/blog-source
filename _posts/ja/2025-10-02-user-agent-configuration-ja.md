---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: CodeIgniterユーザーエージェント設定配列
translated: true
type: note
---

### 概要
このPHPコードスニペットは、CodeIgniterフレームワーク（PHPのWebフレームワーク）の一部であり、特にUser Agent Classの設定ファイルからのものです。これは4つの配列（`$platforms`、`$browsers`、`$mobiles`、`$robots`）を定義しており、ユーザーエージェント文字列の断片を、ブラウザ、オペレーティングシステム、モバイルデバイス、Webクローラー/ボットの人間が読める名前にマッピングします。このコードは、クライアントから送信されるHTTP User-Agentヘッダーに基づいて、ウェブサイトを訪問しているデバイス、ブラウザ、ボットの種類を解析し、識別するために使用されます。

これらの配列は連想配列（キーと値のペア）であり、キーはユーザーエージェント文字列からの部分文字列（大文字小文字を区別しないマッチ）、値は対応する表示名です。CodeIgniterのUser Agentライブラリはこれらを検出に使用します。例えば、訪問者がAndroidを使用しているか、Chromeを使用しているか、検索ボットであるかなどを判定します。

### $platforms 配列
この配列は、オペレーティングシステムまたはプラットフォームを識別します。キーはUser-Agentヘッダーに現れる可能性のある部分文字列であり、値は表示用のクリーンな名前です。

- **エントリ例**:
  - `'windows nt 10.0'` → `'Windows 10'`
  - `'android'` → `'Android'`
  - `'os x'` → `'Mac OS X'`
- **目的**: クライアントのOS（例: Windows, iOS, Linux）を検出し、分析、コンテンツのカスタマイズ、または機能の調整に役立てます。
- **注意**: 一部の部分文字列が重複する可能性があるため（例: `'windows'` は最後の包括的なマッチとして）、順序は正確性に影響します。

### $browsers 配列
Webブラウザを識別します。ブラウザは複数の識別子を報告することが多いため、順序はサブタイプを優先します（コメントによる）。

- **エントリ例**:
  - `'Chrome'` → `'Chrome'`
  - `'MSIE'` → `'Internet Explorer'`
  - `'Firefox'` → `'Firefox'`
  - 特別なケース: `'Opera.*?Version'`（正規表現のようなマッチ）は、"Opera/9.80"とバージョンを報告するモダンなOpera用です。
- **目的**: ブラウザ（例: Chrome, Safari）を判定し、ブラウザ固有の機能を提供したり、リダイレクトを行ったりします。
- **正規表現の注意**: 一部のキーは基本的な正規表現パターン（例: `.*?` によるワイルドカードマッチ）を使用しており、ライブラリ内で処理されます。

### $mobiles 配列
モバイルデバイス、電話、および関連するデバイス/ブラウザのユーザーエージェントフラグをマッピングします。より大きく、電話、タブレット、ゲーム機、フォールバックカテゴリを含みます。

- **構造化されたセクション**:
  - 電話/製造元: `'iphone'` → `'Apple iPhone'`, `'samsung'` → `'Samsung'`.
  - オペレーティングシステム: `'android'` → `'Android'`, `'symbian'` → `'Symbian'`.
  - ブラウザ: `'opera mini'` → `'Opera Mini'`, `'fennec'` → `'Firefox Mobile'`.
  - その他/フォールバック: `'mobile'` → `'Generic Mobile'` は、マッチしないモバイル指標用です。
- **目的**: レスポンシブデザイン、モバイル専用機能、またはアプリへのリダイレクトのために、モバイルデバイスをフラグ付けします。レガシーなエントリ（時代遅れとしてコメントアウトされているものも含む）を含みます。

### $robots 配列
一般的なWebクローラーとボットをリストします。キーはボットのユーザーエージェントからの部分文字列です。

- **エントリ例**:
  - `'googlebot'` → `'Googlebot'`
  - `'bingbot'` → `'Bing'`
  - `'yandex'` → `'YandexBot'`
- **目的**: SEO処理のためにクローラーを識別します。例えば、ボットに異なるコンテンツ（広告なしなど）を提供したり、ボットトラフィックをログに記録したりします。

### CodeIgniterでの使用方法
- User Agent Classはこのファイルを読み込み、`is_browser()`、`is_mobile()`、`is_robot()`、`platform()` などのメソッドを使用してUser-Agent文字列を解析します。
- これらの配列を通じて、文字列に対してキーを大文字小文字を区別せずに検索してマッチさせます。
- 不一致がある場合（例: リストにない新しいデバイス/ブラウザ）、これらの配列を手動で、またはコミュニティ拡張機能を介して更新する必要があります。

### 追加の注意
- **セキュリティ**: これは純粋にデータ収集のためのものです。有害なコードを実行するものではありません。User-Agent文字列は偽装される可能性があるため、重要なセキュリティチェックにこれを依存しないでください。
- **更新**: CodeIgniterのバージョンによってはエントリが追加/変更されている可能性があります。これは古いスナップショットのように見えます（例: Edgeが 'Spartan' とされているのは時代遅れ）。
- **テスト方法**: PHPスクリプトでこれを読み込み、`strpos` または正規表現を使用してサンプルのUser-Agent文字列とマッチングをテストできます。

特定の部分について質問や実装に関する疑問があれば、お知らせください！