---
audio: false
generated: true
image: false
lang: ja
layout: post
title: OpenWRTをワイヤレスブリッジとして設定する
translated: true
type: note
---

Grokの助けを借りて、私はまだ以下の作業に取り組んでいます。

---

OpenWRTをワイヤレスブリッジとして設定する手順についての「これは正しいですか？」という質問に対応し、これを達成する正しい方法を提供するために、あなたが提供した手順を評価し、OpenWRTのベストプラクティスに基づいて改良します。あなたの目標は、OpenWRTルーター（例：Xiaomi Mi Router 4C with OpenWRT 24.10.0）をワイヤレスブリッジとして設定することです——既存のWi-Fiネットワークにクライアントとしてワイヤレス接続し、その接続を自身のWi-Fiアクセスポイント(AP)またはイーサネットポートを介して共有し、すべてのデバイスをメインルーターと同じサブネットに維持します。

あなたが提供した手順は大部分正確ですが、適切なブリッジングを確保し、IP競合を避けるための重要な調整が欠けています。以下では、まずあなたの設定を評価し、その後、OpenWRTでワイヤレスブリッジを実現するための正しく完全な手順を提示します。ここではシンプルなブリッジ方法（クライアントとAPを同じブリッジ上に配置）を使用します。これはあなたの意図に沿った方法です。また、シンプルな方法が失敗した場合の代替案として`relayd`を使用する方法にも簡単に言及しますが、あなたの設定ではおそらくシンプルなアプローチがサポートされているでしょう。

---

### **提供された手順の評価**

あなたの手順は以下のことを目的としています：
1.  OpenWRTルーターをクライアントとして既存のWi-Fiネットワークに接続する。
2.  新しいWi-FiネットワークをブロードキャストするAPを設定する。
3.  クライアントとAPインターフェースをブリッジしてインターネットを共有する。

簡単なレビュー：
- **ステップ1: LuCIにログイン** - 正しい。Webインターフェースへのアクセスが開始点です。
- **ステップ2: ワイヤレスクライアントを設定** - ターゲットのWi-Fiに参加させ、それを`lan`ネットワークに割り当てることは良いスタートですが、OpenWRTのデフォルトの`lan`設定（静的IP、通常は192.168.1.1）は、メインルーターが同じIPを使用している場合、競合を引き起こす可能性があります。これには調整が必要です。
- **ステップ3: ワイヤレスAPを設定** - APを設定し、それを`lan`に割り当てることはブリッジングにとって正しいですが、`lan`インターフェースが適切に設定されていることに依存します。
- **ステップ4: ネットワークをブリッジ** - 両方のインターフェースを`lan`に割り当てることは理論的にはそれらをブリッジしますが、DHCPサーバーを無効にしたりIP設定を調整したりしなければ、シームレスに動作しない可能性があります。
- **ステップ5: 設定をテスト** - テストは不可欠ですが、成功は以前のステップが完全に正しいことに依存します。

**何が欠けている、または間違っているか？**
- デフォルトでは、OpenWRTの`lan`インターフェースは静的IP（例：192.168.1.1）を持ち、DHCPサーバーを実行しています。メインルーターも192.168.1.1である場合、これはIP競合を引き起こします。`lan`インターフェースをDHCPクライアントモードに設定してメインルーターからIPを取得し、メインルーターがすべてのデバイスにIPを割り当てるようにローカルのDHCPサーバーを無効にする必要があります。
- ファイアウォールゾーンの`lan`への割り当てはシンプルさのために問題ありませんが、IP設定が重要です。

この点を考慮すると、あなたの手順は「大部分正しい」ですが、`lan`インターフェース設定の調整がなければ不完全です。以下に修正された手順を示します。

---

### **OpenWRTをワイヤレスブリッジとして設定する正しい手順（シンプルブリッジ方法）**

この方法は、あなたのOpenWRTルーターを既存のWi-Fiネットワークにクライアントとして接続し、その接続を自身のAPまたはイーサネットポートを介して共有するように設定します。すべての通信はメインルーター（例：192.168.1.x）と同じサブネット上で行われます。LuCI Webインターフェースを使用した手順は以下の通りです：

#### **前提条件**
- OpenWRTがインストールされている（例：Xiaomi Mi Router 4Cにバージョン24.10.0）。
- メインWi-FiネットワークのSSID、パスワード、暗号化タイプ（例：WPA2-PSK）を把握している。
- LuCIに`http://192.168.1.1`（または現在のIP）でアクセスでき、管理者資格情報を持っている。

#### **ステップ1: LuCIにログイン**
- ブラウザを開き、`http://192.168.1.1`に移動します。
- OpenWRTのユーザー名（デフォルト：`root`）とパスワード（インストール時に設定）でログインします。

#### **ステップ2: ワイヤレスクライアントを設定**
- **ワイヤレス設定に移動:**
  - **Network > Wireless**に進みます。
- **ネットワークをスキャン:**
  - 該当する無線（例：Mi Router 4Cでは2.4 GHz用の`radio0`）を見つけます。
  - **Scan**をクリックして利用可能なWi-Fiネットワークのリストを表示します。
- **メインWi-Fiネットワークに参加:**
  - メインルーターのWi-FiのSSIDを見つけます。
  - **Join Network**をクリックします。
- **クライアント設定を構成:**
  - **Wi-Fi Key:** メインWi-Fiのパスワードを入力します。
  - **Network:** `lan`を選択または設定します（これによりクライアントインターフェースが`br-lan`ブリッジに追加されます）。
  - **Firewall Zone:** `lan`に割り当てます（これによりブリッジングのためのトラフィックルールが簡素化されます）。
  - **Interface Name:** LuCIが`wwan`を提案する場合があります。明確にするために`client`に名前を変更することもできますが、`lan`に関連付けられていることを確認してください。
- **保存 & 適用:**
  - **Save & Apply**をクリックしてメインWi-Fiに接続します。

#### **ステップ3: LANインターフェースをDHCPクライアントに調整**
- **インターフェースに移動:**
  - **Network > Interfaces**に移動します。
- **LANインターフェースを編集:**
  - `lan`インターフェースの横の**Edit**をクリックします。
- **プロトコルをDHCPクライアントに設定:**
  - **Protocol**ドロップダウンで、**DHCP client**を選択します。
  - これにより、`br-lan`ブリッジ（これにはワイヤレスクライアントが含まれるようになりました）がメインルーターのDHCPサーバーからIPアドレス（例：192.168.1.x）を取得できるようになります。
- **DHCPサーバーを無効化:**
  - `lan`がDHCPクライアントになったため、ローカルDHCPサーバーは自動的に無効になります。**Advanced Settings**または**DHCP and DNS**でこれを確認してください——オプションが表示される場合は「Ignore interface」がチェックされていることを確認してください。
- **保存 & 適用:**
  - **Save & Apply**をクリックします。ルーターはメインルーターにIPを要求します。

#### **ステップ4: ワイヤレスアクセスポイントを設定**
- **新しいワイヤレスネットワークを追加:**
  - **Network > Wireless**に戻ります。
  - 同じ無線（例：`radio0`）の下の**Add**をクリックして、新しいワイヤレスインターフェースを作成します。
- **APを設定:**
  - **ESSID:** あなたのWi-Fiの名前を選択します（例：`OpenWRT_AP`）。
  - **Mode:** **Access Point (AP)**に設定します。
  - **Network:** `lan`に割り当てます（これによりクライアントインターフェースおよびイーサネットポートとブリッジされます）。
- **セキュリティを構成:**
  - **Wireless Security**タブに移動します。
  - **Encryption:** **WPA2-PSK**を選択します（推奨）。
  - **Key:** あなたのAP用の強力なパスワードを設定します。
- **保存 & 適用:**
  - **Save & Apply**をクリックします。あなたのルーターは自身のWi-Fiをブロードキャストします。

#### **ステップ5: ブリッジを確認**
- **インターフェースを確認:**
  - **Network > Interfaces**に移動します。
  - `lan`インターフェースの下に、ワイヤレスクライアント（例：`wlan0`）とAP（例：`wlan0-1`）の両方が`br-lan`ブリッジの下にリストされていることを確認します。
- **IP割り当てを確認:**
  - **Status > Overview**に移動します。
  - メインルーターによって`lan`インターフェースに割り当てられたIPアドレス（例：`192.168.1.100`）を確認します。

#### **ステップ6: 設定をテスト**
- **Wi-Fiをテスト:**
  - デバイスを`OpenWRT_AP` Wi-Fiに接続します。
  - メインルーターからIP（例：`192.168.1.x`）を受け取り、インターネットにアクセスできることを確認します。
- **イーサネットをテスト（該当する場合）:**
  - デバイスをルーターのLANポートの一つに接続します。
  - メインルーターからIPを取得し、インターネットに接続することを確認します。
- **LuCIにアクセス:**
  - 新しいIPアドレス（例：`http://192.168.1.100`）を使用してOpenWRTインターフェースにアクセスします。

---

### **これが動作する理由**
- クライアントとAPの両方のインターフェースを`lan`ネットワークに割り当てることで、それらが`br-lan`ブリッジに追加され、レイヤー2のトラフィックがそれらとメインルーターの間を流れることが可能になります。
- `lan`をDHCPクライアントに設定することで、OpenWRTルーターがメインルーターから一意のIPを取得し（例：`192.168.1.1`との）競合を回避し、メインルーターがすべてのIP割り当てを管理できるようにローカルDHCPサーバーを無効にします。
- APまたはイーサネットポートに接続されたデバイスは、メインネットワーク（例：`192.168.1.x`）と同じサブネット上に現れ、ワイヤレスブリッジの要件を満たします。

---

### **代替方法: relaydの使用（疑似ブリッジ）**
シンプルなブリッジ方法が失敗した場合（例：ワイヤレスドライバーの制限による）、`relayd`パッケージを使用して疑似ブリッジを構成できます。これはルーテッド設定を作成し、OpenWRTルーターのクライアントは異なるサブネット上にありますが、一部のハードウェアではより信頼性が高いです。以下に概要を示します：

1.  **relaydをインストール:**
    - **System > Software**に移動し、`relayd`を検索してインストールします。
2.  **ワイヤレスクライアントを設定:**
    - メインWi-Fiに参加しますが、それを新しいインターフェース（例：`wwan`）に割り当て、DHCPクライアントに設定します。
3.  **LANを設定:**
    - `lan`を静的IP（例：`192.168.2.1`）に設定し、自身のDHCPサーバーを実行させます。
4.  **relaydを設定:**
    - SSHまたはLuCI（**Network > Hostnames**の下）を介して`relayd`を設定し、`wwan`と`lan`の間でリレーするようにします。
5.  **APを設定:**
    - APを`lan`ネットワーク上に設定します。
6.  **テスト:**
    - `OpenWRT_AP`上のデバイスは`192.168.2.x`上になり、メインルーターからリレーされたインターネットにアクセスします。

**注意:** これは真のブリッジではありません（異なるサブネット）。シンプルな方法が動作しない場合にのみ使用してください。OpenWRT 24.10.0がインストールされたXiaomi Mi Router 4Cでは、シンプルなブリッジで十分なはずです。

---

### **結論**
あなたの元の手順は**大部分正しい**ですが、IP競合を回避し適切なブリッジングを確保するために`lan`インターフェースをDHCPクライアントモードに設定することがなければ不完全です。上記の修正された手順は、OpenWRTをワイヤレスブリッジとして設定する信頼性の高い方法を提供します。これに従えば、あなたのルーターはメインWi-Fiに接続し、その接続をAPまたはイーサネットポートを介してシームレスに共有し、すべて同じサブネット上で通信します。設定をテストし、問題が発生した場合（最近のOpenWRTでは稀です）、`relayd`代替案を検討してください。