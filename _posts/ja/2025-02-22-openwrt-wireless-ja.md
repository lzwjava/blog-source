---
audio: false
lang: ja
layout: post
title: OpenWRTを無線ブリッジとして設定する
translated: true
---

あなたの質問「正しいですか？」に関して、OpenWRTを無線ブリッジとして設定するための手順について、正しい方法を提供し、あなたが提供した手順を評価し、OpenWRTのベストプラクティスに基づいて修正します。あなたの目標は、OpenWRTルーター（例：OpenWRT 24.10.0がインストールされているXiaomi Mi Router 4C）を無線ブリッジとして設定し、既存のWi-Fiネットワークに無線で接続し、その接続を自分のWi-Fiアクセスポイント（AP）またはEthernetポートを通じて共有し、すべてのデバイスをメインルーターと同じサブネットに保つことです。

あなたが提供した手順はほとんど正しいですが、適切なブリッジを確保し、IPの衝突を避けるための重要な調整が欠けています。以下に、あなたの設定を評価し、OpenWRTで無線ブリッジを実現するための正しい、完全な手順を示します。これは、あなたの意図に合致する簡単なブリッジ方法（クライアント+APが同じブリッジ）を使用します。また、簡単な方法が失敗する場合に備えて、`relayd`を使用する代替方法について簡単に触れますが、あなたの設定はより簡単なアプローチをサポートする可能性が高いです。

---

### **あなたが提供した手順の評価**

あなたの手順は以下を目指しています：
1. OpenWRTルーターを既存のWi-Fiネットワークにクライアントとして接続する。
2. 新しいWi-Fiネットワークを放送するAPを設定する。
3. クライアントとAPのインターフェースをブリッジしてインターネットを共有する。

以下に簡単なレビューを示します：
- **手順1：LuCIにログイン** - 正しい、Webインターフェースにアクセスするのはスタート地点です。
- **手順2：無線クライアントの設定** - ターゲットWi-Fiに参加し、`lan`ネットワークに割り当てるのは良いスタートですが、OpenWRTのデフォルトの`lan`設定（静的IP、通常は192.168.1.1）が、メインルーターも同じIPを使用している場合に衝突を引き起こす可能性があります。この設定を調整する必要があります。
- **手順3：無線APの設定** - APを設定し、`lan`に割り当てるのはブリッジするために正しいですが、`lan`インターフェースが適切に設定されていることを前提としています。
- **手順4：ネットワークのブリッジ** - 両方のインターフェースを`lan`に割り当てることで理論的にはブリッジされますが、DHCPサーバーを無効にするかIP設定を調整しないと、スムーズに動作しない可能性があります。
- **手順5：設定のテスト** - テストは重要ですが、成功するかどうかは前の手順が完全に正しいかに依存します。

**欠けているものや間違っているもの**
- デフォルトでは、OpenWRTの`lan`インターフェースには静的IP（例：192.168.1.1）が設定され、DHCPサーバーが実行されています。メインルーターも192.168.1.1の場合、IPの衝突が発生します。`lan`インターフェースをDHCPクライアントモードに設定し、ローカルのDHCPサーバーを無効にして、メインルーターがすべてのデバイスにIPを割り当てるようにする必要があります。
- `lan`に対するファイアウォールゾーンの割り当ては簡単さを考慮して正しいですが、IP設定は重要です。

この点を考慮すると、あなたの手順は「ほとんど正しい」ですが、`lan`インターフェースの設定を調整しないと不完全です。以下に、修正された手順を示します。

---

### **OpenWRTを無線ブリッジとして設定するための正しい手順（簡単なブリッジ方法）**

この方法では、OpenWRTルーターを既存のWi-Fiネットワークにクライアントとして接続し、その接続を自分のAPまたはEthernetポートを通じて共有し、すべてのデバイスをメインルーターと同じサブネット（例：192.168.1.x）にするように設定します。以下に、LuCI Webインターフェースを使用して行う方法を示します。

#### **前提条件**
- OpenWRTがインストールされている（例：Xiaomi Mi Router 4CにOpenWRT 24.10.0）。
- メインWi-FiネットワークのSSID、パスワード、暗号化タイプ（例：WPA2-PSK）を持っている。
- `http://192.168.1.1`（または現在のIP）にアクセスできるLuCIと管理者の資格情報。

#### **手順1：LuCIにログイン**
- ブラウザを開き、`http://192.168.1.1`に移動します。
- OpenWRTのユーザー名（デフォルト：`root`）とパスワード（インストール時に設定）でログインします。

#### **手順2：無線クライアントの設定**
- **無線設定に移動:**
  - **ネットワーク > 無線**に移動します。
- **ネットワークをスキャン:**
  - あなたのラジオ（例：Mi Router 4Cの2.4GHz用の`radio0`）を探します。
  - **スキャン**をクリックして利用可能なWi-Fiネットワークのリストを表示します。
- **メインWi-Fiネットワークに参加:**
  - メインルーターのWi-FiのSSIDを見つけます。
  - **ネットワークに参加**をクリックします。
- **クライアント設定の構成:**
  - **Wi-Fiキー:** メインWi-Fiのパスワードを入力します。
  - **ネットワーク:** `lan`を選択または設定します（これにより、クライアントインターフェースが`br-lan`ブリッジに追加されます）。
  - **ファイアウォールゾーン:** `lan`に割り当てます（これにより、ブリッジのためのトラフィックルールが簡単になります）。
  - **インターフェース名:** LuCIが`wwan`を提案するかもしれませんが、`client`に名前を変更して明確にすることもできますが、`lan`に関連付けていることを確認してください。
- **保存および適用:**
  - **保存および適用**をクリックしてメインWi-Fiに接続します。

#### **手順3：LANインターフェースをDHCPクライアントに調整**
- **インターフェースに移動:**
  - **ネットワーク > インターフェース**に移動します。
- **LANインターフェースを編集:**
  - `lan`インターフェースの横にある**編集**をクリックします。
- **プロトコルをDHCPクライアントに設定:**
  - **プロトコル**のドロップダウンから**DHCPクライアント**を選択します。
  - これにより、`br-lan`ブリッジ（現在無線クライアントを含む）がメインルーターのDHCPサーバーからIPアドレスを取得できます（例：192.168.1.x）。
- **DHCPサーバーを無効に:**
  - `lan`が現在DHCPクライアントであるため、ローカルのDHCPサーバーは自動的に無効になります。**高度な設定**または**DHCPとDNS**の下で確認し、**無視するインターフェース**がチェックされていることを確認します。
- **保存および適用:**
  - **保存および適用**をクリックします。ルーターはメインルーターからIPをリクエストします。

#### **手順4：無線アクセスポイントの設定**
- **新しい無線ネットワークを追加:**
  - **ネットワーク > 無線**に戻ります。
  - 同じラジオ（例：`radio0`）の下に**追加**をクリックして新しい無線インターフェースを作成します。
- **APの設定:**
  - **ESSID:** Wi-Fiの名前を選択します（例：`OpenWRT_AP`）。
  - **モード:** **アクセスポイント（AP）**に設定します。
  - **ネットワーク:** `lan`に割り当てます（これにより、クライアントインターフェースとEthernetポートとブリッジされます）。
- **セキュリティの設定:**
  - **無線セキュリティ**タブに移動します。
  - **暗号化:** **WPA2-PSK**を選択します（推奨）。
  - **キー:** APの強力なパスワードを設定します。
- **保存および適用:**
  - **保存および適用**をクリックします。ルーターは現在自分のWi-Fiを放送します。

#### **手順5：ブリッジの確認**
- **インターフェースの確認:**
  - **ネットワーク > インターフェース**に移動します。
  - `lan`インターフェースが無線クライアント（例：`wlan0`）とAP（例：`wlan0-1`）を`br-lan`ブリッジの下にリストしていることを確認します。
- **IPの割り当ての確認:**
  - **ステータス > 概要**に移動します。
  - メインルーターによって`lan`インターフェースに割り当てられたIPアドレス（例：`192.168.1.100`）を確認します。

#### **手順6：設定のテスト**
- **Wi-Fiのテスト:**
  - デバイスを`OpenWRT_AP` Wi-Fiに接続します。
  - メインルーターからIP（例：`192.168.1.x`）を受け取り、インターネットにアクセスできることを確認します。
- **Ethernetのテスト（必要に応じて）:**
  - デバイスをルーターのLANポートに接続します。
  - メインルーターからIPを受け取り、インターネットに接続できることを確認します。
- **LuCIへのアクセス:**
  - 新しいIPアドレス（例：`http://192.168.1.100`）を使用してOpenWRTインターフェースにアクセスします。

---

### **なぜこれが機能するか**
- クライアントとAPのインターフェースを`lan`ネットワークに割り当てることで、`br-lan`ブリッジに追加され、メインルーターとの間でレイヤー2のトラフィックが流れます。
- `lan`をDHCPクライアントに設定することで、OpenWRTルーターがメインルーターから一意のIPを取得し、衝突を避け（例：192.168.1.1）、ローカルのDHCPサーバーを無効にしてメインルーターがすべてのIPの割り当てを管理するようにします。
- APまたはEthernetポートに接続されたデバイスは、メインネットワークと同じサブネット（例：192.168.1.x）に表示され、無線ブリッジの要件を満たします。

---

### **代替方法：relayd（偽ブリッジ）の使用**
簡単なブリッジ方法が失敗する場合（例：無線ドライバの制限により）、`relayd`パッケージを使用して偽ブリッジを作成することができます。これにより、OpenWRTルーターのクライアントは異なるサブネットにありますが、一部のハードウェアではより信頼性が高くなります。以下に簡単な概要を示します：

1. **relaydのインストール:**
   - **システム > ソフトウェア**に移動し、`relayd`を検索してインストールします。
2. **無線クライアントの設定:**
   - メインWi-Fiに参加し、新しいインターフェース（例：`wwan`）に割り当て、DHCPクライアントに設定します。
3. **LANの設定:**
   - `lan`を静的IP（例：`192.168.2.1`）に設定し、独自のDHCPサーバーを設定します。
4. **relaydの設定:**
   - SSHまたはLuCI（**ネットワーク > ホスト名**の下）を使用して、`relayd`を設定し、`wwan`と`lan`の間でリレーします。
5. **APの設定:**
   - APを`lan`ネットワークに設定します。
6. **テスト:**
   - `OpenWRT_AP`に接続されたデバイスは`192.168.2.x`にあり、インターネットはメインルーターからリレーされます。

**注意:** これは真のブリッジではありません（異なるサブネット）。簡単な方法が機能しない場合にのみ使用してください。あなたのXiaomi Mi Router 4CとOpenWRT 24.10.0では、簡単なブリッジが十分です。

---

### **結論**
あなたの元の手順は**ほとんど正しい**ですが、`lan`インターフェースをDHCPクライアントモードに設定してIPの衝突を避け、適切なブリッジを確保するために不十分です。上記の修正された手順は、OpenWRTを無線ブリッジとして設定するための信頼性の高い方法を提供します。これらの手順に従うと、ルーターはメインWi-Fiに接続し、APまたはEthernetポートを通じてその接続をシームレスに共有し、すべてのデバイスを同じサブネットに保つことができます。設定をテストし、問題が発生した場合（現代のOpenWRTでは稀）は、`relayd`の代替方法を検討してください。