---
audio: false
generated: true
lang: ja
layout: post
title: Control-Mにおけるctmfwコマンド
translated: true
type: note
---

Control-Mの`ctmfw`コマンドは、ファイルの作成、削除、転送完了などのイベントを監視するFile Watcherユーティリティの一部です。特定のコマンド`ctmfw %%FILENAME CREATE 0 60 10 3 1410`は、Control-Mドキュメントで定義されたパラメータに基づいて分解できます。各部分の意味は以下の通りです：

- **`ctmfw`**：Control-M File Watcherユーティリティ。ファイル関連のイベントを検出し、ジョブの開始やコマンドの実行などのアクションを条件に基づいてトリガーします。

- **`%%FILENAME`**：監視するファイルの名前またはパスを表す変数（例：`datafile.txt`や`*.csv`のようなパターン）。実際のファイル名は、通常Control-Mジョブまたは環境で定義され、実行時に解決されます。

- **`CREATE`**：操作モード。指定されたファイルの**作成**を監視していることを示します。他の可能なモードには、ファイル削除を監視する`DELETE`などがあります。

- **`0`**：ファイルが有効と見なされるために必要な最小ファイルサイズ（バイト単位）。値が`0`の場合、任意のファイルサイズが受け入れられるため、ユーティリティはファイルサイズに関係なくファイルを検出します。

- **`60`**：ファイルの存在を確認するための連続試行間の間隔（秒単位）。ユーティリティは60秒ごとにファイルが作成されたかどうかをチェックします。

- **`10`**：ファイルが検出された後、ファイルサイズを監視する試行間の間隔（秒単位）。これにより、ファイルサイズが安定している（まだ書き込み中でない）ことが確認されます。ユーティリティは10秒ごとにファイルサイズをチェックします。

- **`3`**：ファイルが完全に作成されたことを確認するために、ファイルサイズが静的（変更されていない）でなければならない反復回数。ユーティリティはファイルサイズを3回（10秒間隔で合計30秒）チェックして、安定していることを確認します。

- **`1410`**：ユーティリティがファイルの作成とサイズ基準の満たしを待機しながら実行される最大時間（分単位）。1410分は約23.5時間に相当します。この時間内にファイルが検出されないか安定しない場合、ユーティリティはタイムアウトし、`DO_NOTOK`アクション（例：「FILE WAS NOT CREATED」の報告）を実行する可能性があります。

### 動作の仕組み
このコマンドは、`%%FILENAME`で指定されたファイルの作成を監視します。60秒ごとにファイルの存在をチェックします。検出されると、ファイルサイズが10秒間隔で3回（合計30秒）変更されないことを確認します。このプロセスは、最大1410分（23.5時間）続くか、ファイルが検出されて安定するまで継続します。ファイルが作成され基準を満たす場合、`DO_OK`アクション（例：ジョブやコマンドのトリガー）が実行されます。満たさない場合、`DO_NOTOK`アクションが実行されます。

### 例のシナリオ
`%%FILENAME`が`/home/controlm/datafile.txt`に設定されている場合、ユーティリティは：
- 60秒ごとに`datafile.txt`をチェックします。
- 見つかった後、そのサイズが30秒間（10秒間隔で3回チェック）安定していることを確認します。
- 最大23.5時間実行されるか、ファイルが安定するまで続きます。
- 成功した場合、ジョブ（例：ファイルを別のディレクトリに移動）をトリガーする可能性があります。タイムアウトした場合、「FILE WAS NOT CREATED」をログに記録する可能性があります。

### 注意点
- `%%FILENAME`変数は、Control-Mジョブまたは環境で定義されている必要があります。定義されていない場合、コマンドは失敗します。
- ユーティリティは、変更時刻が50年以上前のファイルを無視します。
- `%%FILENAME`でワイルドカードが使用されている場合（例：`*.csv`）、複数ファイルを処理するために`MONITOR_FILE_SIZE`などの追加パラメータが必要になる可能性があります。
- 循環監視（検出後の繰り返しチェック）の場合、`CYCLIC_INTERVAL`パラメータが必要ですが、ここでは指定されていません。

この説明は、BMCの公式ドキュメントやコミュニティディスカッションなどのControl-M File Watcherドキュメントに基づいています。[](https://documents.bmc.com/supportu/controlm-saas/en-US/Documentation/ctmfw.htm)[](https://documents.bmc.com/supportu/9.0.21/en-US/Documentation/ctmfw.htm)[](https://pdfslide.net/documents/file-watcher-for-control-m.html)