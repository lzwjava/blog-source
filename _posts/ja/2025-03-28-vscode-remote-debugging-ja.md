---
audio: false
generated: true
lang: ja
layout: post
title: VSCode リモートデバッグ
translated: true
type: note
---

Visual Studio Code (VSCode) でデバッグモードで実行されている WebSphere Liberty Server のリモートデバッグを実行するには、VSCode の組み込み Java デバッグ機能を使用できます。以下は、標準の **Java Extension Pack** (これには **Debugger for Java** が含まれます) が既にインストールされていることを前提に、WebSphere Liberty 固有のプラグインをインストールせずにこれをセットアップする詳細な手順です。

---

### ステップ 1: WebSphere Liberty Server をデバッグモードで起動する
1. ターミナルまたはコマンドプロンプトを開きます。
2. WebSphere Liberty のインストールディレクトリに移動します。
3. 以下のコマンドを実行して、サーバーをデバッグモードで起動します:
   ```
   server debug default
   ```
   - サーバー名が異なる場合は、`default` をあなたのサーバー名に置き換えてください。
4. サーバーはデバッグが有効な状態で起動し、通常はポート **7777** でリッスンします。
5. サーバーのコンソール出力またはログで、以下のようなメッセージを確認してください:
   ```
   Listening for transport dt_socket at address: 7777
   ```
   - これでデバッグポートが確認できます。(競合などで) 異なるポートが表示された場合は、表示された番号をメモしてください。

---

### ステップ 2: VSCode でリモートデバッグを設定する
1. **VSCode でプロジェクトを開く**:
   - サーバーにデプロイされたソースコードを含む Java プロジェクトが VSCode で開かれていることを確認してください。これにより、デバッガーがブレークポイントを実行中のコードにマッピングできるようになります。

2. **Run and Debug ビューにアクセスする**:
   - 左側のサイドバーにある **Run and Debug** アイコン (再生ボタンと虫のアイコン) をクリックするか、`Ctrl+Shift+D` (Windows/Linux) または `Cmd+Shift+D` (Mac) を押します。

3. **`launch.json` ファイルを作成または編集する**:
   - **Run and Debug** ビューで、構成ドロップダウンの横にある**歯車アイコン**をクリックします。
   - 環境の選択を求められたら、**Java** を選択してください。これにより、ワークスペースの `.vscode` フォルダに `launch.json` ファイルが作成されます。
   - ファイルが既に存在する場合は、編集用に開かれます。

4. **デバッグ構成を追加する**:
   - `launch.json` ファイルに、リモート JVM にアタッチするための構成が含まれていることを確認してください。以下は例です:
     ```json
     {
         "version": "0.2.0",
         "configurations": [
             {
                 "type": "java",
                 "name": "Attach to WebSphere Liberty",
                 "request": "attach",
                 "hostName": "localhost",
                 "port": 7777
             }
         ]
     }
     ```
   - **フィールドの説明**:
     - `"type": "java"`: Java デバッガーを指定します。
     - `"name": "Attach to WebSphere Liberty"`: この構成の説明名です。
     - `"request": "attach"`: VSCode が既存の JVM プロセスにアタッチすることを示します。
     - `"hostName": "localhost"`: サーバーを実行しているマシンのホスト名です。サーバーが別のマシン上にある場合は、サーバーの IP アドレスまたはホスト名を使用してください。
     - `"port": 7777`: ステップ 1 のデバッグポートです。サーバーが異なるポートを使用している場合は、これを更新してください。

5. **ファイルを保存する**:
   - 構成を追加または編集した後、`launch.json` ファイルを保存します。

---

### ステップ 3: デバッグセッションを開始する
1. **サーバーが実行中であることを確認する**:
   - WebSphere Liberty Server がステップ 1 からデバッグモードでまだ実行されていることを確認してください。

2. **構成を選択する**:
   - **Run and Debug** ビューで、上部のドロップダウンメニューから **"Attach to WebSphere Liberty"** を選択します。

3. **デバッガーを起動する**:
   - 緑色の**再生ボタン**をクリックするか、`F5` を押します。VSCode がサーバーの JVM プロセスに接続します。

4. **ブレークポイントを設定する**:
   - VSCode で Java ソースファイルを開きます。
   - 実行を一時停止したい行の左側 (行番号の左側の余白) をクリックしてブレークポイントを設定します。

5. **アプリケーションと対話する**:
   - アプリケーションを使用して (例: HTTP リクエストを送信する)、ブレークポイントがあるコードパスをトリガーします。ブレークポイントにヒットすると、VSCode は実行を一時停止し、変数の検査、コードのステップ実行、デバッグを行えるようにします。

---

### 追加の注意点
- **ローカルサーバーとリモートサーバー**:
  - サーバーが別のマシンで実行されている場合は、`launch.json` ファイル内の `"localhost"` をサーバーのホスト名または IP アドレスに置き換えてください。デバッグポートがネットワーク経由でアクセス可能であること (例: ファイアウォールでブロックされていないこと) を確認してください。

- **デバッグポートの確認**:
  - ポートがわからない場合は、`server debug default` を実行した後のサーバーの出力を常に確認してください。リッスンしているポートが明示的に表示されます。

- **ソースコードの一致**:
  - ブレークポイントが正しく機能するためには、VSCode のソースコードがサーバーで実行されているコードと一致している必要があります。プロジェクトが最新であり、デバッグ情報付きでコンパイルされている (ほとんどの Java ビルドのデフォルト) ことを確認してください。

- **サーバーの動作**:
  - `server debug default` では、サーバーはすぐに起動します (デバッガーを待機しません)。サーバーが実行中の間はいつでも VSCode をアタッチできます。

- **前提条件**:
  - **Java Extension Pack** (または少なくとも **Debugger for Java** 拡張機能) が VSCode にインストールされている必要があります。これは Java 開発の標準ツールであり、必要なデバッグ機能を提供します。

---

これらの手順に従うことで、WebSphere に固有の追加プラグインを必要とせずに、VSCode の組み込み機能を使用して WebSphere Liberty Server を効果的にリモートデバッグできます。