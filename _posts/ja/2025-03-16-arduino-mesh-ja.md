---
audio: false
generated: true
lang: ja
layout: post
title: メッシュ解析のArduinoによる検証
translated: true
type: note
---

Arduinoを用いたメッシュ解析の検証は、複数のループを持つ回路を構築し、メッシュ解析を理論的に適用して電流を予測し、次にArduinoを使用して抵抗器両端の電圧を測定し、実際の電流を計算して比較することを含みます。メッシュ解析は、回路理論における手法の一つで、それぞれの独立したループにループ電流を割り当て、キルヒホッフの電圧則(KVL)を用いて方程式を立てます。Arduinoは、計算結果を確認するために現実の回路の挙動を測定するのに役立ちます。

以下では、簡単な2メッシュ回路を設計し、手動でメッシュ解析を実行し、Arduinoを使用して電圧を測定し電流を推定することで結果を検証する手順を説明します（Arduinoは電流を直接測定できないため、オームの法則 \\( I = V/R \\) を使用します）。

---

### **ステップ 1: 2メッシュ回路の設計**

#### **回路の説明**
- **使用部品:**
  - Arduino (例: Uno)
  - 抵抗器 3個 (例: R1 = 330Ω, R2 = 470Ω, R3 = 680Ω)
  - ブレッドボードとジャンパワイヤ
  - 電源 (Arduinoの5Vピン)
- **配線:**
  - 5VをNode Aに接続。
  - Node Aから、R1を介してNode Bに接続。
  - Node Bから、R2を介してNode C (GND) に接続。
  - Node Aから、R3を介してNode C (GND) に接続。
- **回路構造:**
  - Mesh 1: 5V → R1 → R2 → GND (左ループ)。
  - Mesh 2: 5V → R3 → GND (右ループ)。
  - R1はMesh 1のみ、R3はMesh 2のみに存在し、R2は両メッシュで共有されます。
- **測定ポイント:**
  - A0: R1両端の電圧 (Node A から Node B)。
  - A1: R2両端の電圧 (Node B から Node C)。
  - A2: R3両端の電圧 (Node A から Node C)。

#### **回路図の概念**
```
5V ---- Node A ---- R1 ---- Node B ---- R2 ---- Node C (GND)
       |                        |
       +--------- R3 -----------+
```

---

### **ステップ 2: 理論的にメッシュ解析を実行**

#### **メッシュ電流の定義**
- \\( I_1 \\): Mesh 1の電流 (5V, R1, R2, GNDを時計回り)。
- \\( I_2 \\): Mesh 2の電流 (5V, R3, GNDを時計回り)。

#### **各メッシュにKVLを適用**
1. **Mesh 1 (5V → R1 → R2 → GND):**
   - 電圧源: +5V (ループ方向でGNDから5Vへ向かうため)。
   - R1での電圧降下: \\( -R1 \cdot I_1 \\)。
   - R2での電圧降下: \\( -R2 \cdot (I_1 - I_2) \\) (R2を流れる電流は \\( I_1 - I_2 \\))。
   - 方程式: \\( 5 - R1 \cdot I_1 - R2 \cdot (I_1 - I_2) = 0 \\)。

2. **Mesh 2 (5V → R3 → GND):**
   - 電圧源: +5V。
   - R3での電圧降下: \\( -R3 \cdot I_2 \\)。
   - R2での電圧降下 (逆方向): \\( +R2 \cdot (I_1 - I_2) \\) (R2を流れる電流は \\( I_1 - I_2 \\))。
   - 方程式: \\( 5 - R3 \cdot I_2 + R2 \cdot (I_1 - I_2) = 0 \\)。

#### **値の代入**
- R1 = 330Ω, R2 = 470Ω, R3 = 680Ω。
- Mesh 1: \\( 5 - 330 I_1 - 470 (I_1 - I_2) = 0 \\)
  - 簡略化: \\( 5 - 330 I_1 - 470 I_1 + 470 I_2 = 0 \\)
  - \\( 5 - 800 I_1 + 470 I_2 = 0 \\) → (1)
- Mesh 2: \\( 5 - 680 I_2 + 470 (I_1 - I_2) = 0 \\)
  - 簡略化: \\( 5 + 470 I_1 - 680 I_2 - 470 I_2 = 0 \\)
  - \\( 5 + 470 I_1 - 1150 I_2 = 0 \\) → (2)

#### **方程式を解く**
- (1)より: \\( 5 = 800 I_1 - 470 I_2 \\) → \\( I_1 = \frac{5 + 470 I_2}{800} \\)。
- (2)に代入: \\( 5 + 470 \left( \frac{5 + 470 I_2}{800} \right) - 1150 I_2 = 0 \\)。
- 分数を解消するため両辺に800を乗算:
  - \\( 4000 + 470 (5 + 470 I_2) - 1150 \cdot 800 I_2 = 0 \\)
  - \\( 4000 + 2350 + 220900 I_2 - 920000 I_2 = 0 \\)
  - \\( 6350 - 699100 I_2 = 0 \\)
  - \\( I_2 = \frac{6350}{699100} \approx 0.00908 \, \text{A} = 9.08 \, \text{mA} \\)。
- 戻し代入: \\( I_1 = \frac{5 + 470 \cdot 0.00908}{800} = \frac{5 + 4.2676}{800} \approx 0.01158 \, \text{A} = 11.58 \, \text{mA} \\)。

#### **電圧の計算**
- \\( V_{R1} = R1 \cdot I_1 = 330 \cdot 0.01158 \approx 3.82 \, \text{V} \\)。
- \\( V_{R2} = R2 \cdot (I_1 - I_2) = 470 \cdot (0.01158 - 0.00908) \approx 1.18 \, \text{V} \\)。
- \\( V_{R3} = R3 \cdot I_2 = 680 \cdot 0.00908 \approx 6.17 \, \text{V} \\) (ただし、電源により5Vに制限)。

---

### **ステップ 3: Arduinoで検証**

#### **Arduinoコード**
```cpp
void setup() {
  Serial.begin(9600); // シリアル通信を開始
}

void loop() {
  // 電圧を読み取る (0-1023 は 0-5V にマッピング)
  int sensorValueR1 = analogRead(A0); // R1両端
  int sensorValueR2 = analogRead(A1); // R2両端
  int sensorValueR3 = analogRead(A2); // R3両端

  // 電圧値に変換
  float VR1 = sensorValueR1 * (5.0 / 1023.0);
  float VR2 = sensorValueR2 * (5.0 / 1023.0);
  float VR3 = sensorValueR3 * (5.0 / 1023.0);

  // 抵抗値
  float R1 = 330.0;
  float R2 = 470.0;
  float R3 = 680.0;

  // 電流を計算 (I = V/R)
  float I1 = VR1 / R1;              // R1を流れるMesh 1の電流
  float I2 = VR3 / R3;              // R3を流れるMesh 2の電流
  float IR2 = VR2 / R2;             // R2を流れる電流 (I1 - I2)

  // 結果を出力
  Serial.println("測定値:");
  Serial.print("VR1 (V): "); Serial.println(VR1);
  Serial.print("VR2 (V): "); Serial.println(VR2);
  Serial.print("VR3 (V): "); Serial.println(VR3);
  Serial.print("I1 (mA): "); Serial.println(I1 * 1000);
  Serial.print("I2 (mA): "); Serial.println(I2 * 1000);
  Serial.print("I1 - I2 (mA): "); Serial.println((I1 - I2) * 1000);
  Serial.println("---");

  delay(2000); // 2秒待機
}
```

#### **配線の注意点**
- A0をNode A (5V) と Node Bの間に接続。
- A1をNode BとNode C (GND)の間に接続。
- A2をNode A (5V) と Node C (GND)の間に接続。
- 全てのGNDがArduinoのGNDと共通であることを確認。

---

### **ステップ 4: 結果の比較**

#### **理論値 vs 測定値**
- **理論値 (メッシュ解析より):**
  - \\( I_1 \approx 11.58 \, \text{mA} \\)
  - \\( I_2 \approx 9.08 \, \text{mA} \\)
  - \\( I_1 - I_2 \approx 2.50 \, \text{mA} \\)
  - \\( V_{R1} \approx 3.82 \, \text{V} \\), \\( V_{R2} \approx 1.18 \, \text{V} \\), \\( V_{R3} \approx 5 \, \text{V} \\) (制限値)。
- **測定値:** シリアルモニタ (9600 baud) を開き、Arduinoの出力とこれらの値を比較。

#### **検証**
- \\( V_{R1} + V_{R2} \approx 5V \\) (Mesh 1ループ) であることを確認。
- \\( V_{R3} \approx 5V \\) (Mesh 2ループ) であることを確認。
- \\( I_1 - I_2 \\) がR2を流れる電流と一致することを確認。

---

### **ヒントとトラブルシューティング**
- **精度:** ArduinoのADC分解能は約4.9mVであり、抵抗器の許容誤差により多少のずれが生じる可能性があります。正確な検証にはマルチメーターを使用してください。
- **調整:** 電圧が5Vを超える場合（ここでは起こりにくい）、電圧分圧器を使用して電圧を下げてください。
- **発展:** 複雑さを増すためにメッシュや部品を追加できますが、ピンの制限 (A0–A5) に注意してください。

このセットアップは、理論的な電流と測定された電流を一致させることでメッシュ解析を確認します。回路の改良、デバッグ、またはメッシュの追加についてサポートが必要な場合はお知らせください！