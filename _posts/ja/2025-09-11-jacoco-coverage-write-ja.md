---
audio: false
date: 2025-09-11
generated: true
image: false
lang: ja
layout: post
model: openai/gpt-5
title: JaCoCoカバレッジデータ書き込み動作
translated: true
type: note
---

**統合テスト**（または任意のJVMプロセス）で**JaCoCoエージェント**を使用する場合、カバレッジデータは**JVM終了時に自動的には `.exec` ファイルに書き込まれません**。仕組みは以下の通りです：

---

### JaCoCoがカバレッジデータを書き込むタイミング
- **JVMシャットダウン時**: JaCoCoエージェントは、**JVMが正常にシャットダウンした場合**（例：メインメソッドの終了やテストスイートの完了時）に、収集したカバレッジデータをフラッシュして `.exec` ファイルに**書き込みます**。
- **JVMがクラッシュした場合**: JVMが突然終了した場合（例：クラッシュや `System.exit()` による終了）、エージェントがデータを書き込む機会を**得られない可能性があり**、一部のカバレッジ情報が失われる可能性があります。

---

### データ書き込みを確実にする方法
1. **正常なシャットダウン**: 統合テストやアプリケーションが正常に終了することを確認してください（例：強制終了しない）。
2. **明示的なダンプ（オプション）**: JaCoCoランタイムAPI（例：`org.jacoco.agent.rt.RT.getAgentRuntime().dump(true, outputFile)`）を使用して、実行中に手動でカバレッジデータのダンプをトリガーできます。これは長時間実行されるプロセスや、中間データを取得したい場合に便利です。

---

### 例となるシナリオ
- 統合テストスイートが正常に実行・完了した場合、JaCoCoエージェントは**JVMプロセスの終了時に**カバレッジデータを `jacoco.exec`（または指定したファイル）に書き込みます。
- JVMが強制終了された場合（例：`kill -9`）、データは書き込まれない可能性があります。

---

### ベストプラクティス
- **`append=true` を使用**: 複数のテストスイートを実行する場合、JaCoCoエージェントの引数に `append=true` を設定して、複数回の実行にわたってカバレッジデータを累積させます。
- **部分的なデータを確認**: JVMがクラッシュした場合、`.exec` ファイルは不完全であるか、最後の実行のデータが欠落している可能性があります。

---