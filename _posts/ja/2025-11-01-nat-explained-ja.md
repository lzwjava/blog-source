---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-4-fast
title: ネットワークアドレス変換の簡潔な解説
translated: true
type: note
---

### NAT（ネットワークアドレス変換）とは？

NATは、パケットがルーターやファイアウォールを通過する際に、ヘッダー内のIPアドレス（および場合によってはポート番号）を変更するネットワーク技術です。主な目的は、プライベート（ローカル）ネットワーク上の複数のデバイスがインターネットに接続する際に、単一のパブリックIPアドレスを共有できるようにすることです。これにより、パブリックIPアドレスの節約、内部ネットワークの詳細を隠すことによるセキュリティ向上、そしてプライベートネットワークがパブリックインターネットと通信できるようになります。

NATにはいくつかの一般的な種類があります：
- **ソースNAT（SNAT）**：送信パケットの送信元IPを変換します（例：プライベートIPからパブリックIPへ）。
- **デスティネーションNAT（DNAT）**：受信パケットの宛先IPを変換します（例：特定の内部サーバーにトラフィックを転送するため）。
- **ポートアドレス変換（PAT）**：SNATの一種で、ポート番号も再マッピングし、多くのプライベートデバイスが1つのパブリックIPを共有できるようにします。

NATは通常、ルーター、ファイアウォール、またはゲートウェイに実装されます。

### NATはローカルアドレス（例：192.168.0.x）を別のサブネットに変換しますか？

はい、その通りです。それはNATの核となる機能の一つです。192.168.0.x（または10.0.0.x、172.16-31.x.x）のようなプライベートIP範囲は（RFC 1918に基づき）パブリックインターネット上ではルーティングできません。あなたの自宅/オフィスのLAN上のデバイス（例：192.168.0.10）がトラフィックを送信するとき：

1.  NATデバイス（ルーターなど）は、送信元IPをプライベートIP（192.168.0.10）から自身のパブリックIP（例：203.0.113.5のような別のサブネットのもの）に変更します。
2.  また、元のIP/ポートの組み合わせを記録し、受信した応答を正しく書き戻せるようにします。
3.  この「変換」は送信トラフィックに対して動的に行われ、あなたのすべてのデバイスが1つのパブリックアドレスから来ているように見せます。

受信トラフィック（例：サーバーのホスティング）の場合、パブリックIPを特定のプライベートIPに戻すために、ポートフォワーディング（DNATの一種）などの追加設定が必要です。

### Windows XPにおけるNAT

ご指摘の通り、Windows XPには **インターネット接続の共有（ICS）** による組み込みのNATサポートが含まれていました。これにより、1台のPC（ゲートウェイとして機能）からローカルネットワーク上の他のPCへインターネット接続を共有できました。ICSはNATを使用して、プライベートIP（例：共有ネットワークからのもの）をホストPCのパブリックIPに変換しました。これは、コンシューマー向けルーターが普及する前に、小さなホームネットワークを設定する簡単な方法でした。ネットワーク接続の設定で有効にでき、192.168.0.xのようなDHCP IPを自動的に割り当てることもできました。

### 中国における「花生壳」プログラム（ローカルサーバーの公開）

おそらく **花生壳（Huāshēngké）**、一般に **Peanut Shell** として知られる、中国（および世界的に）人気のダイナミックDNS（DDNS）サービスのことを指していると思います。これはNAT自体ではありませんが、NATと *連携して* 「ローカルコンピューターをサーバーとして公開する」という問題を解決します。

- NATの背後（例：家庭用ルーター）では、あなたのローカルサーバー（例：192.168.0.50:80のWebサーバー）はプライベートIPのためにインターネットから直接アクセスできません。
- Peanut Shellは、あなたのパブリックIPを指すように動的に更新されるドメイン名（例：yourserver.peanuthull.com）を提供します。ルーターでのポートフォワーディングと組み合わせることで、NATを「突破」し、あなたのローカルマシンをパブリックサーバー（Webサイト、ゲーム、ファイル共有など用）として機能させます。
- これは、動的パブリックIPや厳格なNAT設定が行われる地域で特に有用であり、No-IPやDynDNSのようなサービスと同様に、2000年代初頭から存在しています。

もしこれが意図したプログラムでなければ、お気軽に詳細を説明してください！

### AWSにおけるNAT

AWSはクラウドネットワーキングでNATを広範に使用しています：
- **NAT Gateway**： パブリックサブネット内のマネージドサービスで、プライベートサブネット内のインスタンス（例：10.0.1.xのようなプライベートIPを持つ）が、それらを直接公開することなく、インターネットへの送信アクセス（例：ソフトウェア更新のため）を開始できるようにします。これはプライベートの送信元IPをゲートウェイのパブリックElastic IPに変換します。
- **NAT Instance**： EC2インスタンスをNATルーターとして使用するDIYの代替手段（現在ではあまり一般的ではありません）。
- これにより、プライベートリソースを安全に保ちながら、一方向の送信トラフィックを可能にします。VPC（Virtual Private Cloud）に最適です。

要するに、NATはプライベートとパブリックの世界を効率的に橋渡しするために、現代のネットワーキングの至る所で使用されています。特定の設定やシナリオ（例：トラブルシューティング）があれば、さらに深く掘り下げることができます！