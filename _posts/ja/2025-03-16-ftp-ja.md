---
audio: false
generated: true
lang: ja
layout: post
title: FTPサーバー
translated: true
type: note
---

UbuntuにFTPサーバーを設定して、iPadや他のデバイスから（`/var/www/movies/`にある`.mkv`ファイルなどの）ファイルにアクセスできるようにするには、**vsftpd**（Very Secure FTP Daemon）を使用できます。これは軽量で安全な選択肢です。以下に、あなたの環境に合わせたステップバイステップのガイドを示します：

### 前提条件
- Ubuntu（例：2025年3月15日現在の22.04または24.04）を使用している。
- sudo権限を持っている。
- Nginxサーバーが`192.168.1.27`にあり、ファイルが`/var/www/movies/`にある。

### ステップ1: vsftpdのインストール
1. **パッケージリストの更新**:
   ```bash
   sudo apt update
   ```
2. **vsftpdのインストール**:
   ```bash
   sudo apt install vsftpd -y
   ```
3. **インストールの確認**:
   ```bash
   sudo systemctl status vsftpd
   ```
   - `active (running)`と表示されるはずです。そうでない場合は、起動します：
     ```bash
     sudo systemctl start vsftpd
     sudo systemctl enable vsftpd  # 起動時に自動開始
     ```

### ステップ2: vsftpdの設定
デフォルトの設定ファイルは`/etc/vsftpd.conf`です。基本的なアクセス用に調整します。

1. **元の設定のバックアップ**:
   ```bash
   sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.bak
   ```

2. **設定の編集**:
   ```bash
   sudo nano /etc/vsftpd.conf
   ```
   以下の変更を加えます：
   - ローカルユーザーを有効化：
     ```bash
     local_enable=YES
     ```
   - ファイルアップロードを許可（オプション、ファイルをアップロードしたい場合）：
     ```bash
     write_enable=YES
     ```
   - ユーザーを自分のホームディレクトリに制限（オプション、セキュリティのため）：
     ```bash
     chroot_local_user=YES
     ```
   - 映画ディレクトリを指定（オプション、ユーザー設定はステップ3を参照）：
     - デフォルトでは、ユーザーは自分のホームディレクトリにアクセスします。これは後で調整します。

   保存（`Ctrl + O`、Enter、`Ctrl + X`）。

3. **vsftpdの再起動**:
   ```bash
   sudo systemctl restart vsftpd
   ```

### ステップ3: FTPユーザーの設定
既存のユーザーを使用するか、新しいユーザーを作成して`/var/www/movies/`にアクセスできます。

#### オプション1: 既存のユーザーを使用する
現在のUbuntuユーザー（例：`user`）を使用したい場合：
1. **ユーザー名の確認**:
   ```bash
   whoami
   ```
2. **パスワードの設定（必要な場合）**:
   ```bash
   sudo passwd user  # "user"をあなたのユーザー名に置き換え
   ```
3. **映画ディレクトリへのリンク作成**:
   - デフォルトでは、このユーザーのホームディレクトリ（例：`/home/user/`）がFTPのルートです。`/var/www/movies/`にアクセスするには、シンボリックリンクを作成します：
     ```bash
     ln -s /var/www/movies/ /home/user/movies
     ```
   - または、権限を調整します（安全性は低い）：
     ```bash
     sudo chown -R user:user /var/www/movies
     ```

#### オプション2: 専用のFTPユーザーを作成する
セキュリティを向上させるために：
1. **ユーザーの追加**:
   ```bash
   sudo adduser ftpuser
   ```
   - プロンプトに従ってパスワードと詳細を設定します。
2. **ホームディレクトリを映画ディレクトリに設定**:
   ```bash
   sudo usermod -d /var/www/movies ftpuser
   sudo chown -R ftpuser:ftpuser /var/www/movies
   ```

3. **アクセス制限（`chroot_local_user=YES`の場合）**:
   - `/var/www/movies`が`ftpuser`によって書き込み可能であることを確認します：
     ```bash
     sudo chmod -R 755 /var/www/movies
     ```

### ステップ4: ファイアウォールポートの開放
FTPはデフォルトでポート20と21を使用します。
1. **UFWでFTPを許可**:
   ```bash
   sudo ufw allow 21/tcp
   sudo ufw allow 20/tcp
   sudo ufw status
   ```
   - `20/tcp ALLOW`と`21/tcp ALLOW`が表示されるはずです。

2. **vsftpdの再起動**:
   ```bash
   sudo systemctl restart vsftpd
   ```

### ステップ5: iPadからFTPをテストする
iPadにFTPクライアントアプリが必要です。

#### 推奨iPadアプリ: FileZillaまたはFE File Explorer
- **FileZilla**（無料）:
  1. App Storeからインストール（「FileZilla」を検索）。
  2. FileZillaを開く。
  3. **New Site**または**Connect**をタップ。
  4. 入力：
     - ホスト: `192.168.1.27`
     - ユーザー名: `ftpuser`（またはあなたのユーザー名）
     - パスワード: [あなたのパスワード]
     - ポート: 21（デフォルト）
  5. **Connect**をタップ。
- **FE File Explorer**（無料、アプリ内課金あり）:
  1. App Storeからインストール。
  2. **+** > **FTP**をタップ。
  3. 上記と同じ詳細を入力。
  4. 接続。

#### FTPからのストリーミング
- ほとんどのFTPアプリではファイルを閲覧できます。`.mkv`ファイルをストリーミングするには：
  - アプリ内で`.mkv`ファイルをタップ。
  - 直接再生されない場合は、**VLC for Mobile**などのストリーミングアプリをダウンロードし、その**Network Stream**オプションでFTP URLを使用します：
    ```
    ftp://ftpuser:password@192.168.1.27/yourfile.mkv
    ```

### ステップ6: アクセスの確認
- iPadからFTPアプリを介して`192.168.1.27`に接続します。
- `/var/www/movies/`の内容（例：`yourfile.mkv`）が表示されるはずです。
- タップしてプレビューまたはストリーミング（アプリによる）。

### トラブルシューティング
- **接続拒否**: `sudo ufw status`を確認し、ポート20/21が開放されていることを確認します。vsftpdが実行中か確認します（`sudo systemctl status vsftpd`）。
- **権限が拒否されました**: ユーザーが`/var/www/movies/`を所有または読み取り可能か確認します（`ls -l /var/www/movies/`）。
- **404またはファイルなし**: ディレクトリパスがユーザーのホームまたはシンボリックリンクの設定と一致していることを確認します。

### 最終的な注意点
- **セキュリティ**: ローカルネットワークではこの設定で問題ありません。外部アクセスの場合は、`vsftpd.conf`でSSLを有効にしてFTPS（暗号化されたFTP）を検討してください。
- **NginxとFTP**: あなたはすでにNginxでHTTPストリーミングを行っています—FTPはファイル管理を追加します。FTPの設定が冗長に感じる場合は、iPadでVLCを使用してHTTPストリーミングを利用してください。

あなたのiPadは、UbuntuサーバーのファイルにアクセスするためのFTP「魔法」を手に入れました！問題が発生した場合はお知らせください。