---
audio: false
generated: true
image: false
lang: ja
layout: post
model: x-ai/grok-code-fast-1
title: CodeIgniterルーティングガイド
translated: true
type: note
---

### CodeIgniter ルーティングの概要

CodeIgniterのルーティングシステムでは、URL（URI）を特定のコントローラクラスとメソッドにマッピングでき、デフォルトのURLパターン（`example.com/controller/method/id/`）を上書きできます。これは、SEOに優しいURLの作成、RESTful APIの処理、またはリクエスト処理方法のカスタマイズに役立ちます。

提供されたコードスニペットは、CodeIgniterの `routes.php` 設定ファイルからのものです。連想配列 `$route` を定義しており、各キーはURIパターン、値は文字列（`controller/method`）またはHTTPメソッド（GET、POSTなど）ごとに異なる動作を指定する配列です。この設定は、標準的なルーティングとメソッド固有のルーティングの両方をサポートします。

CodeIgniterの標準的な動作とあなたのコード例に基づいて、**ルートの定義方法**、**動作原理**、**使用方法**について説明します。詳細については、公式CodeIgniterユーザーガイドのルーティングを参照してください: https://codeigniter.com/userguide4/general/routing.html。

#### 1. **ルートの定義方法**
ルートは `application/config/routes.php` で配列として定義されます。`$route[]` にエントリを追加します。構文は以下の通りです:

- **基本ルート**: 任意のHTTPメソッドをコントローラ/メソッドにマッピングします。
  ```
  $route['uri_segment'] = 'controller/method';
  ```
  - 例: `$route['login'] = 'users/login';` は、`/login` へのリクエストを `Users::login()` にルーティングします。

- **メソッド固有ルート**: RESTful APIでは、HTTPメソッド（GET、POST、PUTなど）ごとに異なるコントローラ/メソッドを指定できます。これには配列を使用します。
  ```
  $route['uri_segment'] = array(
      'METHOD1' => 'controller/method1',
      'METHOD2' => 'controller/method2'
  );
  ```
  - コード例: `$route['self'] = array('POST' => 'users/update', 'GET' => 'users/self');` は以下を意味します:
    - `/self` へのPOST → `Users::update()`。
    - `/self` へのGET → `Users::self()`。

- **ワイルドカードプレースホルダー**: 正規表現のようなパターンを使用して、URLの動的部分をキャプチャします（メソッドのパラメータとして渡されます）。
  - `(:any)`: 任意の文字（スラッシュを除く）にマッチ - 例: スラグや文字列。
  - `(:num)` または `(\d+)`: 数字のみにマッチ - ID用。
  - カスタム正規表現: 括弧で囲む - 例: 特定のマッチには `(foo|bar)`。
  - コード例:
    - `$route['users/(\d+)']['GET'] = 'users/one/$1';`: GET `/users/123` は `Users::one(123)` にルーティング。
    - `$route['lives/(\d+)/notify'] = 'lives/notifyLiveStart/$1';`: 任意のメソッドで `/lives/123/notify` は `Lives::notifyLiveStart(123)` にルーティング。

- **予約済みルート**:
  - `$route['default_controller'] = 'welcome';`: URIが指定されない場合にロードされるコントローラ（例: ルートURL → `Welcome` コントローラ）。
  - `$route['404_override'] = 'errors/page_missing';`: マッチしないルート用のコントローラ/メソッド（カスタム404）。
  - `$route['translate_uri_dashes'] = FALSE;`: TRUEの場合、URIのダッシュをコントローラ/メソッド名のアンダースコアに変換（例: `my-controller` → `my_controller`）。

- **順序が重要**: ルートは出現順にマッチされます。競合を避けるために、特定のルート（ワイルドカード付き）を一般的なルートの前に定義します。
- **HTTPメソッド**: 指定されていない場合、ルートはすべてのメソッドに適用されます。あなたのコードはAPIに適した精度のために配列を使用しています。

**コードでのルート定義のヒント**:
- 新しいルートは `$route['translate_uri_dashes']` の前に追加します。
- APIルートではPostmanなどのツールでテストし、正しいコントローラ/メソッドが呼び出されることを確認します。
- 複雑なアプリでは、コメント（`// users` など）でセクションごとにルートをグループ化します（あなたのコードで行われているように）。

#### 2. **ルートの動作原理**
CodeIgniterのルータは、各受信リクエストを以下の順序で処理します:
1. **URIの解析**: URLをセグメントに分解（例: `/users/123/edit` → セグメント: `users`, `123`, `edit`）。
2. **ルートとの照合**: `$route` 配列を上から下にチェック。最初に完全一致を探し、次にワイルドカード付きパターンを探します。
   - マッチが見つかると、指定されたコントローラ/メソッドにマッピングし、動的部分（例: `123`）をメソッド引数として渡します。
   - マッチしない場合、デフォルトパターン（`Controller::method/id/`）にフォールバックします。
3. **コントローラとメソッドのロード**: CodeIgniterはコントローラをインスタンス化し、メソッドを呼び出し、URIセグメントやキャプチャされたグループを渡します。
4. **メソッド固有の処理**: ルートが配列の場合（あなたのコードのように）、リクエストのHTTPメソッド（GET、POSTなど）をチェックします。
5. **フォールバック**: マッチしないリクエストは404をトリガーするか、`$route['404_override']` が設定されていればそれを呼び出します。

**処理フローの例**:
- リクエスト: `POST https://example.com/lives`
- マッチ: `$route['lives']['POST'] = 'lives/create';`
- 結果: 引数なしで `Lives::create()` を呼び出します。
- リクエストが `GET https://example.com/lives/456` の場合、`$route['lives/(\d+)']['GET'] = 'lives/one/$1';` にマッチ → `Lives::one(456)`。

**主要な仕組み**:
- **動的パラメータ**: キャプチャされたグループ（例: `$1`）はメソッドの引数として渡されます。コントローラメソッドがそれらを期待していることを確認してください。
- **セキュリティ**: ルートはURLを難読化することで、機密性の高いコントローラへの直接アクセスを防ぐのに役立ちます。
- **パフォーマンス**: 単純な配列ルックアップ。数百のルートがない限り、大きなオーバーヘッドはありません。

#### 3. **ルートの使用方法**
ルートを使用するには、上記のように設定し、アプリケーション（コントローラ、ビューなど）で活用します。

- **コントローラ内**: ルートがURLマッピングを処理すると仮定します。ルーティングされたリクエストを期待するメソッドを記述します。
  - 例: `$route['login']['POST'] = 'users/login';` の場合、POSTデータ（例: `$this->input->post()` 経由）を処理する `login()` メソッドを持つ `Users.php` コントローラを作成します。

- **URLの生成**: リンク/ボタンには、ルートキーと共にCodeIgniterの `site_url()` または `base_url()` を使用します。
  - 例: ビューで `<a href="<?= site_url('login'); ?>">Login</a>` はルーティングされたURLを指しますが、どのコントローラが処理するかはあなたのコードで定義されます。

- **ルートのテスト**:
  - WebブラウザやAPIツール（例: Postman）を使用して `/users/register` などのURLにアクセスします。
  - ルートが失敗した場合、`application/logs/log-{date}.php` でエラーを確認します。
  - デバッグ追加: 一時的に `$route['404_override']` をリセットし、テストコントローラでvar_dumpを使用してパラメータを確認します。

- **RESTfulな使用法（あなたのコードのように）**: あなたのルートはAPIのような構造用に設定されています。例:
  - リソース作成: POSTを `/lives` に送信 → ライブイベントを作成。
  - 読み取り: GET `/lives/123` → ライブイベント #123 を取得。
  - 更新: POST `/lives/123` → ライブイベント #123 を更新。

- **一般的な落とし穴とヒント**:
  - **重複**: 重複するルート（例: `lives` と `lives/(\d+)`）を避け、特定のものを先に配置します。
  - **メソッド指定なし**: ルートが文字列の場合、すべてのHTTPメソッドで動作します。精度のために配列を使用します。
  - **開発用**: コントローラでCodeIgniterのProfiler（`$this->output->enable_profiler(TRUE);`）を有効にしてルーティングをデバッグします。
  - **バージョン管理**: あなたの routes.php はバージョン管理下にあります - 変更はルーティングにライブで影響します。
  - **拡張**: 高度な機能（例: 名前空間サポート）が必要な場合、CI 3（あなたのコード）は古いため、CodeIgniter 4またはサードパーティライブラリを検討してください。

あなたのファイル内の特定のルート（例: なぜ `(\d+)` が使用されているか、新しいルートを追加する方法）について具体的な質問がある場合は、詳細を提供してください！ CodeIgniterのセットアップについては、index.phpで `CI_VERSION` が定義されていることを確認してください。