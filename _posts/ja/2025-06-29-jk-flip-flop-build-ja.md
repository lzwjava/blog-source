---
audio: false
generated: true
lang: ja
layout: post
title: JKフリップフロップの構築とテスト
translated: true
type: note
---

前回の動画では、JKフリップフロップとその動作について探求し、SRフリップフロップとの類似性を確認しましたが、フィードバック機構が追加されている点が異なります。このフィードバックにより、両方の入力が立ち上がりクロックエッジでハイの際に出力がトグルするようになり、未定義状態に入ることはありません。この動画では、その実用的な機能を構築し、観察することを目的としています。

提供された回路図に従ってJKフリップフロップを構築しました。構築中、回路図のラベル付けに誤りがあることに気づきました：こちらが実際にはK入力で、こちらがJ入力です。Jはセットに対応し、つまりJがハイになるとQ出力もハイになるべきです。逆に、Kはリセットに対応するため、KがハイになるとQ出力はローになるべきです。この小さなラベルの修正を除けば、回路の残りの部分は正確です。

NORゲートには74LS02チップ、具体的にはその上部にある2つのNORゲートを使用しています。もう一つのチップ、74LS11はトリプル3入力ANDゲートです。この3入力ANDゲートのうち2つを回路に使用しています。

電源を供給すると、回路は状態に落ち着き、Q出力は「オン」になっているように見えます。その後、クロック回路を接続しました。見えている2つのスイッチはプルダウン抵抗を介してローにプルダウンされています；ボタンを押すと入力はハイになります。これらのスイッチは緑色のワイヤーで2つのANDゲートに接続されており、K入力とJ入力として機能します。

クロック信号もANDゲートに入力されます。クロック信号はRC回路（0.0001マイクロファラッドのコンデンサと1000オームの抵抗で構成）を通過します。このRC回路の出力は、2本の白いワイヤーで運ばれ、両方のANDゲートの別の入力に入ります。これらのANDゲートの出力は青いワイヤーで表され、NORゲートの入力のうち2つに接続されます。NORゲートのもう一方の入力は、黄色いワイヤーを介して自身の出力からのフィードバックを受け取ります。これらの黄色いワイヤーはANDゲートにもループバックします。最後に、NORゲートの出力は2つのLED（Q用とQ補数用）を駆動します。

K入力をハイにすると、ラッチはリセットされ、Q出力はオフになるはずで、実際にそうなります。同様に、J入力をハイにすると、ラッチはセットされ、Q出力はオンになるはずで、これも実際にそうなります。重要な点は、変化がボタンを押した瞬間に即座に起こるのではなく、次のクロック信号とともに起こることです。この動作はクロックの立ち上がりエッジでゲートされているためです。

さて、これはJKフリップフロップなので、J入力とK入力の両方をハイに設定すると、出力は各クロックパルスでトグルすることが期待されます。しかし、一貫してトグルしているわけではありません。特に回路を少し操作するとトグルすることもありますが、非常に不安定です。両方のボタンを確実に押していることを確認するために、ボタンにジャンパーを挿入し、事実上JとKの両方に連続的なハイ入力を供給します。これにより、*すべての*立ち上がりクロックエッジでトグルすることが*期待されます*。今はより良く動作していますが、それでもまだ不安定です。

この不安定な動作には明確な説明があり、それを理解する最良の方法はオシロスコープを使用して信号を観察することです。

まず、基準としてクロック入力を確認します。オシロスコープはクロック信号がオンとオフを切り替えていることを示しており、約1秒間に2回です。オシロスコープ上の1目盛りは100ミリ秒を表すので、10目盛りで1秒間に2回パルスします。

次に、出力を観察したいと思います。これは各クロックパルスでトグルすることが期待される部分です。クロックは確かに約1秒間に2回パルスしています。現在、出力はトグルしていませんが、少し調整するとトグルします。しかし不安定です。トグル*する*ときは、期待通りクロックの立ち上がりエッジでトグルします。

興味深い部分は、クロックの立ち上がりエッジを拡大して観察すると現れます。そこに何らかの活動が見えます。さらに拡大すると、非常に明確になります：クロックがハイになると、出力は確かにトグルしますが、安定した状態に最終的に落ち着く前に、前後に複数回トグルします。これがまさに動作が不安定な理由です。出力は立ち上がりクロックエッジで期待通りトグルしますが、その後すぐに再び急速にトグルします。これらの急速なトグルの周期は約82ナノ秒です。

この現象は「レーシング」として知られており、回路図を再検討すると理解できます。クロックパルスは、その立上りエッジのみを使用する意図であっても、かなりの期間（この場合は250ミリ秒）ハイのままです。出力がこのパルスがゼロに戻る*前に*切り替わると、フィードバックループによって再度、そして再度切り替わり、複数回のトグルを引き起こします。したがって、クロックパルスがハイになると、出力はオンに切り替わりますが、その後、即座にオフとオンを繰り返し切り替えます。時々、期待された状態に落ち着くのは全くの偶然によるものです。

このレーシング状態の根本原因は、立上りエッジを検出するために使用されたRC回路にあります。コンデンサが0.0001マイクロファラッドで抵抗が1000オームであると述べました。これらの値を乗算すると、RC回路の時定数が得られ、パルス幅を示します。この時定数は約100ナノ秒です。

回路へのパルス入力を測定してみましょう。最初は、ズームアウトすると素晴らしく見えます – クロックの立ち上がりエッジで素早いパルスがあり、期待通りです。問題は、このパルスが十分に速く*ない*ことです。これは1マイクロ秒のパルスであり、その1マイクロ秒の間に、出力はオンとオフを繰り返しトグルし、パルスがロジックゼロに落ちた時に最終的に落ち着きます。

これに対して何ができるでしょうか？一つの選択肢は、パルスをより短くすることです。トグルの周期が約80ナノ秒であることを考えると、1マイクロ秒よりも大幅に短いパルスが必要です。1000オームの抵抗を100オームの抵抗に変更してみることができます。これにより時定数が100ナノ秒に減少するはずです。

抵抗を交換した後、はるかに小さなパルスが観察されます。しかし、それでもまだ一貫して動作していません。この時点で、ブレッドボードの限界に直面しています。数十ナノ秒の範囲の高速信号は、浮遊容量、インダクタンス、その他の寄生効果により、ブレッドボード上では困難です。これが、単に手を回路の近くで動かすだけで動作が変化する理由を説明しています。手が接地された物体として作用することで容量が変化するためです。

出力が現在、ハイになり、その後ローになり、ローに留まっていることがわかります。しかし再び、手を調整するとトグルを開始するかもしれません。接続は何も変えていません、ただ手を動かしているだけで、それが容量に影響を与えています。

私たちのクロックの立ち上がりエッジでさえ、この時間スケールではブレッドボードの限界により完全にシャープではありません。生成しているパルスは、より大きな抵抗を使用したときほどクリーンではありません。結局、これら全ては、ブレッドボード上で実現可能なことの限界に挑戦していることを示しています。RC回路を使用して立上りエッジを検出するこの特定の方法は、レーシング状態のためにJKフリップフロップでは本質的に問題があります。パルスが十分に狭くない（理想的には数ナノ秒程度）場合、出力はフィードバックされ、クロックの立上りエッジごとに複数回トグルします。

では、解決策は何でしょうか？次の動画では、このレーシング問題を完全に排除する、はるかに優れたJKフリップフロップの構築方法を実演します：マスタスレーブJKフリップフロップです。これははるかに堅牢な設計であり、ブレッドボード上でも問題なく動作するはずです。