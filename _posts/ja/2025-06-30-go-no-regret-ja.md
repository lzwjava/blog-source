---
audio: false
generated: true
lang: ja
layout: post
title: PingCAPとCloudflareがGo言語を称賛
translated: true
type: note
---

PingCAPもCloudflareもGoを使用したことについて「後悔」を表明したことはありません。実際、両社はGoの強みを公に称賛し、コア製品で広範に使用し続けています。しかし、彼らは言語選択に関して実用的でもあり、特定の問題により適している場合には他の言語も使用しています。

以下に詳細を示します：

### PingCAP (TiDB) と Go

* **後悔なし：** PingCAPは、優れた並行処理モデル（goroutineとchannel）、開発の容易さ、強力な標準ライブラリにより、TiDBのSQLレイヤー（`tidb-server`）にGoを選択しました。これらの特徴により、複雑な分散データベースを比較的短期間で構築することが可能になりました。
* **課題の認識：** GoがTiDBの中心である一方で、PingCAPは特にGoのガベージコレクタに関する課題について非常に率直に説明しています。彼らのドキュメントやブログ記事では頻繁に以下の点が議論されています：
    * **GCポーズ：** たとえ短時間であってもGCポーズが高性能データベースにおいてレイテンシーのジッターを引き起こす可能性があることを認めています。`GOGC`や`GOMEMLIMIT`のチューニング、適応的GCトリガーの実装を通じて、これを軽減するために積極的に取り組んでいます。
    * **メモリ管理：** Goにおける非効率なメモリパターンが問題を引き起こす可能性があることを認識し、メモリ使用量の監視やOOM問題のトラブルシューティングに関する詳細なガイドを提供しています。
* **Rustの戦略的使用：** PingCAPは、分散キーバリューストレージエンジンであるTiKVに **Rust** を選択しました。これはGoに対する「後悔」ではなく、極端な低レイテンシー、予測可能なパフォーマンス、きめ細かいメモリ制御が最も重要となるストレージレイヤーにおける **戦略的決定** でした。
    * Rustの所有権と借用モデル、およびガベージコレクタの欠如は、マイクロ秒単位、バイト単位が重要となるシステムレベルプログラミングに理想的です。
    * 彼らは、Rustの学習曲線が急峻でありコンパイル時間が長いというトレードオフは、重要なストレージエンジンでは許容可能だが、より急速に進化するSQLレイヤーでは望ましくないと判断しました。
* **PingCAPの結論：** 彼らはGoとRustを補完的なツールとして明確に捉えています。高レベルのロジックと迅速な反復開発にはGoを、低レベルでパフォーマンスがクリティカルなコンポーネントにはRustを使用しています。

### Cloudflare と Go

* **広範なGo採用：** CloudflareはGoの初期かつ熱心な採用者でした。DNSインフラ、SSL処理、負荷テストツール、多くの内部システムを含む、非常に多様なサービスにGoを使用しています。彼らは一貫してGoの並行処理、デプロイの容易さ、開発者生産性の高さについて肯定的に発言しています。
* **後悔ではなく進化：** Cloudflareは確かに言語使用を多様化させており、特に重要な領域での **Rust** への移行が顕著です。これはGoに対する「後悔」ではなく、パフォーマンス、セキュリティ、リソース効率の必要性によって推進されています。
    * **Pingora (Rust)：** 代表的な例は、Cloudflareが **Pingora** という新しいHTTPプロキシをRustで開発したことです。これはNGINXインフラ（Cで書かれていた）の一部を置き換えるためのものです。このRustへの移行は主に以下に関するものでした：
        * **メモリ安全性：** C/C++（NGINXなど）で蔓延している一般的なメモリバグ（バッファオーバーフロー、use-after-free）に対するRustの保証。これはセキュリティと安定性を大幅に向上させます。
        * **極限のパフォーマンス：** 何兆ものリクエストを処理するコアコンポーネントにおいて、Rustの「ゼロコスト抽象化」ときめ細かい制御は、Go（GCオーバーヘッドのため）で容易に達成可能なレベルよりも、さらに高性能かつ低リソース消費を実現します。
        * **システムプログラミングにおける改善された開発者体験：** Rustは初期の学習曲線が急峻ですが、極めて低レベルなネットワークコンポーネントを扱うシステムエンジニアにとって、その厳密さと強力な型システムは、長期的にはより堅牢で推論しやすいコードにつながります。
    * **Goは依然として強力：** Pingoraがあっても、Cloudflareは多くのサービスをGoで開発し維持し続けています。彼らは、自身のワークロードの大部分においてGoは「十分に高速」であると見なし、その開発速度と運用の単純さを高く評価しています。
* **Cloudflareの結論：** Cloudflareはマルチ言語戦略を採用し、仕事に最適なツールを選択しています。Goは、特に迅速な開発と並行処理の恩恵を受けるサービスにおいて、彼らの基盤となる言語であり続けています。Rustは、最大のパフォーマンス、メモリ安全性、きめ細かい制御が最も重要となるシステムレベルコンポーネントで、ますます使用されるようになっています。

本質的に、両社は異なるプログラミング言語のトレードオフを理解している洗練されたエンジニアリング組織です。彼らはGoを選択したことを「後悔」しているのではなく、むしろ、クリティカルなインフラにとって重要な利点（例：GCの不在、メモリ安全性）を提供する特定の問題領域に対して、Rustのような他の言語を使用するという実用的なアプローチを示しています。