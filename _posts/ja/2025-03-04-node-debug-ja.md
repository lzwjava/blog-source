---
audio: false
generated: true
lang: ja
layout: post
title: Node.js で Debug パッケージを使ったデバッグ
translated: true
---

### 主要ポイント
- 「debug in npm」は、npmで管理されるNode.jsプロジェクトでログ記録に「debug」パッケージを使用することを指している可能性が高いです。
- 研究によると、パッケージをインストールするには `npm install debug` を使用し、コードで名前空間を使用して `require('debug')('myapp:component')` のように使用することが推奨されています。
- 証拠は、`DEBUG` 環境変数を設定することでデバッグ出力を有効にすることを示唆しています。例えば、`DEBUG=myapp:component npm run start` です。

### Debugパッケージのインストールと使用方法
Node.jsプロジェクトで「debug」パッケージを使用するには、まずnpmを使用してインストールします：
- プロジェクトディレクトリで `npm install debug` を実行します。

次に、JavaScriptコードでパッケージを要求し、名前空間を持つデバッグインスタンスを作成します：
- 例：`const debug = require('debug')('myapp:component'); debug('some message');`。

### デバッグ出力の有効化
アプリケーションを実行する際に `DEBUG` 環境変数を設定してデバッグメッセージを表示します：
- 例：`DEBUG=myapp:component node app.js` または `DEBUG=myapp:component npm run start` を実行します。

### 名前空間の制御
ワイルドカードまたは除外を使用して表示されるデバッグメッセージを制御できます：
- 複数の名前空間を有効にするには `DEBUG=myapp:* node app.js` を使用します。
- 特定の名前空間を除外するには `DEBUG=*,-myapp:exclude node app.js` を使用します。

---

### アンケートノート：npm内でのDebugの詳細な探求

このセクションでは、npmで管理されるNode.jsプロジェクト内で「debug」パッケージを使用する方法について、利用可能なドキュメントとリソースに基づいた包括的な概要を提供します。実践的な実装、高度な機能、開発者のための考慮事項に焦点を当て、初心者から経験豊富なユーザーまでを対象に、徹底した理解を目指します。

#### npmコンテキストにおけるDebugの紹介
「debug in npm」というフレーズは、npm（Node Package Manager）で管理されるプロジェクト内で「debug」パッケージを使用することを指す可能性が高いです。このパッケージは、Node.jsおよびブラウザ環境向けの軽量なデバッグユーティリティです。検索結果における「debug」パッケージの顕著な存在と、Node.js開発に対する関連性から、この解釈は一般的な開発者のログ記録およびデバッグのニーズに対応しています。このパッケージは、最新の更新ではバージョン4.4.0であり、npmレジストリに55,746の他のプロジェクトが採用していることから、エコシステムにおける標準的なステータスを示しています。

#### インストールと基本的な使用方法
まず、npmを使用して「debug」パッケージをインストールします：
- コマンド：`npm install debug`
- これにより、パッケージがプロジェクトの `node_modules` に追加され、`package.json` が更新されます。

JavaScriptコードでパッケージを要求し、名前空間を使用して初期化してデバッグメッセージをカテゴリ分けします：
- 例：`const debug = require('debug')('myapp:component');`。
- デバッグインスタンスを使用してメッセージをログに記録します：`debug('some message');`。
- 名前空間（例：'myapp:component'）は、メッセージの出所を特定するのに役立ち、大規模なアプリケーションでのログのフィルタリングを容易にします。

これらのデバッグメッセージを表示するには、アプリケーションを実行する際に `DEBUG` 環境変数を設定します：
- 例：`DEBUG=myapp:component node app.js`。
- アプリケーションがnpmスクリプト（例：`npm run start`）を介して起動する場合は、以下のようにします：`DEBUG=myapp:component npm run start`。
- この環境変数は、どの名前空間が有効かを制御し、コードを変更せずに選択的なデバッグを行うことができます。

#### 高度な機能と設定
「debug」パッケージには、使用性を向上させるためのいくつかの高度な機能があります：

##### 名前空間の制御とワイルドカード
- ワイルドカードを使用して複数の名前空間を有効にします：`DEBUG=myapp:* node app.js` は、'myapp:' で始まるすべての名前空間からのデバッグメッセージを表示します。
- マイナス記号を使用して特定の名前空間を除外します：`DEBUG=*,-myapp:exclude node app.js` は、'myapp:exclude' で始まる名前空間を除くすべての名前空間を有効にします。
- この選択的なデバッグは、アプリケーションの特定の部分に焦点を当てるために重要です。

##### カラーコーディングと視覚的な解析
- デバッグ出力には、名前空間名に基づくカラーコーディングが含まれており、視覚的な解析を助けます。
- カラーコーディングは、Node.jsでstderrがTTY（ターミナル）の場合にデフォルトで有効になります。さらに、`supports-color` パッケージをdebugと一緒にインストールすることで、より広範なカラーパレットを得ることができます。
- ブラウザでは、WebKitベースのインスペクター、Firefox（バージョン31以降）、Firebugでカラーが機能し、開発ツールでの可読性が向上します。

##### 時間差とパフォーマンスの洞察
- パッケージは、デバッグ呼び出し間の時間差を表示し、パフォーマンス分析に役立ちます。
- この機能は自動的に有効になり、stdoutがTTYでない場合は `Date#toISOString()` を使用して環境間の一貫性を保ちます。

##### 環境変数とカスタマイズ
いくつかの環境変数でデバッグ出力を微調整できます：
| 名前             | 用途                              |
|------------------|--------------------------------------|
| DEBUG            | 名前空間の有効/無効                  |
| DEBUG_HIDE_DATE  | 非TTY出力の日付を非表示にする         |
| DEBUG_COLORS     | 出力でカラー使用を強制               |
| DEBUG_DEPTH      | オブジェクトの検査深度を設定           |
| DEBUG_SHOW_HIDDEN| オブジェクトの非表示プロパティを表示   |

- 例：`DEBUG_DEPTH=5` を設定することで、複雑なデータ構造に対する深いオブジェクト検査が可能になります。

##### カスタムフォーマッターによるカスタム出力
デバッグは、異なるデータ型のためのカスタムフォーマッターをサポートし、ログの可読性を向上させます：
| フォーマッター | 表現                      |
|-----------|-------------------------------------|
| %O        | オブジェクトの美しい表示（複数行）|
| %o        | オブジェクトの美しい表示（1行）   |
| %s        | 文字列                              |
| %d        | 数値（整数/浮動小数点）              |
| %j        | JSON、循環参照を処理               |
| %%        | 単一のパーセント記号                 |

- カスタムフォーマッターを拡張することができます。例：`createDebug.formatters.h = (v) => v.toString('hex')` は、16進数出力のためです。

#### npmスクリプトとの統合
npmスクリプトを使用するプロジェクトでは、デバッグの統合はスムーズです：
- `package.json` スクリプトをデバッグ設定を含めるように修正することができますが、通常はランタイムで `DEBUG` を設定するだけで十分です。
- 例：`"start": "node app.js"`、実行は `DEBUG=myapp:component npm run start`。
- Windowsユーザーは、CMDで `set DEBUG=* & node app.js` またはPowerShellで `$env:DEBUG='*';node app.js` を使用して、クロスプラットフォームの互換性を確保します。

#### ブラウザサポートとエッジケース
デバッグは主にNode.js向けですが、ブラウザ環境もサポートしています：
- Browserifyなどのツールを使用してビルドするか、[browserify-as-a-service](https://wzrd.in/standalone/debug@latest) などのサービスを使用してクライアント側に含めます。
- ブラウザで有効な状態を `localStorage.debug` に保存します。例：`localStorage.debug = 'worker:*'`。
- 注意：Chromiumベースのブラウザ（Brave、Chrome、Electron）では、完全な機能を得るために「詳細」ログレベルを有効にする必要がある場合があります。

#### ベストプラクティスと考慮事項
- 例：`connect:bodyParser` のような説明的な名前空間を使用して、ログの明確さを保ちます。
- 名前空間に「*」を追加して常に有効なデバッグを設定します。例：`DEBUG=connect:*`。
- プロダクション環境では、不要なログを避けるために `DEBUG` を設定しないようにしてください。デバッグステートメントは変数が設定されていない限り無音です。
- パフォーマンスを考慮：デバッグは軽量で、有効にされていない限りログを出力しないため、開発環境ではパフォーマンスに影響を与えません。

#### 予期せぬ詳細：npm自体のデバッグ
主な焦点は「debug」パッケージですが、「debug in npm」はnpmツール（例：`npm install` の問題）自体をデバッグすることと誤解されることがあります。そのような場合は、npmの `--verbose` フラグを使用して詳細な出力を得ますが、これは「debug」パッケージを使用するのとは異なります。この区別は、npm関連のデバッグを探索するユーザーにとって重要ですが、コンテキストからはパッケージの方が関連性が高いです。

#### 結論
npmで管理されるNode.jsプロジェクトで「debug」パッケージを使用することは、選択的なデバッグを実装するための強力で柔軟な方法を提供します。`npm install debug` を使用してインストールし、名前空間を使用して要求し、`DEBUG` を介して出力を制御することで、開発者は効率的にログを管理し、カラーを使用して可読性を向上させ、パフォーマンスを分析することができます。このアプローチは、現代の開発実践に適合し、デバッグワークフローにおける詳細と制御のバランスを提供します。

**主要な引用元：**
- [debug npmパッケージの詳細な使用ガイド](https://www.npmjs.com/package/debug)