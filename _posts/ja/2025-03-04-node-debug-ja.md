---
audio: false
generated: true
lang: ja
layout: post
title: Node.jsでのDebugパッケージを使ったデバッグ
translated: true
type: note
---

### 主なポイント
- 「npm でのデバッグ」は、npm で管理される Node.js プロジェクトでロギングに「debug」パッケージを使用することを指す可能性が高いです。
- 調査によると、`npm install debug` でパッケージをインストールし、コード内で `require('debug')('myapp:component')` のような名前空間を使用して利用します。
- 証拠は、`DEBUG` 環境変数を設定してデバッグ出力を有効にする方法、例えば `DEBUG=myapp:component npm run start` などに傾いています。

### Debug パッケージのインストールと使用
Node.js プロジェクトで「debug」パッケージを使用するには、まず npm を使用してインストールします：
- プロジェクトディレクトリで `npm install debug` を実行します。

次に、JavaScript コード内でパッケージを require し、名前空間を指定して debug インスタンスを作成します：
- 例: `const debug = require('debug')('myapp:component'); debug('some message');`

### デバッグ出力の有効化
デバッグメッセージを表示するには、アプリケーション実行時に `DEBUG` 環境変数を設定します：
- 例: `DEBUG=myapp:component node app.js` または、npm スクリプトを使用している場合は `DEBUG=myapp:component npm run start` を実行します。

### 名前空間の制御
ワイルドカードや除外を使用して、表示されるデバッグメッセージを制御できます：
- 複数の名前空間を有効にする: `DEBUG=myapp:* node app.js`
- 特定の名前空間を除外する: `DEBUG=*,-myapp:exclude node app.js`

---

### 調査ノート: npm での Debug 使用の詳細な探求

このセクションでは、利用可能なドキュメントとリソースに基づいて、npm で管理される Node.js プロジェクト内での「debug」パッケージの使用に関する包括的な概要を提供します。焦点は、実用的な実装、高度な機能、および開発者向けの考慮事項に当てられ、初心者と経験豊富なユーザーの両方に対して徹底的な理解を保証します。

#### npm コンテキストにおける Debug の紹介
「debug in npm」というフレーズは、npm (Node Package Manager) で管理されるプロジェクト内で、Node.js およびブラウザ環境用の軽量なデバッグユーティリティである「debug」パッケージを利用することを指す可能性が最も高いです。検索結果における「debug」パッケージの顕著性と、Node.js 開発におけるロギングとデバッグに対する一般的な開発者のニーズとの関連性を考慮すると、この解釈は npm 管理プロジェクトにおける共通の必要性に合致します。このパッケージは、現在（最近の更新時点で）バージョン 4.4.0 であり、npm レジストリ内の 55,746 以上の他のプロジェクトで採用されていることから、エコシステムにおける標準的な地位を示しています。

#### インストールと基本的な使用法
始めるには、npm を使用して「debug」パッケージをインストールします：
- コマンド: `npm install debug`
- これにより、パッケージがプロジェクトの `node_modules` に追加され、`package.json` が更新されます。

JavaScript コード内でパッケージを require し、デバッグメッセージを分類するための名前空間を指定して初期化します：
- 例: `const debug = require('debug')('myapp:component');`
- debug インスタンスを使用してメッセージをログ出力: `debug('some message');`
- 'myapp:component' のような名前空間は、メッセージのソースを識別するのに役立ち、大規模なアプリケーションでのログのフィルタリングを容易にします。

これらのデバッグメッセージを表示するには、アプリケーション実行時に `DEBUG` 環境変数を設定します：
- 例: `DEBUG=myapp:component node app.js`
- アプリケーションが npm スクリプト（例: `npm run start`）経由で起動する場合は、`DEBUG=myapp:component npm run start` を使用します。
- この環境変数は、どの名前空間が有効になるかを制御し、コードを変更することなく選択的なデバッグを保証します。

#### 高度な機能と設定
「debug」パッケージは、使いやすさを向上させるためのいくつかの高度な機能を提供します：

##### 名前空間制御とワイルドカード
- ワイルドカードを使用して複数の名前空間を有効にする: `DEBUG=myapp:* node app.js` は、'myapp:' で始まるすべての名前空間からのデバッグメッセージを表示します。
- マイナス記号を使用して特定の名前空間を除外する: `DEBUG=*,-myapp:exclude node app.js` は、'myapp:exclude' で始まる名前空間を除くすべての名前空間を有効にします。
- この選択的なデバッグは、ログに圧倒されることなくアプリケーションの特定の部分に焦点を当てるために重要です。

##### カラーコーディングと視覚的解析
- デバッグ出力には、名前空間名に基づくカラーコーディングが含まれ、視覚的な解析を支援します。
- 色は、Node.js では stderr が TTY（端末）である場合にデフォルトで有効になり、より広範なカラーパレットのために `supports-color` パッケージを debug と一緒にインストールすることで強化できます。
- ブラウザでは、WebKit ベースのインスペクタ、Firefox（バージョン 31 以降）、および Firebug で色が機能し、開発ツールでの可読性を高めます。

##### 時間差とパフォーマンス分析
- このパッケージは、デバッグ呼び出し間の時間差を "+NNNms" のプレフィックス付きで表示できます。これはパフォーマンス分析に有用です。
- この機能は自動的に有効になり、stdout が TTY でない場合には `Date#toISOString()` を使用し、環境間での一貫性を保証します。

##### 環境変数とカスタマイズ
いくつかの環境変数がデバッグ出力を微調整します：
| 名前                | 目的                                  |
|---------------------|---------------------------------------|
| DEBUG               | 名前空間の有効/無効を切り替える        |
| DEBUG_HIDE_DATE     | 非 TTY 出力で日付を非表示にする        |
| DEBUG_COLORS        | 出力での色使用を強制する               |
| DEBUG_DEPTH         | オブジェクト検査の深さを設定する       |
| DEBUG_SHOW_HIDDEN   | オブジェクト内の隠しプロパティを表示する |

- 例えば、`DEBUG_DEPTH=5` を設定すると、複雑なデータ構造に対して有用な、より深いオブジェクト検査が可能になります。

##### カスタム出力のためのフォーマッタ
Debug は、さまざまなデータ型に対するカスタムフォーマッタをサポートし、ログの可読性を高めます：
| フォーマッタ | 表現                                   |
|-------------|----------------------------------------|
| %O          | オブジェクトを整形して表示（複数行）    |
| %o          | オブジェクトを整形して表示（単一行）    |
| %s          | 文字列                                 |
| %d          | 数値（整数/浮動小数点数）               |
| %j          | JSON、循環参照を処理する               |
| %%          | 単一のパーセント記号                   |

- カスタムフォーマッタは拡張可能です。例: `createDebug.formatters.h = (v) => v.toString('hex')`（16進数出力用）。

#### npm スクリプトとの統合
npm スクリプトを使用するプロジェクトでは、debug の統合はシームレスです：
- 必要に応じて `package.json` のスクリプトを変更してデバッグ設定を含めることができますが、通常は実行時に `DEBUG` を設定するだけで十分です。
- スクリプトの例: `"start": "node app.js"`、`DEBUG=myapp:component npm run start` で実行。
- Windows ユーザーの場合は、CMD で `set DEBUG=* & node app.js` または PowerShell で `$env:DEBUG='*';node app.js` を使用し、クロスプラットフォームの互換性を確保します。

#### ブラウザサポートとエッジケース
主に Node.js 用ですが、debug はブラウザ環境もサポートします：
- Browserify のようなツールでビルドするか、クライアントサイドへの組み込みに [browserify-as-a-service](https://wzrd.in/standalone/debug@latest) のようなサービスを使用します。
- ブラウザで有効な状態を永続化するには `localStorage.debug` を使用します。例: `localStorage.debug = 'worker:*'`
- 注意: Chromium ベースのブラウザ（Brave, Chrome, Electron）では、完全な機能性のために「詳細」ログレベルを有効にする必要がある場合があります。

#### ベストプラクティスと考慮事項
- ログの明確性を維持するために、「connect:bodyParser」のような説明的な名前空間を使用します。
- 常に有効なデバッグのために名前空間に "*" を追加します。例: `DEBUG=connect:*`
- 本番環境では、不必要なロギングを避けるために `DEBUG` が設定されていないことを確認します。なぜなら、デバッグステートメントは変数が設定されていない場合は無言になるからです。
- パフォーマンスを考慮してください: debug は軽量で、有効にされたときのみロギングするため、本番環境に影響を与えずに開発に適しています。

#### 予期しない詳細: npm 自体のデバッグ
主な焦点は「debug」パッケージですが、「debug in npm」が npm ツール自体（例: `npm install` の問題）のデバッグとして誤って解釈される可能性があることに注意する価値があります。そのような場合は、詳細な出力のために npm の `--verbose` フラグを使用しますが、これは debug パッケージの使用とは異なります。この区別は、npm 関連のデバッグを探求するユーザーにとって重要ですが、文脈上、パッケージの方が関連性が高いことを示唆しています。

#### 結論
npm 管理の Node.js プロジェクトで「debug」パッケージを使用することは、選択的なデバッグを実装するための堅牢で柔軟な方法を提供します。`npm install debug` でインストールし、名前空間を指定して require し、`DEBUG` 経由で出力を制御することにより、開発者はログを効率的に管理し、色で可読性を高め、パフォーマンスを分析できます。このアプローチは、現代の開発プラクティスに沿っており、デバッグワークフローにおける詳細と制御のバランスを提供します。

**主な引用:**
- [debug npm パッケージ詳細使用ガイド](https://www.npmjs.com/package/debug)