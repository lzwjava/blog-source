---
audio: false
generated: true
image: false
lang: hi
layout: post
model: x-ai/grok-4-fast
title: рдЖрд░рдЯреАрдПрдХреНрд╕ 4070 рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдиреИрдиреЛрдЬреАрдкреАрдЯреА рдХреЙрдиреНрдлрд╝рд┐рдЧ
translated: true
type: note
---

рдпрд╣рд╛рдБ рдЖрдкрдХреЗ RTX 4070 (12 GB VRAM) рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдПрдХ nanoGPT рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╣реИ, рдЬреЛ **рд╕рд┐рд░реНрдл рдЗрд╕ рдПрдХрд▓ Parquet рдлрд╝рд╛рдЗрд▓** (~3.1 GB, CC-MAIN-2013-20/000_00000.parquet рд╕реЗ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

### рдореБрдЦреНрдп рд╕рдорд╛рдпреЛрдЬрди рдФрд░ рдЙрдирдХреЗ рдХрд╛рд░рдг
- **рдбреЗрдЯрд╛рд╕реЗрдЯ рдЖрдХрд╛рд░ рдЕрдиреБрдорд╛рди**: рдЗрд╕ рдПрдХ Parquet рдореЗрдВ рд▓рдЧрднрдЧ 1тАУ2 рдмрд┐рд▓рд┐рдпрди рдЯреЛрдХрди рд╣реИрдВ (FineWeb рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЬрд╣рд╛рдБ рдкреВрд░реНрдг CC-MAIN-2013-20 рдХреНрд░реЙрд▓ рдореЗрдВ ~100тАУ150 рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ ~144.5B рдЯреЛрдХрди рд╣реИрдВ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдлрд╛рдЗрд▓ рдЕрдЪреНрдЫреЗ рдХрдореНрдкреНрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдФрд╕рддрди 2тАУ4 GB рдХреА рд╣реИ)ред рдпрд╣ рдкреВрд░реНрдг FineWeb рд╕реЗ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ `max_iters` рдФрд░ `lr_decay_iters` рдХреЛ рдШрдЯрд╛ рджрд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ ~2тАУ3B рдХреБрд▓ рджреЗрдЦреЗ рдЧрдП рдЯреЛрдХрди рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ (125M рдкреИрд░рд╛рдореАрдЯрд░ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдУрд╡рд░рдлрд┐рдЯрд┐рдВрдЧ рдХреЗ рдмрд┐рдирд╛ рдЕрдЪреНрдЫреЗ рдХрдиреНрд╡рд░реНрдЬреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ 1тАУ2 рдпреБрдЧ)ред
- **рдореЗрдореЛрд░реА рдлрд┐рдЯ**: ~125M рдкреИрд░рд╛рдореАрдЯрд░ рдореЙрдбрд▓ (12L/12H/512embd) рдХреЗ рд╕рд╛рде рдмрдиреЗ рд░рд╣рдирд╛ тАУ рдпрд╣ рдЖрдкрдХреЗ 4070 рдкрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди ~9тАУ10 GB VRAM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ OOM (рдореЗрдореЛрд░реА рдЦрддреНрдо) рдХреА рд╕рдорд╕реНрдпрд╛ рдЖрддреА рд╣реИ, рддреЛ `batch_size` рдХреЛ 12 рдкрд░ рдпрд╛ `gradient_accumulation_steps` рдХреЛ 24 рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
- **рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЕрд╡рдзрд┐**: 5000тАУ10000 рдЗрдЯрд░реЗрд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ 4070 рдкрд░ ~5тАУ10 рдШрдВрдЯреЗ рд▓реЗрдЧрд╛ (~1тАУ2 рдЗрдЯрд░реЗрд╢рди/рд╕реЗрдХрдВрдб рдорд╛рдирддреЗ рд╣реБрдП)ред рд▓реЙрд╕ рдкрд░ рдирдЬрд░ рд░рдЦреЗрдВ; рдпрджрд┐ рдпрд╣ рд╕реНрдерд┐рд░ рд╣реЛ рдЬрд╛рдП рддреЛ рдЬрд▓реНрджреА рд░реЛрдХ рджреЗрдВред
- **рдЕрдиреНрдп рдЯреНрд╡реАрдХреНрд╕**: рдбреЗрдЯрд╛ рдЫреЛрдЯрд╛ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг LR рдереЛрдбрд╝рд╛ рдХрдо (рдХрдо рд╡рд┐рд╡рд┐рдзрддрд╛)ред рдмреЗрд╣рддрд░ рдЧреБрдгрд╡рддреНрддрд╛ рдХреЗ рд▓рд┐рдП `block_size=1024` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐ FineWeb рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓рдВрдмреЗ рд╕рдВрджрд░реНрднреЛрдВ рдкрд░ рдЬреЛрд░ рджреЗрддреЗ рд╣реИрдВред
- **рд╕реЗрдЯрдЕрдк рдиреЛрдЯ**: рдЖрдкрдХрд╛ wget рдПрдХ рдлрд╛рдЗрд▓ рдХреЛ `wikipedia_test_dump` рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИред рдЗрд╕реЗ nanoGPT рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
    - рдЗрд╕реЗ `data/fineweb/train/000_00000.parquet` рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдВ/рдирд╛рдо рдмрджрд▓реЗрдВ (рдпрд╛ `data/fineweb/prepare.py` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЖрдкрдХреЗ рдбрд┐рд░реЗрдХреНрдЯрд░реА рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗ рдФрд░ рдХреЗрд╡рд▓ рдЗрд╕реА рдлрд╛рдЗрд▓ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗ)ред
    - `train.bin`/`val.bin` рдореЗрдВ рдЯреЛрдХрдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `prepare.py` рдЪрд▓рд╛рдПрдВред
    - рдпрджрд┐ prepare.py рдПрдХрд╛рдзрд┐рдХ рдлрд╛рдЗрд▓реЛрдВ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╣реИрдХ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд╕рд┐рд░реНрдл рдЗрд╕ рдПрдХ рдкрд░ рд▓реВрдк рдЪрд▓рд╛рдПред

### рд╕рд┐рдВрдЧрд▓ Parquet (~1тАУ2B рдЯреЛрдХрди) рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╢рдВрд╕рд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧ

```python
out_dir = 'out-fineweb-single-parquet'
eval_interval = 500       # рдЫреЛрдЯреЗ рдбреЗрдЯрд╛ рдкрд░ рдЕрдзрд┐рдХ рдмрд╛рд░ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдВ
eval_iters = 200
log_interval = 50         # рдЕрдзрд┐рдХ рдмрд╛рд░ рд▓реЙрдЧ рдХрд░реЗрдВ
always_save_checkpoint = True

wandb_log = True          # рд╡реИрдХрд▓реНрдкрд┐рдХ
wandb_project = 'fineweb'
wandb_run_name = '125M-single-parquet-4070'

dataset = 'fineweb'       # рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдЕрдкрдиреА рд╕рд┐рдВрдЧрд▓ рдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП prepare.py рдХреЛ рдПрдбрд╛рдкреНрдЯ рдХрд┐рдпрд╛ рд╣реИ
gradient_accumulation_steps = 32     # рдкреНрд░рднрд╛рд╡реА рдмреИрдЪ рдЖрдХрд╛рд░: 16 * 32 = 512 рд╕реАрдХреНрд╡реЗрдВрд╕
batch_size = 16
block_size = 1024                    # FineWeb рдХреА рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ

# рдореЙрдбрд▓ (~125M рдкреИрд░рд╛рдореАрдЯрд░) тАУ 12 GB VRAM рдХреЗ рд▓рд┐рдП рдкрд░рдлреЗрдХреНрдЯ
n_layer = 12
n_head = 12
n_embd = 512
dropout = 0.0                        # рдпрджрд┐ рдУрд╡рд░рдлрд┐рдЯрд┐рдВрдЧ рд╣реЛ рддреЛ 0.1 рдЬреЛрдбрд╝реЗрдВ
learning_rate = 5e-4                 # рдЫреЛрдЯреЗ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рдХрдо
max_iters = 6000                     # ~3B рдЯреЛрдХрди рджреЗрдЦреЗ рдЧрдП (рдпрджрд┐ рд▓реЙрд╕ рдЧрд┐рд░рддрд╛ рд░рд╣реЗ рддреЛ 10000 рддрдХ рдПрдбрдЬрд╕реНрдЯ рдХрд░реЗрдВ)
warmup_iters = 500                   # рдЫреЛрдЯрд╛ рд╡рд╛рд░реНрдордЕрдк
lr_decay_iters = 6000
min_lr = 5e-5
beta2 = 0.99

# рд╕реНрдкреАрдб/рд╕реНрдЯреЗрдмрд┐рд▓рд┐рдЯреА рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реНрдЯреНрд░рд╛рд╕
compile = True            # 20тАУ30% рддреЗрдЬ рдЯреНрд░реЗрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП PyTorch compile
bias = False              # LLaMA/Mistral рдХреА рддрд░рд╣
weight_decay = 0.1
```

### рдЫреЛрдЯреЗ рдореЙрдбрд▓ рдХрд╛ рд╡рд┐рдХрд▓реНрдк (рдпрджрд┐ рдЖрдк рддреЗрдЬрд╝ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдпрд╛ рдХрдо рдореЗрдореЛрд░реА рдЪрд╛рд╣рддреЗ рд╣реИрдВ)
рдпрджрд┐ рдЙрдкрд░реЛрдХреНрдд ~11 GB VRAM рдкреАрдХ рдкрд░ рдкрд╣реБрдБрдЪрддрд╛ рд╣реИ, рддреЛ рдЗрд╕ ~84M рдкреИрд░рд╛рдореАрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЛ рдЖрдЬрд╝рдорд╛рдПрдВ (~7тАУ8 GB рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ):
```python
n_layer = 6
n_head = 6
n_embd = 384
learning_rate = 6e-4      # рдЫреЛрдЯреЗ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ
max_iters = 8000          # рдЕрдзрд┐рдХ рдЗрдЯрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдХрдореНрдкрдиреНрд╕реЗрдЯ рдХрд░реЗрдВ (~3тАУ4B рдЯреЛрдХрди)
```
рдЕрднреА рднреА рдареЛрд╕ рдЧреБрдгрд╡рддреНрддрд╛, рд▓реЗрдХрд┐рди 125M рд╕реЗ рдХрдордЬреЛрд░ред

### рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдпреБрдХреНрддрд┐рдпрд╛рдБ
- **рдкреНрд░рддрд┐ рдЗрдЯрд░реЗрд╢рди рдХреБрд▓ рдЯреЛрдХрди**: ~512 рд╕реАрдХреНрд╡реЗрдВрд╕ * 1024 рдЯреЛрдХрди = ~0.5M рдЯреЛрдХрдиред
- **рдпреБрдЧ (Epochs)**: рдлрд╛рдЗрд▓ рдореЗрдВ ~1.5B рдЯреЛрдХрди рдХреЗ рд╕рд╛рде, 6000 рдЗрдЯрд░реЗрд╢рди тЙИ 2 рдпреБрдЧред FineWeb рдЙрдЪреНрдЪ-рдЧреБрдгрд╡рддреНрддрд╛ рд╡рд╛рд▓рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП 1тАУ3 рдпреБрдЧ рдЖрджрд░реНрд╢ рд╣реИ тАУ рд╡реИрд▓ рд▓реЙрд╕ рдкрд░ рдирдЬрд░ рд░рдЦреЗрдВред
- **рдпрджрд┐ рдбреЗрдЯрд╛ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рд╣реИ**: `max_iters` рдмрдврд╝рд╛рдХрд░ рдПрдХрд╛рдзрд┐рдХ рдпреБрдЧ рд▓реВрдк рдХрд░реЗрдВред рдпрд╛ рдмреЗрд╣рддрд░ рд╡рд┐рд╡рд┐рдзрддрд╛ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдФрд░ Parquets (рдЬреИрд╕реЗ, 000_00001.parquet) рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред
- **рдореЙрдирд┐рдЯрд░**: рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП wandb рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрджрд┐ рд▓реЙрд╕ ~3.5тАУ4.0 рдкрд░реНрдкреНрд▓реЗрдХреНрд╕рд┐рдЯреА рд╕реЗ рдиреАрдЪреЗ рдирд╣реАрдВ рдЖрддрд╛ рд╣реИ, рддреЛ dropout=0.1 рдЬреЛрдбрд╝реЗрдВред
- **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░**: 4070 рдкрд░, `--compile` рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдФрд░ рдЧрддрд┐ рдХреЗ рд▓рд┐рдП `torch.backends.cuda.matmul.allow_tf32=True` рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдПрдВред

рдпрд╣ рдЖрдкрдХреЛ рдЗрд╕ рд╕рдмрд╕реЗрдЯ рдкрд░ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЫреЛрдЯрд╛ GPT рджреЗрдЧрд╛ред рдпрджрд┐ рдЖрдк prepare.py рд╕реЗ рд▓реЙрд╕ рдХрд░реНрд╡реНрд╕ рдпрд╛ рд╕рдЯреАрдХ рдЯреЛрдХрди рдХрд╛рдЙрдВрдЯ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдореИрдВ рдФрд░ рдкрд░рд┐рд╖реНрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ! ЁЯЪА