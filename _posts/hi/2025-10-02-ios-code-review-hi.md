---
audio: false
generated: true
image: false
lang: hi
layout: post
model: deepseek/deepseek-v3.2-exp
title: рдЖрдИрдУрдПрд╕ рдХреЛрдб рд╕рдореАрдХреНрд╖рд╛ рд╕рдВрдмрдВрдзреА рдЪрд┐рдВрддрд╛рдПрдБ рдФрд░ рд╕реБрдЭрд╛рд╡
translated: true
type: note
---

рдПрдХ iOS рдЗрдВрдЬреАрдирд┐рдпрд░ рдХреЗ рдирдЬрд░рд┐рдП рд╕реЗ, рдпрд╣рд╛рдВ рддрдХрдиреАрдХреА рдЪрд┐рдВрддрд╛рдУрдВ рдФрд░ рд╕рд┐рдлрд╛рд░рд┐рд╢реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рд╕реНрддреГрдд рдХреЛрдб рд╕рдореАрдХреНрд╖рд╛ рд╣реИ:

## ЁЯЪи **рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдФрд░ рдбрд┐рдЬрд╝рд╛рдЗрди рд╕рдорд╕реНрдпрд╛рдПрдВ**

### **1. рдореИрд╕рд┐рд╡ рд╡реНрдпреВ рдХрдВрдЯреНрд░реЛрд▓рд░ рдЙрд▓реНрд▓рдВрдШрди**
```objc
// рдпрд╣ рдХрдВрдЯреНрд░реЛрд▓рд░ рдмрд╣реБрдд рд╕рд╛рд░реА рдЬрд┐рдореНрдореЗрджрд╛рд░рд┐рдпрд╛рдВ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ:
- рдиреЗрдЯрд╡рд░реНрдХ рдСрдкрд░реЗрд╢рди (рдореИрд╕реЗрдЬ рднреЗрдЬрдирд╛/рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛)
- рдбреЗрдЯрд╛рдмреЗрд╕ рдСрдкрд░реЗрд╢рди (рдХреИрд╢рд┐рдВрдЧ, рдлреЗрд▓реНрдб рдореИрд╕реЗрдЬ)
- рдореАрдбрд┐рдпрд╛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ (рдЗрдореЗрдЬ/рд╡реАрдбрд┐рдпреЛ/рдСрдбрд┐рдпреЛ рд╣реИрдВрдбрд▓рд┐рдВрдЧ)
- UI рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рдкреНрд░рдмрдВрдзрди
- рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╣реИрдВрдбрд▓рд┐рдВрдЧ
- рдореИрд╕реЗрдЬрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдмрд┐рдЬрдиреЗрд╕ рд▓реЙрдЬрд┐рдХ
```

**рд╕рд┐рдлрд╛рд░рд┐рд╢**: рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВ:
- `MessageService` - рдиреЗрдЯрд╡рд░реНрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП
- `MessageRepository` - рдбреЗрдЯрд╛ рдкрд░рд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП
- `MediaProcessor` - рдореАрдбрд┐рдпрд╛ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП
- `MessageViewModel` - рдмрд┐рдЬрдиреЗрд╕ рд▓реЙрдЬрд┐рдХ рдХреЗ рд▓рд┐рдП

### **2. рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЯрд╛рдЗрдЯ рдХрдкрд▓рд┐рдВрдЧ**
```objc
// рдкреВрд░реЗ рдХреЛрдб рдореЗрдВ LeanCloud рдлреНрд░реЗрдорд╡рд░реНрдХ рдкрд░ рд╕реАрдзреА рдирд┐рд░реНрднрд░рддрд╛
@property (nonatomic, strong, readwrite) AVIMConversation *conv;
// рддреГрддреАрдп-рдкрдХреНрд╖ UI рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рд┐рдд
[self.shareMenuView reloadData];
```

**рд╕рдорд╕реНрдпрд╛**: рдЯреЗрд╕реНрдЯ рдХрд░рдирд╛, рдмрджрд▓рдирд╛, рдпрд╛ рд╕рд░реНрд╡рд┐рд╕реЗрдЬ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ред

### **3. рдЦрд░рд╛рдм рдПрд░рд░ рд╣реИрдВрдбрд▓рд┐рдВрдЧ**
```objc
- (BOOL)filterError:(NSError *)error {
    return [self alertError:error] == NO;  // рд╡реИрд▓рд┐рдбреЗрд╢рди рдореЗрдердб рдореЗрдВ рд╕рд╛рдЗрдб рдЗрдлреЗрдХреНрдЯреНрд╕
}

- (void)sendImage:(UIImage *)image {
    // рдПрд░рд░ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдмрд┐рдЬрдиреЗрд╕ рд▓реЙрдЬрд┐рдХ рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рд┐рдд
    if (error) {
        [self alert:@"write image to file error"];
    }
}
```

## ЁЯФз **рдореЗрдореЛрд░реА рдкреНрд░рдмрдВрдзрди рд╕рдВрдмрдВрдзреА рдЪрд┐рдВрддрд╛рдПрдВ**

### **1. рд░рд┐рдЯреЗрди рд╕рд╛рдЗрдХрд┐рд▓ рдФрд░ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╕рдорд╕реНрдпрд╛рдПрдВ**
```objc
- (void)dealloc {
    [[NSNotificationCenter defaultCenter] removeObserver:self];
    // рд▓реЗрдХрд┐рди рдСрдмреНрдЬрд░реНрд╡рд░ viewDidLoad рдореЗрдВ рдПрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, viewWillAppear рдореЗрдВ рдирд╣реАрдВ
    // рдпрджрд┐ dealloc рдХреЗ рдмрд╛рдж рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдЖрддреЗ рд╣реИрдВ рддреЛ рдЗрд╕рд╕реЗ рдХреНрд░реИрд╢ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ
}
```

**рд╕реБрдзрд╛рд░**:
```objc
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    [self addObservers];
}

- (void)viewDidDisappear:(BOOL)animated {
    [super viewDidDisappear:animated];
    [self removeObservers];
}
```

### **2. рдереНрд░реЗрдб рд╕реЗрдлреНрдЯреА рд╕рдорд╕реНрдпрд╛рдПрдВ**
```objc
@property (atomic, assign) BOOL isLoadingMsg;
// atomic рдЬрдЯрд┐рд▓ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдб рд╕реЗрдлреНрдЯреА рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рджреЗрддрд╛

- (void)insertMessage:(AVIMTypedMessage *)message {
    if (self.isLoadingMsg) {
        [self performSelector:@selector(insertMessage:) withObject:message afterDelay:1];
        return;  // рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХреА рд╕рдВрднрд╛рд╡рдирд╛
    }
}
```

## ЁЯУ▒ **UI рдФрд░ рдкрд░рдлреЙрд░реНрдореЗрдВрд╕ рд╕рдорд╕реНрдпрд╛рдПрдВ**

### **1. рдореЗрди рдереНрд░реЗрдб рдмреНрд▓реЙрдХрд┐рдВрдЧ**
```objc
- (void)cacheMsgs:(NSArray *)msgs callback:(AVBooleanResultBlock)callback {
    [self runInGlobalQueue:^{
        for (AVIMTypedMessage *msg in msgs) {
            // рдореЗрди рдереНрд░реЗрдб рдкрд░ рдлрд╛рдЗрд▓ рдСрдкрд░реЗрд╢рди?
            NSData *data = [file getData:&error]; // рдмреНрд▓реЙрдХрд┐рдВрдЧ рдХреЙрд▓!
        }
    }];
}
```

### **2. рдЕрдХреНрд╖рдо TableView рдЕрдкрдбреЗрдЯреНрд╕**
```objc
- (void)insertMessage:(AVIMTypedMessage *)message {
    [self.messages addObject:xhMessage];
    NSIndexPath *indexPath = [NSIndexPath indexPathForRow:self.msgs.count -1 inSection:0];
    [self.messageTableView insertRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationNone];
    // рдХреЛрдИ рдмреИрдЪрд┐рдВрдЧ рдирд╣реАрдВ, рдкреНрд░рддреНрдпреЗрдХ рдореИрд╕реЗрдЬ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЗрдВрд╕рд░реНрдЯ
}
```

## ЁЯЧВ **рдХреЛрдб рдСрд░реНрдЧрдирд╛рдЗрдЬреЗрд╢рди рд╕рдорд╕реНрдпрд╛рдПрдВ**

### **1. рдорд┐рд╢реНрд░рд┐рдд рдПрдмреНрд╕реНрдЯреНрд░рдХреНрд╢рди рд▓реЗрд╡рд▓**
```objc
// рд▓реЛ-рд▓реЗрд╡рд▓ рдлрд╛рдЗрд▓ рдСрдкрд░реЗрд╢рди рд╣рд╛рдИ-рд▓реЗрд╡рд▓ рдмрд┐рдЬрдиреЗрд╕ рд▓реЙрдЬрд┐рдХ рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рд┐рдд
NSData *imageData = UIImageJPEGRepresentation(image, 0.6);
NSString *path = [[CDChatManager manager] tmpPath];
[imageData writeToFile:path options:NSDataWritingAtomic error:&error];

// UI рдХреЛрдб рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рд┐рдд
[self finishSendMessageWithBubbleMessageType:XHBubbleMessageMediaTypeText];
```

### **2. рд▓рдВрдмреА рдореЗрдердбреНрд╕**
```objc
- (XHMessage *)getXHMessageByMsg:(AVIMTypedMessage *)msg {
    // 80+ рд▓рд╛рдЗрдиреЛрдВ рдХреА рдореЗрдердб рдЬрд┐рд╕рдореЗрдВ рдХрдИ рдЬрд┐рдореНрдореЗрджрд╛рд░рд┐рдпрд╛рдВ рд╣реИрдВ
    // рдореИрд╕реЗрдЬ рдХрдиреНрд╡рд░реНрдЬрди, рдореАрдбрд┐рдпрд╛ рд╣реИрдВрдбрд▓рд┐рдВрдЧ, рд╕реНрдЯреЗрдЯрд╕ рдореИрдкрд┐рдВрдЧ
}
```

## ЁЯзк **рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдФрд░ рдореЗрдВрдЯреЗрдирдмрд┐рд▓рд┐рдЯреА**

### **1. рдЕрдирдЯреЗрд╕реНрдЯреЗрдмрд▓ рдбрд┐рдЬрд╝рд╛рдЗрди**
```objc
// рдбрд╛рдпрд░реЗрдХреНрдЯ рд╕рд┐рдВрдЧрд▓рдЯрди рдпреВрд╕реЗрдЬ рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ
[[CDChatManager manager] sendMessage:msg...]
[[CDSoundManager manager] playSendSoundIfNeed]

// рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб рдирд┐рд░реНрднрд░рддрд╛рдПрдВ рдпреВрдирд┐рдЯ рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЛ рдЕрд╕рдВрднрд╡ рдмрдирд╛рддреА рд╣реИрдВ
```

### **2. SOLID рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди**
- **рд╕рд┐рдВрдЧрд▓ рд░реЗрд╕реНрдкреЙрдиреНрд╕рд┐рдмрд┐рд▓рд┐рдЯреА**: рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕рдм рдХреБрдЫ рдХрд░рддрд╛ рд╣реИ
- **рдУрдкрди/рдХреНрд▓реЛрдЬреНрдб**: рдмрд┐рдирд╛ рдореЙрдбрд┐рдлрд╛рдИ рдХрд┐рдП рдПрдХреНрд╕рдЯреЗрдВрдб рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓
- **рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА рдЗрдирд╡рд░реНрдЬрди**: рдХрдВрдХреНрд░реАрдЯ рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реАрдЬ рд╣рд░ рдЬрдЧрд╣

## ЁЯЫа **рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд░рд┐рдлреИрдХреНрдЯрд░рд┐рдВрдЧ**

### **1. рд╕рд░реНрд╡рд┐рд╕ рд▓реЗрдпрд░ рдПрдХреНрд╕рдЯреНрд░реИрдХреНрдЯ рдХрд░реЗрдВ**
```objc
@interface MessageDataService : NSObject
- (void)sendMessage:(AVIMTypedMessage *)message 
     conversation:(AVIMConversation *)conversation
        completion:(void(^)(BOOL success, NSError *error))completion;
@end

@interface MediaService : NSObject
- (void)processImage:(UIImage *)image completion:(void(^)(NSString *filePath, NSError *error))completion;
@end
```

### **2. MVVM рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
```objc
@interface ChatRoomViewModel : NSObject
@property (readonly) NSArray<MessageViewModel *> *messages;
@property (readonly) RACSignal *updateSignal;
- (void)sendTextMessage:(NSString *)text;
@end
```

### **3. рдЙрдЪрд┐рдд рдбреЗрдЯрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЗрдореНрдкреНрд▓реАрдореЗрдВрдЯ рдХрд░реЗрдВ**
```objc
// рдореИрдиреНрдпреБрдЕрд▓ рдЯреЗрдмрд▓ рд╡реНрдпреВ рдЕрдкрдбреЗрдЯ рдХреЗ рдмрдЬрд╛рдп
self.viewModel.updateSignal = [RACObserve(self.viewModel, messages) 
    deliverOnMainThread];
[self.viewModel.updateSignal subscribeNext:^(id x) {
    [self.tableView reloadData];
}];
```

## ЁЯУК **рддрддреНрдХрд╛рд▓ рд╕реБрдзрд╛рд░**

1. **рд╕рднреА рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрд▓реНрд╕** рдХреЛ рдПрдХ рд╕рд░реНрд╡рд┐рд╕ рд▓реЗрдпрд░ рдореЗрдВ рдПрдХреНрд╕рдЯреНрд░реИрдХреНрдЯ рдХрд░реЗрдВ
2. рдореИрдиреЗрдЬрд░реНрд╕ рдХреЗ рд▓рд┐рдП **рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░реЗрдВ
3. **рдЙрдЪрд┐рдд рдПрд░рд░ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рд╕реНрдЯреНрд░реИрдЯреЗрдЬреА** рдЗрдореНрдкреНрд▓реАрдореЗрдВрдЯ рдХрд░реЗрдВ
4. рдЯреЗрдмрд▓ рд╡реНрдпреВ рдХреЗ рд▓рд┐рдП **рдкрд░рдлреЙрд░реНрдореЗрдВрд╕ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдПрдб** рдХрд░реЗрдВ
5. рдХреЙрдорди рдЪреИрдЯ рдлрдВрдХреНрд╢рдиреИрд▓рд┐рдЯреА рдХреЗ рд▓рд┐рдП **рдмреЗрд╕ рдХреНрд▓рд╛рд╕ рдХреНрд░рд┐рдПрдЯ** рдХрд░реЗрдВ
6. **рд╡реНрдпрд╛рдкрдХ рдпреВрдирд┐рдЯ рдЯреЗрд╕реНрдЯреНрд╕** рдПрдб рдХрд░реЗрдВ
7. **рдореЙрдбрд░реНрди рдХрдирдХрд░реЗрдВрд╕реА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (GCD рдХреЗ рдмрдЬрд╛рдп async/await)
8. рд╡реАрдХ рд░реЗрдлрд░реЗрдВрд╕ рдХреЗ рд╕рд╛рде **рдЙрдЪрд┐рдд рдореЗрдореЛрд░реА рдореИрдиреЗрдЬрдореЗрдВрдЯ** рдЗрдореНрдкреНрд▓реАрдореЗрдВрдЯ рдХрд░реЗрдВ

рдпрд╣ рдХреЛрдб iOS рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдПрдВрдЯреА-рдкреИрдЯрд░реНрди рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдФрд░ рдореЙрдбрд░реНрди рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░рд▓ рдкреИрдЯрд░реНрди рдФрд░ рдмреЗрд╣рддрд░ рд╕реЗрдкрд░реЗрд╢рди рдСрдл рдХрдВрд╕рд░реНрди рд╕реЗ рдХрд╛рдлреА рд▓рд╛рднрд╛рдиреНрд╡рд┐рдд рд╣реЛрдЧрд╛ред