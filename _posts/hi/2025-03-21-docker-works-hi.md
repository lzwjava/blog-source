---
audio: false
generated: true
lang: hi
layout: post
title: डॉकर कैसे काम करता है
translated: true
type: note
---

आइए डॉकर के काम करने के तरीके को समझते हैं, विशेष रूप से इसके Linux फाइलसिस्टम के उपयोग और एप्लिकेशन्स को एक-दूसरे से अलग करने के तरीके पर ध्यान केंद्रित करते हुए।

---

### डॉकर का मूल सिद्धांत क्या है?
डॉकर एक प्लेटफॉर्म है जो आपको एप्लिकेशन्स को पैकेज, वितरित और चलाने की सुविधा देता है, जो हल्के, अलग-थलग वातावरण में होते हैं जिन्हें **कंटेनर्स** कहा जाता है। वर्चुअल मशीनों (VMs) के विपरीत, जिनमें एक पूरा ऑपरेटिंग सिस्टम शामिल होता है, डॉकर कंटेनर्स होस्ट OS के कर्नेल को साझा करते हैं और अलगाव व दक्षता प्रदान करने के लिए इसकी सुविधाओं का उपयोग करते हैं।

---

### डॉकर कैसे काम करता है
डॉकर कंटेनर्स को बनाने और प्रबंधित करने के लिए Linux कर्नेल की कई सुविधाओं का लाभ उठाता है:
1. **नैमस्पेसेज (Namespaces)** - अलगाव के लिए।
2. **कंट्रोल ग्रुप्स (cgroups)** - संसाधन प्रबंधन के लिए।
3. **यूनियन फाइलसिस्टम्स (Union Filesystems)** - कुशल स्टोरेज और लेयरिंग के लिए।

यहां बताया गया है कि ये टुकड़े एक साथ कैसे आते हैं:

---

#### 1. Linux नैमस्पेसेज: अलगाव तंत्र
नैमस्पेसेज सिस्टम संसाधनों के अलग-थलग "दृश्य" बनाते हैं, यह सुनिश्चित करते हुए कि एक कंटेनर में चलने वाली प्रक्रियाएं दूसरे कंटेनर वालों के साथ हस्तक्षेप नहीं करती हैं। डॉकर द्वारा उपयोग किए जाने वाले प्रमुख नैमस्पेसेज में शामिल हैं:

- **PID नैमस्पेस**: प्रत्येक कंटेनर का अपना प्रोसेस ID स्पेस होता है। कंटेनर के अंदर प्रोसेस ID 1 होस्ट के PID 1 (आमतौर पर `init` या `systemd`) से अलग होता है।
- **नेटवर्क नैमस्पेस**: कंटेनर्स को अपना खुद का नेटवर्क स्टैक (IP एड्रेस, पोर्ट, रूटिंग टेबल) मिलता है। इसीलिए दो कंटेनर्स बिना किसी संघर्ष के पोर्ट 8080 पर सुन सकते हैं।
- **माउंट नैमस्पेस**: प्रत्येक कंटेनर का फाइलसिस्टम का अपना दृश्य होता है, जो होस्ट और अन्य कंटेनर्स से अलग होता है।
- **UTS नैमस्पेस**: कंटेनर्स का अपना होस्टनेम और डोमेन नेम हो सकता है।
- **IPC नैमस्पेस**: इंटर-प्रोसेस कम्युनिकेशन (जैसे, शेयर्ड मेमोरी, मैसेज कतार) को अलग करता है।
- **यूजर नैमस्पेस** (वैकल्पिक): कंटेनर यूजर्स को होस्ट यूजर्स से मैप करता है, सुरक्षा बढ़ाता है।

**उदाहरण**: यदि आप एक कंटेनर के अंदर `ps` चलाते हैं, तो आपको केवल उस कंटेनर के PID नैमस्पेस के भीतर की प्रक्रियाएं दिखाई देती हैं, होस्ट की प्रक्रियाएं नहीं।

---

#### 2. कंट्रोल ग्रुप्स (cgroups): संसाधन सीमाएं
Cgroups प्रत्येक कंटेनर के लिए संसाधन उपयोग (CPU, मेमोरी, डिस्क I/O, आदि) को सीमित और मॉनिटर करते हैं। यह एक कंटेनर को सभी सिस्टम संसाधनों पर कब्जा करने और दूसरों को भूखा रखने से रोकता है।

- **यह कैसे काम करता है**: डॉकर प्रत्येक कंटेनर को एक cgroup निर्दिष्ट करता है। आप इस तरह की सीमाएं सेट कर सकते हैं:
  ```bash
  docker run --memory="512m" --cpus="0.5" myapp
  ```
  यह कंटेनर को 512 MB RAM और आधे CPU कोर तक सीमित कर देता है।

- **अलगाव**: जहां नैमस्पेस दृश्यता को अलग करते हैं, वहीं cgroups संसाधन खपत को अलग करते हैं।

---

#### 3. यूनियन फाइलसिस्टम: लेयर्ड स्टोरेज
डॉकर कंटेनर इमेज और उनके फाइलसिस्टम को कुशलतापूर्वक प्रबंधित करने के लिए एक **यूनियन फाइलसिस्टम** (जैसे, OverlayFS, AUFS) का उपयोग करता है। यह Linux फाइलसिस्टम से कैसे जुड़ता है:

- **इमेज लेयर्स**: एक डॉकर इमेज स्टैक्ड, रीड-ओनली लेयर्स से बनी होती है। प्रत्येक लेयर परिवर्तनों के एक सेट का प्रतिनिधित्व करती है (जैसे, कोई पैकेज इंस्टॉल करना, फाइल्स कॉपी करना) जो आपके `Dockerfile` में परिभाषित होते हैं।
  - उदाहरण: `FROM openjdk:17` एक लेयर है, `COPY app.jar` दूसरी जोड़ती है।
  - लेयर्स कैश्ड और पुन: उपयोग की जाती हैं, जिससे डिस्क स्पेस बचता है और बिल्ड तेज होते हैं।

- **कंटेनर फाइलसिस्टम**: जब आप एक कंटेनर चलाते हैं, तो डॉकर रीड-ओनली इमेज लेयर्स के शीर्ष पर एक पतली, लिखने योग्य लेयर जोड़ता है। इसे **कॉपी-ऑन-राइट (CoW)** तंत्र कहा जाता है:
  - रीड इमेज लेयर्स से आते हैं।
  - राइट (जैसे, लॉग फाइल्स, अस्थायी डेटा) राइटेबल लेयर में जाते हैं।
  - यदि किसी निचली लेयर में एक फाइल संशोधित की जाती है, तो उसे पहले राइटेबल लेयर में कॉपी किया जाता है (इसलिए "कॉपी-ऑन-राइट")।

- **अलगाव**: प्रत्येक कंटेनर को अपनी खुद की राइटेबल लेयर मिलती है, इसलिए एक कंटेनर में किए गए परिवर्तन दूसरों को प्रभावित नहीं करते हैं, भले ही वे एक ही बेस इमेज साझा करते हों।

- **डिस्क पर**: होस्ट पर, ये लेयर्स `/var/lib/docker` (जैसे, OverlayFS के लिए `/var/lib/docker/overlay2`) में संग्रहीत होती हैं। आप सीधे इसके साथ इंटरैक्ट नहीं करते—डॉकर इसे प्रबंधित करता है।

---

### एप्लिकेशन्स एक-दूसरे से कैसे अलग होते हैं
यहां बताया गया है कि उपरोक्त घटक एप्लिकेशन्स को अलग करने के लिए एक साथ कैसे काम करते हैं:

1. **प्रोसेस अलगाव (PID नैमस्पेस)**:
   - प्रत्येक कंटेनर अपने ऐप को एक स्वतंत्र प्रोसेस ट्री के रूप में चलाता है, जो अन्य कंटेनर्स या होस्ट से अनजान होता है।

2. **नेटवर्क अलगाव (नेटवर्क नैमस्पेस)**:
   - कंटेनर्स के अलग-अलग नेटवर्क इंटरफेस होते हैं। डॉकर का डिफॉल्ट "ब्रिज" नेटवर्क प्रत्येक कंटेनर को एक अद्वितीय IP प्रदान करता है, और NAT बाहरी संचार को संभालता है।
   - उदाहरण: दो Spring Boot ऐप अपने कंटेनर्स के अंदर बिना किसी संघर्ष के पोर्ट 8080 पर बाइंड कर सकते हैं।

3. **फाइलसिस्टम अलगाव (माउंट नैमस्पेस + यूनियनFS)**:
   - प्रत्येक कंटेनर केवल अपनी खुद की फाइलसिस्टम देखता है, जो इमेज लेयर्स और उसकी राइटेबल लेयर से बनी होती है।
   - यदि कंटेनर A `/tmp` में लिखता है, तो कंटेनर B इसे नहीं देखता है।

4. **संसाधन अलगाव (cgroups)**:
   - एक ऐप होस्ट के CPU या मेमोरी को समाप्त नहीं कर सकता है और दूसरे को क्रैश नहीं कर सकता है।

5. **साझा कर्नेल**:
   - कंटेनर्स होस्ट के Linux कर्नेल को साझा करते हैं, लेकिन नैमस्पेस यह सुनिश्चित करते हैं कि वे एक-दूसरे के रास्ते में न आएं। Syscalls को आवश्यकतानुसार फ़िल्टर या रीडायरेक्ट किया जाता है।

---

### सरलीकृत वर्कफ़्लो
1. **बिल्ड**: आप एक `Dockerfile` के साथ एक इमेज बनाते हैं, जो ऐप और उसकी निर्भरताओं को परिभाषित करता है। डॉकर इन्हें यूनियन फाइलसिस्टम का उपयोग करके लेयर्स में स्टैक कर देता है।
2. **रन**: डॉकर एक कंटेनर बनाता है:
   - अलगाव के लिए नैमस्पेसेज स्थापित करके।
   - संसाधन सीमाओं के लिए cgroups आवंटित करके।
   - इमेज लेयर्स और एक राइटेबल लेयर माउंट करके।
   - आपके ऐप को एंट्रीपॉइंट (जैसे, `java -jar app.jar`) के रूप में शुरू करके।
3. **क्लीनअप**: जब कंटेनर रुकता है, तो राइटेबल लेयर को छोड़ दिया जाता है (जब तक कि `docker commit` के साथ नई इमेज के रूप में सेव न किया गया हो)।

---

### Linux ही क्यों?
डॉकर Linux कर्नेल सुविधाओं (नैमस्पेसेज, cgroups, यूनियन फाइलसिस्टम) पर निर्भर करता है जो इसके संचालन के तरीके में गहराई से एकीकृत हैं। macOS या Windows पर, डॉकर इन क्षमताओं को प्रदान करने के लिए एक हल्का Linux VM (HyperKit या WSL2 के माध्यम से) चलाता है, फिर उन्हें होस्ट OS पर मैप करता है।

---

### दृश्य सादृश्य
डॉकर कंटेनर्स को एक इमारत में अपार्टमेंट के रूप में सोचें:
- **नैमस्पेसेज**: दीवारें और दरवाजे किरायेदारों को अलग रखते हैं।
- **Cgroups**: मकान मालिक प्रति यूनिट पानी या बिजली सीमित करता है।
- **यूनियनFS**: सभी अपार्टमेंट एक सामान्य ब्लूप्रिंट (इमेज लेयर्स) साझा करते हैं, लेकिन प्रत्येक किरायेदार अपनी जगह को सजा सकता है (राइटेबल लेयर)।

---

क्या यह स्पष्ट करता है कि डॉकर कैसे काम करता है और ऐप्स को अलग करता है? मुझे बताएं यदि आप किसी भी हिस्से में गहराई से जाना चाहते हैं!