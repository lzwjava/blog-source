---
audio: false
generated: true
lang: hi
layout: post
title: प्री-कमिट हुक में स्टेज परिवर्तन
translated: true
type: note
---

`update_notes_link.py` स्क्रिप्ट में किए गए परिवर्तनों को अलग से कमिट बनाने के बजाय वर्तमान कमिट में शामिल करने के लिए (pre-commit hook के दौरान), आपको हुक को इस तरह संशोधित करना होगा कि वह अपडेट किए गए फाइलों को स्टेज कर दे, उनके लिए अलग से कमिट न बनाए। इस तरह, Python स्क्रिप्ट के परिवर्तन उपयोगकर्ता की कमिट में शामिल हो जाएंगे। नीचे, मैं एक संशोधित pre-commit hook स्क्रिप्ट प्रदान कर रहा हूं जो इसे प्राप्त करती है।

### मुख्य परिवर्तन
- **कोई अलग कमिट नहीं**: हुक में `git commit` चलाने के बजाय, स्क्रिप्ट केवल अपडेट किए गए फाइलों को स्टेज करेगी (`git add`) ताकि वे उपयोगकर्ता की कमिट में शामिल हो जाएं।
- **उपयोगकर्ता के कमिट संदेश को बनाए रखना**: हुक एक नई कमिट नहीं बनाएगा, जिससे उपयोगकर्ता का मूल कमिट संदेश उपयोग में आएगा।
- **त्रुटि प्रबंधन**: यदि Python स्क्रिप्ट विफल हो जाती है, तो हुक कमिट को रोकने के लिए गैर-शून्य स्थिति (non-zero status) के साथ समाप्त हो जाएगा।

### Pre-Commit Hook स्क्रिप्ट

यहां अपडेट की गई pre-commit hook स्क्रिप्ट दी गई है जो अलग से कमिट बनाए बिना परिवर्तनों को स्टेज करती है:

```x-shellscript
#!/bin/bash

# update_notes_link.py स्क्रिप्ट चलाएं और इसके आउटपुट को कैप्चर करें
OUTPUT=$(python scripts/generate/update_notes_link.py 2>&1)
EXIT_CODE=$?

# जांचें कि क्या Python स्क्रिप्ट सफलतापूर्वक निष्पादित हुई
if [ $EXIT_CODE -ne 0 ]; then
    echo "त्रुटि: update_notes_link.py $EXIT_CODE एग्जिट कोड के साथ विफल रहा"
    echo "$OUTPUT"
    exit 1
fi

# जांचें कि क्या विशिष्ट फाइल अपडेट की गई थी
if echo "$OUTPUT" | grep -q "Updated original/2025-01-11-notes-en.md"; then
    echo "नोट्स लिंक अपडेट किए गए, वर्तमान कमिट के लिए परिवर्तनों को स्टेज किया जा रहा है।"

    # संबंधित फाइलों को स्टेज करें
    git add original/2025-01-11-notes-en.md
    git add _posts/en/*.md

    # सत्यापित करें कि फाइलें स्टेज की गईं
    if ! git diff --cached --quiet; then
        echo "परिवर्तन सफलतापूर्वक स्टेज किए गए।"
    else
        echo "स्टेज करने के लिए कोई परिवर्तन नहीं।"
    fi
else
    echo "original/2025-01-11-notes-en.md में कोई अपडेट नहीं, कोई अतिरिक्त फाइल स्टेज नहीं की गई।"
fi

# कमिट को आगे बढ़ने की अनुमति देने के लिए सफलता के साथ एग्जिट करें
exit 0
```

### स्क्रिप्ट की व्याख्या

- **शेबैंग (`#!/bin/bash`)**: यह सुनिश्चित करता है कि स्क्रिप्ट Bash शेल में चले।
- **Python स्क्रिप्ट चलाएं**: `python scripts/generate/update_notes_link.py` को निष्पादित करता है और इसके आउटपुट और एग्जिट कोड को कैप्चर करता है।
- **त्रुटि प्रबंधन**: Python स्क्रिप्ट के एग्जिट कोड (`$EXIT_CODE`) की जांच करता है। यदि यह गैर-शून्य है, तो हुक विफल हो जाता है, त्रुटि प्रिंट करता है, और कमिट को रोक देता है।
- **आउटपुट जांचें**: यह जांचने के लिए `grep` का उपयोग करता है कि क्या आउटपुट इंगित करता है कि `original/2025-01-11-notes-en.md` अपडेट की गई थी।
- **फाइलों को स्टेज करें**: उपयोगकर्ता की कमिट में उन्हें शामिल करने के लिए निर्दिष्ट फाइलों (`original/2025-01-11-notes-en.md` और `_posts/en/*.md`) पर `git add` चलाता है।
- **कोई कमिट नहीं**: `git commit` को छोड़ देता है, जिससे उपयोगकर्ता का `git commit` कमांड उनके मूल कमिट संदेश के साथ स्टेज किए गए परिवर्तनों को शामिल कर सके।
- **फीडबैक**: उपयोगकर्ता को सूचित करने के लिए संदेश प्रिंट करता है कि क्या परिवर्तन स्टेज किए गए थे।
- **एग्जिट कोड**: कमिट को आगे बढ़ने की अनुमति देने के लिए `0` के साथ एग्जिट करता है, जब तक कि Python स्क्रिप्ट विफल न हो जाए।

### हुक सेट अप करना

1. **हुक बनाएं**:
   - स्क्रिप्ट को अपने रिपॉजिटरी में `.git/hooks/pre-commit` में रखें।

2. **इसे एक्जीक्यूटेबल बनाएं**:
   ```bash
   chmod +x .git/hooks/pre-commit
   ```

3. **हुक का परीक्षण करें**:
   - एक फाइल को संशोधित करें या सुनिश्चित करें कि Python स्क्रिप्ट `original/2025-01-11-notes-en.md` को अपडेट करेगी।
   - `git commit -m "आपका कमिट संदेश"` चलाएं।
   - कमिट करने से पहले `git diff --cached` या कमिट करने के बाद `git show` से जांचें कि अपडेट की गई फाइलें कमिट में शामिल हैं।

### `pre-commit` फ्रेमवर्क का उपयोग करना (वैकल्पिक)

यदि आप `pre-commit` फ्रेमवर्क का उपयोग करना पसंद करते हैं, तो आप समान तर्क को `.pre-commit-config.yaml` फाइल में परिभाषित कर सकते हैं। यह दृष्टिकोण अधिक पोर्टेबल है और आपको यह निर्दिष्ट करने की अनुमति देता है कि कौन सी फाइलें हुक को ट्रिगर करती हैं।

1. **pre-commit इंस्टॉल करें**:
   ```bash
   pip install pre-commit
   ```

2. **`.pre-commit-config.yaml` बनाएं**:

```yaml
repos:
- repo: local
  hooks:
  - id: update-notes-links
    name: Update Notes Links
    entry: bash -c '
      OUTPUT=$(python scripts/generate/update_notes_link.py 2>&1);
      EXIT_CODE=$?;
      if [ $EXIT_CODE -ne 0 ]; then
        echo "Error: update_notes_link.py failed with exit code $EXIT_CODE";
        echo "$OUTPUT";
        exit 1;
      fi;
      if echo "$OUTPUT" | grep -q "Updated original/2025-01-11-notes-en.md"; then
        echo "Notes links updated, staging changes for the current commit.";
        git add original/2025-01-11-notes-en.md;
        git add _posts/en/*.md;
        if ! git diff --cached --quiet; then
          echo "Changes staged successfully.";
        else
          echo "No changes to stage.";
        fi;
      else
        echo "No updates to original/2025-01-11-notes-en.md, no additional files staged.";
      fi'
    language: script
    files: ^(original/2025-01-11-notes-en\.md|_posts/en/.*\.md)$
    stages: [commit]
```

3. **हुक इंस्टॉल करें**:
   ```bash
   pre-commit install
   ```

4. **हुक का परीक्षण करें**:
   - `files` regex से मेल खाने वाली फाइलों में परिवर्तन कमिट करें (जैसे, `original/2025-01-11-notes-en.md` या `_posts/en/*.md`)।
   - सत्यापित करें कि हुक चलता है, यदि लागू हो तो परिवर्तनों को स्टेज करता है, और उन्हें आपकी कमिट में शामिल करता है।

### मूल GitHub Actions से मुख्य अंतर

- **कोई अलग कमिट नहीं**: GitHub Actions वर्कफ़्लो के विपरीत, जो एक नई कमिट बनाता था, यह हुक उपयोगकर्ता की वर्तमान कमिट के लिए परिवर्तनों को स्टेज करता है।
- **कोई पुश नहीं**: हुक परिवर्तनों को पुश नहीं करता, क्योंकि pre-commit hooks स्थानीय रूप से कमिट के अंतिम रूप देने से पहले चलते हैं। उपयोगकर्ता को मैन्युअल रूप से `git push` चलाना होगा।
- **त्रुटि प्रबंधन**: हुक यह सुनिश्चित करने के लिए Python स्क्रिप्ट के एग्जिट कोड की जांच करता है कि वह चुपचाप विफल न हो।
- **कोई Git उपयोगकर्ता कॉन्फ़िग नहीं**: स्क्रिप्ट `git config user.name` और `user.email` को छोड़ देती है क्योंकि कमिट के लिए उपयोगकर्ता का Git कॉन्फ़िगरेशन उपयोग किया जाएगा।

### नोट्स

- **Python स्क्रिप्ट**: सुनिश्चित करें कि `scripts/generate/update_notes_link.py` मौजूद है और स्थानीय रूप से एक्जीक्यूटेबल है। यदि यह environment variables या dependencies पर निर्भर करता है, तो सुनिश्चित करें कि वे उपलब्ध हैं।
- **फाइल पाथ**: सत्यापित करें कि पाथ `original/2025-01-11-notes-en.md` और `_posts/en/*.md` आपकी रिपॉजिटरी संरचना से मेल खाते हैं।
- **हुक विफलता**: यदि Python स्क्रिप्ट विफल हो जाती है, तो हुक कमिट को रोक देगा, यह सुनिश्चित करते हुए कि कोई आंशिक अपडेट स्टेज नहीं किए गए हैं।
- **परीक्षण**: इसकी पुष्टि करने के लिए परीक्षण करें कि `git commit` के साथ परिवर्तन स्टेज किए गए हैं और अतिरिक्त कमिट बनाए बिना कमिट में शामिल हैं। कमिट सामग्री का निरीक्षण करने के लिए `git show` का उपयोग करें।

### सत्यापन

सत्यापित करने के लिए:
1. एक फाइल को संशोधित करें या सुनिश्चित करें कि Python स्क्रिप्ट `original/2025-01-11-notes-en.md` को अपडेट करती है।
2. `git commit -m "टेस्ट कमिट"` चलाएं।
3. यह पुष्टि करने के लिए जांचें कि `git show` से अपडेट की गई फाइलें आपके मूल संदेश के साथ कमिट में शामिल हैं।
4. सुनिश्चित करें कि कोई अतिरिक्त कमिट नहीं बनाई गई है (जैसे, कोई `chore(notes): Update notes links` कमिट नहीं)।

यदि आपको आगे ट्वीक की आवश्यकता है, जैसे कि विशिष्ट त्रुटि मामलों को संभालना या स्टेज करने के लिए अधिक फाइलें जोड़ना, तो मुझे बताएं!