---
audio: false
generated: true
image: false
lang: hi
layout: post
model: x-ai/grok-code-fast-1
title: जावा ओएसएस छवि अपलोड नियंत्रक
translated: true
type: note
---

### कोड कैसे काम करता है

यह एक Java Spring Boot कंट्रोलर (`FileController`) है जो HTTP POST रिक्वेस्ट के माध्यम से फ़ाइल अपलोड को हैंडल करने के लिए डिज़ाइन किया गया है। यह अपलोड की गई फ़ाइलों को क्लाउड में स्टोर करने के लिए **अलीबाबा क्लाउड ऑब्जेक्ट स्टोरेज सर्विस (OSS)** के साथ एकीकृत होता है। कोड इमेज अपलोड (JPEG/PNG फॉर्मेट तक सीमित) पर केंद्रित है और एक सरल, अनॉथेंटिकेटेड एंडपॉइंट प्रदान करता है। यह प्रक्रिया के दौरान स्थानीय फ़ाइल को अस्थायी रूप से स्टोर करने के बाद उसे डिलीट कर देता है।

#### मुख्य घटक और प्रवाह:
1.  **क्लास संरचना**:
    - यह एक `@RestController` है जिसे बेस पाथ `"file"` पर मैप किया गया है, और यह `BaseController` का विस्तार करता है (संभवतः साझा लॉजिक के लिए)।
    - मुख्य मेथड `upload()` है, जिसे `"/file/upload"` पर मैप किया गया है।
    - एनोटेशन:
        - `@RequestMapping`: एंडपॉइंट और अनुमत HTTP मेथड (POST) को परिभाषित करता है।
        - `@ResponseBody`: सुनिश्चित करता है कि प्रतिक्रिया JSON (`LQResponse` के माध्यम से) हो।
        - `@NoAuth`: इंगित करता है कि इस एंडपॉइंट के लिए कोई प्रमाणीकरण आवश्यक नहीं है (कस्टम AOP एनोटेशन)।

2.  **निर्भरताएं**:
    - Spring Framework (जैसे, `@RestController`, `@RequestMapping`, `@RequestParam`, फ़ाइल हैंडलिंग के लिए `MultipartFile`)।
    - Aliyun OSS SDK (जैसे, OSS के साथ इंटरैक्शन के लिए `OSSClient`)।
    - Apache Commons Lang (जैसे, यादृच्छिक कुंजी जनरेट करने के लिए `RandomStringUtils`, स्ट्रिंग मैनिपुलेशन के लिए `StringUtils`)।
    - कस्टम क्लासेज जैसे `LQException`, `LQError`, और `LQResponse` (संभवतः आपके ऐप की एरर हैंडलिंग और रिस्पांस यूटिलिटीज का हिस्सा)।

3.  **`upload()` मेथड का चरण-दर-चरण विवरण**:
    - **इनपुट वैलिडेशन**:
        - एक `MultipartFile` (अपलोड की गई फ़ाइल) प्राप्त करता है।
        - `URLConnection.guessContentTypeFromStream()` का उपयोग करके कंटेंट टाइप (MIME प्रकार) निर्धारित करता है। यह फ़ाइल के बाइट्स के आधार पर जाँचता है कि क्या फ़ाइल वास्तव में एक इमेज फ़ाइल है।
        - केवल विशिष्ट प्रकारों की अनुमति देता है: `"image/jpeg"`, `"image/jpg"`, या `"image/png"`। यदि नहीं है, तो `UNSUPPORTED_IMAGE_FILE` एरर कोड के साथ `LQException` फेंकता है।
        - कंटेंट टाइप से फ़ाइल एक्सटेंशन (जैसे, `.jpg`) निकालता है।

    - **फ़ाइल तैयारी**:
        - ओरिजिनल फ़ाइलनाम का उपयोग करके एक अस्थायी स्थानीय `File` ऑब्जेक्ट बनाता है।
        - फ़ाइल के बाइट्स को `FileOutputStream` का उपयोग करके लोकल डिस्क पर लिखता है। यह चरण आवश्यक है क्योंकि OSS SDK के `putObject` को `File` या `InputStream` की आवश्यकता होती है।

    - **OSS अपलोड**:
        - एक `OSSClient` को इनिशियलाइज़ करता है:
            - **एंडपॉइंट**: `https://oss-cn-qingdao.aliyuncs.com` (चीन में किंगदाओ क्षेत्र)।
            - **एक्सेस की आईडी**: `"LTAIuXm7..` (हार्डकोडेड—नोट: प्रोडक्शन में, क्रेडेंशियल्स को एक्सपोज होने से बचाने के लिए इसे एनवायरनमेंट वेरिएबल्स या कॉन्फ़िग फ़ाइल से सुरक्षित रूप से लोड करना चाहिए)।
            - **सीक्रेट एक्सेस की**: `"GP8FRF..."` (यह भी हार्डकोडेड—समान सुरक्षा नोट)।
            - **बकेट**: खाली स्ट्रिंग (`""`)—यह संभवतः एक प्लेसहोल्डर है और इसे एक वैध OSS बकेट नाम (जैसे, `"my-bucket"`) पर सेट किया जाना चाहिए।
        - एक यूनिक ऑब्जेक्ट की जनरेट करता है: एक यादृच्छिक 6-वर्ण का अल्फ़ान्यूमेरिक स्ट्रिंग + फ़ाइल एक्सटेंशन (जैसे, `a3bS9k.jpg`)।
        - `ossClient.putObject()` को `PutObjectRequest` के साथ कॉल करता है जो बकेट, की, और स्थानीय फ़ाइल की ओर इशारा करता है। यह फ़ाइल को OSS पर अपलोड करता है।
        - `OSSException` (OSS-साइड एरर) या `ClientException` (क्लाइंट/नेटवर्क एरर) को कैच करता है और `FILE_UPLOAD_FAIL` एरर कोड के साथ एक कस्टम `LQException` फेंकता है।

    - **क्लीनअप और प्रतिक्रिया**:
        - डिस्क क्लटर से बचने के लिए `newFile.delete()` के साथ अस्थायी स्थानीय फ़ाइल को डिलीट कर देता है।
        - अपलोड की गई फ़ाइल का पब्लिक URL: `FILE_HOST + "/" + key` के साथ एक `LQResponse.success()` रिटर्न करता है।
            - `FILE_HOST` एक और खाली स्ट्रिंग प्लेसहोल्डर है—इसे अपने OSS बकेट के डोमेन (जैसे, `"https://my-bucket.oss-cn-qingdao.aliyuncs.com"`) पर सेट करें।

    - **एरर हैंडलिंग**: वैलिडेशन और अपलोड फेल्योर के लिए कस्टम एक्सेप्शन (`LQException`) का उपयोग करता है, जो ऐप-वाइड एरर रिस्पांस को सुसंगत सुनिश्चित करता है।

#### सुरक्षा नोट्स:
- हार्डकोडेड क्रेडेंशियल्स एक बड़ी समस्या हैं—एनवायरनमेंट वेरिएबल्स, AWS SSM, या अलीबाबा क्लाउड KMS का उपयोग करें।
- एंडपॉइंट और बकेट अधूरे हैं—वास्तविक उपयोग के लिए उन्हें भरें।
- कोई प्रमाणीकरण नहीं (`@NoAuth`) का मतलब है कि कोई भी अपलोड कर सकता है; यदि आवश्यक हो तो प्रमाणीकरण जोड़ें (जैसे, JWT के माध्यम से)।
- कंटेंट-टाइप जाँच बुनियादी है; स्पूफिंग को रोकने के लिए अधिक मजबूत वैलिडेशन (जैसे, Apache Tika का उपयोग करके) पर विचार करें।

### Aliyun OSS SDK इम्पोर्ट्स का उपयोग कैसे करें

सूचीबद्ध इम्पोर्ट्स Alibaba Cloud OSS Java SDK के लिए हैं (आमतौर पर Maven/Gradle के माध्यम से `com.aliyun.oss:aliyun-sdk-oss` के रूप में जोड़े जाते हैं)। वे OSS के साथ इंटरैक्ट करने के लिए क्लासेज प्रदान करते हैं। नीचे दिया गया है कि प्रत्येक का संदर्भ में कैसे उपयोग किया जाता है, उदाहरणों के साथ।

1.  **`import com.aliyun.oss.OSSClient;`**:
    - OSS ऑपरेशन्स के लिए मुख्य क्लाइंट क्लास (अब `OSSClientBuilder` के पक्ष में डिप्रिकेटेड, लेकिन पुराने कोडबेस में अभी भी कार्यात्मक)।
    - **उपयोग**: OSS से कनेक्ट करने के लिए एक इंस्टेंस बनाएं।
        ```java
        OSSClient ossClient = new OSSClient(ENDPOINT, ACCESS_KEY_ID, SECRET_ACCESS_KEY);
        // फिर putObject(), getObject(), deleteObject() जैसी मेथड्स का उपयोग करें।
        ```
    - **यहाँ क्यों**: निर्दिष्ट बकेट में फ़ाइल अपलोड करने के लिए प्रमाणित करने और उपयोग करने के लिए।

2.  **`import com.aliyun.oss.ClientException;`**:
    - क्लाइंट-साइड समस्याओं (जैसे, नेटवर्क फेल्योर, अमान्य क्रेडेंशियल्स) के लिए फेंका जाता है।
    - **उपयोग**: एरर को हैंडल करने के लिए इसे कैच करें।
        ```java
        try {
            // OSS ऑपरेशन
        } catch (ClientException e) {
            // क्लाइंट एरर को हैंडल करें (जैसे, रिट्राई या लॉग)
        }
        ```
    - **यहाँ क्यों**: लचीला एरर हैंडलिंग के लिए अपलोड मेथड में कैच किया गया।

3.  **`import com.aliyun.oss.OSSException;`**:
    - OSS सर्विस-साइड एरर (जैसे, बकेट नहीं मिला, अनुमति अस्वीकृत) के लिए फेंका जाता है।
    - **उपयोग**: `ClientException` के समान, लेकिन सर्विस-विशिष्ट।
        ```java
        try {
            // OSS ऑपरेशन
        } catch (OSSException e) {
            // e.getErrorCode() और e.getErrorMessage() लॉग करें
        }
        ```
    - **यहाँ क्यों**: `LQException` के माध्यम से उपयोगकर्ता-अनुकूल फेल्योर संदेश प्रदान करने के लिए कैच किया गया।

4.  **`import com.aliyun.oss.model.PutObjectRequest;`**:
    - अपलोड रिक्वेस्ट्स (बकेट, की, फ़ाइल/इनपुट स्ट्रीम, मेटाडेटा शामिल) बनाने के लिए एक मॉडल क्लास।
    - **उपयोग**:
        ```java
        PutObjectRequest request = new PutObjectRequest(BUCKET, KEY, FILE);
        // वैकल्पिक: मेटाडेटा जोड़ें, जैसे, request.setObjectMetadata(metadata);
        ossClient.putObject(request);
        ```
    - **यहाँ क्यों**: अपलोड विवरण (बकेट, की, स्थानीय फ़ाइल) निर्दिष्ट करने के लिए उपयोग किया गया।

5.  **`import com.aliyun.oss.model.PutObjectResult;`**:
    - `putObject()` द्वारा रिटर्न किया गया; इसमें अपलोड मेटाडेटा (जैसे, इंटीग्रिटी चेक के लिए ETag) शामिल होता है।
    - **उपयोग**:
        ```java
        PutObjectResult result = ossClient.putObject(request);
        String etag = result.getETag();  // सत्यापन के लिए
        ```
    - **यहाँ क्यों**: असाइन किया गया लेकिन कोड में गहराई से उपयोग नहीं किया गया (डीबगिंग के लिए लॉग किया जा सकता है)।

#### सेटअप और एकीकरण सुझाव:
- **प्लेसहोल्डर्स बदलें**: `BUCKET` और `FILE_HOST` को वास्तविक मानों के साथ अपडेट करें। सुनिश्चित करें कि आपका Alibaba अकाउंट OSS एक्सेस की अनुमति देता है।
- **Maven डिपेंडेंसी** (`pom.xml` में जोड़ें):
    ```xml
    <dependency>
        <groupId>com.aliyun.oss</groupId>
        <artifactId>aliyun-sdk-oss</artifactId>
        <version>3.17.4</version>  <!-- नवीनतम स्थिर का उपयोग करें -->
    </dependency>
    ```
- **टेस्टिंग**: एक फ़ाइल पैरामीटर के साथ `/file/upload` पर POST भेजने के लिए Postman जैसे टूल्स का उपयोग करें। प्रतिक्रिया फ़ाइल URL के साथ एक JSON ऑब्जेक्ट होनी चाहिए।
- **पूर्ण OSS डॉक्यूमेंटेशन**: मेटाडेटा, ACLs, या मल्टीपार्ट अपलोड जैसी उन्नत सुविधाओं के लिए [Alibaba OSS Java SDK Docs](https://help.aliyun.com/document_detail/31856.html) देखें।

यदि आप अधिक विवरण प्रदान करते हैं (जैसे, विशिष्ट त्रुटियाँ या अनुकूलन), तो मैं इसे और परिष्कृत कर सकता हूँ!