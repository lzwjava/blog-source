---
audio: false
generated: true
lang: hi
layout: post
title: परीक्षण के लिए एच२ डेटाबेस का उपयोग करें
translated: true
type: note
---

Spring प्रोजेक्ट में H2 डेटाबेस का उपयोग करने के लिए, विशेष रूप से टेस्टिंग के उद्देश्य से, आपको इस lightweight, in-memory डेटाबेस को अपने Spring एप्लिकेशन में integrate करना होगा। H2 डेटाबेस टेस्टिंग के लिए आदर्श है क्योंकि यह मेमोरी में चलता है, तेज़ है, और डेटा को डिस्क पर सहेजे बिना आसानी से सेट अप और टियर डाउन किया जा सकता है। नीचे, मैं समझाऊंगा कि अपने Spring प्रोजेक्ट में H2 को कैसे शामिल करें, यह मानते हुए कि आप Spring Boot का उपयोग कर रहे हैं (Spring प्रोजेक्ट्स के लिए एक सामान्य सेटअप), और `com.h2database.h2` के संदर्भ को स्पष्ट करूंगा, जो संभवतः एक Maven dependency को संदर्भित करता है न कि package या class name को (ड्राइवर क्लास वास्तव में `org.h2.Driver` है)।

---

### चरण 1: H2 Dependency जोड़ें
अपने Spring प्रोजेक्ट में H2 का उपयोग करने के लिए, आपको इसे अपनी build फ़ाइल में शामिल करना होगा। चूंकि आपने `com.h2database.h2` का उल्लेख किया है, यह H2 डेटाबेस artifact के लिए Maven coordinates के अनुरूप है। इसे जोड़ने का तरीका यहां बताया गया है:

#### Maven के लिए (`pom.xml`):
```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>
```
- **नोट**: `<scope>test</scope>` सुनिश्चित करता है कि H2 केवल test phase के दौरान उपलब्ध हो, जो आपके टेस्टिंग फोकस के अनुकूल है।

#### Gradle के लिए (`build.gradle`):
```gradle
testImplementation 'com.h2database:h2'
```

यदि आप Spring Boot का उपयोग कर रहे हैं और आपने `spring-boot-starter-data-jpa` या `spring-boot-starter-jdbc` जैसे starters शामिल किए हैं, तो जब आप टेस्टिंग के लिए H2 data source configure करते हैं, तो Spring Boot की dependency management स्वचालित रूप से एक compatible H2 version pull कर लेगी। ऐसे मामलों में, स्पष्ट रूप से H2 dependency जोड़ना वैकल्पिक है, जब तक कि आपको किसी specific version की आवश्यकता न हो।

---

### चरण 2: टेस्टिंग के लिए Data Source के रूप में H2 Configure करें
Spring Boot प्रोजेक्ट में, आप properties के माध्यम से डेटाबेस configure करते हैं, आमतौर पर `application.properties` या `application.yml` में। टेस्टिंग के लिए, इन configurations को `src/test/resources` में रखें ताकि main application settings override हो सकें।

#### `src/test/resources/application.properties` में Configuration:
```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
```
- **स्पष्टीकरण**:
  - `spring.datasource.url=jdbc:h2:mem:testdb`: एक in-memory H2 डेटाबेस नाम `testdb` निर्दिष्ट करता है। `mem` कीवर्ड सुनिश्चित करता है कि डेटा RAM में store हो।
  - `spring.datasource.driverClassName=org.h2.Driver`: H2 के लिए JDBC driver class (`com.h2database.h2` नहीं, जो संभवतः एक टाइपो है या Maven artifact के साथ confusion है)।
  - `spring.datasource.username=sa`: Default H2 username।
  - `spring.datasource.password=`: Default खाली पासवर्ड।

#### Auto-Configuration के साथ Minimal Configuration:
यदि आप `spring-boot-starter-data-jpa` या `spring-boot-starter-jdbc` के साथ Spring Boot का उपयोग कर रहे हैं और H2 classpath पर है, तो Spring Boot बिना explicit properties के एक embedded H2 डेटाबेस auto-configure कर सकता है। यह एक random डेटाबेस नाम उत्पन्न करता है (जैसे, `jdbc:h2:mem:<random-uuid>`)। हालाँकि, ऊपर दिए गए properties को निर्दिष्ट करने से आपको डेटाबेस नाम और settings पर नियंत्रण मिलता है।

---

### चरण 3: टेस्ट्स में H2 का उपयोग करें
Spring Boot, H2 के साथ डेटाबेस टेस्टिंग को सरल बनाने के लिए testing annotations प्रदान करता है। यह दृष्टिकोण इस बात पर निर्भर करता है कि आप repositories (unit-like tests) का परीक्षण कर रहे हैं या full application stack (integration tests) का।

#### विकल्प 1: `@DataJpaTest` के साथ Repositories का परीक्षण
Spring Data JPA repositories के परीक्षण के लिए, `@DataJpaTest` annotation का उपयोग करें। यह स्वचालित रूप से एक in-memory H2 डेटाबेस configure करता है, `@Entity` classes के लिए scan करता है, और repositories सेट करता है।

**उदाहरण**:
```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import static org.assertj.core.api.Assertions.assertThat;

@DataJpaTest
public class MyRepositoryTest {

    @Autowired
    private MyRepository myRepository;

    @Test
    public void testFindById() {
        // मान लें कि डेटा लोड किया गया है (जैसे, data.sql के माध्यम से)
        MyEntity entity = myRepository.findById(1L).orElse(null);
        assertThat(entity).isNotNull();
    }
}
```
- **लाभ**:
  - H2 स्वचालित रूप से सेट अप हो जाता है।
  - टेस्ट्स डिफ़ॉल्ट रूप से transactional होते हैं और roll back करते हैं, जिससे प्रति टेस्ट एक clean डेटाबेस state सुनिश्चित होती है।

#### विकल्प 2: `@SpringBootTest` के साथ Integration Testing
Full-stack integration tests (जैसे, controllers, services, और repositories को एक साथ test करना) के लिए, `@SpringBootTest` का उपयोग करें। Test-specific properties के माध्यम से H2 configure करें।

**उदाहरण**:
```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
public class MyIntegrationTest {

    @Autowired
    private MyService myService;

    @Test
    public void testServiceMethod() {
        // उस service logic का परीक्षण करें जो डेटाबेस के साथ interact करती है
        String result = myService.someMethod();
        assertThat(result).isEqualTo("expected");
    }
}
```
- **Configuration**: यह सुनिश्चित करने के लिए कि production डेटाबेस के बजाय H2 का उपयोग किया जाए, पहले दिखाए गए अनुसार `src/test/resources` में `application.properties` का उपयोग करें।

#### वैकल्पिक Configuration Methods:
- **`@TestPropertySource` का उपयोग करना**:
  ```java
  @SpringBootTest
  @TestPropertySource(properties = {
      "spring.datasource.url=jdbc:h2:mem:testdb",
      "spring.datasource.driverClassName=org.h2.Driver",
      "spring.datasource.username=sa",
      "spring.datasource.password="
  })
  public class MyIntegrationTest {
      // ...
  }
  ```
- **Profiles का उपयोग करना**:
  - H2 configuration के साथ `src/test/resources/application-test.properties` बनाएं।
  - टेस्ट को `@ActiveProfiles("test")` से annotate करें।

---

### चरण 4: टेस्ट डेटा Initialize करें (वैकल्पिक)
H2 डेटाबेस को test data से populate करने के लिए:

- **`schema.sql` और `data.sql` का उपयोग करना**:
  - इन फ़ाइलों को `src/test/resources` में रखें।
  - जब embedded डेटाबेस start होता है, तो Spring Boot tables बनाने के लिए `schema.sql` और डेटा insert करने के लिए `data.sql` execute करता है।
  - `data.sql` उदाहरण:
    ```sql
    INSERT INTO my_table (id, name) VALUES (1, 'Test');
    ```

- **`@Sql` का उपयोग करना**:
  - टेस्ट methods से पहले या बाद में specific SQL scripts execute करें।
  - उदाहरण:
    ```java
    @Test
    @Sql("/test-schema.sql")
    @Sql("/test-data.sql")
    public void testSomething() {
        // टेस्ट लॉजिक
    }
    ```

---

### चरण 5: टेस्ट Isolation सुनिश्चित करें (वैकल्पिक)
टेस्ट methods को एक दूसरे के साथ interfere करने से रोकने के लिए:
- टेस्ट classes या methods पर `@Transactional` का उपयोग करें। `@DataJpaTest` के साथ, यह डिफ़ॉल्ट रूप से सक्षम होता है, प्रत्येक टेस्ट के बाद changes को roll back करता है। `@SpringBootTest` के लिए, आवश्यकता पड़ने पर इसे स्पष्ट रूप से जोड़ें:
  ```java
  @SpringBootTest
  @Transactional
  public class MyIntegrationTest {
      // ...
  }
  ```
- यह सुनिश्चित करता है कि प्रत्येक टेस्ट एक consistent डेटाबेस state के साथ शुरू हो।

---

### चरण 6: Production डेटाबेस का Emulation करें (वैकल्पिक)
यदि आपका production डेटाबेस भिन्न है (जैसे, MySQL, PostgreSQL), तो compatibility modes का उपयोग करके H2 को इसका emulation करने के लिए configure करें:
```properties
spring.datasource.url=jdbc:h2:mem:testdb;MODE=MySQL
```
- Supported modes में `MySQL`, `PostgreSQL`, आदि शामिल हैं, जो H2 की SQL syntax और behavior को आपके production डेटाबेस के साथ संरेखित करते हैं।

---

### चरण 7: H2 Console के साथ Debugging (वैकल्पिक)
टेस्ट्स के दौरान डेटाबेस का निरीक्षण करने के लिए:
- H2 console सक्षम करें:
  ```properties
  spring.h2.console.enabled=true
  ```
- यदि web server चल रहा है (जैसे, `@SpringBootTest(webEnvironment = RANDOM_PORT)` के साथ), तो इसे `http://localhost:<port>/h2-console` पर एक्सेस करें।
- यह debugging के लिए उपयोगी है लेकिन automated test runs में कम आम है।

---

### मुख्य नोट्स
- **H2 Driver**: सही driver class `org.h2.Driver` है, `com.h2database.h2` नहीं। बाद वाला Maven `groupId:artifactId` को संदर्भित करता है।
- **Spring Boot लाभ**: Auto-configuration, विशेष रूप से टेस्टिंग के लिए, H2 सेटअप को सरल बनाता है।
- **In-Memory प्रकृति**: JVM के रुकने पर H2 का डेटा खो जाता है, जिससे यह isolated test runs के लिए आदर्श बन जाता है।

इन चरणों का पालन करके, आप अपने Spring प्रोजेक्ट में टेस्टिंग के लिए H2 डेटाबेस का प्रभावी ढंग से उपयोग कर सकते हैं, अपनी data layer या full application stack को validate करने के लिए इसकी गति और सरलता का लाभ उठा सकते हैं।