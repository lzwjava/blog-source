---
audio: false
generated: true
lang: hi
layout: post
title: H2 डेटाबेस के लिए टेस्टिंग
translated: true
---

H2 डेटाबेस को एक Spring प्रोजेक्ट में उपयोग करने के लिए, विशेष रूप से टेस्टिंग के लिए, आपको इस लाइटवेट, इन-मेमोरी डेटाबेस को अपने Spring एप्लिकेशन में इंटिग्रेट करना होगा। H2 डेटाबेस टेस्टिंग के लिए आदर्श है क्योंकि यह मेमोरी में चलता है, तेज है, और इसे आसानी से सेट अप और टारन डाउन किया जा सकता है बिना डेटा को डिस्क पर पर्सिस्ट करने। नीचे, मैं आपको बताता हूँ कि H2 को अपने Spring प्रोजेक्ट में कैसे शामिल करें, मानते हुए कि आप Spring Boot (Spring प्रोजेक्ट के लिए एक आम सेटअप) का उपयोग कर रहे हैं, और `com.h2database.h2` का संदर्भ स्पष्ट करता हूँ, जो संभवतः Maven डिपेंडेंसी के बजाय पैकेज या क्लास नाम से संदर्भित नहीं है (ड्राइवर क्लास वास्तव में `org.h2.Driver` है)।

---

### चरण 1: H2 डिपेंडेंसी जोड़ें
H2 को अपने Spring प्रोजेक्ट में उपयोग करने के लिए, आपको अपने बिल्ड फाइल में इसका डिपेंडेंसी शामिल करना होगा। जब आप `com.h2database.h2` का उल्लेख करते हैं, तो यह H2 डेटाबेस आर्टिफैक्ट के लिए Maven कोऑर्डिनेट्स के साथ मेल खाता है। यहाँ यह कैसे जोड़ा जाता है:

#### For Maven (`pom.xml`):
```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>
```
- **नोट**: `<scope>test</scope>` सुनिश्चित करता है कि H2 केवल टेस्ट फेज में उपलब्ध है, जो आपके टेस्टिंग फोकस के अनुकूल है।

#### For Gradle (`build.gradle`):
```gradle
testImplementation 'com.h2database:h2'
```

यदि आप Spring Boot का उपयोग कर रहे हैं और स्टार्टर्स जैसे `spring-boot-starter-data-jpa` या `spring-boot-starter-jdbc` शामिल कर रहे हैं, तो Spring Boot का डिपेंडेंसी मैनेजमेंट एक संगत H2 संस्करण को स्वचालित रूप से खींच लेगा जब आप एक H2 डेटा स्रोत को टेस्टिंग के लिए कॉन्फिगर करते हैं। ऐसे मामलों में, स्पेशल H2 डिपेंडेंसी जोड़ना वैकल्पिक है जब तक कि आपको एक विशेष संस्करण की आवश्यकता नहीं है।

---

### चरण 2: H2 को टेस्टिंग के लिए डेटा स्रोत के रूप में कॉन्फिगर करें
एक Spring Boot प्रोजेक्ट में, आप डेटाबेस को प्रॉपर्टीज के माध्यम से कॉन्फिगर करते हैं, आमतौर पर `application.properties` या `application.yml` में। टेस्टिंग के लिए, इन कॉन्फिगरेशन को `src/test/resources` में रखें ताकि मुख्य एप्लिकेशन सेटिंग्स को ओवरराइड किया जा सके।

#### कॉन्फिगरेशन `src/test/resources/application.properties` में:
```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
```
- **विवरण**:
  - `spring.datasource.url=jdbc:h2:mem:testdb`: एक इन-मेमोरी H2 डेटाबेस का नाम `testdb` निर्दिष्ट करता है। `mem` शब्द सुनिश्चित करता है कि डेटा RAM में स्टोर किया जाता है।
  - `spring.datasource.driverClassName=org.h2.Driver`: H2 के लिए JDBC ड्राइवर क्लास (नहीं `com.h2database.h2`, जो संभवतः एक टाइपो या Maven आर्टिफैक्ट के साथ भ्रम है)।
  - `spring.datasource.username=sa`: डिफॉल्ट H2 यूजरनेम।
  - `spring.datasource.password=`: डिफॉल्ट खाली पासवर्ड।

#### Auto-Configuration के साथ न्यूनतम कॉन्फिगरेशन:
यदि आप Spring Boot का उपयोग कर रहे हैं और `spring-boot-starter-data-jpa` या `spring-boot-starter-jdbc` और H2 क्लासपाथ पर है, तो Spring Boot एक एम्बेडेड H2 डेटाबेस को स्वचालित रूप से कॉन्फिगर कर सकता है बिना स्पष्ट प्रॉपर्टीज। यह एक रैंडम डेटाबेस नाम (जैसे, `jdbc:h2:mem:<random-uuid>`) जनरेट करता है। हालांकि, ऊपर दिए गए प्रॉपर्टीज को स्पेसिफाई करने से आपको डेटाबेस नाम और सेटिंग्स पर नियंत्रण मिलता है।

---

### चरण 3: टेस्ट में H2 का उपयोग करें
Spring Boot टेस्टिंग एनोटेशन प्रदान करता है ताकि H2 के साथ डेटाबेस टेस्टिंग को सरल बनाया जा सके। यह उस पर निर्भर करता है कि आप रिपॉजिटरीज (यूनिट-लाइक टेस्ट) या पूरी एप्लिकेशन स्टैक (इंटिग्रेशन टेस्ट) को टेस्ट कर रहे हैं।

#### विकल्प 1: `@DataJpaTest` के साथ रिपॉजिटरीज को टेस्ट करें
Spring Data JPA रिपॉजिटरीज को टेस्ट करने के लिए, `@DataJpaTest` एनोटेशन का उपयोग करें। यह स्वचालित रूप से एक इन-मेमोरी H2 डेटाबेस को कॉन्फिगर करता है, `@Entity` क्लासों को स्कैन करता है, और रिपॉजिटरीज को सेट अप करता है।

**उदाहरण**:
```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import static org.assertj.core.api.Assertions.assertThat;

@DataJpaTest
public class MyRepositoryTest {

    @Autowired
    private MyRepository myRepository;

    @Test
    public void testFindById() {
        // मानते हुए कि डेटा लोड किया गया है (जैसे, `data.sql` के माध्यम से)
        MyEntity entity = myRepository.findById(1L).orElse(null);
        assertThat(entity).isNotNull();
    }
}
```
- **लाभ**:
  - H2 स्वचालित रूप से सेट अप किया जाता है।
  - टेस्ट ट्रांजैक्शनल हैं और डिफॉल्ट रूप से रोलबैक होते हैं, सुनिश्चित करते हुए कि प्रत्येक टेस्ट के लिए एक साफ डेटाबेस स्टेट है।

#### विकल्प 2: `@SpringBootTest` के साथ इंटिग्रेशन टेस्ट
पूरी स्टैक इंटिग्रेशन टेस्ट (जैसे, कंट्रोलर्स, सर्विस, और रिपॉजिटरीज को एक साथ टेस्ट करने) के लिए, `@SpringBootTest` का उपयोग करें। H2 को टेस्ट-स्पेसिफिक प्रॉपर्टीज के माध्यम से कॉन्फिगर करें।

**उदाहरण**:
```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
public class MyIntegrationTest {

    @Autowired
    private MyService myService;

    @Test
    public void testServiceMethod() {
        // डेटाबेस के साथ इंटरैक्ट करने वाले सर्विस लॉजिक को टेस्ट करें
        String result = myService.someMethod();
        assertThat(result).isEqualTo("expected");
    }
}
```
- **कॉन्फिगरेशन**: पहले दिखाए गए `application.properties` का उपयोग करें ताकि `src/test/resources` में H2 का उपयोग किया जाए।

#### विकल्प कॉन्फिगरेशन विधियाँ:
- **`@TestPropertySource` का उपयोग करें**:
  ```java
  @SpringBootTest
  @TestPropertySource(properties = {
      "spring.datasource.url=jdbc:h2:mem:testdb",
      "spring.datasource.driverClassName=org.h2.Driver",
      "spring.datasource.username=sa",
      "spring.datasource.password="
  })
  public class MyIntegrationTest {
      // ...
  }
  ```
- **प्रोफाइल का उपयोग करें**:
  - `src/test/resources/application-test.properties` में H2 कॉन्फिगरेशन बनाएं।
  - टेस्ट को `@ActiveProfiles("test")` के साथ एनोटेट करें।

---

### चरण 4: टेस्ट डेटा को इनिशियलाइज़ करें (वैकल्पिक)
H2 डेटाबेस को टेस्ट डेटा से भरने के लिए:

- **`schema.sql` और `data.sql` का उपयोग करें**:
  - इन फाइलों को `src/test/resources` में रखें।
  - Spring Boot इन फाइलों को एम्बेडेड डेटाबेस शुरू होने पर `schema.sql` को टेबल बनाने और `data.sql` को डेटा डालने के लिए चलाता है।
  - उदाहरण `data.sql`:
    ```sql
    INSERT INTO my_table (id, name) VALUES (1, 'Test');
    ```

- **`@Sql` का उपयोग करें**:
  - टेस्ट विधियों से पहले या बाद में विशेष SQL स्क्रिप्ट चलाएं।
  - उदाहरण:
    ```java
    @Test
    @Sql("/test-schema.sql")
    @Sql("/test-data.sql")
    public void testSomething() {
        // टेस्ट लॉजिक
    }
    ```

---

### चरण 5: टेस्ट इज़ोलेशन सुनिश्चित करें (वैकल्पिक)
टेस्ट विधियों को एक-दूसरे से बाधित होने से रोकने के लिए:
- टेस्ट क्लास या विधियों पर `@Transactional` का उपयोग करें। `@DataJpaTest` के साथ, यह डिफॉल्ट रूप से सक्षम है, प्रत्येक टेस्ट के बाद बदलाव को रोलबैक करते हुए। `@SpringBootTest` के लिए, आवश्यकता पड़ने पर इसे स्पष्ट रूप से जोड़ें:
  ```java
  @SpringBootTest
  @Transactional
  public class MyIntegrationTest {
      // ...
  }
  ```
- यह सुनिश्चित करता है कि प्रत्येक टेस्ट एक सुसंगत डेटाबेस स्टेट से शुरू होता है।

---

### चरण 6: प्रोडक्शन डेटाबेस को एमुलेट करें (वैकल्पिक)
यदि आपका प्रोडक्शन डेटाबेस अलग है (जैसे, MySQL, PostgreSQL), तो H2 को कॉम्पैटिबिलिटी मोड्स का उपयोग करके इसे एमुलेट करें:
```properties
spring.datasource.url=jdbc:h2:mem:testdb;MODE=MySQL
```
- समर्थित मोड्स में `MySQL`, `PostgreSQL` शामिल हैं, जो H2 के SQL सिंटैक्स और व्यवहार को आपके प्रोडक्शन डेटाबेस के साथ मेल खाते हैं।

---

### चरण 7: H2 कंसोल के साथ डिबग करें (वैकल्पिक)
टेस्ट के दौरान डेटाबेस को जांचने के लिए:
- H2 कंसोल को सक्षम करें:
  ```properties
  spring.h2.console.enabled=true
  ```
- इसे एक वेब सर्वर चलाने पर `http://localhost:<port>/h2-console` पर एक्सेस करें (जैसे, `@SpringBootTest(webEnvironment = RANDOM_PORT)` के साथ)। यह डिबगिंग के लिए उपयोगी है, लेकिन स्वचालित टेस्ट रन में कम आम है।

---

### मुख्य नोट्स
- **H2 ड्राइवर**: सही ड्राइवर क्लास `org.h2.Driver` है, नहीं `com.h2database.h2`। बाद वाला Maven `groupId:artifactId` से संदर्भित करता है।
- **Spring Boot लाभ**: स्वचालित कॉन्फिगरेशन H2 सेटअप को सरल बनाता है, विशेष रूप से टेस्टिंग के लिए।
- **इन-मेमोरी प्रकृति**: H2 के डेटा को जब JVM रुकता है तब खो जाता है, जिससे इसे अलग टेस्ट रन के लिए आदर्श बनाता है।

इन चरणों का पालन करके, आप अपने Spring प्रोजेक्ट में H2 डेटाबेस का उपयोग करने में सक्षम होंगे, और इसके तेजी और सरलता का लाभ उठाकर अपने डेटा लेयर या पूरी एप्लिकेशन स्टैक को वैलिडेट करने में सक्षम होंगे।