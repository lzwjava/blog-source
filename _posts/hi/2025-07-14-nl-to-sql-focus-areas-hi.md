---
audio: false
generated: true
lang: hi
layout: post
title: सटीक और सुरक्षित एनएल-टू-एसक्यूएल प्रणालियों का निर्माण
translated: true
type: note
---

### एनएल-टू-एसक्यूएल सिस्टम बनाते समय मुख्य ध्यान केंद्रित करने के क्षेत्र

एक प्राकृतिक भाषा से एसक्यूएल (NL-to-SQL) सिस्टम बनाने में उपयोगकर्ता के रोजमर्रा की भाषा में पूछे गए प्रश्नों को निष्पादन योग्य एसक्यूएल स्टेटमेंट में अनुवादित करना शामिल होता है, जिसमें अक्सर एआई मॉडल जैसे एलएलएम (उदाहरण के लिए, जीपीटी वेरिएंट या हगिंग फेस जैसे विशेष मॉडल) का उपयोग किया जाता है। आपकी पोस्टग्रेएसक्यूएल स्कीमा और उदाहरण क्वेरी के आधार पर, यहां ध्यान केंद्रित करने के लिए मुख्य क्षेत्र दिए गए हैं:

#### 1. **स्कीमा की सटीकता और समझ**
   - **स्कीमा जागरूकता**: एआई प्रॉम्प्ट में हमेशा पूरी डेटाबेस स्कीमा (टेबल, कॉलम, डेटा प्रकार, संबंध) प्रदान करें। इससे मॉडल को सही एसक्यूएल जनरेट करने में मदद मिलती है। आपके मामले में, `first_name`, `created_at`, `date_of_birth`, और `last_login` जैसे कॉलम पर जोर दें ताकि हॉलुसिनेशन (जैसे, मौजूदा फील्ड का गलत आविष्कार) से बचा जा सके।
   - **अस्पष्टता को संभालना**: प्राकृतिक भाषा अस्पष्ट होती है—उदाहरण के लिए, "around the day last month" का मतलब ±1 दिन हो सकता है, लेकिन फजी शब्दों (जैसे, "recent week" को 7 दिन) की व्याख्या करने के लिए प्रॉम्प्ट के माध्यम से स्पष्ट करें। व्याख्याओं को मार्गदर्शन देने के लिए प्रॉम्प्ट में उदाहरणों का उपयोग करें।
   - **डेटा प्रकार और फंक्शन**: पोस्टग्रेएसक्यूएल-विशिष्ट सिंटैक्स पर ध्यान केंद्रित करें, जैसे तिथियों के लिए `AGE()`, केस-इनसेंसिटिव स्ट्रिंग के लिए `ILIKE`, और उचित कास्टिंग (जैसे, आपके उदाहरण में `CAST(created_at AS DATE)`) का उपयोग करना। मॉडल को एसक्यूएल डायलेक्ट के अंतरों पर प्रशिक्षित या फाइन-ट्यून करें।
   - **एज केस**: जटिल क्वेरीज जैसे जॉइन (यदि एकाधिक टेबल हों), एग्रीगेशन (जैसे COUNT, SUM), या सबक्वेरीज को संभालें। `password_hash` या `account_balance` जैसे संवेदनशील फील्ड वाली क्वेरीज के लिए टेस्ट करें।

#### 2. **प्रदर्शन और अनुकूलन**
   - कुशल एसक्यूएल जनरेट करें: मॉडल को इंडेक्स (जैसे, `created_at` या `first_name` पर) का उपयोग करने, परिणामों को सीमित करने (डिफॉल्ट रूप से `LIMIT` जोड़ें), और फुल-टेबल स्कैन से बचने के लिए प्रोत्साहित करें।
   - स्केलेबिलिटी: बड़े डेटासेट के लिए, क्वेरी ऑप्टिमाइजेशन टूल्स को इंटीग्रेट करें या जनरेट किए गए एसक्यूएल को एक एक्सप्लेन प्लान के खिलाफ वैलिडेट करें।

#### 3. **त्रुटि प्रबंधन और सत्यापन**
   - निष्पादन से पहले जनरेट किए गए एसक्यूएल को पार्स और वैलिडेट करें (जैसे, पायथन में `sqlparse` जैसी एसक्यूएल पार्सर लाइब्रेरी का उपयोग करके)।
   - फॉलबैक प्रतिक्रियाएं प्रदान करें: यदि क्वेरी अस्पष्ट है, तो अमान्य एसक्यूएल जनरेट करने के बजाय उपयोगकर्ता से स्पष्टीकरण के लिए प्रॉम्प्ट करें।

#### 4. **सुरक्षा और सुरक्षा**
   - **एसक्यूएल इंजेक्शन को रोकना**: जोखिम जनरेट किए गए एसक्यूएल को निष्पादित करने से आता है। उपयोगकर्ता इनपुट को सीधे एसक्यूएल स्ट्रिंग में कभी न जोड़ें। इसके बजाय:
     - निष्पादित करते समय **पैरामीटराइज्ड क्वेरी** या प्रिपेयर्ड स्टेटमेंट का उपयोग करें (जैसे, पायथन में `psycopg2` के साथ: `cursor.execute("SELECT * FROM users WHERE first_name = %s", (name,))`)।
     - एआई को प्लेसहोल्डर (जैसे, `WHERE first_name ILIKE %s`) के साथ एसक्यूएल जनरेट करने और मानों को अलग से बाइंड करने का निर्देश दें।
     - एनएल इनपुट को सैनिटाइज़ करें: दुर्भावनापूर्ण पैटर्न (जैसे, "DROP" या ";" जैसे एसक्यूएल कीवर्ड का पता लगाने के लिए रेगेक्स का उपयोग करके) को हटाने के लिए उपयोगकर्ता क्वेरी को प्री-प्रोसेस करें।
     - केवल पढ़ने के लिए सीमित करें: एआई को केवल SELECT क्वेरीज जनरेट करने तक सीमित करें—प्रॉम्प्ट निर्देशों जैसे "केवल SELECT स्टेटमेंट जनरेट करें; डेटा संशोधित न करें" के माध्यम से DDL (जैसे, CREATE/DROP) या DML (जैसे, INSERT/UPDATE) को ब्लॉक कर दें।
   - **डेटा एक्सेस को नियंत्रित करना**:
     - **पंक्ति-स्तरीय सुरक्षा (RLS)**: पोस्टग्रेएसक्यूएल में, टेबल पर RLS पॉलिसी सक्षम करें (जैसे, `ALTER TABLE users ENABLE ROW LEVEL SECURITY; CREATE POLICY user_policy ON users USING (role = current_user);`)। यह सुनिश्चित करता है कि क्वेरीज केवल उन्हीं पंक्तियों को लौटाएं जिन तक उपयोगकर्ता की पहुंच है।
     - **व्यू और भूमिकाएं**: प्रतिबंधित व्यू बनाएं (जैसे, `CREATE VIEW safe_users AS SELECT id, username, first_name FROM users;`) और डेटाबेस भूमिकाओं के माध्यम से एक्सेस प्रदान करें। एआई को बेस टेबल्स के बजाय व्यू को क्वेरी करना चाहिए।
     - **एपीआई लेयर**: सिस्टम को एक एपीआई (जैसे, FastAPI का उपयोग करके) में रैप करें जो उपयोगकर्ताओं को प्रमाणित करता है और एक्सेस कंट्रोल लागू करता है (जैसे, उपयोगकर्ता भूमिकाओं को निर्धारित करने के लिए JWT टोकन)।
     - **सैंडबॉक्स निष्पादन**: क्वेरीज को एक रीड-ओनली रेप्लिका डेटाबेस या कंटेनराइज्ड वातावरण (जैसे, Docker) में चलाएं ताकि उत्पादन डेटा से अलग किया जा सके।
     - **ऑडिट लॉगिंग**: मॉनिटरिंग के लिए सभी जनरेट किए गए एसक्यूएल और निष्पादन को लॉग करें।
   - **डेटा गोपनीयता**: प्रॉम्प्ट में संवेदनशील कॉलम (जैसे, `password_hash`, `email`) को ब्लैकलिस्ट करके उन्हें एक्सपोज होने से बचाएं: "संवेदनशील फील्ड जैसे password_hash, email को तब तक न चुनें जब तक स्पष्ट रूप से आवश्यक और अधिकृत न हो।"
   - **दर सीमा और कोटा**: प्रति उपयोगकर्ता/सत्र क्वेरीज को सीमित करके दुरुपयोग को रोकें।

#### 5. **नियंत्रित रूपांतरण के लिए प्रॉम्प्ट इंजीनियरिंग**
   - एनएल-टू-एसक्यूएल की गुणवत्ता काफी हद तक इस बात पर निर्भर करती है कि आप एआई को कैसे निर्देशित करते हैं। इन तत्वों के साथ संरचित प्रॉम्प्ट का उपयोग करें:
     - **सिस्टम प्रॉम्प्ट टेम्पलेट**:
       ```
       आप पोस्टग्रेएसक्यूएल के लिए एक विशेषज्ञ एसक्यूएल जनरेटर हैं। नीचे दी गई स्कीमा और एक प्राकृतिक भाषा क्वेरी को देखते हुए, एक सुरक्षित, सटीक SELECT क्वेरी जनरेट करें।

       स्कीमा:
       [यहां पूरी स्कीमा डालें, जैसे, CREATE TABLE users (...)]

       नियम:
       - केवल SELECT स्टेटमेंट जनरेट करें। INSERT, UPDATE, DELETE, या DDL नहीं।
       - इंजेक्शन को रोकने के लिए उपयोगकर्ता-प्रदत्त मानों के लिए पैरामीटराइज्ड प्लेसहोल्डर (जैसे %s) का उपयोग करें।
       - तिथियों को पोस्टग्रेएसक्यूएल फंक्शन जैसे AGE(), CURRENT_DATE, INTERVAL के साथ संभालें।
       - अस्पष्ट शब्दों (जैसे, "around last month") के लिए, [विशिष्ट नियम, जैसे, पिछले महीने की उसी तारीख से ±1 दिन] के रूप में व्याख्या करें।
       - निर्दिष्ट न होने पर परिणामों को 100 पंक्तियों तक सीमित करें।
       - यदि क्वेरी में आयु शामिल है, तो चालू वर्ष या निर्दिष्ट वर्ष के अनुसार गणना करें (जैसे, EXTRACT(YEAR FROM AGE(CURRENT_DATE, date_of_birth)) = 20)।
       - password_hash, email जैसे संवेदनशील कॉलम न चुनें।
       - यदि अस्पष्ट है, तो "Clarify: [question]" के साथ उत्तर दें।

       उपयोगकर्ता क्वेरी: [NL query]
       ```
     - **प्रॉम्प्ट में उदाहरण**: मॉडल को मार्गदर्शन देने के लिए 2-3 शॉट उदाहरण शामिल करें, जैसे आपकी प्रदान की गई क्वेरी और जनरेट किया गया एसक्यूएल।
     - **चेन ऑफ थॉट**: मॉडल को चरणबद्ध तरीके से तर्क करने का निर्देश दें: "पहले, मुख्य फिल्टर की पहचान करें। दूसरा, कॉलम से मैप करें। तीसरा, WHERE क्लॉज बनाएं।"
     - **फाइन-ट्यूनिंग**: यदि कस्टम मॉडल का उपयोग कर रहे हैं, तो स्पाइडर या विकीएसक्यूएल जैसे डेटासेट पर फाइन-ट्यून करें, जिसे आपकी स्कीमा-विशिष्ट उदाहरणों के साथ संवर्धित किया गया हो।
     - **परीक्षण**: मेट्रिक्स जैसे निष्पादन सटीकता (क्या यह त्रुटियों के बिना चलता है?) और शब्दार्थ मिलान (क्या यह अपेक्षित परिणाम लौटाता है?) के साथ मूल्यांकन करें।

#### आपकी उदाहरण क्वेरी में संभावित सुधार
मुख्य प्रश्न न होते हुए भी, आपके जनरेट किए गए एसक्यूएल में कुछ अच्छे तत्व हैं लेकिन यह अधिक सुरक्षित/सटीक हो सकती है:
- पैरामीटर का उपयोग करें: इसे `WHERE first_name ILIKE %s` में बदलें और 'andy' को बाइंड करें।
- आयु "as of 2025": किसी विशिष्ट वर्ष-अंत तक ठीक करने के लिए `EXTRACT(YEAR FROM AGE('2025-12-31'::date, date_of_birth)) = 20` का उपयोग करें।
- सुरक्षा के लिए `ORDER BY last_login DESC LIMIT 10;` जोड़ें।

इसे सुरक्षित रूप से लागू करने के लिए एक बैकएंड लेयर (जैसे, एआई आउटपुट से सीधे एसक्यूएल निष्पादित न करना) की आवश्यकता होती है। एक एलएलएम लाइब्रेरी (जैसे, एनएल-टू-एसक्यूएल चेन के लिए LangChain) का उपयोग करके एक स्क्रिप्ट के साथ छोटे से शुरुआत करें।

यदि आपको कोड उदाहरण या विशिष्ट भागों (जैसे, एक पायथन इम्प्लीमेंटेशन) में सहायता की आवश्यकता है, तो अधिक विवरण प्रदान करें!

**संदर्भ**  
[पोस्टग्रेएसक्यूएल डॉक्यूमेंटेशन: पंक्ति-स्तरीय सुरक्षा](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)  
[LangChain एनएल-टू-एसक्यूएल ट्यूटोरियल](https://python.langchain.com/docs/tutorials/sql_qa/)  
[पायथन में एसक्यूएल इंजेक्शन को रोकना](https://realpython.com/prevent-python-sql-injection/)