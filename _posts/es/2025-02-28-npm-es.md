---
audio: false
generated: true
lang: es
layout: post
title: Configuración de NPM
translated: true
type: note
---

### Puntos Clave
- Parece probable que configurar NPM implique editar el archivo `.npmrc` para establecer la configuración de proxy y registro, lo cual puede hacerse manualmente o mediante comandos.
- La investigación sugiere que la configuración del proxy requiere el formato `proxy = http://usuario:contraseña@servidor_proxy:puerto`, con los caracteres especiales codificados en URL.
- La evidencia apunta a establecer el registro como `registry = https://registry.npmjs.org/` por defecto, con opciones para deshabilitar la verificación SSL si es necesario.

### Configuración de NPM y Trabajo con `.npmrc`
NPM, o Node Package Manager, es una herramienta para gestionar dependencias de JavaScript, y configurarla a menudo implica el archivo `.npmrc` para ajustes como el registro y el proxy.

#### ¿Qué es `.npmrc` y Dónde se Encuentra?
El archivo `.npmrc` es un archivo de configuración para NPM que permite personalizar su comportamiento. Puede estar en:
- **Ámbito global**: Se encuentra en `~/.npmrc` en sistemas tipo Unix o en `%APPDATA%\npm\npmrc` en Windows (normalmente `C:\Users\<nombre_de_usuario>\AppData\Roaming\npm\npmrc`).
- **Ámbito local de un proyecto**: Ubicado en `./package/.npmrc` en el directorio raíz del proyecto. Los ajustes locales anulan los globales.

#### Configuración de Proxy y HTTPS Proxy
Para trabajar detrás de un proxy, añada estas líneas a `.npmrc`:
- `proxy = http://usuario:contraseña@servidor_proxy:puerto`
- `https_proxy = http://usuario:contraseña@servidor_proxy:puerto`

Tenga en cuenta que incluso para `https_proxy`, use `http://` como protocolo. Si su nombre de usuario o contraseña tiene caracteres especiales (por ejemplo, `\`, `@`), codifíquelos en URL (por ejemplo, `domain\user` se convierte en `domain%5Cuser`). También puede establecer estos valores mediante comandos:
- `npm config set proxy http://usuario:contraseña@servidor_proxy:puerto`
- `npm config set https_proxy http://usuario:contraseña@servidor_proxy:puerto`

#### Configuración del Registry
El registry es la URL que NPM utiliza para obtener paquetes, típicamente establecida como:
- `registry = https://registry.npmjs.org/`

Para registros personalizados, reemplácelo con su URL (por ejemplo, un registro privado de una empresa). Establézcalo mediante:
- `npm config set registry https://su_registro_personalizado.com/`

#### Manejo de SSL y Verificación
Si enfrenta problemas de SSL, considere:
- `strict-ssl = false` en `.npmrc` para ignorar errores SSL, aunque esto es menos seguro. Establézcalo mediante:
- `npm config set strict-ssl false`

#### Uso y Verificación de Configuraciones
Edite `.npmrc` directamente usando un editor de texto, o use los comandos `npm config set`. Para verificar:
- Liste todos los ajustes con `npm config list`.
- Verifique un ajuste específico con `npm config get proxy`.
- Depure problemas con `npm install --verbose` para obtener una salida detallada.

Un archivo `.npmrc` de ejemplo podría verse así:
```
proxy = http://usuario:contraseña@servidor_proxy:8080
https_proxy = http://usuario:contraseña@servidor_proxy:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

### Nota de Estudio: Guía Integral para Configurar NPM con `.npmrc`
Esta sección proporciona una exploración detallada de la configuración de NPM, centrándose en el archivo `.npmrc` para los ajustes de registro y proxy, ampliando la respuesta directa con contexto adicional y detalles técnicos.

#### Introducción a `.npmrc` y su Función
El archivo `.npmrc` es un archivo de configuración crítico para NPM, que permite personalizar los comportamientos de la gestión de paquetes. Soporta un formato INI con pares clave-valor, donde los comentarios comienzan con punto y coma (`;`). Puede ubicarse global o localmente:
- **Ubicación Global**: En sistemas tipo Unix, está en `~/.npmrc`; en Windows, en `%APPDATA%\npm\npmrc`, típicamente `C:\Users\<nombre_de_usuario>\AppData\Roaming\npm\npmrc`.
- **Ubicación Local**: Dentro del directorio raíz de un proyecto como `./package/.npmrc`. Los ajustes locales anulan los globales, proporcionando configuraciones específicas del proyecto.

Esta jerarquía asegura flexibilidad, permitiendo a los desarrolladores gestionar ajustes tanto a nivel de usuario como de proyecto, lo cual es particularmente útil en entornos con múltiples proyectos o sistemas compartidos.

#### Configuración Detallada del Proxy
Trabajar detrás de un proxy requiere establecer tanto `proxy` como `https_proxy` en `.npmrc`. El formato es:
- `proxy = http://usuario:contraseña@servidor_proxy:puerto`
- `https_proxy = http://usuario:contraseña@servidor_proxy:puerto`

Cabe destacar que `https_proxy` usa `http://` como protocolo, no `https://`, debido a que el servidor proxy maneja la conexión, no la encripta hacia el proxy en sí. Este es un punto común de confusión, ya que la carga útil hacia el destino permanece encriptada por SSL.

Para la autenticación, incluya el nombre de usuario y la contraseña, pero si contienen caracteres especiales, la codificación URL es esencial:
- La barra invertida (`\`) se convierte en `%5C`.
- El símbolo de arroba (`@`) se convierte en `%40`.
- Los dos puntos (`:`) se convierten en `%3A`.

Por ejemplo, si el nombre de usuario es `domain\user` y la contraseña es `pass@word`, sería `proxy = http://domain%5Cuser:pass%40word@servidor_proxy:8080`. Esta codificación asegura un análisis correcto por parte de NPM.

Los usuarios de Windows, especialmente en entornos corporativos con Active Directory, pueden enfrentar problemas con las barras invertidas. Algunos informes indican que `domain\username` en `.npmrc` podría convertirse en `domain/username` al leerse, lo que potencialmente causa fallos de autenticación. En tales casos, herramientas como NTLM Authorization Proxy Server o Cntlm pueden ayudar, aunque están fuera de la configuración directa de `.npmrc`.

#### Configuración del Registry y Consideraciones de SSL
El ajuste del registry define de dónde NPM obtiene los paquetes, por defecto `https://registry.npmjs.org/`. Para registros personalizados o privados, establezca:
- `registry = https://su_registro_personalizado.com/`

Si la verificación SSL falla, a menudo debido a proxies corporativos con certificados autofirmados, puede deshabilitar el SSL estricto:
- `strict-ssl = false`

Sin embargo, esto reduce la seguridad, ya que omite la validación de certificados. Alternativamente, configure la autoridad certificadora:
- Use `npm config -g set cafile [SU_DIRECTORIO_CERTIFICADO]/[NOMBRE_CERTIFICADO].crt` para especificar un archivo CA de confianza.

Algunos desarrolladores optan por `registry = http://registry.npmjs.org/` para evitar SSL por completo, pero esto no se recomienda por razones de seguridad, especialmente en producción.

#### Uso de `.npmrc`: Edición Manual vs. Línea de Comandos
Puede editar `.npmrc` directamente con cualquier editor de texto, asegurándose de que cada ajuste esté en una nueva línea con el formato `clave = valor`. Los comentarios comienzan con `;`, por ejemplo:
```
; Configuración de proxy para red corporativa
proxy = http://usuario:contraseña@servidor_proxy:8080
https_proxy = http://usuario:contraseña@servidor_proxy:8080
registry = https://registry.npmjs.org/
strict-ssl = false
```

Alternativamente, use comandos de NPM por conveniencia:
- Establecer proxy: `npm config set proxy http://usuario:contraseña@servidor_proxy:puerto`
- Establecer registry: `npm config set registry https://registry.npmjs.org/`
- Establecer strict-ssl: `npm config set strict-ssl false`

Estos comandos actualizan el archivo `.npmrc` apropiado según el contexto (global o local). Para cambiar entre global y local, use `-g` para global, por ejemplo, `npm config set -g proxy ...`.

#### Verificación y Resolución de Problemas
Para verificar configuraciones, use:
- `npm config list` para listar todos los ajustes, mostrando tanto los valores efectivos como los predeterminados.
- `npm config get proxy` para recuperar un ajuste específico.

Para la resolución de problemas, especialmente detrás de proxies, ejecute:
- `npm install --verbose` para ver registros detallados, lo que puede ayudar a identificar problemas de conexión, como `ECONNREFUSED` o `socket hang up`.

Si los ajustes no surten efecto, verifique las variables de entorno (`HTTP_PROXY`, `HTTPS_PROXY`) que podrían anular `.npmrc`. Estas pueden establecerse a nivel del sistema y tienen prioridad, así que asegure la consistencia.

#### Mejores Prácticas y Consideraciones Adicionales
- **Seguridad**: Evite `strict-ssl = false` en producción; en su lugar, configure certificados de confianza.
- **Variables de Entorno**: Tenga en cuenta que `NODE_ENV` y `HTTPS_PROXY` pueden anular los ajustes de `.npmrc`, útil para pipelines de CI/CD pero potencialmente confuso localmente.
- **Niveles de Log**: Ajuste `loglevel` en `.npmrc` (por ejemplo, `loglevel = http`) para una salida más detallada durante la depuración, con opciones que van desde `silent` hasta `silly` (7 niveles en total).
- **Proxies Corporativos**: Para proxies NTLM, considere herramientas como Cntlm, configurando un servidor proxy local y configurando `.npmrc` para que apunte a `localhost:3128`, simplificando la autenticación.

#### Configuraciones de Ejemplo
Aquí tiene una tabla que resume los ajustes comunes de `.npmrc` para proxy y registry, con ejemplos:

| **Ajuste**      | **Descripción**                              | **Ejemplo**                                      |
|------------------|----------------------------------------------|--------------------------------------------------|
| proxy            | URL del servidor proxy HTTP                  | `proxy = http://usuario:contraseña@proxy:8080`   |
| https_proxy      | URL del servidor proxy HTTPS                 | `https_proxy = http://usuario:contraseña@proxy:8080` |
| registry         | URL del registro de paquetes                 | `registry = https://registry.npmjs.org/`         |
| strict-ssl       | Habilitar/deshabilitar verificación SSL      | `strict-ssl = false`                             |
| loglevel         | Nivel de salida de consola (silent a silly, 7 niveles) | `loglevel = http`                            |

Esta tabla ayuda como referencia rápida, especialmente para desarrolladores nuevos en `.npmrc`.

#### Detalle Inesperado: Impacto en Ajustes Globales vs. Locales
Un aspecto inesperado es cómo los ajustes globales de `.npmrc` afectan a todos los proyectos, mientras que los ajustes locales pueden anularlos para proyectos específicos. Esta superposición puede llevar a confusión si, por ejemplo, se establece un proxy global pero un proyecto local usa un registro diferente, lo que potencialmente causa problemas de autenticación. Entender esta jerarquía es crucial para entornos multiproyecto.

#### Conclusión
Configurar NPM mediante `.npmrc` para los ajustes de proxy y registro es sencillo con el formato correcto y consideraciones para la codificación y SSL. Editando directamente o usando comandos, y verificando con `npm config list`, se asegura una gestión de paquetes fluida, especialmente en redes corporativas con proxies. Para más lectura, consulte la documentación oficial en [NPM CLI Config](https://docs.npmjs.com/cli-config) o explore las mejores prácticas en [Configuring Your .nmprc](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment).

### Citas Clave
- [Documentación de NPM CLI Config](https://docs.npmjs.com/cli-config)
- [Configuring Your .nmprc for an Optimal Node.js Environment](https://nodesource.com/blog/configuring-your-nmprc-for-an-optimal-node-js-environment)
- [How to setup npm proxy settings behind proxy on Windows](https://gist.github.com/zillingen/5c4b8da657025c83ead59e1e547c7436)