---
audio: false
generated: true
lang: es
layout: post
title: Script de Python para Conexiones TCP
translated: true
type: note
---

El comando de PowerShell `Get-NetTCPConnection -LocalPort 80` recupera información sobre las conexiones TCP en un sistema Windows que están utilizando el puerto local especificado (en este caso, el puerto 80). Para lograr una funcionalidad similar en Python, puedes usar la librería `psutil`, que proporciona acceso multiplataforma a detalles del sistema, incluyendo conexiones de red.

A continuación se muestra un script de Python que enumera las conexiones TCP filtradas por un puerto local específico (por ejemplo, el puerto 80), similar al comando de PowerShell:

```python
import psutil

def get_tcp_connections_by_port(local_port):
    # Recuperar todas las conexiones de red
    connections = psutil.net_connections(kind='tcp')
    
    # Filtrar conexiones por puerto local
    matching_connections = [
        conn for conn in connections
        if conn.laddr.port == local_port and conn.status == 'LISTEN'
    ]
    
    # Imprimir detalles de las conexiones coincidentes
    if not matching_connections:
        print(f"No se encontraron conexiones TCP escuchando en el puerto {local_port}")
        return
    
    print(f"Conexiones TCP escuchando en el puerto {local_port}:")
    print("PID\tDirección Local\tDirección Remota\tEstado")
    print("-" * 50)
    
    for conn in matching_connections:
        local_addr = f"{conn.laddr.ip}:{conn.laddr.port}" if conn.laddr else "N/A"
        remote_addr = f"{conn.raddr.ip}:{conn.raddr.port}" if conn.raddr else "N/A"
        pid = conn.pid if conn.pid is not None else "N/A"
        status = conn.status if conn.status else "N/A"
        print(f"{pid}\t{local_addr}\t{remote_addr}\t{status}")

if __name__ == "__main__":
    target_port = 80  # Especificar el puerto a filtrar (ej. 80)
    get_tcp_connections_by_port(target_port)
```

### Explicación:
1. **Instalar `psutil`**:
   - Necesitas la librería `psutil` para acceder a los detalles de las conexiones de red. Instálala usando:
     ```bash
     pip install psutil
     ```

2. **Detalles del Script**:
   - `psutil.net_connections(kind='tcp')` recupera todas las conexiones TCP.
   - El script filtra las conexiones donde el puerto local coincide con el `local_port` especificado (ej. 80) y el estado es `LISTEN` (para imitar el comportamiento de `Get-NetTCPConnection` para puertos en escucha).
   - Para cada conexión coincidente, imprime:
     - **PID**: ID del proceso de la aplicación que usa la conexión.
     - **Dirección Local**: IP y puerto local.
     - **Dirección Remota**: IP y puerto remoto (si aplica; "N/A" si no está conectado).
     - **Estado**: Estado de la conexión (ej. "LISTEN").

3. **Salida**:
   - La salida está formateada para parecerse a la salida tabular de `Get-NetTCPConnection`, mostrando el PID, la dirección local, la dirección remota y el estado.

### Ejemplo de Salida:
Si un servidor web (ej. Apache o Nginx) está escuchando en el puerto 80, la salida podría verse así:
```
Conexiones TCP escuchando en el puerto 80:
PID     Dirección Local         Dirección Remota        Estado
--------------------------------------------------
1234    0.0.0.0:80            N/A                   LISTEN
```

Si ningún proceso está escuchando en el puerto 80:
```
No se encontraron conexiones TCP escuchando en el puerto 80
```

### Notas:
- **Multiplataforma**: La librería `psutil` funciona en Windows, Linux y macOS, a diferencia de `Get-NetTCPConnection`, que es específico de Windows.
- **Permisos**: En algunos sistemas (ej. Linux o macOS), puedes necesitar privilegios de root/administrador para acceder a ciertos detalles de las conexiones.
- **Filtrado**: El script filtra las conexiones `LISTEN` para coincidir con el caso de uso típico de `Get-NetTCPConnection -LocalPort 80`. Puedes modificar el filtro (ej. eliminar la condición `conn.status == 'LISTEN'`) para incluir otros estados de conexión como `ESTABLISHED`.
- **Información Adicional**: Puedes extender el script para incluir más detalles (ej. nombre del proceso) usando `psutil.Process(conn.pid).name()` si un PID está disponible.

Este script proporciona un equivalente en Python al comando de PowerShell, con una funcionalidad y salida similares. Si necesitas características adicionales o tienes requisitos específicos, ¡avísame!