---
audio: false
generated: true
lang: es
layout: post
title: Configuración de un servidor NFS para compartir medios en Ubuntu
translated: true
type: note
---

Para configurar un servidor NFS (Network File System) en Ubuntu para servir archivos multimedia, sigue estos pasos detallados. Esta guía asume que deseas compartir un directorio que contiene archivos multimedia (por ejemplo, videos, música) a través de tu red de forma segura y eficiente.

---

### Paso 1: Instalar el Software del Servidor NFS
Primero, necesitas instalar el paquete del servidor NFS en tu sistema Ubuntu.

1. Actualiza la lista de paquetes para asegurarte de obtener las últimas versiones:
   ```bash
   sudo apt update
   ```

2. Instala el paquete `nfs-kernel-server`, que proporciona la funcionalidad del servidor NFS:
   ```bash
   sudo apt install nfs-kernel-server
   ```

Esto instala el software necesario para ejecutar un servidor NFS.

---

### Paso 2: Crear y Configurar el Directorio Multimedia
Necesitas un directorio para almacenar tus archivos multimedia y configurarlo para compartir.

1. Crea un directorio para contener tus archivos multimedia (por ejemplo, `/media/share`):
   ```bash
   sudo mkdir -p /media/share
   ```

2. Establece la propiedad a tu cuenta de usuario (reemplaza `$USER` con tu nombre de usuario real si es necesario):
   ```bash
   sudo chown $USER:$USER /media/share
   ```

3. Ajusta los permisos para permitir el acceso. Para archivos multimedia que son principalmente de solo lectura para los clientes, puedes establecer:
   - Directorios: `755` (lectura y ejecución para otros)
   - Archivos: `644` (lectura para otros)
   Sin embargo, para simplificar, aplica `755` recursivamente si no necesitas un control detallado:
   ```bash
   sudo chmod -R 755 /media/share
   ```
   - **Nota**: Los archivos multimedia no necesitan ser ejecutables, pero `755` en los archivos no perjudicará la funcionalidad de NFS ya que la ejecución ocurre localmente en el cliente.

4. Coloca tus archivos multimedia en `/media/share` (por ejemplo, copia videos o música en este directorio).

---

### Paso 3: Configurar las Exportaciones de NFS
El servidor NFS utiliza el archivo `/etc/exports` para definir qué directorios compartir y quién puede acceder a ellos.

1. Abre el archivo de exportaciones con un editor de texto:
   ```bash
   sudo nano /etc/exports
   ```

2. Agrega una línea para compartir `/media/share`. La sintaxis es:
   ```
   /ruta/al/directorio cliente(opciones)
   ```
   - **Ejemplo 1**: Compartir con una IP de cliente específica (por ejemplo, `192.168.1.100`) con acceso de lectura-escritura:
     ```
     /media/share 192.168.1.100(rw,sync,no_subtree_check)
     ```
   - **Ejemplo 2**: Compartir con todos los dispositivos en tu subred (por ejemplo, `192.168.1.0/24`) con acceso de solo lectura:
     ```
     /media/share 192.168.1.0/24(ro,sync,no_subtree_check)
     ```
   - **Ejemplo 3**: Compartir con cualquier dispositivo (menos seguro, usar con precaución):
     ```
     /media/share *(rw,sync,no_subtree_check)
     ```

   **Opciones Explicadas**:
   - `rw`: Acceso de lectura-escritura (usa `ro` para solo lectura si se prefiere para streaming multimedia).
   - `sync`: Asegura que los datos se escriben en el disco antes de confirmar las operaciones (más seguro pero más lento; usa `async` para rendimiento con el riesgo de pérdida de datos en fallos).
   - `no_subtree_check`: Mejora el rendimiento al desactivar la verificación de subárbol (recomendado para la mayoría de configuraciones).

3. Guarda el archivo (`Ctrl+O`, luego `Enter` en nano) y sal (`Ctrl+X`).

---

### Paso 4: Aplicar la Configuración de NFS
Después de editar el archivo de exportaciones, actualiza el servidor NFS para reflejar tus cambios.

1. Exporta los recursos compartidos:
   ```bash
   sudo exportfs -a
   ```

2. Reinicia el servidor NFS para aplicar la configuración:
   ```bash
   sudo systemctl restart nfs-kernel-server
   ```

3. Verifica que el servicio esté en ejecución:
   ```bash
   sudo systemctl status nfs-kernel-server
   ```
   - Busca "active (running)" en la salida.

4. Comprueba los directorios exportados:
   ```bash
   sudo exportfs -v
   ```
   - Esto debería listar `/media/share` con las opciones que especificaste.

---

### Paso 5: Configurar el Firewall
NFS utiliza puertos específicos, y necesitas asegurarte de que tu firewall permita el tráfico hacia ellos. Ubuntu a menudo usa UFW (Uncomplicated Firewall).

1. **Puertos Predeterminados de NFS**:
   - NFS: 2049 (TCP/UDP)
   - RPC: 111 (TCP/UDP)
   - Otros servicios (mountd, statd, lockd): Dinámicos por defecto, pero se pueden configurar a puertos estáticos.

2. Para simplificar, permite los puertos esenciales con configuraciones dinámicas (si no configuras puertos estáticos):
   ```bash
   sudo ufw allow 2049
   sudo ufw allow 111
   ```
   - **Nota**: Esto puede no cubrir todo el tráfico de NFS si mountd, statd o lockd usan puertos aleatorios.

3. **Opcional: Establecer Puertos Estáticos para un Mejor Control** (recomendado para reglas de firewall precisas):
   - Edita `/etc/default/nfs-kernel-server`:
     ```bash
     sudo nano /etc/default/nfs-kernel-server
     ```
     Añade o modifica:
     ```
     RPCMOUNTDOPTS="-p 4001"
     ```
   - Edita `/etc/default/nfs-common`:
     ```bash
     sudo nano /etc/default/nfs-common
     ```
     Añade o modifica:
     ```
     STATDOPTS="-p 4002"
     ```
   - Crea `/etc/modprobe.d/nfs.conf` para lockd:
     ```bash
     sudo nano /etc/modprobe.d/nfs.conf
     ```
     Añade:
     ```
     options lockd nlm_udp_port=4003 nlm_tcp_port=4003
     ```
   - Reinicia el servidor NFS:
     ```bash
     sudo systemctl restart nfs-kernel-server
     ```

4. Permite los puertos estáticos en UFW:
   ```bash
   sudo ufw allow 2049/tcp
   sudo ufw allow 2049/udp
   sudo ufw allow 111/tcp
   sudo ufw allow 111/udp
   sudo ufw allow 4001/tcp
   sudo ufw allow 4001/udp
   sudo ufw allow 4002/tcp
   sudo ufw allow 4002/udp
   sudo ufw allow 4003/tcp
   sudo ufw allow 4003/udp
   ```

5. Habilita UFW si no está ya activo:
   ```bash
   sudo ufw enable
   ```

---

### Paso 6: Verificar la Configuración
Asegúrate de que el servidor NFS esté funcionando correctamente.

1. Comprueba los recursos compartidos exportados desde el servidor:
   ```bash
   showmount -e localhost
   ```
   - Deberías ver `/media/share` listado con los clientes/opciones correctos.

2. Verifica los puertos en escucha:
   ```bash
   sudo ss -tuln | grep -E "2049|111|4001|4002|4003"
   ```
   - Confirma que estos puertos estén abiertos y vinculados a los servicios NFS.

---

### Paso 7: Probar desde un Cliente (Opcional)
En una máquina cliente (por ejemplo, otro sistema Ubuntu), prueba a montar el recurso compartido:
```bash
sudo mount -t nfs <ip_del_servidor>:/media/share /mnt
```
- Reemplaza `<ip_del_servidor>` con la dirección IP de tu servidor NFS.
- Asegúrate de que `/mnt` exista (`sudo mkdir /mnt` si es necesario).
- Accede a `/mnt` para verificar que puedes ver y reproducir los archivos multimedia.

---

### Notas Adicionales para Archivos Multimedia
- **Acceso de Solo Lectura**: Si los clientes solo necesitan transmitir medios, usa `ro` en `/etc/exports` para evitar modificaciones.
- **Permisos**: Asegúrate de que los archivos multimedia sean legibles por los clientes. Las discrepancias de UID/GID entre el servidor y el cliente pueden causar problemas de acceso; ajusta los permisos de archivo o usa opciones de NFS como `all_squash` si es necesario (avanzado).
- **Rendimiento**: Para archivos multimedia grandes, la opción predeterminada `sync` es segura pero más lenta. Prueba con `async` si el rendimiento es una prioridad y el riesgo de pérdida de datos es aceptable.
- **Versión de NFS**: Ubuntu utiliza por defecto NFSv4, que es adecuado para servir medios. Normalmente no se necesita configuración adicional a menos que se den soporte a clientes antiguos (NFSv3).

---

### Resumen de Comandos
Aquí tienes una referencia rápida para la configuración básica (sin puertos estáticos):
```bash
sudo apt update
sudo apt install nfs-kernel-server
sudo mkdir -p /media/share
sudo chown $USER:$USER /media/share
sudo chmod -R 755 /media/share
echo "/media/share *(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports
sudo exportfs -a
sudo systemctl restart nfs-kernel-server
sudo ufw allow 2049
sudo ufw allow 111
```

Con esta configuración, tu servidor NFS de Ubuntu debería estar listo para servir archivos multimedia a través de la red. Ajusta las direcciones IP, permisos y reglas del firewall según tus requisitos de seguridad y red.