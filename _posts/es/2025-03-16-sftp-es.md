---
audio: false
generated: true
lang: es
layout: post
title: Configuración de un Servidor SFTP en Ubuntu
translated: true
type: note
---

Configurar un servidor SFTP (SSH File Transfer Protocol) en Ubuntu es un proceso sencillo que te permite transferir archivos de forma segura a través de una red utilizando el cifrado de SSH. A continuación, se presenta una guía completa paso a paso para ayudarte a configurarlo.

---

### Paso 1: Instalar el Servidor OpenSSH
SFTP depende del servidor OpenSSH, que necesitas instalar en tu sistema Ubuntu.

1. Abre una terminal y actualiza tu lista de paquetes:
   ```bash
   sudo apt update
   ```

2. Instala el servidor OpenSSH:
   ```bash
   sudo apt install openssh-server
   ```

3. Verifica que el servicio SSH esté en ejecución:
   ```bash
   sudo systemctl status ssh
   ```
   - Si no se está ejecutando, inícialo:
     ```bash
     sudo systemctl start ssh
     ```
   - Asegúrate de que se inicie automáticamente al arrancar:
     ```bash
     sudo systemctl enable ssh
     ```

---

### Paso 2: Crear un Usuario Dedicado para SFTP
Para una mejor seguridad, crea un usuario específico para el acceso SFTP.

1. Añade un nuevo usuario (por ejemplo, `sftpuser`):
   ```bash
   sudo adduser sftpuser
   ```
   - Sigue las instrucciones para establecer una contraseña y completar cualquier detalle opcional.

2. (Opcional) Impide que este usuario acceda a una shell a través de SSH:
   ```bash
   sudo usermod -s /bin/false sftpuser
   ```

---

### Paso 3: Configurar SSH para SFTP
Puedes permitir que todos los usuarios utilicen SFTP con sus directorios personales o restringir a usuarios específicos a ciertas carpetas.

#### Opción 1: Permitir SFTP para Todos los Usuarios
Si deseas que todos los usuarios accedan a sus directorios personales vía SFTP, no se necesita configuración adicional después de instalar OpenSSH. Salta al Paso 5.

#### Opción 2: Restringir un Usuario a un Directorio Específico
Para limitar a un usuario (por ejemplo, `sftpuser`) a un directorio específico:

1. Edita el archivo de configuración de SSH:
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```

2. Añade las siguientes líneas al final del archivo:
   ```ini
   Match User sftpuser
       ChrootDirectory /home/sftpuser
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   - Guarda el archivo (`Ctrl+O`, luego `Enter`) y sal (`Ctrl+X`).

3. Esta configuración:
   - Limita a `sftpuser` a `/home/sftpuser`.
   - Fuerza el uso exclusivo de SFTP.
   - Deshabilita funciones adicionales como el reenvío TCP.

---

### Paso 4: Configurar los Permisos del Directorio
Para que la configuración restringida (chroot) funcione, ajusta los permisos:

1. Haz que el directorio chroot sea propiedad de root:
   ```bash
   sudo chown root:root /home/sftpuser
   ```

2. Crea un subdirectorio donde el usuario pueda escribir (por ejemplo, `uploads`):
   ```bash
   sudo mkdir /home/sftpuser/uploads
   sudo chown sftpuser:sftpuser /home/sftpuser/uploads
   ```
   - El usuario ahora puede cargar archivos en `/home/sftpuser/uploads`.

---

### Paso 5: Reiniciar el Servicio SSH
Aplica tus cambios reiniciando SSH:
```bash
sudo systemctl restart ssh
```

---

### Paso 6: Probar tu Servidor SFTP
Verifica que el servidor funcione conectándote desde otro dispositivo.

1. Encuentra la dirección IP de tu máquina Ubuntu:
   ```bash
   ip addr show
   ```
   - Busca una IP como `192.168.1.100`.

2. Prueba la conexión:
   - **Desde una terminal (Linux/macOS):**
     ```bash
     sftp sftpuser@<dirección-ip-ubuntu>
     ```
     - Introduce la contraseña cuando se solicite.
   - **Usando FileZilla (cualquier SO):**
     - Host: `sftp://<dirección-ip-ubuntu>`
     - Usuario: `sftpuser`
     - Contraseña: (tu contraseña)
     - Puerto: 22

3. Intenta cargar un archivo a la carpeta `uploads` o listar el contenido del directorio.

---

### Paso 7: Configurar el Firewall
Si estás usando el firewall de Ubuntu (UFW), permite el tráfico SFTP:

1. Comprueba el estado del firewall:
   ```bash
   sudo ufw status
   ```

2. Permite SSH/SFTP (puerto 22):
   ```bash
   sudo ufw allow 22/tcp
   sudo ufw reload
   ```

---

### ¡Listo!
¡Tu servidor SFTP ya está listo! Los usuarios pueden conectarse de forma segura y transferir archivos a sus directorios designados utilizando un cliente SFTP. Si restringiste a `sftpuser`, solo podrá acceder a `/home/sftpuser/uploads` (o donde lo hayas configurado). ¡Disfruta de las transferencias de archivos seguras!