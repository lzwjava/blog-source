lzwjava@Zhiweis-MacBook-Air-1255 playground-server % tree .
.
├── AGENTS.md
├── Dockerfile
├── LICENSE
├── PYTHON_COVERAGE.md
├── PlaygroundUtils
│   ├── pom.xml
│   ├── src
│   │   └── main
│   │       └── java
│   │           └── org
│   │               └── lzw
│   │                   ├── PlaygroundUtils.java
│   │                   └── SystemUtils.java
│   └── target
│       ├── PlaygroundUtils-1.0.jar
│       ├── classes
│       │   └── org
│       │       └── lzw
│       │           ├── PlaygroundUtils.class
│       │           └── SystemUtils.class
│       ├── generated-sources
│       │   └── annotations
│       ├── maven-archiver
│       │   └── pom.properties
│       └── maven-status
│           └── maven-compiler-plugin
│               └── compile
│                   └── default-compile
│                       ├── createdFiles.lst
│                       └── inputFiles.lst
├── PlaygroundWeb
│   ├── pom.xml
│   ├── src
│   │   ├── main
│   │   │   ├── java
│   │   │   │   └── org
│   │   │   │       └── lzw
│   │   │   │           ├── HelloController.java
│   │   │   │           ├── MainController.java
│   │   │   │           └── config
│   │   │   │               ├── RootConfig.java
│   │   │   │               └── WebConfig.java
│   │   │   ├── resources
│   │   │   │   ├── logback.xml
│   │   │   │   └── static
│   │   │   │       └── index.html
│   │   │   └── webapp
│   │   │       └── WEB-INF
│   │   │           └── web.xml
│   │   └── test
│   │       └── java
│   │           └── HelloControllerTest.java
│   └── target
│       ├── PlaygroundWeb-1.0
│       │   ├── META-INF
│       │   └── WEB-INF
│       │       ├── classes
│       │       │   ├── logback.xml
│       │       │   ├── org
│       │       │   │   └── lzw
│       │       │   │       ├── AspectJConfig.class
│       │       │   │       ├── DebugAspect.class
│       │       │   │       ├── HelloController.class
│       │       │   │       ├── MainController.class
│       │       │   │       └── config
│       │       │   │           ├── RootConfig.class
│       │       │   │           └── WebConfig.class
│       │       │   └── static
│       │       │       └── index.html
│       │       ├── lib
│       │       │   ├── PlaygroundUtils-1.0.jar
│       │       │   ├── commons-lang3-3.17.0.jar
│       │       │   ├── jackson-annotations-2.13.1.jar
│       │       │   ├── jackson-core-2.13.1.jar
│       │       │   ├── jackson-databind-2.13.1.jar
│       │       │   ├── logback-classic-1.2.13.jar
│       │       │   ├── logback-core-1.2.13.jar
│       │       │   ├── slf4j-api-1.7.36.jar
│       │       │   ├── spring-aop-5.3.39.jar
│       │       │   ├── spring-beans-5.3.39.jar
│       │       │   ├── spring-context-5.3.39.jar
│       │       │   ├── spring-core-5.3.39.jar
│       │       │   ├── spring-expression-5.3.39.jar
│       │       │   ├── spring-jcl-5.3.39.jar
│       │       │   ├── spring-web-5.3.39.jar
│       │       │   └── spring-webmvc-5.3.39.jar
│       │       └── web.xml
│       ├── PlaygroundWeb-1.0.war
│       ├── checkstyle-cachefile
│       ├── checkstyle-checker.xml
│       ├── checkstyle-result.xml
│       ├── checkstyle-suppressions.xml
│       ├── classes
│       │   ├── logback.xml
│       │   ├── org
│       │   │   └── lzw
│       │   │       ├── HelloController.class
│       │   │       ├── MainController.class
│       │   │       └── config
│       │   │           ├── RootConfig.class
│       │   │           └── WebConfig.class
│       │   └── static
│       │       └── index.html
│       ├── generated-sources
│       │   └── annotations
│       ├── generated-test-sources
│       │   └── test-annotations
│       ├── jacoco.exec
│       ├── maven-archiver
│       │   └── pom.properties
│       ├── maven-status
│       │   └── maven-compiler-plugin
│       │       ├── compile
│       │       │   └── default-compile
│       │       │       ├── createdFiles.lst
│       │       │       └── inputFiles.lst
│       │       └── testCompile
│       │           └── default-testCompile
│       │               ├── createdFiles.lst
│       │               └── inputFiles.lst
│       ├── site
│       │   └── jacoco
│       │       ├── index.html
│       │       ├── jacoco-resources
│       │       │   ├── branchfc.gif
│       │       │   ├── branchnc.gif
│       │       │   ├── branchpc.gif
│       │       │   ├── bundle.gif
│       │       │   ├── class.gif
│       │       │   ├── down.gif
│       │       │   ├── greenbar.gif
│       │       │   ├── group.gif
│       │       │   ├── method.gif
│       │       │   ├── package.gif
│       │       │   ├── prettify.css
│       │       │   ├── prettify.js
│       │       │   ├── redbar.gif
│       │       │   ├── report.css
│       │       │   ├── report.gif
│       │       │   ├── session.gif
│       │       │   ├── sort.gif
│       │       │   ├── sort.js
│       │       │   ├── source.gif
│       │       │   └── up.gif
│       │       ├── jacoco-sessions.html
│       │       ├── jacoco.csv
│       │       ├── jacoco.xml
│       │       ├── org.lzw
│       │       │   ├── AspectJConfig.html
│       │       │   ├── AspectJConfig.java.html
│       │       │   ├── DebugAspect.html
│       │       │   ├── DebugAspect.java.html
│       │       │   ├── HelloController.html
│       │       │   ├── HelloController.java.html
│       │       │   ├── MainController.html
│       │       │   ├── MainController.java.html
│       │       │   ├── index.html
│       │       │   └── index.source.html
│       │       └── org.lzw.config
│       │           ├── RootConfig.html
│       │           ├── RootConfig.java.html
│       │           ├── WebConfig.html
│       │           ├── WebConfig.java.html
│       │           ├── index.html
│       │           └── index.source.html
│       ├── surefire-reports
│       │   ├── HelloControllerTest.txt
│       │   └── TEST-HelloControllerTest.xml
│       └── test-classes
│           └── HelloControllerTest.class
├── README.md
├── checks.xml
├── checkstyle-suppressions.xml
├── jetty.log
├── pom.xml
├── scripts
│   ├── constants.py
│   ├── pdf.py
│   ├── test.md
│   ├── test.py
│   ├── test_server.py
│   └── test_server2.py
└── tests
    ├── __init__.py
    ├── __pycache__
    │   ├── test_hello_endpoint.cpython-313.pyc
    │   ├── test_jetty.cpython-313.pyc
    │   └── test_playground_endpoints.cpython-313.pyc
    ├── test_hello_endpoint.py
    ├── test_jetty.py
    └── test_playground_endpoints.py

67 directories, 125 files

----

pom.xml

<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.lzw</groupId>
    <artifactId>PlaygroundLib</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>

    <name>PlaygroundLib - Parent</name>

    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <!-- Centralized versions -->
        <spring.version>5.3.39</spring.version>
        <junit.jupiter.version>5.13.1</junit.jupiter.version>
        <mockito.version>5.18.0</mockito.version>
        <hamcrest.version>2.2</hamcrest.version>
        <slf4j.version>1.7.36</slf4j.version>
        <logback.version>1.2.13</logback.version>
        <servlet.version>4.0.1</servlet.version>
        <commons.lang3.version>3.17.0</commons.lang3.version>
        <jackson.version>2.13.1</jackson.version>
        <spotless.version>2.30.0</spotless.version>
        <checkstyle.plugin.version>3.1.2</checkstyle.plugin.version>
        <checkstyle.version>9.3</checkstyle.version>
        <surefire.version>3.5.3</surefire.version>
        <jacoco.version>0.8.12</jacoco.version>
        <jetty.plugin.version>9.4.54.v20240208</jetty.plugin.version>
        <exec.plugin.version>3.5.1</exec.plugin.version>
        <war.plugin.version>3.4.0</war.plugin.version>
    </properties>

    <modules>
        <module>PlaygroundUtils</module>
        <module>PlaygroundWeb</module>
    </modules>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>${spring.version}</version>
            </dependency>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-web</artifactId>
                <version>${spring.version}</version>
            </dependency>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-webmvc</artifactId>
                <version>${spring.version}</version>
            </dependency>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-core</artifactId>
                <version>${spring.version}</version>
            </dependency>
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>${junit.jupiter.version}</version>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-engine</artifactId>
                <version>${junit.jupiter.version}</version>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.mockito</groupId>
                <artifactId>mockito-core</artifactId>
                <version>${mockito.version}</version>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-test</artifactId>
                <version>${spring.version}</version>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.hamcrest</groupId>
                <artifactId>hamcrest</artifactId>
                <version>${hamcrest.version}</version>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.slf4j</groupId>
                <artifactId>slf4j-api</artifactId>
                <version>${slf4j.version}</version>
            </dependency>
            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
                <version>${logback.version}</version>
            </dependency>
            <dependency>
                <groupId>javax.servlet</groupId>
                <artifactId>javax.servlet-api</artifactId>
                <version>${servlet.version}</version>
                <scope>provided</scope>
            </dependency>
            <dependency>
                <groupId>org.apache.commons</groupId>
                <artifactId>commons-lang3</artifactId>
                <version>${commons.lang3.version}</version>
            </dependency>
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
                <version>${jackson.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>com.diffplug.spotless</groupId>
                    <artifactId>spotless-maven-plugin</artifactId>
                    <version>${spotless.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-checkstyle-plugin</artifactId>
                    <version>${checkstyle.plugin.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>${surefire.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.jacoco</groupId>
                    <artifactId>jacoco-maven-plugin</artifactId>
                    <version>${jacoco.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.eclipse.jetty</groupId>
                    <artifactId>jetty-maven-plugin</artifactId>
                    <version>${jetty.plugin.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>exec-maven-plugin</artifactId>
                    <version>${exec.plugin.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-war-plugin</artifactId>
                    <version>${war.plugin.version}</version>
                </plugin>

                <!-- Keep pluginManagement minimal: only versions here -->
            </plugins>
        </pluginManagement>
        <!-- No plugin executions at parent; delegate to modules -->
    </build>

    

</project>


---

Playground pom.xml:

<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.lzw</groupId>
        <artifactId>PlaygroundLib</artifactId>
        <version>1.0</version>
    </parent>
    <artifactId>PlaygroundWeb</artifactId>
    <packaging>war</packaging>
    <name>PlaygroundWeb</name>

    <properties>
        <!-- Integration test JaCoCo exec lives directly under this module's target/ -->
        <jacoco.it.exec>${project.build.directory}/jacoco-it.exec</jacoco.it.exec>
        <!-- Control whether to skip IT report generation -->
        <it.report.skip>false</it.report.skip>
    </properties>

    <dependencies>
        <dependency>
            <groupId>com.lzw</groupId>
            <artifactId>PlaygroundUtils</artifactId>
            <version>${project.parent.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
        </dependency>
        <!-- Removed AspectJ runtime/weaver as AOP is not used -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-engine</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.mockito</groupId>
            <artifactId>mockito-core</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            
            <plugin>
                <groupId>com.diffplug.spotless</groupId>
                <artifactId>spotless-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>apply</goal>
                        </goals>
                        <phase>compile</phase>
                    </execution>
                </executions>
                <configuration>
                    <java>
                        <palantirJavaFormat />
                    </java>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-checkstyle-plugin</artifactId>
                <dependencies>
                    <dependency>
                        <groupId>com.puppycrawl.tools</groupId>
                        <artifactId>checkstyle</artifactId>
                        <version>${checkstyle.version}</version>
                    </dependency>
                </dependencies>
                <configuration>
                    <configLocation>${project.parent.basedir}/checks.xml</configLocation>
                    <suppressionsLocation>${project.parent.basedir}/checkstyle-suppressions.xml</suppressionsLocation>
                    <failOnViolation>true</failOnViolation>
                </configuration>
                <executions>
                    <execution>
                        <id>checkstyle-check</id>
                        <phase>compile</phase>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <configuration>
                    <failOnMissingWebXml>true</failOnMissingWebXml>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>


            <plugin>
                <groupId>org.jacoco</groupId>
                <artifactId>jacoco-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>prepare-agent</id>
                        <goals>
                            <goal>prepare-agent</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>report-it</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>report</goal>
                        </goals>
                        <configuration>
                            <!-- Generate a separate IT coverage report using the Jetty-attached agent data -->
                            <dataFile>${jacoco.it.exec}</dataFile>
                            <outputDirectory>${project.reporting.outputDirectory}/jacoco-it</outputDirectory>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!-- Run Jetty for integration tests using start (daemon) with JaCoCo agent -->
            <plugin>
                <groupId>org.eclipse.jetty</groupId>
                <artifactId>jetty-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <id>start-jetty</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>start</goal>
                        </goals>
                        <configuration>
                            <!-- Ensure Maven regains control immediately -->
                            <daemon>true</daemon>
                            <jvmArgs>
                                -javaagent:${settings.localRepository}/org/jacoco/org.jacoco.agent/${jacoco.version}/org.jacoco.agent-${jacoco.version}-runtime.jar=destfile=${jacoco.it.exec}
                            </jvmArgs>
                            <httpConnector>
                                <port>8080</port>
                                <host>127.0.0.1</host>
                            </httpConnector>
                            <webApp>
                                <contextPath>/</contextPath>
                            </webApp>
                            <stopHost>127.0.0.1</stopHost>
                            <stopPort>8081</stopPort>
                            <stopKey>stop</stopKey>
                        </configuration>
                    </execution>
                    <execution>
                        <id>stop-jetty</id>
                        <phase>post-integration-test</phase>
                        <goals>
                            <goal>stop</goal>
                        </goals>
                        <configuration>
                            <stopHost>127.0.0.1</stopHost>
                            <stopPort>8081</stopPort>
                            <stopKey>stop</stopKey>
                            <stopWait>15</stopWait>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!-- Execute Python-based integration tests against running Jetty -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <inherited>false</inherited>
                <executions>
                    <execution>
                        <id>python-integration-tests</id>
                        <phase>integration-test</phase>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                        <configuration>
                            <executable>python3</executable>
                            <!-- Python tests live at repository root -->
                            <workingDirectory>${project.parent.basedir}</workingDirectory>
                            <arguments>
                                <argument>-m</argument>
                                <argument>unittest</argument>
                                <argument>discover</argument>
                                <argument>tests/</argument>
                                <argument>-v</argument>
                            </arguments>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!-- JaCoCo report execution merged above to avoid duplicate plugin declaration -->
        </plugins>
    </build>


</project>


----

PlaygroundUtils pom.xml:

<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.lzw</groupId>
        <artifactId>PlaygroundLib</artifactId>
        <version>1.0</version>
    </parent>
    <artifactId>PlaygroundUtils</artifactId>
    <packaging>jar</packaging>
    <name>PlaygroundUtils</name>

    <properties>
        <!-- Module-specific JaCoCo IT exec file -->
        <jacoco.it.exec>${project.build.directory}/jacoco-it.exec</jacoco.it.exec>
        <!-- Control whether to skip IT report generation in this module -->
        <it.report.skip>true</it.report.skip>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>com.diffplug.spotless</groupId>
                <artifactId>spotless-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>apply</goal>
                        </goals>
                        <phase>compile</phase>
                    </execution>
                </executions>
                <configuration>
                    <java>
                        <palantirJavaFormat />
                    </java>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>

           
            <!-- Note: This is a pure library module. Do not run Jetty
                 or Python integration tests from here. Those are configured
                 in the PlaygroundWeb (WAR) module only. -->
        </plugins>
    </build>

    <!-- No module-specific profiles; keep modules simple -->
</project>

----

What I want to do is use Python’s `unittest` to test API endpoints, and then generate a coverage report for a Java Spring project.

What’s special here is that the Python test cases live outside the Java project. That means I need the Maven Exec Plugin to run them.

I also need to start Jetty and keep it running. This is a multi-module project.

At first, I tried using JaCoCo’s aggregate goal.

One issue was that I added the plugins in `PlaygroundLib`, but `PlaygroundLib` has no code or tests. Running the JaCoCo plugin there misses the class file structure.

JaCoCo aggregate doesn’t work well in this setup because the coverage is not from unit tests; it’s from external Python integration tests.

So I fell back to generating per-module JaCoCo reports.

I’ve successfully done this for one module before. The flow is fine: run `jacoco:prepare-agent`, attach the Java agent to the JVM that runs Jetty or WebSphere Liberty, run the Python integration tests, and then generate the coverage report. That part works.

However, there’s a problem with one module. For `PlaygroundUtils`, there’s no controller, so there’s no integration test when building that module. But its classes do appear in the JaCoCo `.exec` file. Because of that, I need to run `PlaygroundWeb` twice—once with the JaCoCo agent for that module’s exec, and once with the agent for `PlaygroundUtils`.

What do you think overall? What’s a good strategy here? Suppose I have a larger project with ten modules—how should I approach it? If handling all ten at once is too complex, we could start with one or two modules.

Also, JaCoCo is more complicated than tools like Checkstyle or Spotless because it isn’t self-contained: it depends on external Python integration tests, and it requires JaCoCo exec files and JVM agent attachment. That makes things more complex.

