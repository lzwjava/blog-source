---
layout: page
---

<select id="sort-select">
  <option value="date-desc" selected>Date Descending</option>
  <option value="date-asc">Date Ascending</option>
  <option value="title-asc">Title Ascending</option>
  <option value="title-desc">Title Descending</option>
  <option value="random">Random Order</option>
</select>

<ul class="post-list">
  <!-- Display pinned posts first -->
  {% for post in site.posts %}
  {% if post.pinned %}
  <li class="list-group-item post-item pinned-post">
    <a href="{{ post.url }}">
      <span class="date">{{ post.date | date: "%Y.%m.%d" }}</span>
      <span class="title">{{ post.title }}</span>
    </a>
  </li>
  {% endif %}
  {% endfor %}

  <!-- Display non-pinned posts -->
  {% for post in site.posts %}
  {% unless post.pinned %}
  <li class="list-group-item post-item">
    <a href="{{ post.url }}">
      <span class="date">{{ post.date | date: "%Y.%m.%d" }}</span>
      <span class="title">{{ post.title }}</span>
    </a>
  </li>
  {% endunless %}
  {% endfor %}
</ul>

<footer class="site-footer">
  <span class="site-footer-credits">Copyright©2010－{{ site.time | date: "%Y" }}</span>
</footer>

<script>
  window.addEventListener('load', function () {
    const pinnedPosts = document.querySelectorAll('.post-list li.post-item.pinned-post');
    const nonPinnedPosts = document.querySelectorAll('.post-list li.post-item:not(.pinned-post)');

    const postArray = Array.from(nonPinnedPosts).map(post => {
      const dateStr = post.querySelector('.date').textContent.replace(/\./g, '-');
      return {
        element: post,
        date: new Date(dateStr),
        title: post.querySelector('.title').textContent.toLowerCase()
      };
    });

    function sortPosts(sortOption) {
      switch (sortOption) {
        case 'date-desc':
          return postArray.sort((a, b) => b.date - a.date);
        case 'date-asc':
          return postArray.sort((a, b) => a.date - b.date);
        case 'title-asc':
          return postArray.sort((a, b) => a.title.localeCompare(b.title));
        case 'title-desc':
          return postArray.sort((a, b) => b.title.localeCompare(a.title));
        case 'random':
          return shuffle(postArray);
        default:
          return postArray.sort((a, b) => b.date - a.date);
      }
    }

    function shuffle(array) {
      let currentIndex = array.length, randomIndex;

      while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }

      return array;
    }

    function updatePostList(sortedPosts) {
      const postList = document.querySelector('.post-list');
      nonPinnedPosts.forEach(post => postList.removeChild(post));
      sortedPosts.forEach(post => postList.appendChild(post.element));
    }

    document.getElementById('sort-select').addEventListener('change', function () {
      const selectedSort = this.value;
      localStorage.setItem('sortOption', selectedSort);
      const sortedPosts = sortPosts(selectedSort);
      updatePostList(sortedPosts);
    });

    window.addEventListener('load', function () {
      const savedSort = localStorage.getItem('sortOption');
      if (savedSort) {
        document.getElementById('sort-select').value = savedSort;
      } else {
        document.getElementById('sort-select').value = 'date-desc';
      }
      const selectedSort = document.getElementById('sort-select').value;
      const sortedPosts = sortPosts(selectedSort);
      updatePostList(sortedPosts);
    });
  });
</script>