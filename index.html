---
layout: page
---

<select id="sort-select">
  <option value="date-desc|all" selected>Date Descending - All</option>
  <option value="date-desc|en">Date Descending - English</option>
  <option value="date-desc|zh">Date Descending - 中文</option>
  <option value="date-asc|all">Date Ascending - All</option>
  <option value="date-asc|en">Date Ascending - English</option>
  <option value="date-asc|zh">Date Ascending - 中文</option>
  <option value="random|all">Random Order - All</option>
  <option value="random|en">Random Order - English</option>
  <option value="random|zh">Random Order - 中文</option>
</select>

<ul class="post-list">
  <!-- Display pinned posts first -->
  {% for post in site.posts %}
  {% if post.pinned %}
  <li class="list-group-item post-item pinned-post lang-{{ post.lang }}">
    <a href="{{ post.url }}">
      <span class="date">{{ post.date | date: "%Y.%m.%d" }}</span>
      <span class="title">{{ post.title }}</span>
    </a>
  </li>
  {% endif %}
  {% endfor %}

  <!-- Display non-pinned posts -->
  {% for post in site.posts %}
  {% unless post.pinned %}
  <li class="list-group-item post-item lang-{{ post.lang }}">
    <a href="{{ post.url }}">
      <span class="date">{{ post.date | date: "%Y.%m.%d" }}</span>
      <span class="title">{{ post.title }}</span>
    </a>
  </li>
  {% endunless %}
  {% endfor %}
</ul>

<footer class="site-footer">
  <span class="site-footer-credits">Copyright©2010－{{ site.time | date: "%Y" }}</span>
</footer>

<script>
  window.addEventListener('load', function () {
    const sortSelect = document.getElementById('sort-select');

    function updatePosts() {
      const selectedValue = sortSelect.value;
      const [sortOption, langFilter] = selectedValue.split('|');

      // Select pinned and non-pinned posts
      const pinnedPosts = document.querySelectorAll('.post-list li.post-item.pinned-post');
      const nonPinnedPosts = document.querySelectorAll('.post-list li.post-item:not(.pinned-post)');

      // Filter non-pinned posts by language
      const filteredNonPinnedPosts = langFilter === 'all' ?
        Array.from(nonPinnedPosts) :
        Array.from(nonPinnedPosts).filter(post => post.classList.contains(`lang-${langFilter}`));

      // Create postArray for non-pinned posts
      const postArray = filteredNonPinnedPosts.map(post => {
        const dateStr = post.querySelector('.date').textContent.replace(/\./g, '-');
        return {
          element: post,
          date: new Date(dateStr),
          title: post.querySelector('.title').textContent.toLowerCase()
        };
      });

      // Sort non-pinned posts
      const sortedNonPinnedPosts = sortPosts(postArray, sortOption);

      // Combine pinned and sorted non-pinned posts
      const postList = document.querySelector('.post-list');
      postList.innerHTML = '';
      pinnedPosts.forEach(post => postList.appendChild(post));
      sortedNonPinnedPosts.forEach(post => postList.appendChild(post.element));
    }

    // Sorting function
    function sortPosts(posts, sortOption) {
      switch (sortOption) {
        case 'date-desc':
          return posts.sort((a, b) => b.date - a.date);
        case 'date-asc':
          return posts.sort((a, b) => a.date - b.date);
        case 'random':
          return shuffle(posts);
        default:
          return posts.sort((a, b) => b.date - a.date);
      }
    }

    // Shuffle function for random sorting
    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    // Event listener for select change
    sortSelect.addEventListener('change', function () {
      updatePosts();
      localStorage.setItem('sortOption', sortSelect.value);
    });

    // Restore selection from localStorage
    window.addEventListener('load', function () {
      const savedSort = localStorage.getItem('sortOption');
      if (savedSort) {
        sortSelect.value = savedSort;
      } else {
        sortSelect.value = 'date-desc|all';
      }
      updatePosts();
    });
  });
</script>