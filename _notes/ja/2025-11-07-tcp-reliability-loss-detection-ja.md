---
audio: false
generated: true
image: false
lang: ja
layout: post
model: moonshotai/kimi-k2-thinking
title: TCPの信頼性と損失検出
translated: true
---

このTCPの信頼性に関する議論を明確な概念に分解してみましょう：

## **1. パケットロスの検出**

TCPはデータの欠落を検出するために2つの主要なメカニズムを使用します：

- **タイムアウト**：パケットが送信されると単純なカウントダウンタイマーが開始します。タイマーが切れる前に応答確認（ACK）が到着しない場合、パケットはロストしたと宣言され再送信されます。これは「最後の手段」の検出方法です。

- **重複ACK（高速再送信）**：これはより洗練された方法です。受信側がパケットを*順不同*で受信すると、最後に正常に受信した*順序通りの*パケットに対するACKを送信し続けます。例えば：
  - パケット＃1、＃2を受信したが＃3が欠落している場合、後で＃4、＃5などを受信しても＃2に対するACKを送信し続けます
  - 同じシーケンス番号（この例では＃2）に対する**3回の重複ACK**は、パケット＃3が（単に遅延しているのではなく）おそらくロストしたことを示し、タイムアウトを待つよりもはるかに高速な*即時*再送信をトリガーします

## **2. 高RTTのパフォーマンスへの影響**

高い往復時間（RTT）が再送信に悪影響を及ぼすという指摘は正しいです：
- RTT = 200ms（例：大陸間通信）でパケットがロストした場合、タイムアウトによる検出には少なくとも200ms待つ必要があります
- この待機期間中、帯域幅はアイドル状態になり、スループットは急落し、接続は「もっさり」した感じになります
- 高速再送信はここで劇的に役立ち、検出時間を秒単位からミリ秒単位に短縮します

## **3. 適応型タイムアウト間隔**

TCPは固定のタイムアウト値を使用しません―ネットワーク状況をインテリジェントに追跡します：

- **RTT推定**：TCPは応答確認にかかる時間を継続的に測定します
- **動的タイムアウト**：再送信タイムアウト（RTO）は測定されたRTTに安全マージン（通常RTT + 4×偏差）を加えて計算されます
- **自己調整**：RTTが増加する（ネットワークの混雑、経路の延長）と、タイムアウトは*早期の*再送信を避けるために自動的に延長されます
- **不要な再送信の回避**：これがないと、TCPは単に遅延しているだけの完全に正常なパケットを再送信し、帯域幅を浪費し重複配信を引き起こす可能性があります

**要約**：TCPの信頼性は単なる再送信ではなく、待ち時間が長すぎたり性急に行動したりすることなく、*賢く*ロスを検出することにあります。