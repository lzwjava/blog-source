---
audio: false
generated: true
image: false
lang: hi
layout: post
model: moonshotai/kimi-k2-thinking
title: डीबी२ लेनदेन रोलबैक और त्रुटि पहचान
translated: true
---

## सिस्टम त्रुटियों के कारण जब DB2 रोलबैक करता है

IBM DB2 डेटा अखंडता को खतरे में डालने वाली गंभीर सिस्टम त्रुटियों का सामना करने पर स्वचालित रूप से लेन-देन को रोलबैक कर देता है। सामान्य परिदृश्यों में शामिल हैं:

- **डेडलॉक या टाइमआउट**: SQLCODE -911, SQLSTATE 40001, कारण कोड "2" डेडलॉक के कारण लेन-देन के रोलबैक होने का संकेत देता है
- **प्रक्रिया असामान्य समाप्ति (abend)**: सभी DB2 वातावरणों में, प्रक्रिया समाप्ति अंतर्निहित रोलबैक को ट्रिगर करती है
- **सिस्टम संसाधन विफलताएं**: मेमोरी, डिस्क, या नेटवर्क विफलताएं जो लेन-देन के पूरा होने से रोकती हैं
- **टाइमस्टैम्प संघर्ष**: SQLCODE -818 तब होता है जब आंतरिक टाइमस्टैम्प मॉड्यूल और DBRM के बीच मेल नहीं खाते
- **कनेक्शन पूलिंग सुरक्षा उपाय**: कुछ कार्यान्वयनों में लॉकिंग मुद्दों को रोकने के लिए जारी किए जाने पर अनकमिटेड लेन-देन से बचने के लिए कनेक्शन को स्वचालित रूप से रोलबैक कर दिया जाता है

## विस्तृत त्रुटि जानकारी का पता कैसे लगाएं

### 1. प्राथमिक त्रुटि पहचान तंत्र

**SQLCODE और SQLSTATE**
प्रत्येक SQL स्टेटमेंट के बाद, DB2 इन चरों को सेट करता है:

```sql
-- स्टेटमेंट निष्पादन के तुरंत बाद जांचें
IF SQLCODE < 0 THEN
    -- त्रुटि हुई
    ROLLBACK;
END IF;
```

SQLSTATE वर्ग कोड विशेष रूप से त्रुटि प्रकारों की पहचान करते हैं:
- **वर्ग 58**: सिस्टम त्रुटि (उदाहरण के लिए, संसाधन अनुपलब्ध, ऑपरेटर हस्तक्षेप)
- **वर्ग 40**: लेन-देन रोलबैक
- **वर्ग 25**: अमान्य लेन-देन स्थिति

**GET DIAGNOSTICS स्टेटमेंट**
SQL PL स्टोर्ड प्रोसीजर में विस्तृत त्रुटि जानकारी के लिए:

```sql
DECLARE v_sqlcode INTEGER;
DECLARE v_sqlstate CHAR(5);
DECLARE v_sqlmessage VARCHAR(256);

GET DIAGNOSTICS CONDITION 1
    v_sqlcode = DB2_RETURNED_SQLCODE,
    v_sqlstate = RETURNED_SQLSTATE,
    v_sqlmessage = MESSAGE_TEXT;
```

### 2. कमांड-लाइन त्रुटि पहचान

`db2` कमांड लाइन के माध्यम से स्क्रिप्ट निष्पादित करते समय, एग्जिट कोड जांचें:

- **एग्जिट कोड 8**: सिस्टम त्रुटि
- **एग्जिट कोड 4**: DB2 त्रुटि (कंस्ट्रेंट उल्लंघन, ऑब्जेक्ट नहीं मिला)
- **एग्जिट कोड 2**: DB2 चेतावनी
- **एग्जिट कोड 1**: कोई पंक्ति नहीं मिली

**अनुशंसित स्क्रिप्ट पैटर्न**:
```bash
db2 -l migration.log +c -stf migration.sql
if [ $? -ge 4 ]; then
    db2 rollback
    tail -10 migration.log  # विस्तृत त्रुटि की समीक्षा करें
else
    db2 commit
fi
```

### 3. स्टोर्ड प्रोसीजर त्रुटि हैंडलिंग

SQL PL में व्यापक त्रुटि पहचान के लिए, घोषित हैंडलर का उपयोग करें:

```sql
CREATE PROCEDURE my_procedure()
BEGIN
    DECLARE v_sqlcode INTEGER DEFAULT 0;
    DECLARE v_sqlstate CHAR(5) DEFAULT '00000';
    DECLARE v_error_message VARCHAR(256);
    
    -- किसी भी अपवाद के लिए एग्जिट हैंडलर घोषित करें
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        GET DIAGNOSTICS CONDITION 1
            v_sqlcode = DB2_RETURNED_SQLCODE,
            v_sqlstate = RETURNED_SQLSTATE,
            v_error_message = MESSAGE_TEXT;
            
        -- त्रुटि विवरण को टेबल या फ़ाइल में लॉग करें
        INSERT INTO error_log (sqlcode, sqlstate, message, timestamp)
        VALUES (v_sqlcode, v_sqlstate, v_error_message, CURRENT_TIMESTAMP);
        
        ROLLBACK;
    END;
    
    -- आपका लेन-देन तर्क यहां
    UPDATE employee SET salary = salary + 1000 WHERE job = 'MANAGER';
    INSERT INTO audit_log VALUES (CURRENT_TIMESTAMP, 'Salary update');
    
    COMMIT;
END
```

### 4. DB2 डायग्नोस्टिक लॉग फ़ाइलें

सिस्टम-स्तरीय त्रुटियों के लिए, हमेशा जांचें:

- **db2diag.log**: विस्तृत सिस्टम त्रुटि जानकारी के साथ प्राथमिक डायग्नोस्टिक लॉग
- **नोटिफिकेशन लॉग**: त्रुटि सारांश शामिल होते हैं
- **कमांड-लाइन लॉग**: त्रुटियों को कैप्चर करने के लिए `-l logfile.txt` विकल्प का उपयोग करें

## त्रुटि पहचान के लिए सर्वोत्तम अभ्यास

1. **महत्वपूर्ण ऑपरेशनों के तुरंत बाद हमेशा SQLCODE/SQLSTATE जांचें**
2. **स्टोर्ड प्रोसीजर में समृद्ध त्रुटि संदर्भ के लिए GET DIAGNOSTICS का उपयोग करें**
3. **लेन-देन रोलबैक प्रतिशत मॉनिटरिंग लागू करें** - 1% से अधिक कुछ भी जांच का warrents
4. **स्क्रिप्ट निष्पादन के लिए कमांड विकल्प सक्षम करें**:
   ```bash
   db2 +c -s -v -l error.log -f script.sql
   ```
   जहां `+c` ऑटोकमिट को अक्षम करता है और `-s` त्रुटि पर रुक जाता है
5. **जटिल लेन-देन के भीतर आंशिक रोलबैक के लिए सेवपॉइंट का उपयोग करें**
6. **नैदानिक जानकारी को संरक्षित करने के लिए रोलबैक से पहले त्रुटि विवरण को स्थायी टेबल में लॉग करें**

## निगरानी के लिए प्रमुख सिस्टम त्रुटि SQLSTATEs

| SQLSTATE | विवरण | कार्रवाई |
|----------|-------------|--------|
| **58004** | सिस्टम त्रुटि (विभिन्न कारण) | तुरंत db2diag.log जांचें |
| **58008** | संचार त्रुटि | नेटवर्क/कनेक्टिविटी सत्यापित करें |
| **HY000** | सामान्य ड्राइवर त्रुटि | ODBC/JDBC ड्राइवर लॉग जांचें  |
| **40001** | डेडलॉक/टाइमआउट | बैकऑफ़ के साथ लेन-देन पुनः प्रयास करें  |

प्रोडक्शन वातावरण के लिए, मॉनिटरिंग टूल्स को **SQLCODE < 0** और **वर्ग 58 SQLSTATEs** पर सतर्क करना चाहिए ताकि सिस्टम-स्तरीय मुद्दों का पता लगाया जा सके इससे पहले कि वे कैस्केड करें।