---
audio: false
generated: true
image: false
lang: hant
layout: post
model: moonshotai/kimi-k2-thinking
title: TCP可靠性與丟失檢測
translated: true
---

讓我來解析這個TCP可靠性對話的清晰概念：

## **1. 偵測遺失封包**

TCP使用兩種主要機制來發現遺失的數據：

- **逾時機制**：當封包發送時會啟動一個簡單的倒數計時器。如果在計時器到期前沒有收到確認（ACK），該封包就會被宣告遺失並重新傳輸。這是「最後手段」的偵測方法。

- **重複ACK（快速重傳）**：這是更精密的機制。當接收方收到*亂序*的封包時，它會持續發送最後成功接收的*順序*封包的ACK。例如：
  - 如果收到了封包#1、#2，但#3遺失了，即使後來收到#4、#5等封包，它仍會持續ACK#2
  - 對相同序號（在我們的例子中是#2）出現**三個重複ACK**時，表示封包#3很可能已遺失（不僅是延遲），從而觸發*立即*重傳——這比等待逾時要快得多

## **2. 高RTT對效能的影響**

你說得完全正確——高往返時間會讓重傳變得很痛苦：
- 如果RTT = 200ms（例如跨洲傳輸），且一個封包遺失，你至少需要等待200ms才能透過逾時機制發現
- 在等待期間，頻寬處於閒置狀態，吞吐量急遽下降，連線會感覺「遲緩」
- 快速重傳在這裡幫助很大，能將偵測時間從數秒縮短到毫秒級

## **3. 自適應逾時間隔**

TCP不使用固定的逾時值——它會智能地追蹤網路狀況：

- **RTT估算**：TCP持續測量確認返回所需的時間
- **動態逾時**：重傳逾時（RTO）是根據測量的RTT加上安全邊際來計算的（通常是RTT + 4×偏差值）
- **自我調適**：當RTT增加時（網路擁塞、路徑變長），逾時會自動延長以避免*過早*重傳
- **避免不必要的重傳**：若沒有這個機制，TCP可能會重新傳送只是稍微延遲但完好的封包，浪費頻寬並導致重複傳遞

**關鍵結論**：TCP的可靠性不僅僅是重新傳輸——它關乎*智能地*偵測遺失，既不會等待太久也不會過於倉促行動。